var JSON;JSON||(JSON={});
(function(){function d(a){return 10>a?"0"+a:a}function a(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=h[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(c,d){var f,h,q,s,m=e,r,l=d[c];l&&"object"===typeof l&&"function"===typeof l.toJSON&&(l=l.toJSON(c));"function"===typeof g&&(l=g.call(d,c,l));switch(typeof l){case "string":return a(l);case "number":return isFinite(l)?""+l:"null";case "boolean":case "null":return""+l;
case "object":if(!l)return"null";e+=i;r=[];if("[object Array]"===Object.prototype.toString.apply(l)){s=l.length;for(f=0;f<s;f+=1)r[f]=b(f,l)||"null";q=0===r.length?"[]":e?"[\n"+e+r.join(",\n"+e)+"\n"+m+"]":"["+r.join(",")+"]";e=m;return q}if(g&&"object"===typeof g){s=g.length;for(f=0;f<s;f+=1)"string"===typeof g[f]&&(h=g[f],(q=b(h,l))&&r.push(a(h)+(e?": ":":")+q))}else for(h in l)Object.prototype.hasOwnProperty.call(l,h)&&(q=b(h,l))&&r.push(a(h)+(e?": ":":")+q);q=0===r.length?"{}":e?"{\n"+e+r.join(",\n"+
e)+"\n"+m+"}":"{"+r.join(",")+"}";e=m;return q}}if("function"!==typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+d(this.getUTCMonth()+1)+"-"+d(this.getUTCDate())+"T"+d(this.getUTCHours())+":"+d(this.getUTCMinutes())+":"+d(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,i,h={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g;if("function"!==typeof JSON.stringify)JSON.stringify=function(a,c,d){var f;i=e="";if("number"===typeof d)for(f=0;f<d;f+=1)i+=" ";else"string"===typeof d&&(i=d);if((g=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return b("",
{"":a})};if("function"!==typeof JSON.parse)JSON.parse=function(a,b){function d(a,c){var f,g,e=a[c];if(e&&"object"===typeof e)for(f in e)Object.prototype.hasOwnProperty.call(e,f)&&(g=d(e,f),void 0!==g?e[f]=g:delete e[f]);return b.call(a,c,e)}var f,a=""+a;c.lastIndex=0;c.test(a)&&(a=a.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),"function"===typeof b?d({"":f},""):f;throw new SyntaxError("JSON.parse");}})();(function(d){function a(a,b,c){var f,c=c||"",e=c.match(RegExp("(?:^|\\s|;)("+a+")\\s*:\\s*([^;]*(?:;|$))","i"));e&&(e[0]=e[0].replace(/^;/,""));null===b?f="":"string"===typeof b&&(f=a+":"+b+" !important;");e?("boolean"===typeof b&&(f=d.important(a+":"+e[2],b)),c=c.replace(e[0],f)):"undefined"!==typeof f&&(c=d.trim(c),""!==c&&(";"!==c.slice(-1)&&(c+=";"),c+=" "),c+=f);return c}function b(a,c){var d=b.re;if(!d)d=b.re=/\s*(! ?important)?[\s\r\t\n]*;/g;return!1===c?a.replace(d,";"):a.replace(d,function(a,
c){return c?a:" !important;"})}function c(a,d){var f=c.re;if(!f)f=c.re=/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g;return a.replace(f,function(a,c){return b(c,d)})}var f=!1,e={},i={},h=d.each({css:function(c,b){var f={},h=d(this),i=h.attr("style");if("string"===typeof c){if("undefined"===typeof b)return e.css.apply(this,arguments);f[c]=b}else if("object"===typeof c)f=c;else return h;d.each(f,function(c,b){i=a(c,b,i)});return h.attr("style",i)}},function(a,c){e[a]=d.fn[a];c.overridden=!0;i[a]=function(){var b=
d.makeArray(arguments),h=b[b.length-1],i=d(this);return!0===h?c.apply(i,b.slice(0,-1)):f&&!1!==h?c.apply(i,b):e[a].apply(i,b)}});d.extend(d.fn,i);d.important=d.extend(function(){var a=d.makeArray(arguments),e;if("string"===typeof a[0]){if("undefined"===typeof a[1]||"boolean"===typeof a[1])return e=!1!==a[1],/<\w+.*>/.test(a[0])?c(a[0],e):b(a[0],e)}else if(d.isFunction(a[0]))e=f,d.important.status=f=!0,a[0].call(this),d.important.status=f=e;else if("undefined"===typeof a[0]||"boolean"===typeof a[0])d.important.status=
f=!1!==a[0];return f},{status:f,noConflict:function(){d.each(e,function(a,c){d.fn[a]=c});return h},declaration:a});d.fn.important=function(c){var f=d(this),e=d.makeArray(arguments).concat(!0),h=f.data("nodeName"),p;if("undefined"===typeof c||"boolean"===typeof c)h||(h=f.attr("nodeName").toLowerCase(),f.data("nodeName",h)),"style"===h?(p=!1!==c,f.html(b(f.html(),p)),e=f.attr("sheet"),_("stylesheet",e),e&&e.cssRules&&(_("cssRules",e.cssRules),d.each(e.cssRules,function(a,c){_("rule",c,c.cssText);_(d.important(c.style.cssText,
p));if(c.type===CSSRule.STYLE_RULE)c.style.cssText=d.important(c.style.cssText,p)}))):f.attr("style",d.important(f.attr("style"),c));else{if("object"===typeof c)return e.unshift("css"),f.important.apply(this,e);if("string"===typeof c)if(d.isFunction(i[c]))e=e.slice(1),i[c].apply(f,e);else{if("undefined"===typeof e[1]||"boolean"===typeof e[1])p=!1!==e[1],f.attr("style",a(c,p,f.attr("style")))}else d.isFunction(c)&&d.important.call(this,c)}return f}})(jQuery);(function(d){var a=function(a){var b=a.data("scrollbarPaper")||a.data("scrollbar-paper"),d=a.innerHeight(),i=d-a.height();return{height:d,ratio:d/(b.clearer.position().top-((b.content.children(":visible").eq(0).position()||{}).top||0)+i),offset:a.offset()}},b={_init:function(c){c=d.extend({parentSelector:"",css:d.css,show:function(a){a.show()},hide:function(a){a.hide()}},c);return this.each(function(){var b=d(this),e=b.data("scrollbarPaper")||b.data("scrollbar-paper");if(!e){c.css.apply(b,[{"overflow-x":"hidden",
"overflow-y":"auto"},!0]);e=b.closest(c.parentSelector);e.length||(e=b.offsetParent());var i=d('<div class="scrollbarpaper-container"></div>').appendTo(e);c.hide(i);var h=d('<div class="scrollbarpaper-track"></div>').appendTo(i),g=d('<div class="scrollbarpaper-drag"></div>').appendTo(h),e={options:c,offsetParent:e,paper:i,track:h,drag:g,dragTop:d('<div class="scrollbarpaper-drag-top"></div>').appendTo(g),dragBottom:d('<div class="scrollbarpaper-drag-bottom"></div>').appendTo(g),content:b,clearer:d('<div style="clear:both;"></div>').appendTo(b),
offsetHeight:h.outerHeight()-h.height()};b.data("scrollbarPaper",e).data("scrollbar-paper",e);var j=a(b),o=setInterval(function(){if(b.closest(c.parentSelector).length){if(b.is(":visible")){var d=a(b);if(d.height!=j.height||d.ratio!=j.ratio||d.offset.left!=j.offset.left||d.offset.top!=j.offset.top)b.scrollbarPaper("update"),j=d}}else clearInterval(o),i.remove(),b.removeData("scrollbarPaper").removeData("scrollbar-paper")},250)}b.scrollbarPaper("update")})},update:function(c){return this.each(function(){var b=
d(this);if(b.is(":visible")&&!b.data("scrollbarpaperfrozen")){var e=b.data("scrollbarPaper")||b.data("scrollbar-paper");c=c||a(b);b.unbind(".scrollbarPaper");var i=b.innerHeight()-e.offsetHeight;e.options.css.apply(e.track,[{height:i+"px"},!0]);var h=0<e.offsetParent.not("html, body").length?e.offsetParent.offset():{left:0,top:0};e.options.css.apply(e.paper,[{left:-h.left+c.offset.left+b.innerWidth()-e.paper.width()+"px",top:-h.top+c.offset.top+"px"},!0]);var g=Math.max(Math.round(i*c.ratio),e.dragTop.height()+
e.dragBottom.height());e.options.css.apply(e.drag,[{height:g+"px"},!0]);h=function(){e.options.css.apply(e.drag,[{top:Math.min(Math.round(b.scrollTop()*c.ratio),i-g)+"px"},!0])};h();b.bind("scroll.scrollbarPaper",h);var j=function(a){return a.pageY||(a.originalEvent&&(a.originalEvent.targetTouches||a.originalEvent.touches||[])[0]||a).pageY},o=function(){d("body").unbind("mousemove.scrollbarPaper touchmove.scrollbarPaper")};e.drag.bind("mousedown.scrollbarPaper touchstart.scrollbarPaper",function(a){o();
var h=j(a)-e.drag.offset().top;d("body").bind("mousemove.scrollbarPaper touchmove.scrollbarPaper",function(a){a.preventDefault();b.scrollTop((j(a)-b.offset().top-h)/c.ratio);return!1}).bind("mouseup.scrollbarPaper touchend.scrollbarPaper",o);return!1});1>c.ratio?(e.options.show(e.drag),e.content.addClass("scrollbarpaper-visible")):(e.options.hide(e.drag),e.content.removeClass("scrollbarpaper-visible"))}})},show:function(){return this.each(function(){var a=d(this),b=a.data("scrollbarPaper")||a.data("scrollbar-paper");
b&&(a.scrollbarPaper("update"),"function"==typeof b.options.show?b.options.show(b.paper):b.paper.show())})},hide:function(){return this.each(function(){var a=d(this);(a=a.data("scrollbarPaper")||a.data("scrollbar-paper"))&&("function"==typeof a.options.hide?a.options.hide(a.paper):a.paper.hide())})},freeze:function(){return this.each(function(){d(this).data("scrollbarpaperfrozen",!0)})},thaw:function(){return this.each(function(){d(this).data("scrollbarpaperfrozen",!1)})}};d.fn.scrollbarPaper=function(a){if(b[a])return b[a].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return b._init.apply(this,arguments);throw"Method "+a+" does not exist on jQuery.scrollbarPaper.";}})(jQuery);(function(d,a,b){function c(a){return a}function f(a){return decodeURIComponent(a.replace(e," "))}var e=/\+/g,i=d.cookie=function(e,g,j){if(g!==b){j=d.extend({},i.defaults,j);if(null===g)j.expires=-1;if("number"===typeof j.expires){var o=j.expires,n=j.expires=new Date;n.setDate(n.getDate()+o)}g=i.json?JSON.stringify(g):""+g;return a.cookie=[encodeURIComponent(e),"=",i.raw?g:encodeURIComponent(g),j.expires?"; expires="+j.expires.toUTCString():"",j.path?"; path="+j.path:"",j.domain?"; domain="+j.domain:
"",j.secure?"; secure":""].join("")}g=i.raw?c:f;j=a.cookie.split("; ");o=0;for(n=j.length;o<n;o++){var p=j[o].split("=");if(g(p.shift())===e)return e=g(p.join("=")),i.json?JSON.parse(e):e}return null};i.defaults={};d.removeCookie=function(a,b){return null!==d.cookie(a)?(d.cookie(a,null,b),!0):!1}})(jQuery,document);jQuery.cookie.json=!0;(function(d,a){"object"===typeof exports&&"function"===typeof require?module.exports=a(require("underscore"),require("backbone")):"function"===typeof define&&define.amd?define(["underscore","backbone"],function(b,c){return a(b||d._,c||d.Backbone)}):a(_,Backbone)})(this,function(d,a){function b(){return(65536*(1+Math.random())|0).toString(16).substring(1)}a.LocalStorage=window.Store=function(a){if(!this.localStorage)throw"Backbone.localStorage: Environment does not support localStorage.";this.name=
a;this.records=(a=this.localStorage().getItem(this.name))&&a.split(",")||[]};d.extend(a.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(a){if(!a.id)a.id=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b(),a.set(a.idAttribute,a.id);this.localStorage().setItem(this.name+"-"+a.id,JSON.stringify(a));this.records.push(a.id.toString());this.save();return this.find(a)},update:function(a){this.localStorage().setItem(this.name+"-"+a.id,JSON.stringify(a));
d.include(this.records,a.id.toString())||this.records.push(a.id.toString());this.save();return this.find(a)},find:function(a){return this.jsonData(this.localStorage().getItem(this.name+"-"+a.id))},findAll:function(){return(d.chain||d)(this.records).map(function(a){return this.jsonData(this.localStorage().getItem(this.name+"-"+a))},this).compact().value()},destroy:function(a){if(a.isNew())return!1;this.localStorage().removeItem(this.name+"-"+a.id);this.records=d.reject(this.records,function(b){return b===
a.id.toString()});this.save();return a},localStorage:function(){return localStorage},jsonData:function(a){return a&&JSON.parse(a)},_clear:function(){var a=this.localStorage(),b=RegExp("^"+this.name+"-");a.removeItem(this.name);(d.chain||d)(a).keys().filter(function(a){return b.test(a)}).each(function(b){a.removeItem(b)});this.records.length=0},_storageSize:function(){return this.localStorage().length}});a.LocalStorage.sync=window.Store.sync=a.localSync=function(b,d,e){var i=d.localStorage||d.collection.localStorage,
h,g,j=a.$&&a.$.Deferred&&a.$.Deferred();try{switch(b){case "read":h=void 0!=d.id?i.find(d):i.findAll();break;case "create":h=i.create(d);break;case "update":h=i.update(d);break;case "delete":h=i.destroy(d)}}catch(o){g=22===o.code&&0===i._storageSize()?"Private browsing is unsupported":o.message}h?(e&&e.success&&("0.9.10"===a.VERSION?e.success(d,h,e):e.success(h)),j&&j.resolve(h)):(g=g?g:"Record Not Found",e&&e.error&&("0.9.10"===a.VERSION?e.error(d,g,e):e.error(g)),j&&j.reject(g));e&&e.complete&&
e.complete(h);return j&&j.promise()};a.ajaxSync=a.sync;a.getSyncMethod=function(b){return b.localStorage||b.collection&&b.collection.localStorage?a.localSync:a.ajaxSync};a.sync=function(b,d,e){return a.getSyncMethod(d).apply(this,[b,d,e])};return a.LocalStorage});(function(){if(!window.Modernizr)window.Modernizr=function(d,a,b){function c(a,b){var d=a.charAt(0).toUpperCase()+a.substr(1),d=(a+" "+j.join(d+" ")+d).split(" ");return f(d,b)}function f(a,d){for(var c in a)if(g[a[c]]!==b)return"pfx"==d?a[c]:!0;return!1}var e={},i=a.documentElement;a.head||a.getElementsByTagName("head");var h=a.createElement("modernizr"),g=h.style,d=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),j="Webkit Moz O ms Khtml".split(" "),h={},o=[],n=function(b,d,c,e){var f,h,g=a.createElement("div");
if(parseInt(c,10))for(;c--;)h=a.createElement("div"),h.id=e?e[c]:"modernizr"+(c+1),g.appendChild(h);f=["&shy;<style>",b,"</style>"].join("");g.id="modernizr";g.innerHTML+=f;i.appendChild(g);b=d(g,b);g.parentNode.removeChild(g);return!!b},p,q={}.hasOwnProperty,s;typeof q!==b&&typeof q.call!==b?s=function(a,b){return q.call(a,b)}:s=function(a,d){return d in a&&typeof a.constructor.prototype[d]===b};(function(a,b){var d=a.join(""),c=b.length;n(d,function(a){for(var a=a.childNodes,b={};c--;)b[a[c].id]=
a[c];e.csstransforms3d=9===b.csstransforms3d.offsetLeft},c,b)})([,["@media (",d.join("transform-3d),("),"modernizr){#csstransforms3d{left:9px;position:absolute}}"].join("")],[,"csstransforms3d"]);h.csstransforms=function(){return!!f(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])};h.csstransforms3d=function(){var a=!!f(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);a&&"webkitPerspective"in i.style&&(a=e.csstransforms3d);
return a};h.csstransitions=function(){return c("transitionProperty")};for(var m in h)s(h,m)&&(p=m.toLowerCase(),e[p]=h[m](),o.push((e[p]?"":"no-")+p));g.cssText="";h=null;e._version="2.0.6";e._prefixes=d;e._domPrefixes=j;e.testProp=function(a){return f([a])};e.testAllProps=c;e.testStyles=n;return e}(this,this.document)})();(function(d,a,b,c,f,e){function i(a,b){var d=typeof a[b];return"function"==d||!!("object"==d&&a[b])||"unknown"==d}function h(){if(!s(navigator.plugins)&&"object"==typeof navigator.plugins["Shockwave Flash"]){var a=navigator.plugins["Shockwave Flash"].description;a&&!s(navigator.mimeTypes)&&navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(A=a.match(/\d+/g))}if(!A){var b;try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),
A=Array.prototype.slice.call(b.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1)}catch(d){}}if(!A)return!1;a=parseInt(A[0],10);b=parseInt(A[1],10);M=9<a&&0<b;return!0}function g(){if(!B){B=!0;for(var a=0;a<H.length;a++)H[a]();H.length=0}}function j(a,b){B?a.call(b):H.push(function(){a.call(b)})}function o(){var a=parent;if(""!==E)for(var b=0,d=E.split(".");b<d.length;b++)a=a[d[b]];return a.easyXDM}function n(a){var b=a.toLowerCase().match(I),a=b[2],d=b[3],b=b[4]||"";if("http:"==a&&":80"==
b||"https:"==a&&":443"==b)b="";return a+"//"+d+b}function p(a){a=a.replace(V,"$1/");if(!a.match(/^(http||https):\/\//)){var d="/"===a.substring(0,1)?"":b.pathname;"/"!==d.substring(d.length-1)&&(d=d.substring(0,d.lastIndexOf("/")+1));a=b.protocol+"//"+b.host+d+a}for(;Q.test(a);)a=a.replace(Q,"");return a}function q(a,b){var d="",c=a.indexOf("#");-1!==c&&(d=a.substring(c),a=a.substring(0,c));var c=[],f;for(f in b)b.hasOwnProperty(f)&&c.push(f+"="+e(b[f]));return a+(R?"#":-1==a.indexOf("?")?"?":"&")+
c.join("&")+d}function s(a){return"undefined"===typeof a}function m(a,b,d){var c,e;for(e in b)b.hasOwnProperty(e)&&(e in a?(c=b[e],"object"===typeof c?m(a[e],c,d):d||(a[e]=b[e])):a[e]=b[e]);return a}function r(b){if(s(J)){var d=a.body.appendChild(a.createElement("form")),c=d.appendChild(a.createElement("input"));c.name=v+"TEST"+P;J=c!==d.elements[c.name];a.body.removeChild(d)}J?d=a.createElement('<iframe name="'+b.props.name+'"/>'):(d=a.createElement("IFRAME"),d.name=b.props.name);d.id=d.name=b.props.name;
delete b.props.name;if("string"==typeof b.container)b.container=a.getElementById(b.container);if(!b.container)m(d.style,{position:"absolute",top:"-2000px",left:"0px"}),b.container=a.body;c=b.props.src;b.props.src="javascript:false";m(d,b.props);d.border=d.frameBorder=0;d.allowTransparency=!0;b.container.appendChild(d);b.onLoad&&w(d,"load",b.onLoad);if(b.usePost){var e=b.container.appendChild(a.createElement("form")),f;e.target=d.name;e.action=c;e.method="POST";if("object"===typeof b.usePost)for(var h in b.usePost)if(b.usePost.hasOwnProperty(h))J?
f=a.createElement('<input name="'+h+'"/>'):(f=a.createElement("INPUT"),f.name=h),f.value=b.usePost[h],e.appendChild(f);e.submit();e.parentNode.removeChild(e)}else d.src=c;b.props.src=c;return d}function l(c){var e=c.protocol,f;c.isHost=c.isHost||s(u.xdm_p);R=c.hash||!1;if(!c.props)c.props={};if(c.isHost)c.remote=p(c.remote),c.channel=c.channel||"default"+P++,c.secret=Math.random().toString(16).substring(2),s(e)&&(e=n(b.href)==n(c.remote)?"4":i(d,"postMessage")||i(a,"postMessage")?"1":c.swf&&i(d,"ActiveXObject")&&
h()?"6":"Gecko"===navigator.product&&"frameElement"in d&&-1==navigator.userAgent.indexOf("WebKit")?"5":c.remoteHelper?"2":"0");else{c.channel=u.xdm_c.replace(/["'<>\\]/g,"");c.secret=u.xdm_s;c.remote=u.xdm_e.replace(/["'<>\\]/g,"");var e=u.xdm_p,g;if(g=c.acl){a:{g=c.acl;var j=c.remote;"string"==typeof g&&(g=[g]);for(var x,y=g.length;y--;)if(x=g[y],x=RegExp("^"==x.substr(0,1)?x:"^"+x.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),x.test(j)){g=!0;break a}g=!1}g=!g}if(g)throw Error("Access denied for "+
c.remote);}c.protocol=e;switch(e){case "0":m(c,{interval:100,delay:2E3,useResize:!0,useParent:!1,usePolling:!1},!0);if(c.isHost){if(!c.local){e=b.protocol+"//"+b.host;f=a.body.getElementsByTagName("img");for(j=f.length;j--;)if(g=f[j],g.src.substring(0,e.length)===e){c.local=g.src;break}if(!c.local)c.local=d}e={xdm_c:c.channel,xdm_p:0};c.local===d?(c.usePolling=!0,c.useParent=!0,c.local=b.protocol+"//"+b.host+b.pathname+b.search,e.xdm_e=c.local,e.xdm_pa=1):e.xdm_e=p(c.local);if(c.container)c.useResize=
!1,e.xdm_po=1;c.remote=q(c.remote,e)}else m(c,{channel:u.xdm_c,remote:u.xdm_e,useParent:!s(u.xdm_pa),usePolling:!s(u.xdm_po),useResize:c.useParent?!1:c.useResize});f=[new k.stack.HashTransport(c),new k.stack.ReliableBehavior({}),new k.stack.QueueBehavior({encode:!0,maxLength:4E3-c.remote.length}),new k.stack.VerifyBehavior({initiate:c.isHost})];break;case "1":f=[new k.stack.PostMessageTransport(c)];break;case "2":if(c.isHost)c.remoteHelper=p(c.remoteHelper);f=[new k.stack.NameTransport(c),new k.stack.QueueBehavior,
new k.stack.VerifyBehavior({initiate:c.isHost})];break;case "3":f=[new k.stack.NixTransport(c)];break;case "4":f=[new k.stack.SameOriginTransport(c)];break;case "5":f=[new k.stack.FrameElementTransport(c)];break;case "6":A||h(),f=[new k.stack.FlashTransport(c)]}f.push(new k.stack.QueueBehavior({lazy:c.lazy,remove:!0}));return f}function O(a){for(var b,c={incoming:function(a,b){this.up.incoming(a,b)},outgoing:function(a,b){this.down.outgoing(a,b)},callback:function(a){this.up.callback(a)},init:function(){this.down.init()},
destroy:function(){this.down.destroy()}},d=0,e=a.length;d<e;d++){b=a[d];m(b,c,!0);if(0!==d)b.down=a[d-1];if(d!==e-1)b.up=a[d+1]}return b}function U(a){a.up.down=a.down;a.down.up=a.up;a.up=a.down=null}var G=this,P=Math.floor(1E4*Math.random()),L=Function.prototype,I=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,Q=/[\-\w]+\/\.\.\//,V=/([^:])\/\//g,E="",k={},W=d.easyXDM,v="easyXDM_",J,R=!1,A,M,w,C;if(i(d,"addEventListener"))w=function(a,b,c){a.addEventListener(b,c,!1)},C=function(a,b,c){a.removeEventListener(b,
c,!1)};else if(i(d,"attachEvent"))w=function(a,b,c){a.attachEvent("on"+b,c)},C=function(a,b,c){a.detachEvent("on"+b,c)};else throw Error("Browser not supported");var B=!1,H=[],K;"readyState"in a?(K=a.readyState,B="complete"==K||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==K||"interactive"==K)):B=!!a.body;if(!B){if(i(d,"addEventListener"))w(a,"DOMContentLoaded",g);else if(w(a,"readystatechange",function(){"complete"==a.readyState&&g()}),a.documentElement.doScroll&&d===top){var S=function(){if(!B){try{a.documentElement.doScroll("left")}catch(b){c(S,
1);return}g()}};S()}w(d,"load",g)}var u=function(a){for(var a=a.substring(1).split("&"),b={},c,d=a.length;d--;)c=a[d].split("="),b[c[0]]=f(c[1]);return b}(/xdm_e=/.test(b.search)?b.search:b.hash),N=function(){var a={},b={a:[1,2,3]};if("undefined"!=typeof JSON&&"function"===typeof JSON.stringify&&'{"a":[1,2,3]}'===JSON.stringify(b).replace(/\s/g,""))return JSON;if(Object.toJSON&&'{"a":[1,2,3]}'===Object.toJSON(b).replace(/\s/g,""))a.stringify=Object.toJSON;if("function"===typeof String.prototype.evalJSON&&
(b='{"a":[1,2,3]}'.evalJSON(),b.a&&3===b.a.length&&3===b.a[2]))a.parse=function(a){return a.evalJSON()};return a.stringify&&a.parse?(N=function(){return a},a):null};m(k,{version:"2.4.18.25",query:u,stack:{},apply:m,getJSONObject:N,whenReady:j,noConflict:function(a){d.easyXDM=W;(E=a)&&(v="easyXDM_"+E.replace(".","_")+"_");return k}});k.DomHelper={on:w,un:C,requiresJSON:function(b){"object"==typeof d.JSON&&d.JSON||a.write('<script type="text/javascript" src="'+b+'"><\/script>')}};(function(){var a=
{};k.Fn={set:function(b,c){a[b]=c},get:function(b,c){var d=a[b];c&&delete a[b];return d}}})();k.Socket=function(a){var b=O(l(a).concat([{incoming:function(b,c){a.onMessage(b,c)},callback:function(b){if(a.onReady)a.onReady(b)}}])),c=n(a.remote);this.origin=n(a.remote);this.destroy=function(){b.destroy()};this.postMessage=function(a){b.outgoing(a,c)};b.init()};k.Rpc=function(a,b){if(b.local)for(var c in b.local)if(b.local.hasOwnProperty(c)){var d=b.local[c];"function"===typeof d&&(b.local[c]={method:d})}var e=
O(l(a).concat([new k.stack.RpcBehavior(this,b),{callback:function(b){if(a.onReady)a.onReady(b)}}]));this.origin=n(a.remote);this.destroy=function(){e.destroy()};e.init()};k.stack.SameOriginTransport=function(a){var d,e,f,g;return d={outgoing:function(a,b,c){f(a);c&&c()},destroy:function(){e&&(e.parentNode.removeChild(e),e=null)},onDOMReady:function(){g=n(a.remote);a.isHost?(m(a.props,{src:q(a.remote,{xdm_e:b.protocol+"//"+b.host+b.pathname,xdm_c:a.channel,xdm_p:4}),name:v+a.channel+"_provider"}),
e=r(a),k.Fn.set(a.channel,function(a){f=a;c(function(){d.up.callback(!0)},0);return function(a){d.up.incoming(a,g)}})):(f=o().Fn.get(a.channel,!0)(function(a){d.up.incoming(a,g)}),c(function(){d.up.callback(!0)},0))},init:function(){j(d.onDOMReady,d)}}};k.stack.FlashTransport=function(d){function f(a){c(function(){h.up.incoming(a,x)},0)}function g(b){var c=d.swf+"?host="+d.isHost,f="easyXDM_swf_"+Math.floor(1E4*Math.random());k.Fn.set("flash_loaded"+b.replace(/[\-.]/g,"_"),function(){k.stack.FlashTransport[b].swf=
y=D.firstChild;for(var a=k.stack.FlashTransport[b].queue,c=0;c<a.length;c++)a[c]();a.length=0});d.swfContainer?D="string"==typeof d.swfContainer?a.getElementById(d.swfContainer):d.swfContainer:(D=a.createElement("div"),m(D.style,M&&d.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),a.body.appendChild(D));var h="callback=flash_loaded"+e(b.replace(/[\-.]/g,"_"))+"&proto="+G.location.protocol+"&domain="+
e(G.location.href.match(I)[3])+"&port="+e(G.location.href.match(I)[4]||"")+"&ns="+e(E);D.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+f+"' data='"+c+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+c+"'></param><param name='flashvars' value='"+h+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+h+"' allowScriptAccess='always' wmode='transparent' src='"+c+"' height='1' width='1'></embed></object>"}
var h,i,x,y,D;return h={outgoing:function(a,b,c){y.postMessage(d.channel,a.toString());c&&c()},destroy:function(){try{y.destroyChannel(d.channel)}catch(a){}y=null;i&&(i.parentNode.removeChild(i),i=null)},onDOMReady:function(){x=d.remote;k.Fn.set("flash_"+d.channel+"_init",function(){c(function(){h.up.callback(!0)})});k.Fn.set("flash_"+d.channel+"_onMessage",f);d.swf=p(d.swf);var a=d.swf.match(I)[3],e=function(){k.stack.FlashTransport[a].init=!0;y=k.stack.FlashTransport[a].swf;y.createChannel(d.channel,
d.secret,n(d.remote),d.isHost);d.isHost&&(M&&d.swfNoThrottle&&m(d.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),m(d.props,{src:q(d.remote,{xdm_e:n(b.href),xdm_c:d.channel,xdm_p:6,xdm_s:d.secret}),name:v+d.channel+"_provider"}),i=r(d))};k.stack.FlashTransport[a]&&k.stack.FlashTransport[a].init?e():k.stack.FlashTransport[a]?k.stack.FlashTransport[a].queue.push(e):(k.stack.FlashTransport[a]={queue:[e]},g(a))},init:function(){j(h.onDOMReady,h)}}};k.stack.PostMessageTransport=function(a){function e(c){var d;
if(c.origin)d=n(c.origin);else if(c.uri)d=n(c.uri);else if(c.domain)d=b.protocol+"//"+c.domain;else throw"Unable to retrieve the origin of the event";d==i&&c.data.substring(0,a.channel.length+1)==a.channel+" "&&f.up.incoming(c.data.substring(a.channel.length+1),d)}var f,g,h,i;return f={outgoing:function(b,c,d){h.postMessage(a.channel+" "+b,c||i);d&&d()},destroy:function(){C(d,"message",e);g&&(h=null,g.parentNode.removeChild(g),g=null)},onDOMReady:function(){i=n(a.remote);if(a.isHost){var j=function(b){b.data==
a.channel+"-ready"&&(h="postMessage"in g.contentWindow?g.contentWindow:g.contentWindow.document,C(d,"message",j),w(d,"message",e),c(function(){f.up.callback(!0)},0))};w(d,"message",j);m(a.props,{src:q(a.remote,{xdm_e:n(b.href),xdm_c:a.channel,xdm_p:1}),name:v+a.channel+"_provider"});g=r(a)}else w(d,"message",e),h="postMessage"in d.parent?d.parent:d.parent.document,h.postMessage(a.channel+"-ready",i),c(function(){f.up.callback(!0)},0)},init:function(){j(f.onDOMReady,f)}}};k.stack.FrameElementTransport=
function(e){var f,g,h,i;return f={outgoing:function(a,b,c){h.call(this,a);c&&c()},destroy:function(){g&&(g.parentNode.removeChild(g),g=null)},onDOMReady:function(){i=n(e.remote);if(e.isHost)m(e.props,{src:q(e.remote,{xdm_e:n(b.href),xdm_c:e.channel,xdm_p:5}),name:v+e.channel+"_provider"}),g=r(e),g.fn=function(a){delete g.fn;h=a;c(function(){f.up.callback(!0)},0);return function(a){f.up.incoming(a,i)}};else{if(a.referrer&&n(a.referrer)!=u.xdm_e)d.top.location=u.xdm_e;h=d.frameElement.fn(function(a){f.up.incoming(a,
i)});f.up.callback(!0)}},init:function(){j(f.onDOMReady,f)}}};k.stack.NameTransport=function(a){function b(c){i.contentWindow.sendMessage(c,a.remoteHelper+(h?"#_3":"#_2")+a.channel)}function d(){h?(2===++t||!h)&&g.up.callback(!0):(b("ready"),g.up.callback(!0))}function e(a){g.up.incoming(a,F)}function f(){z&&c(function(){z(!0)},0)}var g,h,i,l,t,z,F,T;return g={outgoing:function(a,c,d){z=d;b(a)},destroy:function(){i.parentNode.removeChild(i);i=null;h&&(l.parentNode.removeChild(l),l=null)},onDOMReady:function(){h=
a.isHost;t=0;F=n(a.remote);a.local=p(a.local);h?(k.Fn.set(a.channel,function(b){h&&"ready"===b&&(k.Fn.set(a.channel,e),d())}),T=q(a.remote,{xdm_e:a.local,xdm_c:a.channel,xdm_p:2}),m(a.props,{src:T+"#"+a.channel,name:v+a.channel+"_provider"}),l=r(a)):(a.remoteHelper=a.remote,k.Fn.set(a.channel,e));var b=function(){var e=i||this;C(e,"load",b);k.Fn.set(a.channel+"_load",f);(function Y(){"function"==typeof e.contentWindow.sendMessage?d():c(Y,50)})()};i=r({props:{src:a.local+"#_4"+a.channel},onLoad:b})},
init:function(){j(g.onDOMReady,g)}}};k.stack.HashTransport=function(a){function b(){if(l){var a=l.location.href,c="",d=a.indexOf("#");-1!=d&&(c=a.substring(d));c&&c!=i&&(i=c,e.up.incoming(i.substring(i.indexOf("_")+1),F))}}var e,f,g,h,i,k,l,t,z,F;return e={outgoing:function(b){if(t)b=a.remote+"#"+k++ +"_"+b,(f||!z?t.contentWindow:t).location=b},destroy:function(){d.clearInterval(g);(f||!z)&&t.parentNode.removeChild(t);t=null},onDOMReady:function(){f=a.isHost;h=a.interval;i="#"+a.channel;k=0;z=a.useParent;
F=n(a.remote);if(f){m(a.props,{src:a.remote,name:v+a.channel+"_provider"});if(z)a.onLoad=function(){l=d;g=setInterval(b,h);e.up.callback(!0)};else{var j=0,o=a.delay/50;(function X(){if(++j>o)throw Error("Unable to reference listenerwindow");try{l=t.contentWindow.frames[v+a.channel+"_consumer"]}catch(d){}l?(g=setInterval(b,h),e.up.callback(!0)):c(X,50)})()}t=r(a)}else l=d,g=setInterval(b,h),z?(t=parent,e.up.callback(!0)):(m(a,{props:{src:a.remote+"#"+a.channel+new Date,name:v+a.channel+"_consumer"},
onLoad:function(){e.up.callback(!0)}}),t=r(a))},init:function(){j(e.onDOMReady,e)}}};k.stack.ReliableBehavior=function(){var a,b,c=0,d=0,e="";return a={incoming:function(f,g){var h=f.indexOf("_"),i=f.substring(0,h).split(","),f=f.substring(h+1);i[0]==c&&(e="",b&&b(!0));0<f.length&&(a.down.outgoing(i[1]+","+c+"_"+e,g),d!=i[1]&&(d=i[1],a.up.incoming(f,g)))},outgoing:function(f,g,h){e=f;b=h;a.down.outgoing(d+","+ ++c+"_"+f,g)}}};k.stack.QueueBehavior=function(a){function b(){if(a.remove&&0===g.length)U(d);
else if(!h&&!(0===g.length||j)){h=!0;var e=g.shift();d.down.outgoing(e.data,e.origin,function(a){h=!1;e.callback&&c(function(){e.callback(a)},0);b()})}}var d,g=[],h=!0,i="",j,k=0,l=!1,t=!1;return d={init:function(){s(a)&&(a={});if(a.maxLength)k=a.maxLength,t=!0;a.lazy?l=!0:d.down.init()},callback:function(a){h=!1;var c=d.up;b();c.callback(a)},incoming:function(b,c){if(t){var e=b.indexOf("_"),g=parseInt(b.substring(0,e),10);i+=b.substring(e+1);0===g&&(a.encode&&(i=f(i)),d.up.incoming(i,c),i="")}else d.up.incoming(b,
c)},outgoing:function(c,f,h){a.encode&&(c=e(c));var i=[],j;if(t){for(;0!==c.length;)j=c.substring(0,k),c=c.substring(j.length),i.push(j);for(;j=i.shift();)g.push({data:i.length+"_"+j,origin:f,callback:0===i.length?h:null})}else g.push({data:c,origin:f,callback:h});l?d.down.init():b()},destroy:function(){j=!0;d.down.destroy()}}};k.stack.VerifyBehavior=function(a){function b(){d=Math.random().toString(16).substring(2);c.down.outgoing(d)}var c,d,e;return c={incoming:function(f,g){var h=f.indexOf("_");
-1===h?f===d?c.up.callback(!0):e||(e=f,a.initiate||b(),c.down.outgoing(f)):f.substring(0,h)===e&&c.up.incoming(f.substring(h+1),g)},outgoing:function(a,b,e){c.down.outgoing(d+"_"+a,b,e)},callback:function(){a.initiate&&b()}}};k.stack.RpcBehavior=function(a,b){function c(a){a.jsonrpc="2.0";f.down.outgoing(g.stringify(a))}function d(a,b){var e=Array.prototype.slice;return function(){var d=arguments.length,f,g={method:b};0<d&&"function"===typeof arguments[d-1]?(1<d&&"function"===typeof arguments[d-2]?
(f={success:arguments[d-2],error:arguments[d-1]},g.params=e.call(arguments,0,d-2)):(f={success:arguments[d-1]},g.params=e.call(arguments,0,d-1)),i[""+ ++h]=f,g.id=h):g.params=e.call(arguments,0);if(a.namedParams&&1===g.params.length)g.params=g.params[0];c(g)}}function e(a,b,d,f){if(d){var g,h;b?(g=function(a){g=L;c({id:b,result:a})},h=function(a,d){h=L;var e={id:b,error:{code:-32099,message:a}};if(d)e.error.data=d;c(e)}):g=h=L;"[object Array]"===Object.prototype.toString.call(f)||(f=[f]);try{var i=
d.method.apply(d.scope,f.concat([g,h]));s(i)||g(i)}catch(j){h(j.message)}}else b&&c({id:b,error:{code:-32601,message:"Procedure not found."}})}var f,g=b.serializer||N(),h=0,i={};return f={incoming:function(a){a=g.parse(a);if(a.method)b.handle?b.handle(a,c):e(a.method,a.id,b.local[a.method],a.params);else{var d=i[a.id];a.error?d.error&&d.error(a.error):d.success&&d.success(a.result);delete i[a.id]}},init:function(){if(b.remote)for(var c in b.remote)b.remote.hasOwnProperty(c)&&(a[c]=d(b.remote[c],c));
f.down.init()},destroy:function(){for(var c in b.remote)b.remote.hasOwnProperty(c)&&a.hasOwnProperty(c)&&delete a[c];f.down.destroy()}}};G.easyXDM=k})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);"undefined"==typeof CFW&&(CFW={});"undefined"==typeof CFW_OPTIONS&&(CFW_OPTIONS={});CFW.domain=/[.]local/.test(window.location.host)||/yestech/.test(window.location.host)||/asqua/.test(window.location.host)?"http://tameron.herokuapp.com":"http://cfwhiteboard.com";CFW.important=jQuery.important.noConflict();CFW.oxygenTank=function(){var d=Array.prototype.slice.call(arguments),a=d.pop(),d=_.inject(d,function(a,c){return"undefined"!=typeof a?a[c]:a},d.shift());return"undefined"!=typeof d?d:a};
CFW.tunnel=new easyXDM.Rpc({remote:CFW.domain+"/tunnel"},{remote:{request:{}}});CFW.strcmp=function(d,a){return d>a?1:d<a?-1:0};CFW.natcmp=function(d,a){var b=[],c=[];d.replace(/(\d+)|(\D+)/g,function(a,c,d){b.push(["undefined"==typeof c?Infinity:c,d])});for(a.replace(/(\d+)|(\D+)/g,function(a,b,d){c.push(["undefined"==typeof b?Infinity:b,d])});b.length&&c.length;){var f=b.shift(),e=c.shift();if(f=f[0]-e[0]||CFW.strcmp(f[1],e[1]))return f}return b.length?-1:c.length?1:0};
CFW.ajax=function(d){var a=jQuery.Deferred();a.done(function(){d.success&&d.success.apply(this,arguments)});a.fail(function(a){a=a.message;d.error&&d.error.apply(this,[a])});a.always(function(){d.complete&&d.complete.apply(this)});d.method=d.type;CFW.tunnel.request(_.extend({},d,{model:null,collection:null}),function(){a.resolveWith(this,arguments)},function(){a.rejectWith(this,arguments)});return a.promise()};Backbone.ajax=CFW.ajax;
CFW.fixEmbeds=function(d){var a=function(){var a=d(this);setTimeout(function(){var c=!1,f=a.attr("wmode");"opaque"!=f&&"transparent"!=f&&(a.attr("wmode","opaque"),c=!0);var e=a.closest("object"),f=e.children('param[name="wmode"]').val();"opaque"!=f&&"transparent"!=f&&(e.prepend(d('<param name="wmode" value="opaque" />')),c=!0);c&&(e=e.length?e:a,c=d('<span class="cfw-placeholder" />'),e.wrap(c),c.html(c.html()),c.children().unwrap())},0)};d(document.embeds).each(a);d("object").each(a);d("iframe").each(function(){/youtube/.test(this.src)&&
(this.src+=(0<=this.src.indexOf("?")?"&":"?")+"wmode=opaque")})};jQuery(window).load(function(){CFW.fixEmbeds(jQuery)});
CFW.init=function(d){if(!Modernizr.csstransitions)Modernizr.csstransforms=!1,Modernizr.csstransforms3d=!1;if(/AppleWebKit/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent))Modernizr.csstransforms3d=!1;(function(a){function b(){a(".dropdown-backdrop").remove();a(d).each(function(){c(a(this)).removeClass("open")})}function c(b){var c=b.attr("data-target");c||(c=(c=b.attr("href"))&&/#/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));c=c&&a(c);if(!c||!c.length)c=b.parent();return c}var d='[data-toggle="bsdropdown"]',
e=function(b){var c=a(b).on("click.dropdown.data-api",this.toggle);a("html").on("click.dropdown.data-api",function(){c.parent().removeClass("open")})};e.prototype={constructor:e,toggle:function(){var d=a(this),e,f;if(!d.is(".disabled, :disabled")){e=c(d);f=e.hasClass("open");b();if(!f){if("ontouchstart"in document.documentElement)a('<div class="dropdown-backdrop"/>').insertBefore(a(this)).on("click",b);e.toggleClass("open")}d.focus();return!1}},keydown:function(b){var e,i,o;if(/(38|40|27)/.test(b.keyCode)&&
(e=a(this),b.preventDefault(),b.stopPropagation(),!e.is(".disabled, :disabled"))){i=c(e);o=i.hasClass("open");if(!o||o&&27==b.keyCode)return 27==b.which&&i.find(d).focus(),e.click();e=a('[role="menu"] li:not(.divider):visible a',i);e.length&&(i=e.index(e.filter(":focus")),38==b.keyCode&&0<i&&i--,40==b.keyCode&&i<e.length-1&&i++,~i||(i=0),e.eq(i).focus())}}};var i=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data("dropdown");d||c.data("dropdown",d=new e(this));
"string"==typeof b&&d[b].call(c)})};a.fn.dropdown.Constructor=e;a.fn.dropdown.noConflict=function(){a.fn.dropdown=i;return this};a.fn.dropdown.initContainerEvents=function(c){a(c).on("click.dropdown.data-api",b).on("click.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.dropdown.data-api",d,e.prototype.toggle).on("keydown.dropdown.data-api",d+', [role="menu"]',e.prototype.keydown)}})(window.jQuery);d.fn.cfwDropdown=d.fn.dropdown.noConflict();CFW.User=Backbone.Model.extend({defaults:function(){return{email:"",
known_as:"",count:0,highlightColor:CFW.User.prototype.randomColor()}},randomColor:function(){return[[255,75,105],[255,105,75],[75,105,255],[105,75,255],[75,255,105],[105,255,75],[123,6,226],[226,6,123],[6,226,123],[6,123,226]][Math.floor(10*Math.random()+0)]}});CFW.UserList=Backbone.Collection.extend({model:CFW.User,initialize:function(){this.localStorage=new Store("cfw-users");return this},comparator:function(a){return-a.get("count")}});CFW.users=new CFW.UserList;CFW.users.fetch();CFW.Entry=Backbone.Model.extend({idAttribute:"_id",
defaults:{athlete_id:"",known_as:"",email:"",component_results:[],notes:"",facebook_url:""},emailRegex:/^\S+@\S+\.\S+$/,validate:function(a){var b=[];!(a.athlete_id||this.attributes&&this.get("athlete_id"))&&!this.emailRegex.test(a.email)&&b.push("email");if(b.length)return b},setUrlHash:function(){if(this.collection&&this.collection.whiteboardId&&this.collection.wpId){var a="cfwhiteboard-"+this.collection.whiteboardId+"-"+this.collection.wpId+"-"+this.get("athlete_slug");d(document.body).append(d('<span id="'+
a+'" style="position:absolute; top:'+d(document.body).scrollTop()+'px; display:none;"></span>'));window.location.hash=a}}});CFW.EntryList=Backbone.Collection.extend({model:CFW.Entry,comparators:{name:{asc:function(a){return a.get("known_as").replace(/^\s+/,"").toLowerCase()}},forComponent:function(a){var b=a.id;if(!a.get("sort_order"))return function(a,c){var d=_(a.get("component_results")).find(function(a){return a.component_id==b}),h=_(c.get("component_results")).find(function(a){return a.component_id==
b});return CFW.natcmp(jQuery.trim(d.result).toLowerCase(),jQuery.trim(h.result).toLowerCase())};var c="asc"==a.get("sort_order")?1:-1;return function(a){var e;e=(a=_(a.get("component_results")).find(function(a){return a.component_id==b}))&&a.result_data||0,a=e;return 0==a&&1==c?Infinity:a*c}}},url:function(){return CFW.domain+"/affiliates/"+(this.affiliateId||"")+"/wods/"+(this.wodId||"")+"/posts"},initialize:function(a,b){if(b)this.affiliateId=b.affiliateId,this.wodId=b.wodId,this.whiteboardId=b.whiteboardId,
this.wpId=b.wpId;return this}});CFW.EntryList.prototype.comparator=CFW.EntryList.prototype.comparators.name.asc;CFW.Component=Backbone.Model.extend({idAttribute:"_id",defaults:{description:"",label:"",result_type:"",result_notes:""},parse:function(a){switch(a.result_type){case "time":a.sort_order="asc";break;case "load":a.sort_order="desc";break;case "rounds":a.sort_order="desc";break;case "reps":a.sort_order="desc";break;case "distance":a.sort_order="desc";break;default:a.sort_order=!1}return a}});
CFW.ComponentList=Backbone.Collection.extend({model:CFW.Component});CFW.Wod=Backbone.Model.extend({idAttribute:"_id",defaults:function(){return{affiliate_id:"",whiteboard_id:"",wp_id:"",components:new CFW.ComponentList,entries:new CFW.EntryList}},initialize:function(){return this},parse:function(a){a.name=a.name.replace(/workout of the day/ig,"WOD");a.entries=new CFW.EntryList(a.posts,{affiliateId:a.affiliate_id,wodId:a._id,whiteboardId:a.whiteboard_id,wpId:a.wp_id});delete a.posts;a.components=new CFW.ComponentList(a.components,
{parse:!0});return a}});CFW.WodList=Backbone.Collection.extend({model:CFW.Wod,url:function(){return this.affiliateId?CFW.domain+"/affiliates/"+this.affiliateId+"/wods":""},fetchData:function(){var a={format:"json",wods:"",d:"_"};this.chain().uniq(function(a){return a.get("whiteboard_id")}).each(function(b,c){0<c&&(a.wods+=a.d+a.d);a.wods+=b.get("whiteboard_id")+a.d+b.get("post_modified")});return a},initialize:function(){var a=this;this.on("add",function(b){a.affiliateId=b.get("affiliate_id")});return this},
wodsQuery:function(){var a="";this.each(function(b,c){a+=(0==c?"":",")+b.get("post_id")+"["+b.get("wp_id")+"]"});return a}});CFW.EntryItemView=Backbone.View.extend({tagName:"tr",template:_.template('            <td class="cfw-known-as">                <a href="<%- athlete_url %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash"><%- known_as %></a>            </td>            <%             if (wod.components && wod.components.length > 1) {                wod.components.each(function(component, i, components) {                    var componentResult = _(component_results).find(function(cr) {                        return cr.component_id == component.id;                    }) || {                        result: "",                        rx: false,                        mods: ""                    };                    var isLast = (i + 1 == components.length);                    %>                     <td class="cfw-component" title="<%- componentResult.result %><%- componentResult.rx ? " [Rx]" : "" %><%- componentResult.mods ? " ("+componentResult.mods+")" : "" %>">                        <%= isLast ? "<div>" : "" %>                        <span class="cfw-result"><%- componentResult.result %></span>                        <span class="cfw-mods">                            <%= componentResult.rx ? "<strong>Rx</strong>" : "" %>                            <%- componentResult.mods %>                        </span>                        <% if (isLast) { %>                            <% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %>                            <span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                        <% } %>                        <%= isLast ? "</div>" : "" %>                    </td>                <%                 });            } else {                var componentResult = _.find(component_results, function(cr) {                    return cr.component_id == (wod.components.at(0) || {id: "uh oh"}).id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                 <td class="cfw-result" title="<%- componentResult.result %>"><%- componentResult.result %></td>                <td class="cfw-mods" title="<%- componentResult.rx ? "[Rx] " : "" %><%- componentResult.mods %>">                    <div>                        <%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %><% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %><span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                    </div>                </td>            <%             }            %>         '),
events:{click:"showDetail","click .cfw-set-url-hash":"setUrlHash"},initialize:function(a){this.options=a||{};this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this);this.model.on("show",this.lookSelected,this);this.model.on("unshow",this.unlookSelected,this);this.model.on("highlight",this.highlight,this);return this.render()},render:function(){var a=_.extend({wod:this.options.wod.toJSON()},this.model.toJSON());if(!a.athlete_url)a.athlete_url=CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink",
"")+this.model.get("athlete_slug");this.$el.html(this.template(a));return this},lookSelected:function(){this.$el.addClass("cfw-selected")},unlookSelected:function(){this.$el.removeClass("cfw-selected")},highlight:function(){this.$el.addClass("cfw-highlighted").trigger("scrollToEntry");if(Modernizr.csstransitions)this.$el.addClass("cfw-highlighted-transition").removeClass("cfw-highlighted").one("mouseenter touchstart",function(){d(this).removeClass("cfw-highlighted-transition")});else{var a=this.$el,
b=function(){a.toggleClass("cfw-highlighted")};setTimeout(b,300);setTimeout(b,600);setTimeout(b,900);setTimeout(b,1200);setTimeout(function(){a.removeClass("cfw-highlighted")},1500)}},showDetail:function(a){this.itemClickDisabled||0<d(a.target).closest("a").length||(a.stopPropagation(),this.model.trigger("show",this.model))},setUrlHash:function(){this.model.setUrlHash()}});CFW.WhiteboardPage=Backbone.View.extend({tagName:"div",className:"cfw-page",show:function(){this.$el.addClass("active");var a=
this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),a.scrollbarReady=!0;a.showScrollbar()},Modernizr.csstransitions?400:0)},hide:function(){this.freezeScrollbar();this.$el.removeClass("active");var a=this;setTimeout(function(){a.hideScrollbar();a.thawScrollbar();a.$el.trigger("cfwhide")},Modernizr.csstransitions?300:0)},isActive:function(){return this.$el.hasClass("active")},initScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,
show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("show")},hideScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("hide")},freezeScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("freeze")},thawScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("thaw")}});CFW.EntryListView=CFW.WhiteboardPage.extend({template:_.template('            <table class="cfw-components-<%= wod.components && wod.components.length || 1 %>" cellspacing="0">                <thead>                    <tr>                        <th class="cfw-known-as">                            Name                        </th>                        <% wod.components.each(function(component) { %>                            <th class="cfw-component" title="<%- component.get("description") %>"                                <%= wod.components.length == 1 ? \'colspan="2"\' : "" %>                                data-sort-by-component="<%- component.id %>">                                <%- component.get("label") %>                            </th>                        <% }); %>                    </tr>                </thead>            </table>            <div class="cfw-scrollable">                <table cellspacing="0" class="cfw-components-<%= wod.components && wod.components.length || 1 %>">                    <tbody></tbody>                </table>            </div>        '),
events:{"scrollToEntry tr":"scrollToEntry","touchmove .cfw-scrollable":"disableItemClicks","touchstart .cfw-scrollable":"enableItemClicks","click .cfw-retry-fetch-wods":"retryFetchWods","click thead th":"sortHeadingClicked"},initialize:function(a){this.options=a||{};this.entryItemViews=[];this.resetModel(this.model)},resetModel:function(a){this.model&&this.stopListening(this.model.get("entries"));this.model=a;this.render();if(this.isActive()){var b=this;setTimeout(function(){b.initScrollbar();b.showScrollbar()},
0)}else this.scrollbarReady=!1;this.listenTo(this.model.get("entries"),"change",function(){this.model.get("entries").sort()});this.listenTo(this.model.get("entries"),"add remove reset sort",this.addAll);this.addAll();this.listenTo(this.model.get("entries"),"sort",this.updateColumnSortIcons);var a=(a=this.model.get("components").find(function(a){return!!a.benchmark_group}))&&a.id,c=this.model.get("components").first(),c=c&&c.id;this.sortByColumn(a||c||!1)},render:function(){this.$el.html(this.template({wod:this.model.toJSON()}));
this.isActive()&&this.setComponentsClass();this.updateColumnSortIcons();return this},addOne:function(a){a=new CFW.EntryItemView({model:a,wod:this.model});this.entryItemViews.push(a);this.$("tbody").append(a.el)},addAll:function(){_.each(this.entryItemViews,function(a,b,c){a.remove();delete c[b]});this.$("tbody").empty();this.model.get("entries").length?this.model.get("entries").each(this.addOne,this):CFW.wods.fetchAttempted&&CFW.wods.fetchFailed?this.$("tbody").append(d('                    <tr class="cfw-no-entries">                        <td colspan="100">Error communicating with the server.<br /><a class="cfw-retry-fetch-wods">Retry Now<a></td>                    </tr>                ')):
CFW.wods.fetchAttempted?this.$("tbody").append(d('                    <tr class="cfw-no-entries">                        <td colspan="100">No one has added an entry yet.<br /><a class="cfw-new-entry">Add yours now!<a></td>                    </tr>                ')):this.$("tbody").append(d('                    <tr class="cfw-no-entries">                        <td colspan="100">Loading...</td>                    </tr>                '))},retryFetchWods:function(){this.$("tbody td").text("Loading...");
CFW.fetchWods()},setComponentsClass:function(){var a=this.$("table").attr("class"),b=this.$el.closest(".cfw-contents");setTimeout(function(){b.addClass(a).data("componentsclass",a);b.siblings(".cfw-classes").addClass(a)},Modernizr.csstransitions?300:0)},unsetComponentsClass:function(){var a=this.$("table").attr("class");this.$el.closest(".cfw-contents").removeClass(a).removeData("componentsclass").siblings(".cfw-classes").removeClass(a)},show:function(){this.setComponentsClass();CFW.WhiteboardPage.prototype.show.apply(this,
arguments)},hide:function(){this.unsetComponentsClass();CFW.WhiteboardPage.prototype.hide.apply(this,arguments)},scrollToEntry:function(a){var b=this.$(".cfw-scrollable").scrollTop(0);(a=d(a.target).position())&&a.top&&b.scrollTop(a.top-15-(b.height()||0)/2)},disableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!0})},enableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!1})},sortHeadingClicked:function(a){this.sortByColumn(d(a.currentTarget).data("sortByComponent")||
!1)},sortByColumn:function(a){var b=this.model.get("entries");if(a){if(this._sortedByComponent!=a)this._sortedByComponent=a,a=this.model.get("components").get(a),b.comparator=b.comparators.forComponent(a),b.sort()}else if(this._sortedByComponent)this._sortedByComponent=!1,b.comparator=b.comparators.name.asc,b.sort()},updateColumnSortIcons:function(){var a=this.$("thead th:not([data-sort-by-component])");this._sortedByComponent&&(a=this.$('thead th[data-sort-by-component="'+this._sortedByComponent+
'"]'));a.addClass("cfw-sort-active").siblings().removeClass("cfw-sort-active")}});CFW.EntryDetailView=CFW.WhiteboardPage.extend({template:_.template('            <div class="cfw-entry-detail">                <a class="cfw-back">back</a><a class="cfw-edit">edit</a>                <dl class="cfw-scrollable">                    <dt class="cfw-hidden">Name</dt>                    <dd class="cfw-known-as">                        <%- known_as %>                        <a href="<%- athlete_url %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash">view profile</a>                    </dd>                    <%                    wod.components.each(function(component) {                        var componentResult = _.find(component_results, function(cr) {                            return cr.component_id == component.id;                        }) || {                            result: "",                            rx: false,                            mods: ""                        };                    %>                        <dt title="<%- component.get("description") %>"><%= component.get("label") %></dt>                        <dd class="cfw-component">                            <span class="cfw-result"><%- componentResult.result %></span>                            <span class="cfw-mods"><%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %></span>                        </dd>                    <%                    });                    %>                    <dt>Notes</dt>                    <dd class="cfw-notes"><%- notes || "(no data)" %></dd>                </dl>            </div>        '),
events:{"click .cfw-set-url-hash":"setUrlHash","click a.cfw-edit":"edit","click a.cfw-back":"back",cfwhide:"cleanup"},initialize:function(a){this.options=a||{};this.wod=a.wod;this.model.on("change",this.render,this);this.model.on("change",function(){var a=this;setTimeout(function(){a.initScrollbar();a.showScrollbar()},300)},this);this.model.on("destroy",this.back,this);return this.render()},render:function(){var a=_.extend({wod:this.wod.toJSON()},this.model.toJSON());if(!a.athlete_url)a.athlete_url=
CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink","")+this.model.get("athlete_slug");this.$el.html(this.template(a));return this},setUrlHash:function(){this.model.setUrlHash()},edit:function(){this.model.trigger("edit",this.model)},back:function(){this.$el.trigger("hideEntryDetails")},cleanup:function(){var a=this;setTimeout(function(){a.model.trigger("unshow",a.model);a.remove()},0)}});CFW.ModalPage=Backbone.View.extend({tagName:"div",className:"cfw-scrollable cfw-modal",events:{'focus :input:not([type="checkbox"], [type="radio"])':"scrollToInput",
'change :input[type="checkbox"]':"scrollToInput",'change :input[type="radio"]':"scrollToInput","click .cfw-close-modal":"remove"},initScrollbar:function(){this.$el.scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$el.scrollbarPaper("show")},hideScrollbar:function(){this.$el.scrollbarPaper("hide")},freezeScrollbar:function(){this.$el.scrollbarPaper("freeze")},
thawScrollbar:function(){this.$el.scrollbarPaper("thaw")},scrollToInput:function(a){if(!this.height)this.height=this.$el.parent().height();var a=(d(a.target).position()||{}).top,b=this.height/2;a&&a>b&&this.$el.animate({scrollTop:a+this.$el.scrollTop()-b},300)},show:function(){var a=this.$el.closest(".cfw-contents"),b=a.data("componentsclass");b&&(a.removeClass(b),a.siblings(".cfw-classes").removeClass(b));var c=this;setTimeout(function(){c.$el.addClass("cfw-translate-oldfashioned")},0);setTimeout(function(){if(!c.scrollbarReady)c.initScrollbar(),
c.scrollbarReady=!0;c.showScrollbar();var a=c.$el.find(":input[type!=hidden]:first")[0];a&&a.focus&&a.focus()},Modernizr.csstransitions?400:0)},remove:function(a,b){this.freezeScrollbar();var c=this,d=this.$el.closest(".cfw-contents");this.$el.removeClass("cfw-translate-oldfashioned");setTimeout(function(){c.hideScrollbar();var e=d.data("componentsclass");e&&(d.addClass(e),d.siblings(".cfw-classes").addClass(e));"object"==typeof a&&a.silent?c.$el.remove():c.$el.trigger("cfwremove").remove();_.isFunction(b)&&
b()},Modernizr.csstransitions?300:0)}});CFW.EntryFormView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <\!--<h2><%= new_record ? "Add Your Entry" : "Edit Your Entry" %></h2>--\>                <h2><label for="cfw-email">Email Address</label></h2>                <input type="hidden" name="<%= new_record ? "decoy" : "email" %>" value="<%- email %>" />                <input type="email" id="cfw-email" name="<%= new_record ? "email" : "decoy" %>" placeholder="name@example.com" <%= new_record ? "" : \'value="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" disabled="disabled"\' %> />                <\!--<h2><label for="cfw-known-as">Name</label></h2>--\>                <\!--<input type="text" id="cfw-known-as" name="known_as" placeholder="Guest" value="<%- known_as %>" />--\>            </fieldset>            <%            wod.components.each(function(component) {                var componentResult = _.find(component_results, function(cr) {                    return cr.component_id == component.id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                <fieldset><%                    switch (component.get("result_type")) {                    case "time":                        if ("seconds" in componentResult) {                            componentResult.minutes = Math.floor(componentResult.seconds / 60);                            componentResult.seconds = (componentResult.seconds % 60);                        }                    %>                        <h2><label for="cfw-component-<%= component.id %>-minutes" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <% if (component.get("result_notes")) { %><p class="cfw-result-notes"><%- component.get("result_notes") %></p><% } %>                        <div class="cfw-nobr">                            <input type="text" pattern="[0-9]*" id="cfw-component-<%= component.id %>-minutes" name="component-<%= component.id %>-minutes" placeholder="0" value="<%- componentResult.minutes || "" %>" size="3" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-minutes" class="cfw-inline">minutes</label>                            <input type="text" pattern="[0-9]*" id="cfw-component-<%= component.id %>-seconds" name="component-<%= component.id %>-seconds" placeholder="0" value="<%- componentResult.seconds || "" %>" size="2" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-seconds" class="cfw-inline">seconds</label>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "load":                    %>                        <h2><label for="cfw-component-<%= component.id %>-mass" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" pattern="[0-9.]*" id="cfw-component-<%= component.id %>-mass" name="component-<%= component.id %>-mass" placeholder="0" value="<%- componentResult.mass || "" %>" size="10" class="cfw-minority" />                            <% unit_options = component.get("unit_options") || [{name: "lbs", value: "lbs"}]; %>                            <div class="cfw-dropdown">                                <input type="hidden" id="cfw-component-<%= component.id %>-units" name="component-<%= component.id %>-units" value="<%- componentResult.units || unit_options[0].value %>" size="10" class="cfw-minority" />                                <a href="javascript:// Select Units" class="cfw-dropdown-toggle" data-toggle="bsdropdown" data-target=".cfw-dummy-selector"><span class="cfw-text"><%- componentResult.units || unit_options[0].name %></span> <span class="cfw-caret"></span></a>                                <ul class="cfw-dropdown-menu cfw-units-select">                                    <% for (var i = 0; i < unit_options.length; i++) { %>                                        <li><a href="javascript://" data-value="<%- unit_options[i].value || "" %>"><%- unit_options[i].name || "" %></a></li>                                    <% } %>                                </ul>                            </div>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "rounds":                        if ("reps" in componentResult) {                            componentResult.rounds = Math.floor(componentResult.reps / component.get("reps_per_round"));                            componentResult.reps = (componentResult.reps % component.get("reps_per_round"));                        }                    %>                        <h2><label for="cfw-component-<%= component.id %>-rounds" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" pattern="[0-9]*" id="cfw-component-<%= component.id %>-rounds" name="component-<%= component.id %>-rounds" placeholder="0" value="<%- componentResult.rounds || "" %>" size="3" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-rounds" class="cfw-inline">rounds</label>                            <label class="cfw-inline">+</label>                            <input type="text" pattern="[0-9]*" id="cfw-component-<%= component.id %>-reps" name="component-<%= component.id %>-reps" placeholder="0" value="<%- componentResult.reps || "" %>" size="3" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-reps" class="cfw-inline">reps</label>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "reps":                    %>                        <h2><label for="cfw-component-<%= component.id %>-reps" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" pattern="[0-9]*" id="cfw-component-<%= component.id %>-reps" name="component-<%= component.id %>-reps" placeholder="0" value="<%- componentResult.reps || "" %>" size="5" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-reps" class="cfw-inline">reps</label>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "distance":                    %>                        <h2><label for="cfw-component-<%= component.id %>-distance" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" pattern="[0-9.]*" id="cfw-component-<%= component.id %>-distance" name="component-<%= component.id %>-distance" placeholder="0" value="<%- componentResult.distance || "" %>" size="10" class="cfw-minority" />                            <% unit_options = component.get("unit_options") || [{name: "error", value: "error"}]; %>                            <div class="cfw-dropdown">                                <input type="hidden" id="cfw-component-<%= component.id %>-units" name="component-<%= component.id %>-units" value="<%- componentResult.units || unit_options[0].value %>" size="10" class="cfw-minority" />                                <a href="javascript:// Select Units" class="cfw-dropdown-toggle" data-toggle="bsdropdown" data-target=".cfw-dummy-selector"><span class="cfw-text"><%- componentResult.units || unit_options[0].name %></span> <span class="cfw-caret"></span></a>                                <ul class="cfw-dropdown-menu cfw-units-select">                                    <% for (var i = 0; i < unit_options.length; i++) { %>                                        <li><a href="javascript://" data-value="<%- unit_options[i].value || "" %>"><%- unit_options[i].name || "" %></a></li>                                    <% } %>                                </ul>                            </div>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "text":                    default:                    %>                        <h2><label for="cfw-component-<%= component.id %>-result" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <input type="text" id="cfw-component-<%= component.id %>-result" name="component-<%= component.id %>-result" placeholder="What was your result?" value="<%- componentResult.result %>" />                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <% } %>                </fieldset>            <%            });            %>            <fieldset class="cfw-last">                <div class="cfw-notes <%= notes ? "cfw-open cfw-opaque" : "" %>">                    <h2><label for="cfw-notes">Notes</label></h2>                    <textarea rows="3" id="cfw-notes" name="notes" placeholder="Notes or Tips for next time?"><%- notes %></textarea>                </div>                <div class="cfw-footer">                    <a class="cfw-add-notes <%= notes ? "cfw-hidden" : "" %>"><label for="cfw-notes"><strong>+</strong> add notes</label></a>                    <input type="submit" value="<%= new_record ? "Submit" : "Save" %>" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                    <% if (!new_record) { %><div><a href="javascript://" class="cfw-delete-entry cfw-btn cfw-btn-danger" style="margin-top:5px !important;">Delete</a></div><% } %>                </div>            </fieldset>        '),
events:d.extend({},CFW.ModalPage.prototype.events,{"click .cfw-units-select a":"selectUnits","click .cfw-add-notes":"showNotesFields",submit:"save","click .cfw-delete-entry":"destroyEntry"}),initialize:function(a){this.options=a||{};this.wod=a.wod;return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(_.extend({wod:this.wod.toJSON(),new_record:!this.model},(this.model||new CFW.Entry).toJSON())));return this},guessNameFromEmail:function(a){if(!_.capitalize)_.capitalize=
function(a){return a.substring(0,1).toUpperCase()+a.substring(1)};return _.capitalize((/[^.@0-9]+/.exec(a)||[""])[0])},selectUnits:function(a){a.preventDefault();a=d(a.target);a.closest(".cfw-dropdown").find("input").val(a.data("value")).end().find(".cfw-dropdown-toggle .cfw-text").text(a.text())},showNotesFields:function(){var a=this.$(".cfw-notes").addClass("cfw-open"),b=this.$(".cfw-add-notes").addClass("cfw-transparent");setTimeout(function(){a.addClass("cfw-opaque");b.addClass("cfw-hidden")},
Modernizr.csstransitions?200:0)},save:function(a){a&&a.preventDefault&&a.preventDefault();if(!this.isLoading()){var b={email:this.$('input[name="email"]').val(),component_results:[],notes:this.$('textarea[name="notes"]').val(),no_auto_registration:!0},c={};this.$('input[name^="component-"]').each(function(){var a=d(this),b=a.attr("name").split("-"),a="checkbox"==a.attr("type")?a.is(":checked"):a.val();c[b[1]]||(c[b[1]]={component_id:b[1]});c[b[1]][b[2]]=a});_.each(c,function(a){b.component_results.push(a)});
var a=_.bind(function(){this.showLoading();this.$(".ajax-error-notice, .cfw-field-errors").remove()},this),f=_.bind(function(){this.hideLoading()},this),e=_.bind(this.model?function(){f();this.remove()}:function(a){f();this.$el.trigger("showEntryShare",a)},this),i=_.bind(function(a,b){f();var c=d.parseJSON(b.responseText);if(449==b.status){if(c&&c.registration_url)this.registrationUrl=c.registration_url;this.confirmNewAthlete()}else c&&c.length?this.showValidationErrors(c):this.$(".cfw-footer").after(d('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Click <strong>'+
this.$('input[type="submit"]').val()+"</strong> to try again or contact athlete support if the problem persists.</label>"))},this);a();a={success:e,error:i,wait:!0};this.model?this.model.save(b,a):this.wod.get("entries").create(b,a)||this.showValidationErrors(CFW.Entry.prototype.validate(b))}},showLoading:function(a){_.isUndefined(a)&&(a=this.$('input[type="submit"]'));a.addClass("loading");this._loadingButton=a},isLoading:function(){return!!this._loadingButton},hideLoading:function(){if(_.isUndefined(this._loadingButton))this._loadingButton=
this.$('input[type="submit"]');this._loadingButton.removeClass("loading").removeAttr("disabled");delete this._loadingButton},showValidationErrors:function(a){_.isArray(a)?_(a).each(function(a,c){this.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){d('label[for="'+d(this).attr("id")+'"]').addClass("cfw-invalid");0==c&&d(this).focus()}).one("keydown change",function(){d(this).removeClass("cfw-invalid");d('label[for="'+d(this).attr("id")+'"]').removeClass("cfw-invalid")})},this):_.isObject(a)&&
_(a).each(function(a,c){var f=_(a).inject(function(a,b,c){0<c&&(a+=", ");return a+b},"");this.$('input[name="'+c+'"]').addClass("cfw-invalid").each(function(){d('label[for="'+d(this).attr("id")+'"]').addClass("cfw-invalid").after('<p class="cfw-field-errors">'+f+"</p>")}).one("keydown change",function(){d(this).removeClass("cfw-invalid").closest(".cfw-contents").find('label[for="'+d(this).attr("id")+'"]').removeClass("cfw-invalid").siblings(".cfw-field-errors").addClass("cfw-muted")})},this)},confirmNewAthlete:function(){var a=
new CFW.ConfirmNewAthleteView({email:this.$('input[name="email"]').val()});this.$el.closest(".cfw-contents").append(a.el);this.hideScrollbar();var b=_.bind(function(b){a.remove({silent:!0},_.bind(function(){this.showScrollbar();_.isFunction(b)&&b()},this))},this);a.on("done",_.bind(function(){b(_.bind(this.signupNewAthlete,this))},this));a.on("fail",_.bind(function(){b();var a=this.$('[name="email"]')[0];a&&a.focus()},this));setTimeout(function(){a.show()},0)},signupNewAthlete:function(){var a={action:this.registrationUrl,
email:this.$('[name="email"]').val()};a.name=this.guessNameFromEmail(a.email);var b=new CFW.AthleteSignupView(a);this.$el.closest(".cfw-contents").append(b.el);this.hideScrollbar();var c=_.bind(function(){b.remove({silent:!0},_.bind(function(){this.showScrollbar()},this))},this);b.on("done",_.bind(function(){c();this.save()},this));b.on("fail",_.bind(function(){c();var a=this.$('[name="email"]')[0];a&&a.focus()},this));setTimeout(function(){b.show()},0)},destroyEntry:function(){if(confirm("Are you sure?")){var a=
this.$(".cfw-delete-entry"),b=_.bind(function(){this.showLoading(a);this.$(".ajax-error-notice, .cfw-field-errors").remove()},this),c=_.bind(function(){this.hideLoading()},this),f=_.bind(function(){c();this.remove()},this),e=_.bind(function(a,b){c();var e=d.parseJSON(b.responseText);e&&e.length?this.showValidationErrors(e):this.$(".cfw-footer").after(d('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Please try again or contact athlete support if the problem persists.</label>'))},
this);b();this.model.destroy({success:f,error:e,wait:!0,data:{email:this.model.get("email"),password:this.model.get("password")},processData:!0})}}});CFW.AthleteAuthView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <h2><label style="white-space:normal !important;">Enter <%- known_as %>\'s email & password to edit:</label></h2>            </fieldset>            <fieldset>                <h2><label for="cfw-email">Email</label></h2>                <input type="email" id="cfw-email" name="email" value="" />                <h2><label for="cfw-password">Password</label></h2>                <input type="password" id="cfw-password" name="password" value="" />            </fieldset>            <fieldset class="cfw-last">                <div class="cfw-footer">                    <a href="javascript://" class="cfw-reset-password js-reset-password">forgot password?</a>                    <input type="submit" value="Unlock" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:d.extend({},CFW.ModalPage.prototype.events,{submit:"submit","click .js-reset-password":"resetPassword"}),initialize:function(a){this.options=a||{};return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(this.model.toJSON()));return this},submit:function(a){a.preventDefault();if(!this.isLoading()){var b={email:this.$('[name="email"]').val(),password:this.$('[name="password"]').val()},a=_.bind(function(){this.showLoading();this.$(".ajax-error-notice, .cfw-field-errors").remove()},
this),c=_.bind(function(){this.hideLoading()},this),f=_.bind(function(){this.options.success(b)},this),e=_.bind(function(){this.showValidationErrors(["email","password"]);var a='<a href="mailto:'+(CFW_OPTIONS.custom_branding_email||"athletesupport@cfwhiteboard.com")+'" target="_blank">athlete support</a>';this.$(".cfw-footer").after(d('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! Incorrect email or password. Please try again or contact '+a+" so we can help!</label>"))},
this);a();a={url:CFW.domain+"/athletes/"+this.model.get("athlete_id")+"/verify_creds",complete:c,success:f,error:e,type:"POST",data:b,dataType:"json",cache:!1};CFW.ajax(a)}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){_.isArray(a)?_(a).each(function(a,c){this.$('input[name="'+
a+'"]').addClass("cfw-invalid").each(function(){d('label[for="'+d(this).attr("id")+'"]').addClass("cfw-invalid");0==c&&d(this).focus()}).one("keydown change",function(){d(this).removeClass("cfw-invalid");d('label[for="'+d(this).attr("id")+'"]').removeClass("cfw-invalid")})},this):_.isObject(a)&&_(a).each(function(a,c){var f=_(a).inject(function(a,b,c){0<c&&(a+=", ");return a+b},"");this.$('input[name="'+c+'"]').addClass("cfw-invalid").each(function(){d('label[for="'+d(this).attr("id")+'"]').addClass("cfw-invalid").after('<p class="cfw-field-errors">'+
f+"</p>")}).one("keydown change",function(){d(this).removeClass("cfw-invalid").closest(".cfw-contents").find('label[for="'+d(this).attr("id")+'"]').removeClass("cfw-invalid").siblings(".cfw-field-errors").addClass("cfw-muted")})},this)},resetPassword:function(){this.$el.trigger("showResetPassword",[{email:this.$('[name="email"]').val()}])}});CFW.ResetPasswordView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <h2><label style="white-space:normal !important;">Enter your email to reset your password:</label></h2>            </fieldset>            <fieldset>                <h2><label for="cfw-email">Email</label></h2>                <input type="email" id="cfw-email" name="email" value="<%- email %>" />            </fieldset>            <fieldset class="cfw-last">                <div class="cfw-footer">                    <input type="submit" value="Send Reset Link" />                    <input type="reset" value="Cancel" class="cfw-cancel" />                </div>            </fieldset>        '),
events:d.extend({},CFW.ModalPage.prototype.events,{submit:"submit","click .cfw-cancel":"cancel"}),initialize:function(a){this.options=a||{};return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template({email:this.options.email||""}));return this},submit:function(a){a.preventDefault();if(!this.isLoading()){var b={email:this.$('[name="email"]').val()},a=_.bind(function(){this.showLoading();this.$(".ajax-error-notice, .cfw-field-errors").remove()},this),
c=_.bind(function(){this.hideLoading()},this),f=_.bind(function(){this.$el.html('<fieldset><h2 style="white-space:normal !important;">Check your email for a link to reset your password.</h2></fieldset><fieldset class="cfw-last"><a href="javascript://" class="cfw-js-done cfw-btn cfw-btn-block cfw-btn-primary">Cool. Thanks!</a></fieldset>');this.options.success&&this.$el.find(".cfw-js-done").click(_.bind(function(){this.options.success(b)},this));this.options.always&&this.$el.find(".cfw-js-done").click(this.options.always);
!this.options.success&&!this.options.always&&this.$el.find(".cfw-js-done").addClass("cfw-close-modal")},this),e=_.bind(function(){this.showValidationErrors(["email"]);var a='<a href="mailto:'+(CFW_OPTIONS.custom_branding_email||"athletesupport@cfwhiteboard.com")+'" target="_blank">athlete support</a>';this.$(".cfw-footer").after(d('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! Incorrect email or password. Please try again or contact '+a+" so we can help!</label>"))},
this);a();a={url:CFW.domain+"/account/password",complete:c,success:f,error:e,type:"POST",data:function(a){var b={},c;for(c in a)b["athlete["+c+"]"]=a[c];return b}(b),dataType:"json",cache:!1};CFW.ajax(a)}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){_.isArray(a)?
_(a).each(function(a,c){this.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){d('label[for="'+d(this).attr("id")+'"]').addClass("cfw-invalid");0==c&&d(this).focus()}).one("keydown change",function(){d(this).removeClass("cfw-invalid");d('label[for="'+d(this).attr("id")+'"]').removeClass("cfw-invalid")})},this):_.isObject(a)&&_(a).each(function(a,c){var f=_(a).inject(function(a,b,c){0<c&&(a+=", ");return a+b},"");this.$('input[name="'+c+'"]').addClass("cfw-invalid").each(function(){d('label[for="'+
d(this).attr("id")+'"]').addClass("cfw-invalid").after('<p class="cfw-field-errors">'+f+"</p>")}).one("keydown change",function(){d(this).removeClass("cfw-invalid").closest(".cfw-contents").find('label[for="'+d(this).attr("id")+'"]').removeClass("cfw-invalid").siblings(".cfw-field-errors").addClass("cfw-muted")})},this)},cancel:function(){this.options.always&&this.options.always()}});CFW.EntryShareView=CFW.ModalPage.extend({template:_.template('            <div class="cfw-facebook-card">                <p>                    <a href="<%- fbShareUrl %>" class="cfw-fb-action cfw-set-url-hash cfw-close-modal">Share on Facebook</a>                </p>                <p>                    <a href="javascript://" class="cfw-fb-inaction cfw-close-modal">Not this time</a>                </p>                <div class="cfw-fb-footer"></div>                <div class="cfw-fb-logo"></div>            </div>            <p class="cfw-facebook-links">                <a href="javascript://" class="cfw-never-again cfw-close-modal">Don\'t show this message again on this computer</a>            </p>        '),
events:d.extend({},CFW.ModalPage.prototype.events,{"click .cfw-never-again":"neverAgain","click .cfw-set-url-hash":"setUrlHash"}),initialize:function(a){this.options=a||{};return this.render()},render:function(){this.$el.html(this.template({fbShareUrl:this.model.url()+"/share"}));return this},setUrlHash:function(){this.model.setUrlHash()},neverAgain:function(){d.cookie("CFW",d.extend(d.cookie("CFW"),{no_facebook_share_dialog:!0}),{expires:365,path:"/"})}});CFW.ConfirmNewAthleteView=CFW.ModalPage.extend({tagName:"form",
template:_.template('            <fieldset>                <h2><label style="white-space:normal !important;">Email not recognized:</label></h2>                <p class="cfw-email-display"><%- email %></p>            </fieldset>            <fieldset class="cfw-last">                <a href="javascript://" class="cfw-btn cfw-btn-block cfw-btn-orange js-join" style="margin-bottom:5px !important;">This is my first time.</a>                <a href="javascript://" class="cfw-btn cfw-btn-block js-back">Let me fix my email.</a>            </fieldset>        '),
events:d.extend({},CFW.ModalPage.prototype.events,{"click .js-join":"join","click .js-back":"back"}),initialize:function(a){this.options=a||{};return this.render()},render:function(){this.$el.html(this.template({email:this.options.email||""}));return this},join:function(){this.trigger("done")},back:function(){this.trigger("fail")}});CFW.AthleteSignupView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <h2><label style="white-space:normal !important;">Welcome! Please create a password.</label></h2>            </fieldset>            <fieldset>                <h2><label>Email</label></h2>                <input type="email" value="<%- email %>" disabled="disabled" />            </fieldset>            <fieldset>                <h2><label for="cfw-name">Name</label></h2>                <input type="text" id="cfw-name" name="name" placeholder="Guest" value="<%- name %>" />            </fieldset>            <fieldset>                <h2><label for="cfw-new-password">New Password</label></h2>                <input type="password" id="cfw-new-password" name="password" value="" />                <h2><label for="cfw-new-password-confirmation">Re-enter Password</label></h2>                <input type="password" id="cfw-new-password-confirmation" name="password_confirmation" value="" />            </fieldset>            <fieldset class="cfw-last">                <div class="cfw-footer">                    <input type="submit" value="Sign Up" />                    <input type="reset" value="Cancel" class="js-cancel" />                </div>            </fieldset>        '),
events:d.extend({},CFW.ModalPage.prototype.events,{submit:"submit","click .js-cancel":"cancel"}),initialize:function(a){this.options=a||{};return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template({email:this.options.email,name:this.options.name}));return this},submit:function(a){a.preventDefault();if(!this.isLoading()){var b={affiliate_id:CFW.wods.affiliateId,email:this.options.email,name:this.$('input[name="name"]').val(),password:this.$('input[name="password"]').val(),
password_confirmation:this.$('input[name="password_confirmation"]').val()},a=_.bind(function(){this.showLoading();this.$(".ajax-error-notice, .cfw-field-errors").remove()},this),c=_.bind(function(){this.hideLoading()},this),f=_.bind(function(){this.trigger("done")},this),e=_.bind(function(a){(a=d.parseJSON(a.responseText))&&a.errors&&this.showValidationErrors(a.errors);a='<a href="mailto:'+(CFW_OPTIONS.custom_branding_email||"athletesupport@cfwhiteboard.com")+'" target="_blank">athlete support</a>';
this.$(".cfw-footer").after(d('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! That didn\'t work. Please try again or contact '+a+" so we can help!</label>"))},this),b={url:this.options.action,complete:c,success:f,error:e,type:"POST",data:function(a){var b={},c;for(c in a)b["athlete["+c+"]"]=a[c];return b}(b),dataType:"json",cache:!1};a();CFW.ajax(b)}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},
hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){_.isArray(a)?_(a).each(function(a,c){this.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){d('label[for="'+d(this).attr("id")+'"]').addClass("cfw-invalid");0==c&&d(this).focus()}).one("keydown change",function(){d(this).removeClass("cfw-invalid");d('label[for="'+d(this).attr("id")+'"]').removeClass("cfw-invalid")})},this):_.isObject(a)&&_(a).each(function(a,
c){var f=_(a).inject(function(a,b,c){0<c&&(a+=", ");return a+b},"");this.$('input[name="'+c+'"]').addClass("cfw-invalid").each(function(){d('label[for="'+d(this).attr("id")+'"]').addClass("cfw-invalid").after('<p class="cfw-field-errors">'+f+"</p>")}).one("keydown change",function(){d(this).removeClass("cfw-invalid").closest(".cfw-contents").find('label[for="'+d(this).attr("id")+'"]').removeClass("cfw-invalid").siblings(".cfw-field-errors").addClass("cfw-muted")})},this)},cancel:function(){this.trigger("fail")}});
CFW.WhiteboardView=Backbone.View.extend({className:"cfw-pane",template:_.template('            <div>                <div class="cfw-window">                    <h2>Entries</h2>                    <a class="cfw-new-entry">+</a>                    <ul class="cfw-classes cfw-<%- allWods.length || 1 %>-classes cfw-components-<%= wod.components && wod.components.length || 1 %>">                        <%                        _.each(allWods, function(w) {                            %><li class="<%- w.wp_id == wod.wp_id ? "cfw-selected" : "" %>"><div>                                <a href="javascript://" data-wp_id="<%- w.wp_id %>" title="<%- w.name %>">                                    <span class="cfw-centered">                                        <span class="cfw-entry-count" data-wp_id="<%- w.wp_id %>"></span>                                        <span class="cfw-link-text"><%- w.name.replace(/workout of the day/ig, "WOD") %></span>                                    </span>                                    <span class="cfw-separator"></span>                                </a>                            </div></li><%                        });                        %>                    </ul>                    <div class="cfw-contents"></div>                    <div class="cfw-footer">                        <a href="<%- brandUrl %>" target="_blank" class="cfw-hook-what-is-this">                            What Is This?                        </a><a href="mailto:<%- supportEmail %>">                            Email Athlete Support                        </a>                    </div>                </div>            </div>            <a class="cfw-print cfw-admin-tool cfw-hidden" target="_blank">Print</a>        '),
events:{"click .cfw-new-entry:not([disabled])":"newEntry",hideEntryDetails:"hideEntry","cfwremove .cfw-modal":"cleanupModal",showEntryShare:"showEntryShare",showResetPassword:"showResetPassword","click .cfw-classes a":"returnToEntryList"},initialize:function(a){this.options=a||{};this.model=new CFW.Wod({affiliate_id:a.affiliateId,whiteboard_id:a.whiteboardId,wp_id:a.wpId,post_modified:a.postModified});CFW.wods.push(this.model);CFW.wods.on("reset",this.resetModel,this);this.render();this.disableEntriesUntilLoaded();
CFW.wods.on("reset",this.disableEntriesUntilLoaded,this);a.hidden&&this.hide();return this},resetModel:function(){var a=this;if(this.model=CFW.wods.find(function(b){return b.get("whiteboard_id")==a.options.whiteboardId&&b.get("wp_id")==a.options.wpId}))this.model.get("entries").on("add remove reset",this.newEntryCount,this),this.newEntryCount(),this.model.get("entries").on("edit",this.editEntry,this),this.model.get("entries").on("show",this.showEntry,this),this.model.get("entries").on("add change:known_as",
this.updateUsers,this),this.entryListView.resetModel(this.model)},render:function(){this.$el.html(this.template({wod:this.model.toJSON(),allWods:this.options.allWods,brandUrl:CFW_OPTIONS.custom_branding_url||"http://cfwhiteboard.com",supportEmail:CFW_OPTIONS.custom_branding_email||"athletesupport@cfwhiteboard.com"}));d.fn.cfwDropdown.initContainerEvents(this.$el);this.entryListView=new CFW.EntryListView({model:this.model});this.$(".cfw-contents").append(this.entryListView.el);this.entryListView.show();
"admin"==this.options.authorization&&this.$(".cfw-admin-tool").removeClass("cfw-hidden");return this},attach:function(){this.$children&&this.$el.append(this.$children)},detach:function(){this.$children=this.$el.children();this.$children.detach()},show:function(){this.$el.removeClass("cfw-hidden")},hide:function(){this.$el.addClass("cfw-hidden")},newEntry:function(){this.showEntryForm()},editEntry:function(a){this.showEmailAuth(a,_.bind(function(b){this.modalView.remove({silent:!0});a.set(b,{silent:!0});
this.showEntryForm(a)},this))},highlightEntry:function(a){var b=this,c=function(){(b.model.get("entries").get(a)||b.model.get("entries").find(function(b){return b.get("athlete_slug")==a})).trigger("highlight")};if(this.model.get("entries").length)c();else this.model.get("entries").on("reset",c)},showEmailAuth:function(a,b){this.disableNewEntries();this.modalView=new CFW.AthleteAuthView({model:a,success:b});this.$(".cfw-contents").append(this.modalView.el);var c=this;setTimeout(function(){c.detailView?
c.detailView.hideScrollbar():c.entryListView.hideScrollbar();c.modalView.show()},0)},showResetPassword:function(a,b){this.disableNewEntries();var c=new CFW.ResetPasswordView({email:b&&b.email,always:_.bind(function(){c.remove({silent:!0});this.modalView&&this.modalView.showScrollbar()},this)});this.$(".cfw-contents").append(c.el);setTimeout(_.bind(function(){this.modalView?this.modalView.hideScrollbar():this.detailView?this.detailView.hideScrollbar():this.entryListView.hideScrollbar();c.show()},this),
0)},showEntryForm:function(a){this.modalView=new CFW.EntryFormView({model:a,wod:this.model});this.$(".cfw-contents").append(this.modalView.el);var b=this;setTimeout(function(){a||(b.detailView?b.detailView.hideScrollbar():b.entryListView.hideScrollbar());b.disableNewEntries();b.modalView.show()},0)},showEntryShare:function(a,b){var c=d.cookie("CFW");if(c&&c.no_facebook_share_dialog)this.modalView.remove();else{var f=new CFW.EntryShareView({model:b,wod:this.options.wod,whiteboardId:this.options.whiteboardId,
postPermalink:this.options.postPermalink});this.$(".cfw-contents").append(f.el);this.modalView.remove({silent:!0},function(){f.show()});this.modalView=f}},cleanupModal:function(){this.enableNewEntries();this.detailView?this.detailView.showScrollbar():this.entryListView.showScrollbar();delete this.modalView},disableNewEntries:function(){this.$el.children().length?this.$el.find(".cfw-new-entry").attr("disabled",!0):this.$children.find(".cfw-new-entry").attr("disabled",!0)},enableNewEntries:function(){this.$el.children().length?
this.$el.find(".cfw-new-entry").removeAttr("disabled"):this.$children.find(".cfw-new-entry").removeAttr("disabled")},disableEntriesUntilLoaded:function(){CFW.wods.fetchAttempted&&!CFW.wods.fetchFailed?this.enableNewEntries():this.disableNewEntries()},showEntry:function(a){this.detailView=new CFW.EntryDetailView({model:a,wod:this.model});this.$(".cfw-contents").append(this.detailView.el);var b=this;setTimeout(function(){b.entryListView.hide();b.detailView.show()},0)},hideEntry:function(){this.detailView.hide();
this.entryListView.show();var a=this;setTimeout(function(){delete a.detailView},Modernizr.csstransitions?400:100)},newEntryCount:function(){this.$el.trigger("newEntryCount",[this.options.wpId,this.model.get("entries").length])},updateEntryCount:function(a,b){var c=this.$(".cfw-entry-count");0==c.length&&(c=this.$children.find(".cfw-entry-count"));(1<c.length||"embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1))&&c.each(function(){var c=d(this);c.data("wp_id")==a&&c.text(b).attr("title",""+
b+" entries")})},updateUsers:function(a){var b=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.get("email").toLowerCase()});b?b.save({known_as:a.get("known_as"),count:b.get("count")+1}):b=CFW.users.create({email:a.get("email"),known_as:a.get("known_as"),count:1})},returnToEntryList:function(){this.modalView?this.modalView.remove():this.detailView&&this.hideEntry()}});CFW.WhiteboardButtonView=Backbone.View.extend({template:_.template('            <h1><%= buttonText %> <span class="cfw-entry-count-all cfw-hidden"></span></h1>        '),
events:{"click h1":"toggleWhiteboard","click .cfw-classes a":"showClass","newEntryCount .cfw-pane":"updateEntryCounts","mouseenter h1":"hoverButton","mouseleave h1":"unhoverButton"},initialize:function(){var a=this.$el.data("cfwhiteboard");this.affiliateId=a.affiliateId;this.whiteboardId=a.whiteboardId;this.postId=a.postId;this.postPermalink=a.postPermalink;this.postModified=a.postModified;this.wods=a.wods;this.authorization=this.$el.data("authorization");if(-1<_(CFW.instances).chain().pluck("whiteboardId").indexOf(this.whiteboardId).value())this.duplicate=
!0;else return this.render()},render:function(){var a="embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1);if(a){this.$el.last().addClass("cfw-display-embed");1<this.$el.length&&this.$el.first().replaceWith(this.$el.last());var b=d("<div />").addClass("cfw-clearer");this.$el.last().parent().append(b)}this.$el.first().html(this.template({buttonText:CFW_OPTIONS.custom_branding_button_text||"Whiteboard"}));this.whiteboardViews={};var c=this;_.each(c.wods,function(a,b){var d=new CFW.WhiteboardView({affiliateId:c.affiliateId,
whiteboardId:c.whiteboardId,wpId:a.wp_id,postPermalink:c.postPermalink,postModified:c.postModified,allWods:c.wods,authorization:c.authorization,hidden:0==b?!1:!0});c.$el.last().append(d.el);c.whiteboardViews[a.wp_id]=d});a||setTimeout(function(){c.positionWhiteboard();_.each(c.whiteboardViews,function(a){a.detach()})},0);return this},hoverButton:function(){this.$el.first().find("h1").addClass("cfw-hovering");this.attachWhiteboard();this.positionWhiteboard()},unhoverButton:function(a){this.$el.first().find("h1").removeClass("cfw-hovering");
this.detachWhiteboard(a)},attachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")||(this.$el.first().addClass("cfw-attached"),_.each(this.whiteboardViews,function(a){a.attach()}))},detachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")&&!this.$el.first().hasClass("cfw-active")&&!this.$el.first().find("h1").hasClass("cfw-hovering")&&(this.$el.first().removeClass("cfw-attached"),_.each(this.whiteboardViews,function(a){a.detach()}))},toggleWhiteboard:function(a){this.$el.is(".cfw-active")?
this.closeWhiteboard():this.openWhiteboard();a.preventDefault()},openWhiteboard:function(){this.$el.addClass("cfw-active").removeClass("cfw-postactive");var a=this;setTimeout(function(){var b=a.$el.first().offset(),b=a.$el.first().outerWidth(!1)+b.left;a.$el.last().find(".cfw-pane:visible").outerWidth(!1)>=b&&(a.$el.last().addClass("position-inline"),CFW.important.css.apply(a.$el.last(),[{left:"0",margin:"0 10px 10px",right:"auto"},!0]))},0)},closeWhiteboard:function(){this.$el.addClass("cfw-postactive").removeClass("cfw-active");
var a=this;setTimeout(function(){a.$el.removeClass("cfw-postactive");a.detachWhiteboard()},Modernizr.csstransitions?300:0)},positionWhiteboard:function(){if("embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1))this.$el.last().addClass("cfw-active");else if(this.$el.last().parent().is("body")){var a=this.$el.first().offset(),b={position:"absolute",margin:"0",top:a.top+"px"};this.$el.last().is(".position-inline, .position-block, .position-floatleft")?b.left=a.left+"px":(a=this.$el.first().outerWidth(!1)+
a.left,b.right=d(document.body).width()-a,b.right+="px");CFW.important.css.apply(this.$el.last(),[b,!0])}},showClass:function(a){var b=a.target?d(a.target).closest("a").data("wp_id"):a;_.each(this.whiteboardViews,function(a,d){d==b?a.show():a.hide()})},updateEntryCounts:function(a,b,c){this.whiteboardViews[b.toString()].entryCount=c;_.each(this.whiteboardViews,function(a){a.updateEntryCount(b,c)});a=_.inject(this.whiteboardViews,function(a,b){return a+(b.entryCount||0)},0);this.$(".cfw-entry-count-all").text(a).attr("title",
""+a+" entries").removeClass("cfw-hidden")}});CFW.goToHash=function(a){var b=a.split("-");_.each(CFW.instances,function(c){if(!(c.whiteboardId!=b[1]&&c.postId!=b[1])){b[2]&&c.showClass(b[2]);var f=c.$el.offset().top-100;d(document.body).append(d('<span id="'+a.replace(/^#/,"")+'" style="position:absolute; top:'+f+'px; display:none;"></span>'));d("html, body").animate({scrollTop:f},800,function(){c.attachWhiteboard();c.positionWhiteboard();c.openWhiteboard();b[2]&&b[3]&&c.whiteboardViews[b[2]].highlightEntry(b[3])})}})};
CFW.instances=[];setTimeout(function(){CFW.wods=new CFW.WodList;d(".cfwhiteboard").each(function(){var a=d(this);if(!(_.isString(CFW.oxygenTank(CFW_OPTIONS,"whiteboard_exclude_selector",!1))&&0<CFW_OPTIONS.whiteboard_exclude_selector.length)||!a.closest(CFW_OPTIONS.whiteboard_exclude_selector).length){var b=a.closest("a");b.length&&b.before(a);if(!1!=CFW.oxygenTank(CFW_OPTIONS,"position",!1)){b=a.closest(CFW_OPTIONS.position.parent).find(CFW_OPTIONS.position.target);if(b.length)switch(CFW_OPTIONS.position.insertion){case "append":b.append(a);
break;case "before":b.before(a);break;case "after":b.after(a);break;default:b.prepend(a)}switch(CFW_OPTIONS.position.alignment){case "inline":a.addClass("position-inline");break;case "block":a.addClass("position-block");break;case "floatleft":a.addClass("position-floatleft")}CFW_OPTIONS.position.margin&&CFW.important.css.apply(a,[{margin:CFW_OPTIONS.position.margin},!0])}a=a.add(a.clone().appendTo(document.body));a=new CFW.WhiteboardButtonView({el:a});a.duplicate||CFW.instances.push(a)}});CFW.fetchWods=
function(){CFW.wods.fetchFailed=!1;CFW.wods.fetchAttempted=!0;return CFW.wods.fetch({reset:!0,data:CFW.wods.fetchData(),error:function(){CFW.wods.fetchFailed=!0;CFW.wods.trigger("reset")},cache:!1})};CFW.instances.length&&CFW.fetchWods();"embed"!=CFW.oxygenTank(CFW_OPTIONS,"position","display",!1)&&(_.each(CFW.instances,function(a){a.$el.on("click",function(a){a.stopPropagation()})}),d(document.body).on("click",function(){_.each(CFW.instances,function(a){a.closeWhiteboard()})}));0==window.location.hash.indexOf("#cfwhiteboard")&&
CFW.goToHash(window.location.hash)},0)};jQuery(CFW.init);
