var JSON;JSON||(JSON={});
(function(){function b(a){return 10>a?"0"+a:a}function a(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=g[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(b,d){var f,k,g,o,p=e,n,l=d[b];l&&"object"===typeof l&&"function"===typeof l.toJSON&&(l=l.toJSON(b));"function"===typeof h&&(l=h.call(d,b,l));switch(typeof l){case "string":return a(l);case "number":return isFinite(l)?""+l:"null";case "boolean":case "null":return""+l;
case "object":if(!l)return"null";e+=i;n=[];if("[object Array]"===Object.prototype.toString.apply(l)){o=l.length;for(f=0;f<o;f+=1)n[f]=c(f,l)||"null";g=0===n.length?"[]":e?"[\n"+e+n.join(",\n"+e)+"\n"+p+"]":"["+n.join(",")+"]";e=p;return g}if(h&&"object"===typeof h){o=h.length;for(f=0;f<o;f+=1)"string"===typeof h[f]&&(k=h[f],(g=c(k,l))&&n.push(a(k)+(e?": ":":")+g))}else for(k in l)Object.prototype.hasOwnProperty.call(l,k)&&(g=c(k,l))&&n.push(a(k)+(e?": ":":")+g);g=0===n.length?"{}":e?"{\n"+e+n.join(",\n"+
e)+"\n"+p+"}":"{"+n.join(",")+"}";e=p;return g}}if("function"!==typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,i,g={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if("function"!==typeof JSON.stringify)JSON.stringify=function(a,b,d){var f;i=e="";if("number"===typeof d)for(f=0;f<d;f+=1)i+=" ";else"string"===typeof d&&(i=d);if((h=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",
{"":a})};if("function"!==typeof JSON.parse)JSON.parse=function(a,b){function c(a,d){var f,e,h=a[d];if(h&&"object"===typeof h)for(f in h)Object.prototype.hasOwnProperty.call(h,f)&&(e=c(h,f),void 0!==e?h[f]=e:delete h[f]);return b.call(a,d,h)}var f,a=""+a;d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),"function"===typeof b?c({"":f},""):f;throw new SyntaxError("JSON.parse");}})();(function(b){function a(a,c,d){var f,d=d||"",e=d.match(RegExp("(?:^|\\s|;)("+a+")\\s*:\\s*([^;]*(?:;|$))","i"));e&&(e[0]=e[0].replace(/^;/,""));null===c?f="":"string"===typeof c&&(f=a+":"+c+" !important;");e?("boolean"===typeof c&&(f=b.important(a+":"+e[2],c)),d=d.replace(e[0],f)):"undefined"!==typeof f&&(d=b.trim(d),""!==d&&(";"!==d.slice(-1)&&(d+=";"),d+=" "),d+=f);return d}function c(a,b){var d=c.re;if(!d)d=c.re=/\s*(! ?important)?[\s\r\t\n]*;/g;return!1===b?a.replace(d,";"):a.replace(d,function(a,
b){return b?a:" !important;"})}function d(a,b){var f=d.re;if(!f)f=d.re=/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g;return a.replace(f,function(a,d){return c(d,b)})}var f=!1,e={},i={},g=b.each({css:function(d,c){var f={},g=b(this),i=g.attr("style");if("string"===typeof d){if("undefined"===typeof c)return e.css.apply(this,arguments);f[d]=c}else if("object"===typeof d)f=d;else return g;b.each(f,function(b,d){i=a(b,d,i)});return g.attr("style",i)}},function(a,d){e[a]=b.fn[a];d.overridden=!0;i[a]=function(){var c=
b.makeArray(arguments),g=c[c.length-1],i=b(this);return!0===g?d.apply(i,c.slice(0,-1)):f&&!1!==g?d.apply(i,c):e[a].apply(i,c)}});b.extend(b.fn,i);b.important=b.extend(function(){var a=b.makeArray(arguments),e;if("string"===typeof a[0]){if("undefined"===typeof a[1]||"boolean"===typeof a[1])return e=!1!==a[1],/<\w+.*>/.test(a[0])?d(a[0],e):c(a[0],e)}else if(b.isFunction(a[0]))e=f,b.important.status=f=!0,a[0].call(this),b.important.status=f=e;else if("undefined"===typeof a[0]||"boolean"===typeof a[0])b.important.status=
f=!1!==a[0];return f},{status:f,noConflict:function(){b.each(e,function(a,d){b.fn[a]=d});return g},declaration:a});b.fn.important=function(d){var f=b(this),e=b.makeArray(arguments).concat(!0),g=f.data("nodeName"),k;if("undefined"===typeof d||"boolean"===typeof d)g||(g=f.attr("nodeName").toLowerCase(),f.data("nodeName",g)),"style"===g?(k=!1!==d,f.html(c(f.html(),k)),e=f.attr("sheet"),_("stylesheet",e),e&&e.cssRules&&(_("cssRules",e.cssRules),b.each(e.cssRules,function(a,d){_("rule",d,d.cssText);_(b.important(d.style.cssText,
k));if(d.type===CSSRule.STYLE_RULE)d.style.cssText=b.important(d.style.cssText,k)}))):f.attr("style",b.important(f.attr("style"),d));else{if("object"===typeof d)return e.unshift("css"),f.important.apply(this,e);if("string"===typeof d)if(b.isFunction(i[d]))e=e.slice(1),i[d].apply(f,e);else{if("undefined"===typeof e[1]||"boolean"===typeof e[1])k=!1!==e[1],f.attr("style",a(d,k,f.attr("style")))}else b.isFunction(d)&&b.important.call(this,d)}return f}})(jQuery);(function(b){var a=function(a){var b=a.data("scrollbarPaper")||a.data("scrollbar-paper"),c=a.innerHeight(),i=c-a.height();return{height:c,ratio:c/(b.clearer.position().top-((b.content.children(":visible").eq(0).position()||{}).top||0)+i),offset:a.offset()}},c={_init:function(d){d=b.extend({parentSelector:"",css:b.css,show:function(a){a.show()},hide:function(a){a.hide()}},d);return this.each(function(){var c=b(this),e=c.data("scrollbarPaper")||c.data("scrollbar-paper");if(!e){d.css.apply(c,[{"overflow-x":"hidden",
"overflow-y":"auto"},!0]);e=c.closest(d.parentSelector);e.length||(e=c.offsetParent());var i=b('<div class="scrollbarpaper-container"></div>').appendTo(e);d.hide(i);var g=b('<div class="scrollbarpaper-track"></div>').appendTo(i),h=b('<div class="scrollbarpaper-drag"></div>').appendTo(g),e={options:d,offsetParent:e,paper:i,track:g,drag:h,dragTop:b('<div class="scrollbarpaper-drag-top"></div>').appendTo(h),dragBottom:b('<div class="scrollbarpaper-drag-bottom"></div>').appendTo(h),content:c,clearer:b('<div style="clear:both;"></div>').appendTo(c),
offsetHeight:g.outerHeight()-g.height()};c.data("scrollbarPaper",e).data("scrollbar-paper",e);var j=a(c),m=setInterval(function(){if(c.closest(d.parentSelector).length){if(c.is(":visible")){var b=a(c);if(b.height!=j.height||b.ratio!=j.ratio||b.offset.left!=j.offset.left||b.offset.top!=j.offset.top)c.scrollbarPaper("update"),j=b}}else clearInterval(m),i.remove(),c.removeData("scrollbarPaper").removeData("scrollbar-paper")},250)}c.scrollbarPaper("update")})},update:function(d){return this.each(function(){var c=
b(this);if(c.is(":visible")&&!c.data("scrollbarpaperfrozen")){var e=c.data("scrollbarPaper")||c.data("scrollbar-paper");d=d||a(c);c.unbind(".scrollbarPaper");var i=c.innerHeight()-e.offsetHeight;e.options.css.apply(e.track,[{height:i+"px"},!0]);var g=0<e.offsetParent.not("html, body").length?e.offsetParent.offset():{left:0,top:0};e.options.css.apply(e.paper,[{left:-g.left+d.offset.left+c.innerWidth()-e.paper.width()+"px",top:-g.top+d.offset.top+"px"},!0]);var h=Math.max(Math.round(i*d.ratio),e.dragTop.height()+
e.dragBottom.height());e.options.css.apply(e.drag,[{height:h+"px"},!0]);g=function(){e.options.css.apply(e.drag,[{top:Math.min(Math.round(c.scrollTop()*d.ratio),i-h)+"px"},!0])};g();c.bind("scroll.scrollbarPaper",g);var j=function(a){return a.pageY||(a.originalEvent&&(a.originalEvent.targetTouches||a.originalEvent.touches||[])[0]||a).pageY},m=function(){b("body").unbind("mousemove.scrollbarPaper touchmove.scrollbarPaper")};e.drag.bind("mousedown.scrollbarPaper touchstart.scrollbarPaper",function(a){m();
var g=j(a)-e.drag.offset().top;b("body").bind("mousemove.scrollbarPaper touchmove.scrollbarPaper",function(a){a.preventDefault();c.scrollTop((j(a)-c.offset().top-g)/d.ratio);return!1}).bind("mouseup.scrollbarPaper touchend.scrollbarPaper",m);return!1});1>d.ratio?(e.options.show(e.drag),e.content.addClass("scrollbarpaper-visible")):(e.options.hide(e.drag),e.content.removeClass("scrollbarpaper-visible"))}})},show:function(){return this.each(function(){var a=b(this),c=a.data("scrollbarPaper")||a.data("scrollbar-paper");
c&&(a.scrollbarPaper("update"),"function"==typeof c.options.show?c.options.show(c.paper):c.paper.show())})},hide:function(){return this.each(function(){var a=b(this);(a=a.data("scrollbarPaper")||a.data("scrollbar-paper"))&&("function"==typeof a.options.hide?a.options.hide(a.paper):a.paper.hide())})},freeze:function(){return this.each(function(){b(this).data("scrollbarpaperfrozen",!0)})},thaw:function(){return this.each(function(){b(this).data("scrollbarpaperfrozen",!1)})}};b.fn.scrollbarPaper=function(a){if(c[a])return c[a].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return c._init.apply(this,arguments);throw"Method "+a+" does not exist on jQuery.scrollbarPaper.";}})(jQuery);(function(b,a,c){function d(a){return a}function f(a){return decodeURIComponent(a.replace(e," "))}var e=/\+/g,i=b.cookie=function(e,h,j){if(h!==c){j=b.extend({},i.defaults,j);if(null===h)j.expires=-1;if("number"===typeof j.expires){var m=j.expires,q=j.expires=new Date;q.setDate(q.getDate()+m)}h=i.json?JSON.stringify(h):""+h;return a.cookie=[encodeURIComponent(e),"=",i.raw?h:encodeURIComponent(h),j.expires?"; expires="+j.expires.toUTCString():"",j.path?"; path="+j.path:"",j.domain?"; domain="+j.domain:
"",j.secure?"; secure":""].join("")}h=i.raw?d:f;j=a.cookie.split("; ");m=0;for(q=j.length;m<q;m++){var k=j[m].split("=");if(h(k.shift())===e)return e=h(k.join("=")),i.json?JSON.parse(e):e}return null};i.defaults={};b.removeCookie=function(a,c){return null!==b.cookie(a)?(b.cookie(a,null,c),!0):!1}})(jQuery,document);jQuery.cookie.json=!0;function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}window.Store=function(b){this.name=b;this.records=(b=localStorage.getItem(this.name))&&b.split(",")||[]};
_.extend(Store.prototype,{save:function(){localStorage.setItem(this.name,this.records.join(","))},create:function(b){if(!b.id)b.id=b.attributes.id=guid();localStorage.setItem(this.name+"-"+b.id,JSON.stringify(b));this.records.push(b.id.toString());this.save();return b},update:function(b){localStorage.setItem(this.name+"-"+b.id,JSON.stringify(b));_.include(this.records,b.id.toString())||this.records.push(b.id.toString());this.save();return b},find:function(b){return JSON.parse(localStorage.getItem(this.name+
"-"+b.id))},findAll:function(){return _.map(this.records,function(b){return JSON.parse(localStorage.getItem(this.name+"-"+b))},this)},destroy:function(b){localStorage.removeItem(this.name+"-"+b.id);this.records=_.reject(this.records,function(a){return a==b.id.toString()});this.save();return b}});Backbone.remoteSync=Backbone.sync;
Backbone.sync=function(b,a,c,d){"function"==typeof c&&(c={success:c,error:d});var f,e=a.localStorage||a.collection&&a.collection.localStorage;if(!e)return Backbone.remoteSync(b,a,c,d);switch(b){case "read":f=a.id?e.find(a):e.findAll();break;case "create":f=e.create(a);break;case "update":f=e.update(a);break;case "delete":f=e.destroy(a)}f?c.success(f):c.error("Record not found")};window.Modernizr=function(b,a,c){function d(a,c){var b=a.charAt(0).toUpperCase()+a.substr(1),b=(a+" "+j.join(b+" ")+b).split(" ");return f(b,c)}function f(a,b){for(var d in a)if(h[a[d]]!==c)return"pfx"==b?a[d]:!0;return!1}var e={},i=a.documentElement;a.head||a.getElementsByTagName("head");var g=a.createElement("modernizr"),h=g.style,b=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),j="Webkit Moz O ms Khtml".split(" "),g={},m=[],q=function(c,b,d,e){var f,g,h=a.createElement("div");if(parseInt(d,10))for(;d--;)g=
a.createElement("div"),g.id=e?e[d]:"modernizr"+(d+1),h.appendChild(g);f=["&shy;<style>",c,"</style>"].join("");h.id="modernizr";h.innerHTML+=f;i.appendChild(h);c=b(h,c);h.parentNode.removeChild(h);return!!c},k,r={}.hasOwnProperty,o;typeof r!==c&&typeof r.call!==c?o=function(a,c){return r.call(a,c)}:o=function(a,b){return b in a&&typeof a.constructor.prototype[b]===c};(function(a,c){var b=a.join(""),d=c.length;q(b,function(a){for(var a=a.childNodes,c={};d--;)c[a[d].id]=a[d];e.csstransforms3d=9===c.csstransforms3d.offsetLeft},
d,c)})([,["@media (",b.join("transform-3d),("),"modernizr){#csstransforms3d{left:9px;position:absolute}}"].join("")],[,"csstransforms3d"]);g.csstransforms=function(){return!!f(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])};g.csstransforms3d=function(){var a=!!f(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);a&&"webkitPerspective"in i.style&&(a=e.csstransforms3d);return a};g.csstransitions=function(){return d("transitionProperty")};
for(var p in g)o(g,p)&&(k=p.toLowerCase(),e[k]=g[p](),m.push((e[k]?"":"no-")+k));h.cssText="";g=null;e._version="2.0.6";e._prefixes=b;e._domPrefixes=j;e.testProp=function(a){return f([a])};e.testAllProps=d;e.testStyles=q;return e}(this,this.document);"undefined"==typeof CFW&&(CFW={});"undefined"==typeof CFW_OPTIONS&&(CFW_OPTIONS={});CFW.domain=/[.]local/.test(window.location.host)||/rinkl/.test(window.location.host)||/squatc/.test(window.location.host)?"http://tameron.herokuapp.com":"http://cfwhiteboard.com";CFW.important=jQuery.important.noConflict();CFW.oxygenTank=function(){var b=Array.prototype.slice.call(arguments),a=b.pop(),b=_.reduceRight(b,function(a,b){return"undefined"!=typeof a?a[b]:a},b.shift());return"undefined"!=typeof b?b:a};
CFW.ajaxOptions=!jQuery.browser.msie||!window.XDomainRequest?{}:{xhr:function(){try{var b=new XDomainRequest;b.timeout=5E3;var a;b.getAllResponseHeaders=function(){return""};var c=function(c,d){b.onload=b.onerror=b.ontimeout=jQuery.noop;b.status=c;b.statusText=d;b.readyState=4;if(a)b.responseText=a.responseText;b.onreadystatechange&&b.onreadystatechange()},d=function(){a=new XDomainRequest;a.timeout=b.timeout;a.onload=b.onload;a.onerror=b.onerror;a.ontimeout=b.ontimeout;a.open(b.openArgs[0],b.openArgs[1]);
a.send(b.sendArgs[0])};b.onload=function(){c(200,"OK")};b.onerror=function(){a?c(400,"Error"):d()};b.ontimeout=function(){a?c(0,"timeout"):d()};b.originalOpen=b.open;b.open=function(a,c){"PUT"===a?(c+="/revise",a="POST"):"DELETE"===a&&(c+="/annihilate",a="POST");b.openArgs=[a,c];b.originalOpen(a,c)};b.originalSend=b.send;b.send=function(a){var c=function(a){for(var b in a)a[b]="object"==typeof a[b]?c(a[b]):encodeURIComponent(a[b]);return a},a=JSON.stringify(c(JSON.parse(a)));b.sendArgs=[a];setTimeout(function(){b.originalSend(a)},
0)};return b}catch(f){return jQuery.ajaxSettings.xhr()}}};
jQuery(function(b){b(document.embeds).each(function(){var a=b(this);setTimeout(function(){var c=!1,d=a.attr("wmode");"opaque"!=d&&"transparent"!=d&&(a.attr("wmode","opaque"),c=!0);var f=a.closest("object"),d=f.children("param[name=wmode]").val();"opaque"!=d&&"transparent"!=d&&(f.prepend(b('<param name="wmode" value="opaque" />')),c=!0);c&&(f=f.length?f:a,c=f.wrap(b('<span class="cfw-placeholder" />')),c.html(c.html()),c.children().unwrap())},b.browser.msie?300:0)});b("iframe").each(function(){/youtube/.test(this.src)&&
(this.src+=(0<=this.src.indexOf("?")?"&":"?")+"wmode=opaque")})});jQuery(function(b){b.fn.bindBefore=function(a,c){a=a.split(/\s+/);this.each(function(){for(var d=a.length;d--;){b(this).bind(a[d],c);var f=b.data(this,"events")[a[d]];f.splice(0,0,f.pop())}})};b.fn.oneBefore=function(a,c){a=a.split(/\s+/);this.each(function(){for(var d=a.length;d--;){b(this).one(a[d],c);var f=b.data(this,"events")[a[d]];f.splice(0,0,f.pop())}})}});
jQuery(function(b){if(!Modernizr.csstransitions)Modernizr.csstransforms=!1,Modernizr.csstransforms3d=!1;if(/AppleWebKit/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent))Modernizr.csstransforms3d=!1;if(b.browser.msie&&window.XDomainRequest)jQuery.support.cors=!0;CFW.User=Backbone.Model.extend({defaults:function(){return{email:"",known_as:"",count:0,highlightColor:CFW.User.prototype.randomColor()}},randomColor:function(){return[[255,75,105],[255,105,75],[75,105,255],[105,75,255],[75,
255,105],[105,255,75],[123,6,226],[226,6,123],[6,226,123],[6,123,226]][Math.floor(10*Math.random()+0)]}});CFW.UserList=Backbone.Collection.extend({model:CFW.User,initialize:function(){this.localStorage=new Store("cfw-users");return this},comparator:function(a){return-a.get("count")}});CFW.users=new CFW.UserList;CFW.users.fetch();CFW.Entry=Backbone.Model.extend({idAttribute:"_id",defaults:{athlete_id:"",known_as:"",email:"",component_results:[],notes:"",facebook_url:""},emailRegex:/^\S+@\S+\.\S+$/,
validate:function(a){var c=[];!(a.athlete_id||this.attributes&&this.get("athlete_id"))&&!this.emailRegex.test(a.email)&&c.push("email");_.each(a.component_results,function(a){(!a.result||!a.result.length)&&c.push("component-"+a.wp_id+"-result")});(!a.known_as||!a.known_as.replace(/^\s+/,"").replace(/\s+$/,"").length)&&c.push("known_as");if(c.length)return c},setUrlHash:function(){if(this.collection&&this.collection.postId&&this.collection.wod&&this.collection.wod.wp_id){var a="cfwhiteboard-"+this.collection.postId+
"-"+this.collection.wod.wp_id+"-"+this.get("athlete_slug");b(document.body).append(b('<span id="'+a+'" style="position:absolute; top:'+b(document.body).scrollTop()+'px; display:none;"></span>'));window.location.hash=a}}});CFW.EntryList=Backbone.Collection.extend({model:CFW.Entry,url:function(){return CFW.domain+"/affiliates/"+this.affiliateId+"/wods/"+this.postId+"/"+this.wod.wp_id+"/posts"},initialize:function(a,c){this.affiliateId=c.affiliateId;this.postId=c.postId;this.wod=c.wod;return this},comparator:function(a){return a.get("known_as").replace(/^\s+/,
"").toLowerCase()}});CFW.EntryItemView=Backbone.View.extend({tagName:"tr",template:_.template('            <td class="cfw-known-as">                <a href="'+CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink","")+'<%- athlete_slug %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash"><%- known_as %></a>            </td>            <%             if (wod.components && wod.components.length > 1) {                _.each(wod.components, function(component, i, components) {                    var componentResult = _.find(component_results, function(cr) {                        return cr.wp_id == component.wp_id;                    }) || {                        result: "",                        rx: false,                        mods: ""                    };                    var isLast = (i + 1 == components.length);                    %>                     <td class="cfw-component" title="<%- componentResult.result %><%- componentResult.rx ? " [Rx]" : "" %><%- componentResult.mods ? " ("+componentResult.mods+")" : "" %>">                        <%= isLast ? "<div>" : "" %>                        <span class="cfw-result"><%- componentResult.result %></span>                        <span class="cfw-mods">                            <%= componentResult.rx ? "<strong>Rx</strong>" : "" %>                            <%- componentResult.mods %>                        </span>                        <% if (isLast) { %>                            <% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %>                            <span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                        <% } %>                        <%= isLast ? "</div>" : "" %>                    </td>                <%                 });            } else {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == (wod.components[0] || {wp_id: "uh oh"}).wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                 <td class="cfw-result" title="<%- componentResult.result %>"><%- componentResult.result %></td>                <td class="cfw-mods" title="<%- componentResult.rx ? "[Rx] " : "" %><%- componentResult.mods %>">                    <div>                        <%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %><% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %><span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                    </div>                </td>            <%             }            %>         '),
events:{"click *:not(a, a *)":"showDetail","click .cfw-set-url-hash":"setUrlHash"},initialize:function(){this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this);this.model.on("show",this.lookSelected,this);this.model.on("unshow",this.unlookSelected,this);this.model.on("highlight",this.highlight,this);return this.render()},render:function(){this.$el.html(this.template(_.extend({wod:this.options.wod},this.model.toJSON())));return this},lookSelected:function(){this.$el.addClass("cfw-selected")},
unlookSelected:function(){this.$el.removeClass("cfw-selected")},highlight:function(){this.$el.addClass("cfw-highlighted").trigger("scrollToEntry");if(Modernizr.csstransitions)this.$el.addClass("cfw-highlighted-transition").removeClass("cfw-highlighted").one("mouseenter touchstart",function(){b(this).removeClass("cfw-highlighted-transition")});else{var a=this.$el,c=function(){a.toggleClass("cfw-highlighted")};setTimeout(c,300);setTimeout(c,600);setTimeout(c,900);setTimeout(c,1200);setTimeout(function(){a.removeClass("cfw-highlighted")},
1500)}},showDetail:function(a){this.itemClickDisabled||(a.stopPropagation(),this.model.trigger("show",this.model))},setUrlHash:function(){this.model.setUrlHash()}});CFW.WhiteboardPage=Backbone.View.extend({tagName:"div",className:"cfw-page",show:function(){this.$el.addClass("active");var a=this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),a.scrollbarReady=!0;a.showScrollbar()},Modernizr.csstransitions?400:0)},hide:function(){this.freezeScrollbar();this.$el.removeClass("active");var a=
this;setTimeout(function(){a.hideScrollbar();a.thawScrollbar();a.$el.trigger("cfwhide")},Modernizr.csstransitions?300:0)},initScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("show")},hideScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("hide")},freezeScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("freeze")},
thawScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("thaw")}});CFW.EntryListView=CFW.WhiteboardPage.extend({template:_.template('            <table class="cfw-components-<%= wod.components && wod.components.length || 1 %>" cellspacing="0">                <thead>                    <tr>                        <th class="cfw-known-as">Name</th>                        <% _.each(wod.components, function(component) { %>                            <th class="cfw-component" <%= wod.components.length == 1 ? \'colspan="2"\' : "" %> title="<%- component.description %>"><%- component.label %></th>                        <% }); %>                    </tr>                </thead>            </table>            <div class="cfw-scrollable">                <table cellspacing="0" class="cfw-components-<%= wod.components && wod.components.length || 1 %>">                    <tbody>                    </tbody>                </table>            </div>        '),
events:{"scrollToEntry tr":"scrollToEntry","touchmove .cfw-scrollable":"disableItemClicks","touchstart .cfw-scrollable":"enableItemClicks"},initialize:function(a){this.entries=a.entries;this.wod=a.wod;this.entryItemViews=[];this.entries.on("add change:known_as remove reset",this.addAll,this);return this.render()},render:function(){this.$el.html(this.template({wod:this.wod}));return this},addOne:function(a){a=new CFW.EntryItemView({model:a,wod:this.wod});this.entryItemViews.push(a);this.$("tbody").append(a.el)},
addAll:function(){_.each(this.entryItemViews,function(a,c,b){a.remove();delete b[c]});this.$("tbody").empty();this.entries.length?this.entries.each(this.addOne,this):this.$("tbody").append(b('                    <tr class="cfw-no-entries">                        <td colspan="100">No one has added an entry yet.<br /><a class="cfw-new-entry">Add yours now!<a></td>                    </tr>                '))},show:function(){var a=this.$("table").attr("class"),c=this.$el.closest(".cfw-contents");setTimeout(function(){c.addClass(a).data("componentsclass",
a);c.siblings(".cfw-classes").addClass(a)},Modernizr.csstransitions?300:0);CFW.WhiteboardPage.prototype.show.apply(this,arguments)},hide:function(){var a=this.$("table").attr("class");this.$el.closest(".cfw-contents").removeClass(a).removeData("componentsclass").siblings(".cfw-classes").removeClass(a);CFW.WhiteboardPage.prototype.hide.apply(this,arguments)},scrollToEntry:function(a){var c=this.$(".cfw-scrollable").scrollTop(0);(a=b(a.target).position())&&a.top&&c.scrollTop(a.top-15-(c.height()||0)/
2)},disableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!0})},enableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!1})}});CFW.EntryDetailView=CFW.WhiteboardPage.extend({template:_.template('            <div class="cfw-entry-detail">                <a class="cfw-back">back</a><a class="cfw-edit">edit</a>                <dl class="cfw-scrollable">                    <dt class="cfw-hidden">Name</dt>                    <dd class="cfw-known-as">                        <%- known_as %>                        <a href="'+
CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink","")+'<%- athlete_slug %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash">view profile</a>                    </dd>                    <%                    _.each(wod.components, function(component) {                        var componentResult = _.find(component_results, function(cr) {                            return cr.wp_id == component.wp_id;                        }) || {                            result: "",                            rx: false,                            mods: ""                        };                    %>                        <dt><%= component.label %></dt>                        <dd class="cfw-component">                            <span class="cfw-result"><%- componentResult.result %></span>                            <span class="cfw-mods"><%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %></span>                        </dd>                    <%                    });                    %>                    <dt>Notes</dt>                    <dd class="cfw-notes"><%- notes || "(no data)" %></dd>                </dl>            </div>        '),
events:{"click .cfw-set-url-hash":"setUrlHash","click a.cfw-edit":"edit","click a.cfw-back":"back",cfwhide:"cleanup"},initialize:function(a){this.wod=a.wod;this.model.on("change",this.render,this);this.model.on("change",function(){var a=this;setTimeout(function(){a.initScrollbar();a.showScrollbar()},300)},this);this.model.on("destroy",this.hide,this);return this.render()},render:function(){this.$el.html(this.template(_.extend({wod:this.wod},this.model.toJSON())));return this},setUrlHash:function(){this.model.setUrlHash()},
edit:function(){this.model.trigger("edit",this.model)},back:function(){this.$el.trigger("hideEntryDetails")},cleanup:function(){var a=this;setTimeout(function(){a.model.trigger("unshow",a.model);a.remove()},0)}});CFW.ModalPage=Backbone.View.extend({tagName:"div",className:"cfw-scrollable cfw-modal",events:{"focus :input":"scrollToInput","click .cfw-close-modal":"remove"},initScrollbar:function(){this.$el.scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},
hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$el.scrollbarPaper("show")},hideScrollbar:function(){this.$el.scrollbarPaper("hide")},freezeScrollbar:function(){this.$el.scrollbarPaper("freeze")},thawScrollbar:function(){this.$el.scrollbarPaper("thaw")},scrollToInput:function(a){if(!this.height)this.height=this.$el.parent().height();(a=(b(a.target).position()||{}).top)&&this.$el.animate({scrollTop:a+this.$el.scrollTop()-this.height/2},300)},show:function(){var a=this.$el.closest(".cfw-contents"),
c=a.data("componentsclass");c&&(a.removeClass(c),a.siblings(".cfw-classes").removeClass(c));var b=this;setTimeout(function(){b.$el.addClass("cfw-translate-oldfashioned")},0);setTimeout(function(){if(!b.scrollbarReady)b.initScrollbar(),b.scrollbarReady=!0;b.showScrollbar();var a=b.$el.find(":input:first")[0];a&&a.focus&&a.focus()},Modernizr.csstransitions?400:0)},remove:function(a){this.freezeScrollbar();var c=this,b=this.$el.closest(".cfw-contents");this.$el.removeClass("cfw-translate-oldfashioned");
setTimeout(function(){c.hideScrollbar();var f=b.data("componentsclass");f&&(b.addClass(f),b.siblings(".cfw-classes").addClass(f));"object"==typeof a&&a.silent?c.$el.remove():c.$el.trigger("cfwremove").remove()},Modernizr.csstransitions?300:0)}});CFW.EntryFormView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <\!--<h2><%= new_record ? "Add Your Entry" : "Edit Your Entry" %></h2>--\>                <h2><label for="cfw-email">Email Address</label></h2>                <input type="hidden" name="<%= new_record ? "decoy" : "email" %>" value="<%- email %>" />                <input type="email" id="cfw-email" name="<%= new_record ? "email" : "decoy" %>" placeholder="name@example.com" <%= new_record ? "" : \'value="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" disabled="disabled"\' %> />            </fieldset>            <fieldset>                <h2><label for="cfw-known-as">Name</label></h2>                <input type="text" id="cfw-known-as" name="known_as" placeholder="Guest" value="<%- known_as %>" />            </fieldset>            <%            _.each(wod.components, function(component) {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == component.wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                <fieldset>                    <h2><label for="cfw-component-<%= component.wp_id %>-result"><%= component.label %></label></h2>                    <input type="text" id="cfw-component-<%= component.wp_id %>-result" name="component-<%= component.wp_id %>-result" placeholder="What was your result?" value="<%- componentResult.result %>" />                    <div class="cfw-nobr">                        <label for="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority">Modifications</label>                    </div>                    <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                        <input type="checkbox" id="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority" name="component-<%= component.wp_id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                        /><span>or</span><input type="text" id="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority" name="component-<%= component.wp_id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                    </div>                </fieldset>            <%            });            %>            <fieldset class="cfw-last">                <div class="cfw-notes <%= notes ? "cfw-open cfw-opaque" : "" %>">                    <h2><label for="cfw-notes">Notes</label></h2>                    <textarea rows="3" id="cfw-notes" name="notes" placeholder="Notes or Tips for next time?"><%- notes %></textarea>                </div>                <div class="cfw-footer">                    <a class="cfw-add-notes <%= notes ? "cfw-hidden" : "" %>"><label for="cfw-notes"><strong>+</strong> add notes</label></a>                    <input type="submit" value="<%= new_record ? "Submit" : "Save" %>" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{'keyup input[name="email"]':"guessName",'change input[name="email"]':"guessName",'blur input[name="known_as"]':"guessName","click .cfw-add-notes":"showNotesFields",submit:"save"}),initialize:function(a){this.entries=a.entries;this.wod=a.wod;return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(_.extend({wod:this.wod,new_record:!this.model},(this.model||new CFW.Entry).toJSON())));return this},guessName:function(){var a=
this.$('input[name="email"]'),c=this.$('input[name="known_as"]');if(!(c.val().length&&this.lastGuess&&c.val()!=this.lastGuess||c.val().length&&!this.lastGuess)){var b=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.val().toLowerCase()});if(b)c.val(this.lastGuess=b.get("known_as"));else{b=a.val();if(!_.capitalize)_.capitalize=function(a){return a.substring(0,1).toUpperCase()+a.substring(1)};this.lastGuess=_.capitalize((/[^.@0-9]+/.exec(b)||[""])[0]);c.val(this.lastGuess)}}},showNotesFields:function(){var a=
this.$(".cfw-notes").addClass("cfw-open"),b=this.$(".cfw-add-notes").addClass("cfw-transparent");setTimeout(function(){a.addClass("cfw-opaque");b.addClass("cfw-hidden")},Modernizr.csstransitions?200:0)},save:function(a){a.preventDefault();if(!this.isLoading()){var c={email:this.$('input[name="email"]').val(),known_as:this.$('input[name="known_as"]').val(),component_results:[],notes:this.$('textarea[name="notes"]').val()},d={};this.$('input[name^="component-"]').each(function(){var a=b(this),c=a.attr("name").split("-"),
a="checkbox"==a.attr("type")?a.is(":checked"):a.val();d[c[1]]||(d[c[1]]={wp_id:c[1]});d[c[1]][c[2]]=a});_.each(d,function(a){c.component_results.push(a)});var f=this,a=this.model?function(){f.hideLoading();f.remove()}:function(a){f.hideLoading();f.$el.trigger("showEntryShare",a)};f.showLoading();f.$(".ajax-error-notice").remove();a=b.extend({},CFW.ajaxOptions,{success:a,error:function(a,c){f.hideLoading();c&&c.length?f.showValidationErrors(c):f.$(".cfw-footer").after(b('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Click <strong>'+
f.$('input[type="submit"]').val()+"</strong> to try again or contact athlete support if the problem persists.</label>"))},wait:!0});this.model?this.model.save(c,a):this.entries.create(c,a)||this.showValidationErrors(CFW.Entry.prototype.validate(c))}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},
showValidationErrors:function(a){var c=this;_.each(a,function(a){c.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+b(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){b(this).removeClass("cfw-invalid");b('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid")})})}});CFW.EmailAuthView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <h2><label for="cfw-email" title="Enter <%- known_as %>&apos;s Email to Edit" style="white-space:normal;">Enter <%= known_as %>&apos;s Email to Edit</label></h2>                <input type="email" id="cfw-email" name="email" placeholder="name@example.com" value="" />            </fieldset>            <fieldset class="cfw-last">                <div class="cfw-footer">                    <input type="submit" value="Unlock" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{submit:"submit"}),initialize:function(){return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(this.model.toJSON()));return this},submit:function(a){a.preventDefault();if(!this.isLoading()){var c=this.$('input[name="email"]').val(),d=this;d.showLoading();d.$(".ajax-error-notice").remove();a=b.extend({},CFW.ajaxOptions,{complete:function(){d.hideLoading()},success:function(){d.options.success(c)},
error:function(){d.showValidationErrors(["email"]);d.$(".cfw-footer").after(b('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! That email doesn&apos;t match. Please try again or contact <a href="mailto:athletesupport@cfwhiteboard.com">athlete support</a> if there&apos;s any way we can help.</label>'))},type:"POST",data:JSON.stringify({email:c}),cache:!1});b.ajax(CFW.domain+"/athletes/"+this.model.get("athlete_id")+"/verify_email",a)}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},
isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){var c=this;_.each(a,function(a){c.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+b(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){b(this).removeClass("cfw-invalid");b('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid")})})}});
CFW.EntryShareView=CFW.ModalPage.extend({template:_.template('            <div class="cfw-facebook-card">                <p>                    <a href="<%- fbShareUrl %>" class="cfw-fb-action cfw-set-url-hash cfw-close-modal">Share on Facebook</a>                </p>                <p>                    <a href="javascript://" class="cfw-fb-inaction cfw-close-modal">Not this time</a>                </p>                <div class="cfw-fb-footer"></div>                <div class="cfw-fb-logo"></div>            </div>            <p class="cfw-facebook-links">                <a href="javascript://" class="cfw-never-again cfw-close-modal">Don\'t show this message again on this computer</a>            </p>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{"click .cfw-never-again":"neverAgain","click .cfw-set-url-hash":"setUrlHash"}),initialize:function(){return this.render()},render:function(){this.$el.html(this.template({fbShareUrl:this.model.url()+"/share"}));return this},setUrlHash:function(){this.model.setUrlHash()},neverAgain:function(){b.cookie("CFW",b.extend(b.cookie("CFW"),{no_facebook_share_dialog:!0}),{expires:365,path:"/"})}});CFW.WhiteboardView=Backbone.View.extend({className:"cfw-pane",
template:_.template('            <div>                <div class="cfw-window">                    <h2>Entries</h2>                    <a class="cfw-new-entry">+</a>                    <ul class="cfw-classes cfw-<%- allWods.length || 1 %>-classes cfw-components-<%= wod.components && wod.components.length || 1 %>">                        <%                        _.each(allWods, function(w) {                            %><li class="<%- w.wp_id == wod.wp_id ? "cfw-selected" : "" %>"><div>                                <a href="javascript://" data-wp_id="<%- w.wp_id %>" title="<%- w.name %>">                                    <span class="cfw-centered">                                        <span class="cfw-entry-count" data-wp_id="<%- w.wp_id %>"></span>                                        <span class="cfw-link-text"><%- w.name %></span>                                    </span>                                    <span class="cfw-separator"></span>                                </a>                            </div></li><%                        });                        %>                    </ul>                    <div class="cfw-contents"></div>                    <div class="cfw-footer">                        <a href="http://cfwhiteboard.com" target="_blank">                            What Is This?                        </a><a href="mailto:athletesupport@cfwhiteboard.com">                            Email Athlete Support                        </a>                    </div>                </div>            </div>            <a class="cfw-print cfw-admin-tool cfw-hidden" target="_blank">Print</a>        '),
events:{"click .cfw-new-entry:not([disabled])":"newEntry",hideEntryDetails:"hideEntry","cfwremove .cfw-modal":"cleanupModal",showEntryShare:"showEntryShare","click .cfw-classes a":"returnToEntryList"},initialize:function(a){this.entries=new CFW.EntryList([],{affiliateId:a.affiliateId,postId:a.postId,wod:a.wod});this.entries.on("add remove reset",this.newEntryCount,this);this.entries.on("edit",this.editEntry,this);this.entries.on("show",this.showEntry,this);this.entries.on("add change:known_as",this.updateUsers,
this);this.render();a.hidden&&this.hide();this.entries.fetch(b.extend({},CFW.ajaxOptions,{data:{postModified:a.postModified}}))},render:function(){this.$el.html(this.template({wod:this.options.wod,allWods:this.options.allWods}));this.entryListView=new CFW.EntryListView({entries:this.entries,wod:this.options.wod});this.$(".cfw-contents").append(this.entryListView.el);this.entryListView.show();"admin"==this.options.authorization&&(this.$(".cfw-print").attr("href",this.entries.url()),this.$(".cfw-admin-tool").removeClass("cfw-hidden"));
return this},attach:function(){this.$children&&this.$el.append(this.$children)},detach:function(){this.$children=this.$el.children();this.$children.detach()},show:function(){this.$el.removeClass("cfw-hidden")},hide:function(){this.$el.addClass("cfw-hidden")},newEntry:function(){this.showEntryForm()},editEntry:function(a){var c=this;this.showEmailAuth(a,function(b){c.modalView.remove({silent:!0});a.set({email:b},{silent:!0});c.showEntryForm(a)})},highlightEntry:function(a){var b=this,d=function(){(b.entries.get(a)||
b.entries.find(function(b){return b.get("athlete_slug")==a})).trigger("highlight")};if(this.entries.length)d();else this.entries.on("reset",d)},showEmailAuth:function(a,b){this.disableNewEntries();this.modalView=new CFW.EmailAuthView({model:a,success:b});this.$(".cfw-contents").append(this.modalView.el);var d=this;setTimeout(function(){d.detailView?d.detailView.hideScrollbar():d.entryListView.hideScrollbar();d.modalView.show()},0)},showEntryForm:function(a){this.modalView=new CFW.EntryFormView({entries:this.entries,
model:a,wod:this.options.wod});this.$(".cfw-contents").append(this.modalView.el);var b=this;setTimeout(function(){a||(b.detailView?b.detailView.hideScrollbar():b.entryListView.hideScrollbar());b.disableNewEntries();b.modalView.show()},0)},showEntryShare:function(a,c){var d=b.cookie("CFW");if(d&&d.no_facebook_share_dialog)this.modalView.remove();else{this.modalView.remove({silent:!0});this.modalView=new CFW.EntryShareView({model:c,wod:this.options.wod,postId:this.options.postId,postPermalink:this.options.postPermalink});
this.$(".cfw-contents").append(this.modalView.el);var f=this;setTimeout(function(){f.modalView.show()},0)}},cleanupModal:function(){this.enableNewEntries();this.detailView?this.detailView.showScrollbar():this.entryListView.showScrollbar();delete this.modalView},disableNewEntries:function(){this.$el.find(".cfw-new-entry").attr("disabled",!0)},enableNewEntries:function(){this.$el.find(".cfw-new-entry").removeAttr("disabled")},showEntry:function(a){this.detailView=new CFW.EntryDetailView({model:a,wod:this.options.wod});
this.$(".cfw-contents").append(this.detailView.el);var b=this;setTimeout(function(){b.entryListView.hide();b.detailView.show()},0)},hideEntry:function(){this.detailView.hide();this.entryListView.show();var a=this;setTimeout(function(){delete a.detailView},Modernizr.csstransitions?400:100)},newEntryCount:function(){this.$el.trigger("newEntryCount",[this.options.wod.wp_id,this.entries.length])},updateEntryCount:function(a,c){var d=this.$(".cfw-entry-count");0==d.length&&(d=this.$children.find(".cfw-entry-count"));
1<d.length&&d.each(function(){var d=b(this);d.data("wp_id")==a&&d.text(c).attr("title",""+c+" entries")})},updateUsers:function(a){var b=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.get("email").toLowerCase()});b?b.save({known_as:a.get("known_as"),count:b.get("count")+1}):b=CFW.users.create({email:a.get("email"),known_as:a.get("known_as"),count:1})},returnToEntryList:function(){this.modalView?this.modalView.remove():this.detailView&&this.hideEntry()}});CFW.WhiteboardButtonView=
Backbone.View.extend({template:_.template('            <h1>Whiteboard <span class="cfw-entry-count-all cfw-hidden"></span></h1>        '),events:{"click h1":"toggleWhiteboard","click .cfw-classes a":"showClass","newEntryCount .cfw-pane":"updateEntryCounts","mouseenter h1":"hoverButton","mouseleave h1":"unhoverButton"},initialize:function(){var a=this.$el.data("cfwhiteboard");this.affiliateId=a.affiliateId;this.postId=a.postId;this.postPermalink=a.postPermalink;this.postModified=a.postModified;this.wods=
a.wods;this.authorization=this.$el.data("authorization");return-1<_.indexOf(_.pluck(CFW.instances,"postId"),this.postId)?void 0:this.render()},render:function(){if("embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1)&&1<this.$el.length){this.$el.first().replaceWith(this.$el.last().addClass("cfw-display-embed"));var a=b("<div />").addClass("cfw-clearer");this.$el.last().parent().append(a)}this.$el.first().html(this.template());this.positionWhiteboard();this.whiteboardViews={};var c=this;_.each(c.wods,
function(a,b){c.wods[b].name=a.name.replace(/workout of the day/ig,"WOD")});_.each(c.wods,function(a,b){var e=new CFW.WhiteboardView({affiliateId:c.affiliateId,postId:c.postId,postPermalink:c.postPermalink,postModified:c.postModified,wod:a,allWods:c.wods,authorization:c.authorization,hidden:0==b?!1:!0});c.$el.last().append(e.el);c.whiteboardViews[a.wp_id]=e;setTimeout(function(){e.detach()},0)});return this},hoverButton:function(){this.$el.first().find("h1").addClass("cfw-hovering");this.attachWhiteboard();
this.positionWhiteboard()},unhoverButton:function(a){this.$el.first().find("h1").removeClass("cfw-hovering");this.detachWhiteboard(a)},attachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")||(this.$el.first().addClass("cfw-attached"),_.each(this.whiteboardViews,function(a){a.attach()}))},detachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")&&!this.$el.first().hasClass("cfw-active")&&!this.$el.first().find("h1").hasClass("cfw-hovering")&&(this.$el.first().removeClass("cfw-attached"),
_.each(this.whiteboardViews,function(a){a.detach()}))},toggleWhiteboard:function(a){this.$el.is(".cfw-active")?this.closeWhiteboard():this.openWhiteboard();a.preventDefault()},openWhiteboard:function(){this.$el.addClass("cfw-active").removeClass("cfw-postactive")},closeWhiteboard:function(){this.$el.addClass("cfw-postactive").removeClass("cfw-active");var a=this;setTimeout(function(){a.$el.removeClass("cfw-postactive");a.detachWhiteboard()},Modernizr.csstransitions?300:0)},positionWhiteboard:function(){if("embed"==
CFW.oxygenTank(CFW_OPTIONS,"position","display",!1))this.$el.last().addClass("cfw-active");else if(this.$el.last().parent().is("body")){var a=this.$el.first().offset(),c={position:"absolute",margin:"0",top:a.top+"px"};this.$el.last().is(".position-inline, .position-block, .position-floatleft")?c.left=a.left+"px":(c.right=b(document).width()-this.$el.first().outerWidth(!1)-a.left,c.right+="px");CFW.important.css.apply(this.$el.last(),[c,!0])}},showClass:function(a){var c=a.target?b(a.target).closest("a").data("wp_id"):
a;_.each(this.whiteboardViews,function(a,b){b==c?a.show():a.hide()})},updateEntryCounts:function(a,b,d){this.whiteboardViews[b.toString()].entryCount=d;_.each(this.whiteboardViews,function(a){a.updateEntryCount(b,d)});a=_.inject(this.whiteboardViews,function(a,b){return a+(b.entryCount||0)},0);this.$(".cfw-entry-count-all").text(a).attr("title",""+a+" entries").removeClass("cfw-hidden")}});CFW.instances=[];setTimeout(function(){b(".cfwhiteboard").each(function(){var a=b(this),d=a.closest("a");d.length&&
d.before(a);if(!1!=CFW.oxygenTank(CFW_OPTIONS,"position",!1)){d=a.closest(CFW_OPTIONS.position.parent).find(CFW_OPTIONS.position.target);if(d.length)switch(CFW_OPTIONS.position.insertion){case "append":d.append(a);break;case "before":d.before(a);break;case "after":d.after(a);break;default:d.prepend(a)}switch(CFW_OPTIONS.position.alignment){case "inline":a.addClass("position-inline");break;case "block":a.addClass("position-block");break;case "floatleft":a.addClass("position-floatleft")}CFW_OPTIONS.position.margin&&
CFW.important.css.apply(a,[{margin:CFW_OPTIONS.position.margin},!0])}a=a.add(a.clone().appendTo(document.body));CFW.instances.push(new CFW.WhiteboardButtonView({el:a}))});"embed"!=CFW.oxygenTank(CFW_OPTIONS,"position","display",!1)&&(_.each(CFW.instances,function(a){a.$el.on("click",function(a){a.stopPropagation()})}),b(document.body).on("click",function(){_.each(CFW.instances,function(a){a.closeWhiteboard()})}));if(0==window.location.hash.indexOf("#cfwhiteboard")){var a=window.location.hash.split("-");
_.each(CFW.instances,function(c){if(c.postId==a[1]){a[2]&&c.showClass(a[2]);var d=c.$el.offset().top-100;b(document.body).append(b('<span id="'+window.location.hash.replace(/^#/,"")+'" style="position:absolute; top:'+d+'px; display:none;"></span>'));b("html, body").animate({scrollTop:d},800,function(){c.attachWhiteboard();c.openWhiteboard();a[2]&&a[3]&&c.whiteboardViews[a[2]].highlightEntry(a[3])})}})}},b.browser.msie?1500:0)});
