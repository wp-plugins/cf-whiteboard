var JSON;JSON||(JSON={});
(function(){function b(a){return 10>a?"0"+a:a}function h(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var c=d[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function g(b,d){var e,f,n,p,q=a,o,j=d[b];j&&"object"===typeof j&&"function"===typeof j.toJSON&&(j=j.toJSON(b));"function"===typeof i&&(j=i.call(d,b,j));switch(typeof j){case "string":return h(j);case "number":return isFinite(j)?""+j:"null";case "boolean":case "null":return""+j;
case "object":if(!j)return"null";a+=c;o=[];if("[object Array]"===Object.prototype.toString.apply(j)){p=j.length;for(e=0;e<p;e+=1)o[e]=g(e,j)||"null";n=0===o.length?"[]":a?"[\n"+a+o.join(",\n"+a)+"\n"+q+"]":"["+o.join(",")+"]";a=q;return n}if(i&&"object"===typeof i){p=i.length;for(e=0;e<p;e+=1)"string"===typeof i[e]&&(f=i[e],(n=g(f,j))&&o.push(h(f)+(a?": ":":")+n))}else for(f in j)Object.prototype.hasOwnProperty.call(j,f)&&(n=g(f,j))&&o.push(h(f)+(a?": ":":")+n);n=0===o.length?"{}":a?"{\n"+a+o.join(",\n"+
a)+"\n"+q+"}":"{"+o.join(",")+"}";a=q;return n}}if("function"!==typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,c,d={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if("function"!==typeof JSON.stringify)JSON.stringify=function(b,d,e){var f;c=a="";if("number"===typeof e)for(f=0;f<e;f+=1)c+=" ";else"string"===typeof e&&(c=e);if((i=d)&&"function"!==typeof d&&("object"!==typeof d||"number"!==typeof d.length))throw Error("JSON.stringify");return g("",
{"":b})};if("function"!==typeof JSON.parse)JSON.parse=function(a,c){function b(a,d){var i,e,f=a[d];if(f&&"object"===typeof f)for(i in f)Object.prototype.hasOwnProperty.call(f,i)&&(e=b(f,i),void 0!==e?f[i]=e:delete f[i]);return c.call(a,d,f)}var d,a=""+a;f.lastIndex=0;f.test(a)&&(a=a.replace(f,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"===typeof c?b({"":d},""):d;throw new SyntaxError("JSON.parse");}})();(function(b){function h(a,c,d){var e,d=d||"",f=d.match(RegExp("(?:^|\\s|;)("+a+")\\s*:\\s*([^;]*(?:;|$))","i"));f&&(f[0]=f[0].replace(/^;/,""));null===c?e="":"string"===typeof c&&(e=a+":"+c+" !important;");f?("boolean"===typeof c&&(e=b.important(a+":"+f[2],c)),d=d.replace(f[0],e)):"undefined"!==typeof e&&(d=b.trim(d),""!==d&&(";"!==d.slice(-1)&&(d+=";"),d+=" "),d+=e);return d}function g(a,c){var b=g.re;if(!b)b=g.re=/\s*(! ?important)?[\s\r\t\n]*;/g;return!1===c?a.replace(b,";"):a.replace(b,function(a,
c){return c?a:" !important;"})}function f(a,c){var b=f.re;if(!b)b=f.re=/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g;return a.replace(b,function(a,b){return g(b,c)})}var e=!1,a={},c={},d=b.each({css:function(c,d){var e={},f=b(this),g=f.attr("style");if("string"===typeof c){if("undefined"===typeof d)return a.css.apply(this,arguments);e[c]=d}else if("object"===typeof c)e=c;else return f;b.each(e,function(a,c){g=h(a,c,g)});return f.attr("style",g)}},function(d,f){a[d]=b.fn[d];f.overridden=!0;c[d]=function(){var c=
b.makeArray(arguments),h=c[c.length-1],g=b(this);return!0===h?f.apply(g,c.slice(0,-1)):e&&!1!==h?f.apply(g,c):a[d].apply(g,c)}});b.extend(b.fn,c);b.important=b.extend(function(){var a=b.makeArray(arguments),c;if("string"===typeof a[0]){if("undefined"===typeof a[1]||"boolean"===typeof a[1])return c=!1!==a[1],/<\w+.*>/.test(a[0])?f(a[0],c):g(a[0],c)}else if(b.isFunction(a[0]))c=e,b.important.status=e=!0,a[0].call(this),b.important.status=e=c;else if("undefined"===typeof a[0]||"boolean"===typeof a[0])b.important.status=
e=!1!==a[0];return e},{status:e,noConflict:function(){b.each(a,function(a,c){b.fn[a]=c});return d},declaration:h});b.fn.important=function(a){var d=b(this),e=b.makeArray(arguments).concat(!0),f=d.data("nodeName"),l;if("undefined"===typeof a||"boolean"===typeof a)f||(f=d.attr("nodeName").toLowerCase(),d.data("nodeName",f)),"style"===f?(l=!1!==a,d.html(g(d.html(),l)),e=d.attr("sheet"),_("stylesheet",e),e&&e.cssRules&&(_("cssRules",e.cssRules),b.each(e.cssRules,function(a,c){_("rule",c,c.cssText);_(b.important(c.style.cssText,
l));if(c.type===CSSRule.STYLE_RULE)c.style.cssText=b.important(c.style.cssText,l)}))):d.attr("style",b.important(d.attr("style"),a));else{if("object"===typeof a)return e.unshift("css"),d.important.apply(this,e);if("string"===typeof a)if(b.isFunction(c[a]))e=e.slice(1),c[a].apply(d,e);else{if("undefined"===typeof e[1]||"boolean"===typeof e[1])l=!1!==e[1],d.attr("style",h(a,l,d.attr("style")))}else b.isFunction(a)&&b.important.call(this,a)}return d}})(jQuery);(function(b){var h=function(b){var e=b.data("scrollbarPaper")||b.data("scrollbar-paper"),a=b.innerHeight(),c=a-b.height();return{height:a,ratio:a/(e.clearer.position().top-((e.content.children(":visible").eq(0).position()||{}).top||0)+c),offset:b.offset()}},g={_init:function(f){f=b.extend({parentSelector:"",css:b.css,show:function(b){b.show()},hide:function(b){b.hide()}},f);return this.each(function(){var e=b(this),a=e.data("scrollbarPaper")||e.data("scrollbar-paper");if(!a){f.css.apply(e,[{"overflow-x":"hidden",
"overflow-y":"auto"},!0]);a=e.closest(f.parentSelector);a.length||(a=e.offsetParent());var c=b('<div class="scrollbarpaper-container"></div>').appendTo(a);f.hide(c);var d=b('<div class="scrollbarpaper-track"></div>').appendTo(c),i=b('<div class="scrollbarpaper-drag"></div>').appendTo(d),a={options:f,offsetParent:a,paper:c,track:d,drag:i,dragTop:b('<div class="scrollbarpaper-drag-top"></div>').appendTo(i),dragBottom:b('<div class="scrollbarpaper-drag-bottom"></div>').appendTo(i),content:e,clearer:b('<div style="clear:both;"></div>').appendTo(e),
offsetHeight:d.outerHeight()-d.height()};e.data("scrollbarPaper",a).data("scrollbar-paper",a);var g=h(e),m=setInterval(function(){if(e.closest(f.parentSelector).length){if(e.is(":visible")){var a=h(e);if(a.height!=g.height||a.ratio!=g.ratio||a.offset.left!=g.offset.left||a.offset.top!=g.offset.top)e.scrollbarPaper("update"),g=a}}else clearInterval(m),c.remove(),e.removeData("scrollbarPaper").removeData("scrollbar-paper")},250)}e.scrollbarPaper("update")})},update:function(f){return this.each(function(){var e=
b(this);if(e.is(":visible")&&!e.data("scrollbarpaperfrozen")){var a=e.data("scrollbarPaper")||e.data("scrollbar-paper");f=f||h(e);e.unbind(".scrollbarPaper");var c=e.innerHeight()-a.offsetHeight;a.options.css.apply(a.track,[{height:c+"px"},!0]);var d=0<a.offsetParent.not("html, body").length?a.offsetParent.offset():{left:0,top:0};a.options.css.apply(a.paper,[{left:-d.left+f.offset.left+e.innerWidth()-a.paper.width()+"px",top:-d.top+f.offset.top+"px"},!0]);var i=Math.max(Math.round(c*f.ratio),a.dragTop.height()+
a.dragBottom.height());a.options.css.apply(a.drag,[{height:i+"px"},!0]);d=function(){a.options.css.apply(a.drag,[{top:Math.min(Math.round(e.scrollTop()*f.ratio),c-i)+"px"},!0])};d();e.bind("scroll.scrollbarPaper",d);var g=function(a){return a.pageY||(a.originalEvent&&(a.originalEvent.targetTouches||a.originalEvent.touches||[])[0]||a).pageY},m=function(){b("body").unbind("mousemove.scrollbarPaper touchmove.scrollbarPaper")};a.drag.bind("mousedown.scrollbarPaper touchstart.scrollbarPaper",function(c){m();
var d=g(c)-a.drag.offset().top;b("body").bind("mousemove.scrollbarPaper touchmove.scrollbarPaper",function(a){a.preventDefault();e.scrollTop((g(a)-e.offset().top-d)/f.ratio);return!1}).bind("mouseup.scrollbarPaper touchend.scrollbarPaper",m);return!1});1>f.ratio?(a.options.show(a.drag),a.content.addClass("scrollbarpaper-visible")):(a.options.hide(a.drag),a.content.removeClass("scrollbarpaper-visible"))}})},show:function(){return this.each(function(){var f=b(this),e=f.data("scrollbarPaper")||f.data("scrollbar-paper");
e&&(f.scrollbarPaper("update"),"function"==typeof e.options.show?e.options.show(e.paper):e.paper.show())})},hide:function(){return this.each(function(){var f=b(this);(f=f.data("scrollbarPaper")||f.data("scrollbar-paper"))&&("function"==typeof f.options.hide?f.options.hide(f.paper):f.paper.hide())})},freeze:function(){return this.each(function(){b(this).data("scrollbarpaperfrozen",!0)})},thaw:function(){return this.each(function(){b(this).data("scrollbarpaperfrozen",!1)})}};b.fn.scrollbarPaper=function(b){if(g[b])return g[b].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof b||!b)return g._init.apply(this,arguments);throw"Method "+b+" does not exist on jQuery.scrollbarPaper.";}})(jQuery);(function(b,h,g){function f(a){return a}function e(c){return decodeURIComponent(c.replace(a," "))}var a=/\+/g,c=b.cookie=function(a,i,k){if(i!==g){k=b.extend({},c.defaults,k);if(null===i)k.expires=-1;if("number"===typeof k.expires){var m=k.expires,r=k.expires=new Date;r.setDate(r.getDate()+m)}i=c.json?JSON.stringify(i):""+i;return h.cookie=[encodeURIComponent(a),"=",c.raw?i:encodeURIComponent(i),k.expires?"; expires="+k.expires.toUTCString():"",k.path?"; path="+k.path:"",k.domain?"; domain="+k.domain:
"",k.secure?"; secure":""].join("")}i=c.raw?f:e;k=h.cookie.split("; ");m=0;for(r=k.length;m<r;m++){var l=k[m].split("=");if(i(l.shift())===a)return a=i(l.join("=")),c.json?JSON.parse(a):a}return null};c.defaults={};b.removeCookie=function(a,c){return null!==b.cookie(a)?(b.cookie(a,null,c),!0):!1}})(jQuery,document);jQuery.cookie.json=!0;function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}window.Store=function(b){this.name=b;this.records=(b=localStorage.getItem(this.name))&&b.split(",")||[]};
_.extend(Store.prototype,{save:function(){localStorage.setItem(this.name,this.records.join(","))},create:function(b){if(!b.id)b.id=b.attributes.id=guid();localStorage.setItem(this.name+"-"+b.id,JSON.stringify(b));this.records.push(b.id.toString());this.save();return b},update:function(b){localStorage.setItem(this.name+"-"+b.id,JSON.stringify(b));_.include(this.records,b.id.toString())||this.records.push(b.id.toString());this.save();return b},find:function(b){return JSON.parse(localStorage.getItem(this.name+
"-"+b.id))},findAll:function(){return _.map(this.records,function(b){return JSON.parse(localStorage.getItem(this.name+"-"+b))},this)},destroy:function(b){localStorage.removeItem(this.name+"-"+b.id);this.records=_.reject(this.records,function(h){return h==b.id.toString()});this.save();return b}});Backbone.remoteSync=Backbone.sync;
Backbone.sync=function(b,h,g,f){"function"==typeof g&&(g={success:g,error:f});var e,a=h.localStorage||h.collection&&h.collection.localStorage;if(!a)return Backbone.remoteSync(b,h,g,f);switch(b){case "read":e=h.id?a.find(h):a.findAll();break;case "create":e=a.create(h);break;case "update":e=a.update(h);break;case "delete":e=a.destroy(h)}e?g.success(e):g.error("Record not found")};window.Modernizr=function(b,h,g){function f(a,c){var b=a.charAt(0).toUpperCase()+a.substr(1),b=(a+" "+k.join(b+" ")+b).split(" ");return e(b,c)}function e(a,c){for(var b in a)if(i[a[b]]!==g)return"pfx"==c?a[b]:!0;return!1}var a={},c=h.documentElement;h.head||h.getElementsByTagName("head");var d=h.createElement("modernizr"),i=d.style,b=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),k="Webkit Moz O ms Khtml".split(" "),d={},m=[],r=function(a,b,d,e){var f,i,g=h.createElement("div");if(parseInt(d,10))for(;d--;)i=
h.createElement("div"),i.id=e?e[d]:"modernizr"+(d+1),g.appendChild(i);f=["&shy;<style>",a,"</style>"].join("");g.id="modernizr";g.innerHTML+=f;c.appendChild(g);a=b(g,a);g.parentNode.removeChild(g);return!!a},l,n={}.hasOwnProperty,p;typeof n!==g&&typeof n.call!==g?p=function(a,c){return n.call(a,c)}:p=function(a,c){return c in a&&typeof a.constructor.prototype[c]===g};(function(c,b){var d=c.join(""),e=b.length;r(d,function(c){for(var c=c.childNodes,b={};e--;)b[c[e].id]=c[e];a.csstransforms3d=9===b.csstransforms3d.offsetLeft},
e,b)})([,["@media (",b.join("transform-3d),("),"modernizr){#csstransforms3d{left:9px;position:absolute}}"].join("")],[,"csstransforms3d"]);d.csstransforms=function(){return!!e(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])};d.csstransforms3d=function(){var b=!!e(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);b&&"webkitPerspective"in c.style&&(b=a.csstransforms3d);return b};d.csstransitions=function(){return f("transitionProperty")};
for(var q in d)p(d,q)&&(l=q.toLowerCase(),a[l]=d[q](),m.push((a[l]?"":"no-")+l));i.cssText="";d=null;a._version="2.0.6";a._prefixes=b;a._domPrefixes=k;a.testProp=function(a){return e([a])};a.testAllProps=f;a.testStyles=r;return a}(this,this.document);"undefined"==typeof CFW&&(CFW={});"undefined"==typeof CFW_OPTIONS&&(CFW_OPTIONS={});CFW.domain=/[.]local/.test(window.location.host)||/yestech/.test(window.location.host)||/asqua/.test(window.location.host)?"http://tameron.herokuapp.com":"http://cfwhiteboard.com";CFW.important=jQuery.important.noConflict();CFW.oxygenTank=function(){var b=Array.prototype.slice.call(arguments),h=b.pop(),b=_.inject(b,function(b,f){return"undefined"!=typeof b?b[f]:b},b.shift());return"undefined"!=typeof b?b:h};
CFW.ajaxOptions=!jQuery.browser.msie||!window.XDomainRequest?{}:{xhr:function(){try{var b=new XDomainRequest;b.timeout=5E3;var h;b.getAllResponseHeaders=function(){return""};var g=function(a,c){b.onload=b.onerror=b.ontimeout=jQuery.noop;b.status=a;b.statusText=c;b.readyState=4;if(h)b.responseText=h.responseText;b.onreadystatechange&&b.onreadystatechange()},f=function(){h=new XDomainRequest;h.timeout=b.timeout;h.onload=b.onload;h.onerror=b.onerror;h.ontimeout=b.ontimeout;h.open(b.openArgs[0],b.openArgs[1]);
h.send(b.sendArgs[0])};b.onload=function(){g(200,"OK")};b.onerror=function(){h?g(400,"Error"):f()};b.ontimeout=function(){h?g(0,"timeout"):f()};b.originalOpen=b.open;b.open=function(a,c){"PUT"===a?(c+="/revise",a="POST"):"DELETE"===a&&(c+="/annihilate",a="POST");b.openArgs=[a,c];b.originalOpen(a,c)};b.originalSend=b.send;b.send=function(a){var c=function(a){for(var b in a)a[b]="object"==typeof a[b]?c(a[b]):encodeURIComponent(a[b]);return a},a=JSON.stringify(c(JSON.parse(a)));b.sendArgs=[a];setTimeout(function(){b.originalSend(a)},
0)};return b}catch(e){return jQuery.ajaxSettings.xhr()}}};
jQuery(function(b){b(document.embeds).each(function(){var h=b(this);setTimeout(function(){var g=!1,f=h.attr("wmode");"opaque"!=f&&"transparent"!=f&&(h.attr("wmode","opaque"),g=!0);var e=h.closest("object"),f=e.children("param[name=wmode]").val();"opaque"!=f&&"transparent"!=f&&(e.prepend(b('<param name="wmode" value="opaque" />')),g=!0);g&&(e=e.length?e:h,g=e.wrap(b('<span class="cfw-placeholder" />')),g.html(g.html()),g.children().unwrap())},b.browser.msie?300:0)});b("iframe").each(function(){/youtube/.test(this.src)&&
(this.src+=(0<=this.src.indexOf("?")?"&":"?")+"wmode=opaque")})});jQuery(function(b){b.fn.bindBefore=function(h,g){h=h.split(/\s+/);this.each(function(){for(var f=h.length;f--;){b(this).bind(h[f],g);var e=b.data(this,"events")[h[f]];e.splice(0,0,e.pop())}})};b.fn.oneBefore=function(h,g){h=h.split(/\s+/);this.each(function(){for(var f=h.length;f--;){b(this).one(h[f],g);var e=b.data(this,"events")[h[f]];e.splice(0,0,e.pop())}})}});
jQuery(function(b){function h(){g(b(f)).removeClass("open")}function g(a){var c=a.attr("data-target");c||(c=(c=a.attr("href"))&&c.replace(/.*(?=#[^\s]*$)/,""));c=b(c);c.length||(c=a.parent());return c}if(!Modernizr.csstransitions)Modernizr.csstransforms=!1,Modernizr.csstransforms3d=!1;if(/AppleWebKit/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent))Modernizr.csstransforms3d=!1;if(b.browser.msie&&window.XDomainRequest)jQuery.support.cors=!0;var f="[data-toggle=dropdown]",e=function(a){var c=
b(a).on("click.dropdown.data-api",this.toggle);b("html").on("click.dropdown.data-api",function(){c.parent().removeClass("open")})};e.prototype={constructor:e,toggle:function(){var a=b(this),c,d;if(!a.is(".disabled, :disabled"))return c=g(a),d=c.hasClass("open"),h(),d||(c.toggleClass("open"),a.focus()),!1},keydown:function(a){var c,d,e;if(/(38|40|27)/.test(a.keyCode)&&(c=b(this),a.preventDefault(),a.stopPropagation(),!c.is(".disabled, :disabled"))){d=g(c);e=d.hasClass("open");if(!e||e&&27==a.keyCode)return c.click();
c=b("[role=menu] li:not(.divider) a",d);c.length&&(d=c.index(c.filter(":focus")),38==a.keyCode&&0<d&&d--,40==a.keyCode&&d<c.length-1&&d++,~d||(d=0),c.eq(d).focus())}}};b.fn.dropdown=function(a){return this.each(function(){var c=b(this),d=c.data("dropdown");d||c.data("dropdown",d=new e(this));"string"==typeof a&&d[a].call(c)})};b.fn.dropdown.Constructor=e;CFW.User=Backbone.Model.extend({defaults:function(){return{email:"",known_as:"",count:0,highlightColor:CFW.User.prototype.randomColor()}},randomColor:function(){return[[255,
75,105],[255,105,75],[75,105,255],[105,75,255],[75,255,105],[105,255,75],[123,6,226],[226,6,123],[6,226,123],[6,123,226]][Math.floor(10*Math.random()+0)]}});CFW.UserList=Backbone.Collection.extend({model:CFW.User,initialize:function(){this.localStorage=new Store("cfw-users");return this},comparator:function(a){return-a.get("count")}});CFW.users=new CFW.UserList;CFW.users.fetch();CFW.Entry=Backbone.Model.extend({idAttribute:"_id",defaults:{athlete_id:"",known_as:"",email:"",component_results:[],notes:"",
facebook_url:""},emailRegex:/^\S+@\S+\.\S+$/,validate:function(a){var c=[];!(a.athlete_id||this.attributes&&this.get("athlete_id"))&&!this.emailRegex.test(a.email)&&c.push("email");(!a.known_as||!a.known_as.replace(/^\s+/,"").replace(/\s+$/,"").length)&&c.push("known_as");if(c.length)return c},setUrlHash:function(){if(this.collection&&this.collection.postId&&this.collection.wod&&this.collection.wod.wp_id){var a="cfwhiteboard-"+this.collection.postId+"-"+this.collection.wod.wp_id+"-"+this.get("athlete_slug");
b(document.body).append(b('<span id="'+a+'" style="position:absolute; top:'+b(document.body).scrollTop()+'px; display:none;"></span>'));window.location.hash=a}}});CFW.EntryList=Backbone.Collection.extend({model:CFW.Entry,url:function(){return CFW.domain+"/affiliates/"+(this.affiliateId||"")+"/wods/"+(this.postId||"")+"/"+(this.wpId||"")+"/posts"},initialize:function(a,c){if(c)this.affiliateId=c.affiliateId,this.postId=c.postId,this.wpId=c.wpId;return this},comparator:function(a){return a.get("known_as").replace(/^\s+/,
"").toLowerCase()}});CFW.Component=Backbone.Model.extend({idAttribute:"_id",defaults:{description:"",label:"",result_type:"",result_notes:""}});CFW.ComponentList=Backbone.Collection.extend({model:CFW.Component});CFW.Wod=Backbone.Model.extend({idAttribute:"_id",defaults:function(){return{affiliate_id:"",post_id:"",wp_id:"",components:new CFW.ComponentList,entries:new CFW.EntryList}},initialize:function(){return this},parse:function(a){a.name=a.name.replace(/workout of the day/ig,"WOD");a.entries=new CFW.EntryList(a.posts,
{affiliateId:a.affiliate_id,postId:a.post_id,wpId:a.wp_id});delete a.posts;a.components=new CFW.ComponentList(a.components);return a}});CFW.WodList=Backbone.Collection.extend({model:CFW.Wod,url:function(){return this.affiliateId?CFW.domain+"/affiliates/"+this.affiliateId+"/wods.json":""},fetchData:function(){var a={wods:[]};this.each(function(c){a.wods.push({post_id:c.get("post_id"),wp_id:c.get("wp_id"),post_modified:c.get("post_modified")})});return a},initialize:function(){var a=this;this.on("add",
function(c){a.affiliateId=c.get("affiliate_id")});return this},wodsQuery:function(){var a="";this.each(function(c,b){a+=(0==b?"":",")+c.get("post_id")+"["+c.get("wp_id")+"]"});return a}});CFW.EntryItemView=Backbone.View.extend({tagName:"tr",template:_.template('            <td class="cfw-known-as">                <a href="'+CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink","")+'<%- athlete_slug %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash"><%- known_as %></a>            </td>            <%             if (wod.components && wod.components.length > 1) {                wod.components.each(function(component, i, components) {                    var componentResult = _.find(component_results, function(cr) {                        return cr.component_id == component.id;                    }) || {                        result: "",                        rx: false,                        mods: ""                    };                    var isLast = (i + 1 == components.length);                    %>                     <td class="cfw-component" title="<%- componentResult.result %><%- componentResult.rx ? " [Rx]" : "" %><%- componentResult.mods ? " ("+componentResult.mods+")" : "" %>">                        <%= isLast ? "<div>" : "" %>                        <span class="cfw-result"><%- componentResult.result %></span>                        <span class="cfw-mods">                            <%= componentResult.rx ? "<strong>Rx</strong>" : "" %>                            <%- componentResult.mods %>                        </span>                        <% if (isLast) { %>                            <% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %>                            <span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                        <% } %>                        <%= isLast ? "</div>" : "" %>                    </td>                <%                 });            } else {                var componentResult = _.find(component_results, function(cr) {                    return cr.component_id == (wod.components.at(0) || {id: "uh oh"}).id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                 <td class="cfw-result" title="<%- componentResult.result %>"><%- componentResult.result %></td>                <td class="cfw-mods" title="<%- componentResult.rx ? "[Rx] " : "" %><%- componentResult.mods %>">                    <div>                        <%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %><% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %><span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                    </div>                </td>            <%             }            %>         '),
events:{"click *:not(a, a *)":"showDetail","click .cfw-set-url-hash":"setUrlHash"},initialize:function(){this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this);this.model.on("show",this.lookSelected,this);this.model.on("unshow",this.unlookSelected,this);this.model.on("highlight",this.highlight,this);return this.render()},render:function(){this.$el.html(this.template(_.extend({wod:this.options.wod.toJSON()},this.model.toJSON())));return this},lookSelected:function(){this.$el.addClass("cfw-selected")},
unlookSelected:function(){this.$el.removeClass("cfw-selected")},highlight:function(){this.$el.addClass("cfw-highlighted").trigger("scrollToEntry");if(Modernizr.csstransitions)this.$el.addClass("cfw-highlighted-transition").removeClass("cfw-highlighted").one("mouseenter touchstart",function(){b(this).removeClass("cfw-highlighted-transition")});else{var a=this.$el,c=function(){a.toggleClass("cfw-highlighted")};setTimeout(c,300);setTimeout(c,600);setTimeout(c,900);setTimeout(c,1200);setTimeout(function(){a.removeClass("cfw-highlighted")},
1500)}},showDetail:function(a){this.itemClickDisabled||(a.stopPropagation(),this.model.trigger("show",this.model))},setUrlHash:function(){this.model.setUrlHash()}});CFW.WhiteboardPage=Backbone.View.extend({tagName:"div",className:"cfw-page",show:function(){this.$el.addClass("active");var a=this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),a.scrollbarReady=!0;a.showScrollbar()},Modernizr.csstransitions?400:0)},hide:function(){this.freezeScrollbar();this.$el.removeClass("active");var a=
this;setTimeout(function(){a.hideScrollbar();a.thawScrollbar();a.$el.trigger("cfwhide")},Modernizr.csstransitions?300:0)},isActive:function(){return this.$el.hasClass("active")},initScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("show")},hideScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("hide")},
freezeScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("freeze")},thawScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("thaw")}});CFW.EntryListView=CFW.WhiteboardPage.extend({template:_.template('            <table class="cfw-components-<%= wod.components && wod.components.length || 1 %>" cellspacing="0">                <thead>                    <tr>                        <th class="cfw-known-as">Name</th>                        <% wod.components.each(function(component) { %>                            <th class="cfw-component" <%= wod.components.length == 1 ? \'colspan="2"\' : "" %> title="<%- component.get("description") %>"><%- component.get("label") %></th>                        <% }); %>                    </tr>                </thead>            </table>            <div class="cfw-scrollable">                <table cellspacing="0" class="cfw-components-<%= wod.components && wod.components.length || 1 %>">                    <tbody>                    </tbody>                </table>            </div>        '),
events:{"scrollToEntry tr":"scrollToEntry","touchmove .cfw-scrollable":"disableItemClicks","touchstart .cfw-scrollable":"enableItemClicks","click .cfw-retry-fetch-wods":"retryFetchWods"},initialize:function(){this.entryItemViews=[];this.resetModel(this.model)},resetModel:function(a){this.model=a;this.render();this.model.get("entries").on("add change:known_as remove reset",this.addAll,this);this.model.get("entries").trigger("reset")},render:function(){this.$el.html(this.template({wod:this.model.toJSON()}));
this.isActive()&&this.setComponentsClass();return this},addOne:function(a){a=new CFW.EntryItemView({model:a,wod:this.model});this.entryItemViews.push(a);this.$("tbody").append(a.el)},addAll:function(){_.each(this.entryItemViews,function(a,c,b){a.remove();delete b[c]});this.$("tbody").empty();this.model.get("entries").length?this.model.get("entries").each(this.addOne,this):CFW.wods.fetchAttempted&&CFW.wods.fetchFailed?this.$("tbody").append(b('                    <tr class="cfw-no-entries">                        <td colspan="100">Error communicating with the server.<br /><a class="cfw-retry-fetch-wods">Retry Now<a></td>                    </tr>                ')):
CFW.wods.fetchAttempted?this.$("tbody").append(b('                    <tr class="cfw-no-entries">                        <td colspan="100">No one has added an entry yet.<br /><a class="cfw-new-entry">Add yours now!<a></td>                    </tr>                ')):this.$("tbody").append(b('                    <tr class="cfw-no-entries">                        <td colspan="100">Loading...</td>                    </tr>                '))},retryFetchWods:function(){this.$("tbody td").text("Loading...");
CFW.fetchWods()},setComponentsClass:function(){var a=this.$("table").attr("class"),c=this.$el.closest(".cfw-contents");setTimeout(function(){c.addClass(a).data("componentsclass",a);c.siblings(".cfw-classes").addClass(a)},Modernizr.csstransitions?300:0)},unsetComponentsClass:function(){var a=this.$("table").attr("class");this.$el.closest(".cfw-contents").removeClass(a).removeData("componentsclass").siblings(".cfw-classes").removeClass(a)},show:function(){this.setComponentsClass();CFW.WhiteboardPage.prototype.show.apply(this,
arguments)},hide:function(){this.unsetComponentsClass();CFW.WhiteboardPage.prototype.hide.apply(this,arguments)},scrollToEntry:function(a){var c=this.$(".cfw-scrollable").scrollTop(0);(a=b(a.target).position())&&a.top&&c.scrollTop(a.top-15-(c.height()||0)/2)},disableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!0})},enableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!1})}});CFW.EntryDetailView=CFW.WhiteboardPage.extend({template:_.template('            <div class="cfw-entry-detail">                <a class="cfw-back">back</a><a class="cfw-edit">edit</a>                <dl class="cfw-scrollable">                    <dt class="cfw-hidden">Name</dt>                    <dd class="cfw-known-as">                        <%- known_as %>                        <a href="'+
CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink","")+'<%- athlete_slug %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash">view profile</a>                    </dd>                    <%                    wod.components.each(function(component) {                        var componentResult = _.find(component_results, function(cr) {                            return cr.component_id == component.id;                        }) || {                            result: "",                            rx: false,                            mods: ""                        };                    %>                        <dt title="<%- component.get("description") %>"><%= component.get("label") %></dt>                        <dd class="cfw-component">                            <span class="cfw-result"><%- componentResult.result %></span>                            <span class="cfw-mods"><%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %></span>                        </dd>                    <%                    });                    %>                    <dt>Notes</dt>                    <dd class="cfw-notes"><%- notes || "(no data)" %></dd>                </dl>            </div>        '),
events:{"click .cfw-set-url-hash":"setUrlHash","click a.cfw-edit":"edit","click a.cfw-back":"back",cfwhide:"cleanup"},initialize:function(a){this.wod=a.wod;this.model.on("change",this.render,this);this.model.on("change",function(){var a=this;setTimeout(function(){a.initScrollbar();a.showScrollbar()},300)},this);this.model.on("destroy",this.hide,this);return this.render()},render:function(){this.$el.html(this.template(_.extend({wod:this.wod.toJSON()},this.model.toJSON())));return this},setUrlHash:function(){this.model.setUrlHash()},
edit:function(){this.model.trigger("edit",this.model)},back:function(){this.$el.trigger("hideEntryDetails")},cleanup:function(){var a=this;setTimeout(function(){a.model.trigger("unshow",a.model);a.remove()},0)}});CFW.ModalPage=Backbone.View.extend({tagName:"div",className:"cfw-scrollable cfw-modal",events:{"focus :input":"scrollToInput","click .cfw-close-modal":"remove"},initScrollbar:function(){this.$el.scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},
hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$el.scrollbarPaper("show")},hideScrollbar:function(){this.$el.scrollbarPaper("hide")},freezeScrollbar:function(){this.$el.scrollbarPaper("freeze")},thawScrollbar:function(){this.$el.scrollbarPaper("thaw")},scrollToInput:function(a){if(!this.height)this.height=this.$el.parent().height();(a=(b(a.target).position()||{}).top)&&this.$el.animate({scrollTop:a+this.$el.scrollTop()-this.height/2},300)},show:function(){var a=this.$el.closest(".cfw-contents"),
c=a.data("componentsclass");c&&(a.removeClass(c),a.siblings(".cfw-classes").removeClass(c));var b=this;setTimeout(function(){b.$el.addClass("cfw-translate-oldfashioned")},0);setTimeout(function(){if(!b.scrollbarReady)b.initScrollbar(),b.scrollbarReady=!0;b.showScrollbar();var a=b.$el.find(":input[type!=hidden]:first")[0];a&&a.focus&&a.focus()},Modernizr.csstransitions?400:0)},remove:function(a,b){this.freezeScrollbar();var d=this,e=this.$el.closest(".cfw-contents");this.$el.removeClass("cfw-translate-oldfashioned");
setTimeout(function(){d.hideScrollbar();var f=e.data("componentsclass");f&&(e.addClass(f),e.siblings(".cfw-classes").addClass(f));"object"==typeof a&&a.silent?d.$el.remove():d.$el.trigger("cfwremove").remove();"function"==typeof b&&b()},Modernizr.csstransitions?300:0)}});CFW.EntryFormView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <\!--<h2><%= new_record ? "Add Your Entry" : "Edit Your Entry" %></h2>--\>                <h2><label for="cfw-email">Email Address</label></h2>                <input type="hidden" name="<%= new_record ? "decoy" : "email" %>" value="<%- email %>" />                <input type="email" id="cfw-email" name="<%= new_record ? "email" : "decoy" %>" placeholder="name@example.com" <%= new_record ? "" : \'value="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" disabled="disabled"\' %> />            </fieldset>            <fieldset>                <h2><label for="cfw-known-as">Name</label></h2>                <input type="text" id="cfw-known-as" name="known_as" placeholder="Guest" value="<%- known_as %>" />            </fieldset>            <%            wod.components.each(function(component) {                var componentResult = _.find(component_results, function(cr) {                    return cr.component_id == component.id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                <fieldset><%                    switch (component.get("result_type")) {                    case "time":                        if ("seconds" in componentResult) {                            componentResult.minutes = Math.floor(componentResult.seconds / 60);                            componentResult.seconds = (componentResult.seconds % 60);                        }                    %>                        <h2><label for="cfw-component-<%= component.id %>-minutes" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <% if (component.get("result_notes")) { %><p class="cfw-result-notes"><%- component.get("result_notes") %></p><% } %>                        <div class="cfw-nobr">                            <input type="text" id="cfw-component-<%= component.id %>-minutes" name="component-<%= component.id %>-minutes" placeholder="0" value="<%- componentResult.minutes || "" %>" size="3" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-minutes" class="cfw-inline">minutes</label>                            <input type="text" id="cfw-component-<%= component.id %>-seconds" name="component-<%= component.id %>-seconds" placeholder="0" value="<%- componentResult.seconds || "" %>" size="2" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-seconds" class="cfw-inline">seconds</label>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "load":                    %>                        <h2><label for="cfw-component-<%= component.id %>-mass" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" id="cfw-component-<%= component.id %>-mass" name="component-<%= component.id %>-mass" placeholder="0" value="<%- componentResult.mass || "" %>" size="10" class="cfw-minority" />                            <% unit_options = component.get("unit_options") || [{name: "lbs", value: "lbs"}]; %>                            <div class="cfw-dropdown">                                <input type="hidden" id="cfw-component-<%= component.id %>-units" name="component-<%= component.id %>-units" value="<%- componentResult.units || unit_options[0].value %>" size="10" class="cfw-minority" />                                <a href="javascript:// Select Units" class="cfw-dropdown-toggle" data-toggle="dropdown" data-target=" "><span class="cfw-text"><%- componentResult.units || unit_options[0].name %></span> <span class="cfw-caret"></span></a>                                <ul class="cfw-dropdown-menu cfw-units-select">                                    <% for (var i = 0; i < unit_options.length; i++) { %>                                        <li><a href="javascript://" data-value="<%- unit_options[i].value || "" %>"><%- unit_options[i].name || "" %></a></li>                                    <% } %>                                </ul>                            </div>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "rounds":                        if ("reps" in componentResult) {                            componentResult.rounds = Math.floor(componentResult.reps / component.get("reps_per_round"));                            componentResult.reps = (componentResult.reps % component.get("reps_per_round"));                        }                    %>                        <h2><label for="cfw-component-<%= component.id %>-rounds" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" id="cfw-component-<%= component.id %>-rounds" name="component-<%= component.id %>-rounds" placeholder="0" value="<%- componentResult.rounds || "" %>" size="3" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-rounds" class="cfw-inline">rounds</label>                            <label class="cfw-inline">+</label>                            <input type="text" id="cfw-component-<%= component.id %>-reps" name="component-<%= component.id %>-reps" placeholder="0" value="<%- componentResult.reps || "" %>" size="3" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-reps" class="cfw-inline">reps</label>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "reps":                    %>                        <h2><label for="cfw-component-<%= component.id %>-reps" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" id="cfw-component-<%= component.id %>-reps" name="component-<%= component.id %>-reps" placeholder="0" value="<%- componentResult.reps || "" %>" size="5" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-reps" class="cfw-inline">reps</label>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "distance":                    %>                        <h2><label for="cfw-component-<%= component.id %>-distance" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" id="cfw-component-<%= component.id %>-distance" name="component-<%= component.id %>-distance" placeholder="0" value="<%- componentResult.distance || "" %>" size="10" class="cfw-minority" />                            <% unit_options = component.get("unit_options") || [{name: "error", value: "error"}]; %>                            <div class="cfw-dropdown">                                <input type="hidden" id="cfw-component-<%= component.id %>-units" name="component-<%= component.id %>-units" value="<%- componentResult.units || "" %>" size="10" class="cfw-minority" />                                <a href="javascript:// Select Units" class="cfw-dropdown-toggle" data-toggle="dropdown" data-target=" "><span class="cfw-text"><%- componentResult.units || unit_options[0].name %></span> <span class="cfw-caret"></span></a>                                <ul class="cfw-dropdown-menu cfw-units-select">                                    <% for (var i = 0; i < unit_options.length; i++) { %>                                        <li><a href="javascript://" data-value="<%- unit_options[i].value || "" %>"><%- unit_options[i].name || "" %></a></li>                                    <% } %>                                </ul>                            </div>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "text":                    default:                    %>                        <h2><label for="cfw-component-<%= component.id %>-result" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <input type="text" id="cfw-component-<%= component.id %>-result" name="component-<%= component.id %>-result" placeholder="What was your result?" value="<%- componentResult.result %>" />                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <% } %>                </fieldset>            <%            });            %>            <fieldset class="cfw-last">                <div class="cfw-notes <%= notes ? "cfw-open cfw-opaque" : "" %>">                    <h2><label for="cfw-notes">Notes</label></h2>                    <textarea rows="3" id="cfw-notes" name="notes" placeholder="Notes or Tips for next time?"><%- notes %></textarea>                </div>                <div class="cfw-footer">                    <a class="cfw-add-notes <%= notes ? "cfw-hidden" : "" %>"><label for="cfw-notes"><strong>+</strong> add notes</label></a>                    <input type="submit" value="<%= new_record ? "Submit" : "Save" %>" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{'keyup input[name="email"]':"guessName",'change input[name="email"]':"guessName",'blur input[name="known_as"]':"guessName","click .cfw-units-select a":"selectUnits","click .cfw-add-notes":"showNotesFields",submit:"save"}),initialize:function(a){this.wod=a.wod;return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(_.extend({wod:this.wod.toJSON(),new_record:!this.model},(this.model||new CFW.Entry).toJSON())));
return this},guessName:function(){var a=this.$('input[name="email"]'),b=this.$('input[name="known_as"]');if(!(b.val().length&&this.lastGuess&&b.val()!=this.lastGuess||b.val().length&&!this.lastGuess)){var d=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.val().toLowerCase()});if(d)b.val(this.lastGuess=d.get("known_as"));else{d=a.val();if(!_.capitalize)_.capitalize=function(a){return a.substring(0,1).toUpperCase()+a.substring(1)};this.lastGuess=_.capitalize((/[^.@0-9]+/.exec(d)||
[""])[0]);b.val(this.lastGuess)}}},selectUnits:function(a){a.preventDefault();a=b(a.target);a.closest(".cfw-dropdown").find("input").val(a.data("value")).end().find(".cfw-dropdown-toggle .cfw-text").text(a.text())},showNotesFields:function(){var a=this.$(".cfw-notes").addClass("cfw-open"),b=this.$(".cfw-add-notes").addClass("cfw-transparent");setTimeout(function(){a.addClass("cfw-opaque");b.addClass("cfw-hidden")},Modernizr.csstransitions?200:0)},save:function(a){a.preventDefault();if(!this.isLoading()){var c=
{email:this.$('input[name="email"]').val(),known_as:this.$('input[name="known_as"]').val(),component_results:[],notes:this.$('textarea[name="notes"]').val()},d={};this.$('input[name^="component-"]').each(function(){var a=b(this),c=a.attr("name").split("-"),a="checkbox"==a.attr("type")?a.is(":checked"):a.val();d[c[1]]||(d[c[1]]={component_id:c[1]});d[c[1]][c[2]]=a});_.each(d,function(a){c.component_results.push(a)});var e=this,a=this.model?function(){e.hideLoading();e.remove()}:function(a){e.hideLoading();
e.$el.trigger("showEntryShare",a)};e.showLoading();e.$(".ajax-error-notice").remove();a=b.extend({},CFW.ajaxOptions,{success:a,error:function(a,c){e.hideLoading();c&&c.length?e.showValidationErrors(c):e.$(".cfw-footer").after(b('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Click <strong>'+e.$('input[type="submit"]').val()+"</strong> to try again or contact athlete support if the problem persists.</label>"))},
wait:!0});this.model?this.model.save(c,a):this.wod.get("entries").create(c,a)||this.showValidationErrors(CFW.Entry.prototype.validate(c))}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){var c=this;_.each(a,function(a,e){c.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+
b(this).attr("id")+'"]').addClass("cfw-invalid");0==e&&b(this).focus()}).one("keydown change",function(){b(this).removeClass("cfw-invalid");b('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid")})})}});CFW.EmailAuthView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <h2><label for="cfw-email" title="Enter <%- known_as %>&apos;s Email to Edit" style="white-space:normal;">Enter <%= known_as %>&apos;s Email to Edit</label></h2>                <input type="email" id="cfw-email" name="email" placeholder="name@example.com" value="" />            </fieldset>            <fieldset class="cfw-last">                <div class="cfw-footer">                    <input type="submit" value="Unlock" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{submit:"submit"}),initialize:function(){return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(this.model.toJSON()));return this},submit:function(a){a.preventDefault();if(!this.isLoading()){var c=this.$('input[name="email"]').val(),d=this;d.showLoading();d.$(".ajax-error-notice").remove();a=b.extend({},CFW.ajaxOptions,{complete:function(){d.hideLoading()},success:function(){d.options.success(c)},
error:function(){d.showValidationErrors(["email"]);d.$(".cfw-footer").after(b('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! That email doesn&apos;t match. Please try again or contact <a href="mailto:athletesupport@cfwhiteboard.com">athlete support</a> if there&apos;s any way we can help.</label>'))},type:"POST",data:JSON.stringify({email:c}),cache:!1});b.ajax(CFW.domain+"/athletes/"+this.model.get("athlete_id")+"/verify_email",a)}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},
isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){var c=this;_.each(a,function(a){c.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+b(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){b(this).removeClass("cfw-invalid");b('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid")})})}});
CFW.EntryShareView=CFW.ModalPage.extend({template:_.template('            <div class="cfw-facebook-card">                <p>                    <a href="<%- fbShareUrl %>" class="cfw-fb-action cfw-set-url-hash cfw-close-modal">Share on Facebook</a>                </p>                <p>                    <a href="javascript://" class="cfw-fb-inaction cfw-close-modal">Not this time</a>                </p>                <div class="cfw-fb-footer"></div>                <div class="cfw-fb-logo"></div>            </div>            <p class="cfw-facebook-links">                <a href="javascript://" class="cfw-never-again cfw-close-modal">Don\'t show this message again on this computer</a>            </p>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{"click .cfw-never-again":"neverAgain","click .cfw-set-url-hash":"setUrlHash"}),initialize:function(){return this.render()},render:function(){this.$el.html(this.template({fbShareUrl:this.model.url()+"/share"}));return this},setUrlHash:function(){this.model.setUrlHash()},neverAgain:function(){b.cookie("CFW",b.extend(b.cookie("CFW"),{no_facebook_share_dialog:!0}),{expires:365,path:"/"})}});CFW.WhiteboardView=Backbone.View.extend({className:"cfw-pane",
template:_.template('            <div>                <div class="cfw-window">                    <h2>Entries</h2>                    <a class="cfw-new-entry">+</a>                    <ul class="cfw-classes cfw-<%- allWods.length || 1 %>-classes cfw-components-<%= wod.components && wod.components.length || 1 %>">                        <%                        _.each(allWods, function(w) {                            %><li class="<%- w.wp_id == wod.wp_id ? "cfw-selected" : "" %>"><div>                                <a href="javascript://" data-wp_id="<%- w.wp_id %>" title="<%- w.name %>">                                    <span class="cfw-centered">                                        <span class="cfw-entry-count" data-wp_id="<%- w.wp_id %>"></span>                                        <span class="cfw-link-text"><%- w.name.replace(/workout of the day/ig, "WOD") %></span>                                    </span>                                    <span class="cfw-separator"></span>                                </a>                            </div></li><%                        });                        %>                    </ul>                    <div class="cfw-contents"></div>                    <div class="cfw-footer">                        <a href="http://cfwhiteboard.com" target="_blank" class="cfw-hook-what-is-this">                            What Is This?                        </a><a href="mailto:athletesupport@cfwhiteboard.com">                            Email Athlete Support                        </a>                    </div>                </div>            </div>            <a class="cfw-print cfw-admin-tool cfw-hidden" target="_blank">Print</a>        '),
events:{"click .cfw-new-entry:not([disabled])":"newEntry",hideEntryDetails:"hideEntry","cfwremove .cfw-modal":"cleanupModal",showEntryShare:"showEntryShare","click .cfw-classes a":"returnToEntryList"},initialize:function(a){this.model=new CFW.Wod({affiliate_id:a.affiliateId,post_id:a.postId,wp_id:a.wpId,post_modified:a.postModified});CFW.wods.push(this.model);CFW.wods.on("reset",this.resetModel,this);this.render();this.disableEntriesUntilLoaded();CFW.wods.on("reset",this.disableEntriesUntilLoaded,
this);a.hidden&&this.hide();return this},resetModel:function(){var a=this;this.model=CFW.wods.find(function(b){return b.get("post_id")==a.options.postId&&b.get("wp_id")==a.options.wpId});this.model.get("entries").on("add remove reset",this.newEntryCount,this);this.model.get("entries").on("edit",this.editEntry,this);this.model.get("entries").on("show",this.showEntry,this);this.model.get("entries").on("add change:known_as",this.updateUsers,this);this.entryListView.resetModel(this.model)},render:function(){this.$el.html(this.template({wod:this.model.toJSON(),
allWods:this.options.allWods}));this.$el.on("click.dropdown.data-api touchstart.dropdown.data-api",h);this.$(".cfw-window").on("click.dropdown touchstart.dropdown.data-api",".dropdown",function(a){a.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",f,e.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",f+", [role=menu]",e.prototype.keydown);this.entryListView=new CFW.EntryListView({model:this.model});this.$(".cfw-contents").append(this.entryListView.el);
this.entryListView.show();"admin"==this.options.authorization&&this.$(".cfw-admin-tool").removeClass("cfw-hidden");return this},attach:function(){this.$children&&this.$el.append(this.$children)},detach:function(){this.$children=this.$el.children();this.$children.detach()},show:function(){this.$el.removeClass("cfw-hidden")},hide:function(){this.$el.addClass("cfw-hidden")},newEntry:function(){this.showEntryForm()},editEntry:function(a){var b=this;this.showEmailAuth(a,function(d){b.modalView.remove({silent:!0});
a.set({email:d},{silent:!0});b.showEntryForm(a)})},highlightEntry:function(a){var b=this,d=function(){(b.model.get("entries").get(a)||b.model.get("entries").find(function(b){return b.get("athlete_slug")==a})).trigger("highlight")};if(this.model.get("entries").length)d();else this.model.get("entries").on("reset",d)},showEmailAuth:function(a,b){this.disableNewEntries();this.modalView=new CFW.EmailAuthView({model:a,success:b});this.$(".cfw-contents").append(this.modalView.el);var d=this;setTimeout(function(){d.detailView?
d.detailView.hideScrollbar():d.entryListView.hideScrollbar();d.modalView.show()},0)},showEntryForm:function(a){this.modalView=new CFW.EntryFormView({model:a,wod:this.model});this.$(".cfw-contents").append(this.modalView.el);var b=this;setTimeout(function(){a||(b.detailView?b.detailView.hideScrollbar():b.entryListView.hideScrollbar());b.disableNewEntries();b.modalView.show()},0)},showEntryShare:function(a,c){var d=b.cookie("CFW");if(d&&d.no_facebook_share_dialog)this.modalView.remove();else{var e=
new CFW.EntryShareView({model:c,wod:this.options.wod,postId:this.options.postId,postPermalink:this.options.postPermalink});this.$(".cfw-contents").append(e.el);this.modalView.remove({silent:!0},function(){e.show()});this.modalView=e}},cleanupModal:function(){this.enableNewEntries();this.detailView?this.detailView.showScrollbar():this.entryListView.showScrollbar();delete this.modalView},disableNewEntries:function(){this.$el.children().length?this.$el.find(".cfw-new-entry").attr("disabled",!0):this.$children.find(".cfw-new-entry").attr("disabled",
!0)},enableNewEntries:function(){this.$el.children().length?this.$el.find(".cfw-new-entry").removeAttr("disabled"):this.$children.find(".cfw-new-entry").removeAttr("disabled")},disableEntriesUntilLoaded:function(){CFW.wods.fetchAttempted&&!CFW.wods.fetchFailed?this.enableNewEntries():this.disableNewEntries()},showEntry:function(a){this.detailView=new CFW.EntryDetailView({model:a,wod:this.model});this.$(".cfw-contents").append(this.detailView.el);var b=this;setTimeout(function(){b.entryListView.hide();
b.detailView.show()},0)},hideEntry:function(){this.detailView.hide();this.entryListView.show();var a=this;setTimeout(function(){delete a.detailView},Modernizr.csstransitions?400:100)},newEntryCount:function(){this.$el.trigger("newEntryCount",[this.options.wpId,this.model.get("entries").length])},updateEntryCount:function(a,c){var d=this.$(".cfw-entry-count");0==d.length&&(d=this.$children.find(".cfw-entry-count"));1<d.length&&d.each(function(){var d=b(this);d.data("wp_id")==a&&d.text(c).attr("title",
""+c+" entries")})},updateUsers:function(a){var b=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.get("email").toLowerCase()});b?b.save({known_as:a.get("known_as"),count:b.get("count")+1}):b=CFW.users.create({email:a.get("email"),known_as:a.get("known_as"),count:1})},returnToEntryList:function(){this.modalView?this.modalView.remove():this.detailView&&this.hideEntry()}});CFW.WhiteboardButtonView=Backbone.View.extend({template:_.template('            <h1>Whiteboard <span class="cfw-entry-count-all cfw-hidden"></span></h1>        '),
events:{"click h1":"toggleWhiteboard","click .cfw-classes a":"showClass","newEntryCount .cfw-pane":"updateEntryCounts","mouseenter h1":"hoverButton","mouseleave h1":"unhoverButton"},initialize:function(){var a=this.$el.data("cfwhiteboard");this.affiliateId=a.affiliateId;this.postId=a.postId;this.postPermalink=a.postPermalink;this.postModified=a.postModified;this.wods=a.wods;this.authorization=this.$el.data("authorization");return-1<_.indexOf(_.pluck(CFW.instances,"postId"),this.postId)?void 0:this.render()},
render:function(){var a="embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1);if(a){this.$el.last().addClass("cfw-display-embed");1<this.$el.length&&this.$el.first().replaceWith(this.$el.last());var c=b("<div />").addClass("cfw-clearer");this.$el.last().parent().append(c)}this.$el.first().html(this.template());this.whiteboardViews={};var d=this;_.each(d.wods,function(a,b){var c=new CFW.WhiteboardView({affiliateId:d.affiliateId,postId:d.postId,wpId:a.wp_id,postPermalink:d.postPermalink,postModified:d.postModified,
allWods:d.wods,authorization:d.authorization,hidden:0==b?!1:!0});d.$el.last().append(c.el);d.whiteboardViews[a.wp_id]=c});a||setTimeout(function(){d.positionWhiteboard();_.each(d.whiteboardViews,function(a){a.detach()})},0);return this},hoverButton:function(){this.$el.first().find("h1").addClass("cfw-hovering");this.attachWhiteboard();this.positionWhiteboard()},unhoverButton:function(a){this.$el.first().find("h1").removeClass("cfw-hovering");this.detachWhiteboard(a)},attachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")||
(this.$el.first().addClass("cfw-attached"),_.each(this.whiteboardViews,function(a){a.attach()}))},detachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")&&!this.$el.first().hasClass("cfw-active")&&!this.$el.first().find("h1").hasClass("cfw-hovering")&&(this.$el.first().removeClass("cfw-attached"),_.each(this.whiteboardViews,function(a){a.detach()}))},toggleWhiteboard:function(a){this.$el.is(".cfw-active")?this.closeWhiteboard():this.openWhiteboard();a.preventDefault()},openWhiteboard:function(){this.$el.addClass("cfw-active").removeClass("cfw-postactive");
var a=this;setTimeout(function(){var b=a.$el.first().offset(),b=a.$el.first().outerWidth(!1)+b.left;a.$el.last().find(".cfw-pane:visible").outerWidth(!1)>=b&&(a.$el.last().addClass("position-inline"),CFW.important.css.apply(a.$el.last(),[{left:"0",margin:"0 10px 10px",right:"auto"},!0]))},0)},closeWhiteboard:function(){this.$el.addClass("cfw-postactive").removeClass("cfw-active");var a=this;setTimeout(function(){a.$el.removeClass("cfw-postactive");a.detachWhiteboard()},Modernizr.csstransitions?300:
0)},positionWhiteboard:function(){if("embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1))this.$el.last().addClass("cfw-active");else if(this.$el.last().parent().is("body")){var a=this.$el.first().offset(),c={position:"absolute",margin:"0",top:a.top+"px"};this.$el.last().is(".position-inline, .position-block, .position-floatleft")?c.left=a.left+"px":(a=this.$el.first().outerWidth(!1)+a.left,c.right=b(document).width()-a,c.right+="px");CFW.important.css.apply(this.$el.last(),[c,!0])}},showClass:function(a){var c=
a.target?b(a.target).closest("a").data("wp_id"):a;_.each(this.whiteboardViews,function(a,b){b==c?a.show():a.hide()})},updateEntryCounts:function(a,b,d){this.whiteboardViews[b.toString()].entryCount=d;_.each(this.whiteboardViews,function(a){a.updateEntryCount(b,d)});a=_.inject(this.whiteboardViews,function(a,b){return a+(b.entryCount||0)},0);this.$(".cfw-entry-count-all").text(a).attr("title",""+a+" entries").removeClass("cfw-hidden")}});CFW.instances=[];setTimeout(function(){CFW.wods=new CFW.WodList;
b(".cfwhiteboard").each(function(){var a=b(this),d=a.closest("a");d.length&&d.before(a);if(!1!=CFW.oxygenTank(CFW_OPTIONS,"position",!1)){d=a.closest(CFW_OPTIONS.position.parent).find(CFW_OPTIONS.position.target);if(d.length)switch(CFW_OPTIONS.position.insertion){case "append":d.append(a);break;case "before":d.before(a);break;case "after":d.after(a);break;default:d.prepend(a)}switch(CFW_OPTIONS.position.alignment){case "inline":a.addClass("position-inline");break;case "block":a.addClass("position-block");
break;case "floatleft":a.addClass("position-floatleft")}CFW_OPTIONS.position.margin&&CFW.important.css.apply(a,[{margin:CFW_OPTIONS.position.margin},!0])}a=a.add(a.clone().appendTo(document.body));CFW.instances.push(new CFW.WhiteboardButtonView({el:a}))});CFW.fetchWods=function(){CFW.wods.fetch(b.extend({},CFW.ajaxOptions,{data:CFW.wods.fetchData(),error:function(){CFW.wods.fetchFailed=!0;CFW.wods.trigger("reset")}}));CFW.wods.fetchFailed=!1;CFW.wods.fetchAttempted=!0};CFW.instances.length&&CFW.fetchWods();
"embed"!=CFW.oxygenTank(CFW_OPTIONS,"position","display",!1)&&(_.each(CFW.instances,function(a){a.$el.on("click",function(a){a.stopPropagation()})}),b(document.body).on("click",function(){_.each(CFW.instances,function(a){a.closeWhiteboard()})}));if(0==window.location.hash.indexOf("#cfwhiteboard")){var a=window.location.hash.split("-");_.each(CFW.instances,function(c){if(c.postId==a[1]){a[2]&&c.showClass(a[2]);var d=c.$el.offset().top-100;b(document.body).append(b('<span id="'+window.location.hash.replace(/^#/,
"")+'" style="position:absolute; top:'+d+'px; display:none;"></span>'));b("html, body").animate({scrollTop:d},800,function(){c.attachWhiteboard();c.openWhiteboard();a[2]&&a[3]&&c.whiteboardViews[a[2]].highlightEntry(a[3])})}})}},b.browser.msie?1500:0)});
