var JSON;JSON||(JSON={});
(function(){function b(a){return 10>a?"0"+a:a}function a(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var c=i[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(b,d){var e,i,p,s,m=f,q,l=d[b];l&&"object"===typeof l&&"function"===typeof l.toJSON&&(l=l.toJSON(b));"function"===typeof g&&(l=g.call(d,b,l));switch(typeof l){case "string":return a(l);case "number":return isFinite(l)?""+l:"null";case "boolean":case "null":return""+l;
case "object":if(!l)return"null";f+=h;q=[];if("[object Array]"===Object.prototype.toString.apply(l)){s=l.length;for(e=0;e<s;e+=1)q[e]=c(e,l)||"null";p=0===q.length?"[]":f?"[\n"+f+q.join(",\n"+f)+"\n"+m+"]":"["+q.join(",")+"]";f=m;return p}if(g&&"object"===typeof g){s=g.length;for(e=0;e<s;e+=1)"string"===typeof g[e]&&(i=g[e],(p=c(i,l))&&q.push(a(i)+(f?": ":":")+p))}else for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(p=c(i,l))&&q.push(a(i)+(f?": ":":")+p);p=0===q.length?"{}":f?"{\n"+f+q.join(",\n"+
f)+"\n"+m+"}":"{"+q.join(",")+"}";f=m;return p}}if("function"!==typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,h,i={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g;if("function"!==typeof JSON.stringify)JSON.stringify=function(a,b,d){var e;h=f="";if("number"===typeof d)for(e=0;e<d;e+=1)h+=" ";else"string"===typeof d&&(h=d);if((g=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",
{"":a})};if("function"!==typeof JSON.parse)JSON.parse=function(a,b){function c(a,d){var e,g,f=a[d];if(f&&"object"===typeof f)for(e in f)Object.prototype.hasOwnProperty.call(f,e)&&(g=c(f,e),void 0!==g?f[e]=g:delete f[e]);return b.call(a,d,f)}var e,a=""+a;d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"===typeof b?c({"":e},""):e;throw new SyntaxError("JSON.parse");}})();(function(b){function a(a,c,d){var e,d=d||"",f=d.match(RegExp("(?:^|\\s|;)("+a+")\\s*:\\s*([^;]*(?:;|$))","i"));f&&(f[0]=f[0].replace(/^;/,""));null===c?e="":"string"===typeof c&&(e=a+":"+c+" !important;");f?("boolean"===typeof c&&(e=b.important(a+":"+f[2],c)),d=d.replace(f[0],e)):"undefined"!==typeof e&&(d=b.trim(d),""!==d&&(";"!==d.slice(-1)&&(d+=";"),d+=" "),d+=e);return d}function c(a,b){var d=c.re;if(!d)d=c.re=/\s*(! ?important)?[\s\r\t\n]*;/g;return!1===b?a.replace(d,";"):a.replace(d,function(a,
b){return b?a:" !important;"})}function d(a,b){var e=d.re;if(!e)e=d.re=/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g;return a.replace(e,function(a,d){return c(d,b)})}var e=!1,f={},h={},i=b.each({css:function(c,d){var e={},i=b(this),h=i.attr("style");if("string"===typeof c){if("undefined"===typeof d)return f.css.apply(this,arguments);e[c]=d}else if("object"===typeof c)e=c;else return i;b.each(e,function(b,c){h=a(b,c,h)});return i.attr("style",h)}},function(a,c){f[a]=b.fn[a];c.overridden=!0;h[a]=function(){var d=
b.makeArray(arguments),i=d[d.length-1],h=b(this);return!0===i?c.apply(h,d.slice(0,-1)):e&&!1!==i?c.apply(h,d):f[a].apply(h,d)}});b.extend(b.fn,h);b.important=b.extend(function(){var a=b.makeArray(arguments),f;if("string"===typeof a[0]){if("undefined"===typeof a[1]||"boolean"===typeof a[1])return f=!1!==a[1],/<\w+.*>/.test(a[0])?d(a[0],f):c(a[0],f)}else if(b.isFunction(a[0]))f=e,b.important.status=e=!0,a[0].call(this),b.important.status=e=f;else if("undefined"===typeof a[0]||"boolean"===typeof a[0])b.important.status=
e=!1!==a[0];return e},{status:e,noConflict:function(){b.each(f,function(a,c){b.fn[a]=c});return i},declaration:a});b.fn.important=function(d){var e=b(this),f=b.makeArray(arguments).concat(!0),i=e.data("nodeName"),o;if("undefined"===typeof d||"boolean"===typeof d)i||(i=e.attr("nodeName").toLowerCase(),e.data("nodeName",i)),"style"===i?(o=!1!==d,e.html(c(e.html(),o)),f=e.attr("sheet"),_("stylesheet",f),f&&f.cssRules&&(_("cssRules",f.cssRules),b.each(f.cssRules,function(a,c){_("rule",c,c.cssText);_(b.important(c.style.cssText,
o));if(c.type===CSSRule.STYLE_RULE)c.style.cssText=b.important(c.style.cssText,o)}))):e.attr("style",b.important(e.attr("style"),d));else{if("object"===typeof d)return f.unshift("css"),e.important.apply(this,f);if("string"===typeof d)if(b.isFunction(h[d]))f=f.slice(1),h[d].apply(e,f);else{if("undefined"===typeof f[1]||"boolean"===typeof f[1])o=!1!==f[1],e.attr("style",a(d,o,e.attr("style")))}else b.isFunction(d)&&b.important.call(this,d)}return e}})(jQuery);(function(b){var a=function(a){var c=a.data("scrollbarPaper")||a.data("scrollbar-paper"),b=a.innerHeight(),h=b-a.height();return{height:b,ratio:b/(c.clearer.position().top-((c.content.children(":visible").eq(0).position()||{}).top||0)+h),offset:a.offset()}},c={_init:function(c){c=b.extend({parentSelector:"",css:b.css,show:function(a){a.show()},hide:function(a){a.hide()}},c);return this.each(function(){var e=b(this),f=e.data("scrollbarPaper")||e.data("scrollbar-paper");if(!f){c.css.apply(e,[{"overflow-x":"hidden",
"overflow-y":"auto"},!0]);f=e.closest(c.parentSelector);f.length||(f=e.offsetParent());var h=b('<div class="scrollbarpaper-container"></div>').appendTo(f);c.hide(h);var i=b('<div class="scrollbarpaper-track"></div>').appendTo(h),g=b('<div class="scrollbarpaper-drag"></div>').appendTo(i),f={options:c,offsetParent:f,paper:h,track:i,drag:g,dragTop:b('<div class="scrollbarpaper-drag-top"></div>').appendTo(g),dragBottom:b('<div class="scrollbarpaper-drag-bottom"></div>').appendTo(g),content:e,clearer:b('<div style="clear:both;"></div>').appendTo(e),
offsetHeight:i.outerHeight()-i.height()};e.data("scrollbarPaper",f).data("scrollbar-paper",f);var j=a(e),r=setInterval(function(){if(e.closest(c.parentSelector).length){if(e.is(":visible")){var b=a(e);if(b.height!=j.height||b.ratio!=j.ratio||b.offset.left!=j.offset.left||b.offset.top!=j.offset.top)e.scrollbarPaper("update"),j=b}}else clearInterval(r),h.remove(),e.removeData("scrollbarPaper").removeData("scrollbar-paper")},250)}e.scrollbarPaper("update")})},update:function(c){return this.each(function(){var e=
b(this);if(e.is(":visible")&&!e.data("scrollbarpaperfrozen")){var f=e.data("scrollbarPaper")||e.data("scrollbar-paper");c=c||a(e);e.unbind(".scrollbarPaper");var h=e.innerHeight()-f.offsetHeight;f.options.css.apply(f.track,[{height:h+"px"},!0]);var i=0<f.offsetParent.not("html, body").length?f.offsetParent.offset():{left:0,top:0};f.options.css.apply(f.paper,[{left:-i.left+c.offset.left+e.innerWidth()-f.paper.width()+"px",top:-i.top+c.offset.top+"px"},!0]);var g=Math.max(Math.round(h*c.ratio),f.dragTop.height()+
f.dragBottom.height());f.options.css.apply(f.drag,[{height:g+"px"},!0]);i=function(){f.options.css.apply(f.drag,[{top:Math.min(Math.round(e.scrollTop()*c.ratio),h-g)+"px"},!0])};i();e.bind("scroll.scrollbarPaper",i);var j=function(a){return a.pageY||(a.originalEvent&&(a.originalEvent.targetTouches||a.originalEvent.touches||[])[0]||a).pageY},r=function(){b("body").unbind("mousemove.scrollbarPaper touchmove.scrollbarPaper")};f.drag.bind("mousedown.scrollbarPaper touchstart.scrollbarPaper",function(a){r();
var i=j(a)-f.drag.offset().top;b("body").bind("mousemove.scrollbarPaper touchmove.scrollbarPaper",function(a){a.preventDefault();e.scrollTop((j(a)-e.offset().top-i)/c.ratio);return!1}).bind("mouseup.scrollbarPaper touchend.scrollbarPaper",r);return!1});1>c.ratio?(f.options.show(f.drag),f.content.addClass("scrollbarpaper-visible")):(f.options.hide(f.drag),f.content.removeClass("scrollbarpaper-visible"))}})},show:function(){return this.each(function(){var a=b(this),c=a.data("scrollbarPaper")||a.data("scrollbar-paper");
c&&(a.scrollbarPaper("update"),"function"==typeof c.options.show?c.options.show(c.paper):c.paper.show())})},hide:function(){return this.each(function(){var a=b(this);(a=a.data("scrollbarPaper")||a.data("scrollbar-paper"))&&("function"==typeof a.options.hide?a.options.hide(a.paper):a.paper.hide())})},freeze:function(){return this.each(function(){b(this).data("scrollbarpaperfrozen",!0)})},thaw:function(){return this.each(function(){b(this).data("scrollbarpaperfrozen",!1)})}};b.fn.scrollbarPaper=function(a){if(c[a])return c[a].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return c._init.apply(this,arguments);throw"Method "+a+" does not exist on jQuery.scrollbarPaper.";}})(jQuery);(function(b,a,c){function d(a){return a}function e(a){return decodeURIComponent(a.replace(f," "))}var f=/\+/g,h=b.cookie=function(f,g,j){if(g!==c){j=b.extend({},h.defaults,j);if(null===g)j.expires=-1;if("number"===typeof j.expires){var r=j.expires,n=j.expires=new Date;n.setDate(n.getDate()+r)}g=h.json?JSON.stringify(g):""+g;return a.cookie=[encodeURIComponent(f),"=",h.raw?g:encodeURIComponent(g),j.expires?"; expires="+j.expires.toUTCString():"",j.path?"; path="+j.path:"",j.domain?"; domain="+j.domain:
"",j.secure?"; secure":""].join("")}g=h.raw?d:e;j=a.cookie.split("; ");r=0;for(n=j.length;r<n;r++){var o=j[r].split("=");if(g(o.shift())===f)return f=g(o.join("=")),h.json?JSON.parse(f):f}return null};h.defaults={};b.removeCookie=function(a,c){return null!==b.cookie(a)?(b.cookie(a,null,c),!0):!1}})(jQuery,document);jQuery.cookie.json=!0;function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}window.Store=function(b){this.name=b;this.records=(b=localStorage.getItem(this.name))&&b.split(",")||[]};
_.extend(Store.prototype,{save:function(){localStorage.setItem(this.name,this.records.join(","))},create:function(b){if(!b.id)b.id=b.attributes.id=guid();localStorage.setItem(this.name+"-"+b.id,JSON.stringify(b));this.records.push(b.id.toString());this.save();return b},update:function(b){localStorage.setItem(this.name+"-"+b.id,JSON.stringify(b));_.include(this.records,b.id.toString())||this.records.push(b.id.toString());this.save();return b},find:function(b){return JSON.parse(localStorage.getItem(this.name+
"-"+b.id))},findAll:function(){return _.map(this.records,function(b){return JSON.parse(localStorage.getItem(this.name+"-"+b))},this)},destroy:function(b){localStorage.removeItem(this.name+"-"+b.id);this.records=_.reject(this.records,function(a){return a==b.id.toString()});this.save();return b}});Backbone.remoteSync=Backbone.sync;
Backbone.sync=function(b,a,c,d){"function"==typeof c&&(c={success:c,error:d});var e,f=a.localStorage||a.collection&&a.collection.localStorage;if(!f)return Backbone.remoteSync(b,a,c,d);switch(b){case "read":e=a.id?f.find(a):f.findAll();break;case "create":e=f.create(a);break;case "update":e=f.update(a);break;case "delete":e=f.destroy(a)}e?c.success(e):c.error("Record not found")};window.Modernizr=function(b,a,c){function d(a,c){var b=a.charAt(0).toUpperCase()+a.substr(1),b=(a+" "+j.join(b+" ")+b).split(" ");return e(b,c)}function e(a,b){for(var d in a)if(g[a[d]]!==c)return"pfx"==b?a[d]:!0;return!1}var f={},h=a.documentElement;a.head||a.getElementsByTagName("head");var i=a.createElement("modernizr"),g=i.style,b=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),j="Webkit Moz O ms Khtml".split(" "),i={},r=[],n=function(c,b,d,e){var f,i,g=a.createElement("div");if(parseInt(d,10))for(;d--;)i=
a.createElement("div"),i.id=e?e[d]:"modernizr"+(d+1),g.appendChild(i);f=["&shy;<style>",c,"</style>"].join("");g.id="modernizr";g.innerHTML+=f;h.appendChild(g);c=b(g,c);g.parentNode.removeChild(g);return!!c},o,p={}.hasOwnProperty,s;typeof p!==c&&typeof p.call!==c?s=function(a,c){return p.call(a,c)}:s=function(a,b){return b in a&&typeof a.constructor.prototype[b]===c};(function(a,c){var b=a.join(""),d=c.length;n(b,function(a){for(var a=a.childNodes,c={};d--;)c[a[d].id]=a[d];f.csstransforms3d=9===c.csstransforms3d.offsetLeft},
d,c)})([,["@media (",b.join("transform-3d),("),"modernizr){#csstransforms3d{left:9px;position:absolute}}"].join("")],[,"csstransforms3d"]);i.csstransforms=function(){return!!e(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])};i.csstransforms3d=function(){var a=!!e(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);a&&"webkitPerspective"in h.style&&(a=f.csstransforms3d);return a};i.csstransitions=function(){return d("transitionProperty")};
for(var m in i)s(i,m)&&(o=m.toLowerCase(),f[o]=i[m](),r.push((f[o]?"":"no-")+o));g.cssText="";i=null;f._version="2.0.6";f._prefixes=b;f._domPrefixes=j;f.testProp=function(a){return e([a])};f.testAllProps=d;f.testStyles=n;return f}(this,this.document);(function(b,a,c,d,e,f){function h(a,c){var b=typeof a[c];return"function"==b||!!("object"==b&&a[c])||"unknown"==b}function i(){if(!s(navigator.plugins)&&"object"==typeof navigator.plugins["Shockwave Flash"]){var a=navigator.plugins["Shockwave Flash"].description;a&&!s(navigator.mimeTypes)&&navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(A=a.match(/\d+/g))}if(!A){var c;try{c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),
A=Array.prototype.slice.call(c.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1)}catch(b){}}if(!A)return!1;a=parseInt(A[0],10);c=parseInt(A[1],10);M=9<a&&0<c;return!0}function g(){if(!B){B=!0;for(var a=0;a<H.length;a++)H[a]();H.length=0}}function j(a,c){B?a.call(c):H.push(function(){a.call(c)})}function r(){var a=parent;if(""!==E)for(var c=0,b=E.split(".");c<b.length;c++)a=a[b[c]];return a.easyXDM}function n(a){var c=a.toLowerCase().match(I),a=c[2],b=c[3],c=c[4]||"";if("http:"==a&&":80"==
c||"https:"==a&&":443"==c)c="";return a+"//"+b+c}function o(a){a=a.replace(V,"$1/");if(!a.match(/^(http||https):\/\//)){var b="/"===a.substring(0,1)?"":c.pathname;"/"!==b.substring(b.length-1)&&(b=b.substring(0,b.lastIndexOf("/")+1));a=c.protocol+"//"+c.host+b+a}for(;Q.test(a);)a=a.replace(Q,"");return a}function p(a,c){var b="",d=a.indexOf("#");-1!==d&&(b=a.substring(d),a=a.substring(0,d));var d=[],e;for(e in c)c.hasOwnProperty(e)&&d.push(e+"="+f(c[e]));return a+(R?"#":-1==a.indexOf("?")?"?":"&")+
d.join("&")+b}function s(a){return"undefined"===typeof a}function m(a,c,b){var d,e;for(e in c)c.hasOwnProperty(e)&&(e in a?(d=c[e],"object"===typeof d?m(a[e],d,b):b||(a[e]=c[e])):a[e]=c[e]);return a}function q(c){if(s(J)){var b=a.body.appendChild(a.createElement("form")),d=b.appendChild(a.createElement("input"));d.name=v+"TEST"+P;J=d!==b.elements[d.name];a.body.removeChild(b)}J?b=a.createElement('<iframe name="'+c.props.name+'"/>'):(b=a.createElement("IFRAME"),b.name=c.props.name);b.id=b.name=c.props.name;
delete c.props.name;if("string"==typeof c.container)c.container=a.getElementById(c.container);if(!c.container)m(b.style,{position:"absolute",top:"-2000px",left:"0px"}),c.container=a.body;d=c.props.src;c.props.src="javascript:false";m(b,c.props);b.border=b.frameBorder=0;b.allowTransparency=!0;c.container.appendChild(b);c.onLoad&&w(b,"load",c.onLoad);if(c.usePost){var e=c.container.appendChild(a.createElement("form")),f;e.target=b.name;e.action=d;e.method="POST";if("object"===typeof c.usePost)for(var i in c.usePost)if(c.usePost.hasOwnProperty(i))J?
f=a.createElement('<input name="'+i+'"/>'):(f=a.createElement("INPUT"),f.name=i),f.value=c.usePost[i],e.appendChild(f);e.submit();e.parentNode.removeChild(e)}else b.src=d;c.props.src=d;return b}function l(d){var e=d.protocol,f;d.isHost=d.isHost||s(u.xdm_p);R=d.hash||!1;if(!d.props)d.props={};if(d.isHost)d.remote=o(d.remote),d.channel=d.channel||"default"+P++,d.secret=Math.random().toString(16).substring(2),s(e)&&(e=n(c.href)==n(d.remote)?"4":h(b,"postMessage")||h(a,"postMessage")?"1":d.swf&&h(b,"ActiveXObject")&&
i()?"6":"Gecko"===navigator.product&&"frameElement"in b&&-1==navigator.userAgent.indexOf("WebKit")?"5":d.remoteHelper?"2":"0");else{d.channel=u.xdm_c.replace(/["'<>\\]/g,"");d.secret=u.xdm_s;d.remote=u.xdm_e.replace(/["'<>\\]/g,"");var e=u.xdm_p,g;if(g=d.acl){a:{g=d.acl;var j=d.remote;"string"==typeof g&&(g=[g]);for(var x,y=g.length;y--;)if(x=g[y],x=RegExp("^"==x.substr(0,1)?x:"^"+x.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),x.test(j)){g=!0;break a}g=!1}g=!g}if(g)throw Error("Access denied for "+
d.remote);}d.protocol=e;switch(e){case "0":m(d,{interval:100,delay:2E3,useResize:!0,useParent:!1,usePolling:!1},!0);if(d.isHost){if(!d.local){e=c.protocol+"//"+c.host;f=a.body.getElementsByTagName("img");for(j=f.length;j--;)if(g=f[j],g.src.substring(0,e.length)===e){d.local=g.src;break}if(!d.local)d.local=b}e={xdm_c:d.channel,xdm_p:0};d.local===b?(d.usePolling=!0,d.useParent=!0,d.local=c.protocol+"//"+c.host+c.pathname+c.search,e.xdm_e=d.local,e.xdm_pa=1):e.xdm_e=o(d.local);if(d.container)d.useResize=
!1,e.xdm_po=1;d.remote=p(d.remote,e)}else m(d,{channel:u.xdm_c,remote:u.xdm_e,useParent:!s(u.xdm_pa),usePolling:!s(u.xdm_po),useResize:d.useParent?!1:d.useResize});f=[new k.stack.HashTransport(d),new k.stack.ReliableBehavior({}),new k.stack.QueueBehavior({encode:!0,maxLength:4E3-d.remote.length}),new k.stack.VerifyBehavior({initiate:d.isHost})];break;case "1":f=[new k.stack.PostMessageTransport(d)];break;case "2":if(d.isHost)d.remoteHelper=o(d.remoteHelper);f=[new k.stack.NameTransport(d),new k.stack.QueueBehavior,
new k.stack.VerifyBehavior({initiate:d.isHost})];break;case "3":f=[new k.stack.NixTransport(d)];break;case "4":f=[new k.stack.SameOriginTransport(d)];break;case "5":f=[new k.stack.FrameElementTransport(d)];break;case "6":A||i(),f=[new k.stack.FlashTransport(d)]}f.push(new k.stack.QueueBehavior({lazy:d.lazy,remove:!0}));return f}function O(a){for(var c,b={incoming:function(a,c){this.up.incoming(a,c)},outgoing:function(a,c){this.down.outgoing(a,c)},callback:function(a){this.up.callback(a)},init:function(){this.down.init()},
destroy:function(){this.down.destroy()}},d=0,e=a.length;d<e;d++){c=a[d];m(c,b,!0);if(0!==d)c.down=a[d-1];if(d!==e-1)c.up=a[d+1]}return c}function U(a){a.up.down=a.down;a.down.up=a.up;a.up=a.down=null}var G=this,P=Math.floor(1E4*Math.random()),L=Function.prototype,I=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,Q=/[\-\w]+\/\.\.\//,V=/([^:])\/\//g,E="",k={},W=b.easyXDM,v="easyXDM_",J,R=!1,A,M,w,C;if(h(b,"addEventListener"))w=function(a,c,b){a.addEventListener(c,b,!1)},C=function(a,c,b){a.removeEventListener(c,
b,!1)};else if(h(b,"attachEvent"))w=function(a,c,b){a.attachEvent("on"+c,b)},C=function(a,c,b){a.detachEvent("on"+c,b)};else throw Error("Browser not supported");var B=!1,H=[],K;"readyState"in a?(K=a.readyState,B="complete"==K||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==K||"interactive"==K)):B=!!a.body;if(!B){if(h(b,"addEventListener"))w(a,"DOMContentLoaded",g);else if(w(a,"readystatechange",function(){"complete"==a.readyState&&g()}),a.documentElement.doScroll&&b===top){var S=function(){if(!B){try{a.documentElement.doScroll("left")}catch(c){d(S,
1);return}g()}};S()}w(b,"load",g)}var u=function(a){for(var a=a.substring(1).split("&"),c={},b,d=a.length;d--;)b=a[d].split("="),c[b[0]]=e(b[1]);return c}(/xdm_e=/.test(c.search)?c.search:c.hash),N=function(){var a={},c={a:[1,2,3]};if("undefined"!=typeof JSON&&"function"===typeof JSON.stringify&&'{"a":[1,2,3]}'===JSON.stringify(c).replace(/\s/g,""))return JSON;if(Object.toJSON&&'{"a":[1,2,3]}'===Object.toJSON(c).replace(/\s/g,""))a.stringify=Object.toJSON;if("function"===typeof String.prototype.evalJSON&&
(c='{"a":[1,2,3]}'.evalJSON(),c.a&&3===c.a.length&&3===c.a[2]))a.parse=function(a){return a.evalJSON()};return a.stringify&&a.parse?(N=function(){return a},a):null};m(k,{version:"2.4.18.25",query:u,stack:{},apply:m,getJSONObject:N,whenReady:j,noConflict:function(a){b.easyXDM=W;(E=a)&&(v="easyXDM_"+E.replace(".","_")+"_");return k}});k.DomHelper={on:w,un:C,requiresJSON:function(c){"object"==typeof b.JSON&&b.JSON||a.write('<script type="text/javascript" src="'+c+'"><\/script>')}};(function(){var a=
{};k.Fn={set:function(c,b){a[c]=b},get:function(c,b){var d=a[c];b&&delete a[c];return d}}})();k.Socket=function(a){var c=O(l(a).concat([{incoming:function(c,b){a.onMessage(c,b)},callback:function(c){if(a.onReady)a.onReady(c)}}])),b=n(a.remote);this.origin=n(a.remote);this.destroy=function(){c.destroy()};this.postMessage=function(a){c.outgoing(a,b)};c.init()};k.Rpc=function(a,c){if(c.local)for(var b in c.local)if(c.local.hasOwnProperty(b)){var d=c.local[b];"function"===typeof d&&(c.local[b]={method:d})}var e=
O(l(a).concat([new k.stack.RpcBehavior(this,c),{callback:function(c){if(a.onReady)a.onReady(c)}}]));this.origin=n(a.remote);this.destroy=function(){e.destroy()};e.init()};k.stack.SameOriginTransport=function(a){var b,e,f,g;return b={outgoing:function(a,c,b){f(a);b&&b()},destroy:function(){e&&(e.parentNode.removeChild(e),e=null)},onDOMReady:function(){g=n(a.remote);a.isHost?(m(a.props,{src:p(a.remote,{xdm_e:c.protocol+"//"+c.host+c.pathname,xdm_c:a.channel,xdm_p:4}),name:v+a.channel+"_provider"}),
e=q(a),k.Fn.set(a.channel,function(a){f=a;d(function(){b.up.callback(!0)},0);return function(a){b.up.incoming(a,g)}})):(f=r().Fn.get(a.channel,!0)(function(a){b.up.incoming(a,g)}),d(function(){b.up.callback(!0)},0))},init:function(){j(b.onDOMReady,b)}}};k.stack.FlashTransport=function(b){function e(a){d(function(){i.up.incoming(a,x)},0)}function g(c){var d=b.swf+"?host="+b.isHost,e="easyXDM_swf_"+Math.floor(1E4*Math.random());k.Fn.set("flash_loaded"+c.replace(/[\-.]/g,"_"),function(){k.stack.FlashTransport[c].swf=
y=D.firstChild;for(var a=k.stack.FlashTransport[c].queue,b=0;b<a.length;b++)a[b]();a.length=0});b.swfContainer?D="string"==typeof b.swfContainer?a.getElementById(b.swfContainer):b.swfContainer:(D=a.createElement("div"),m(D.style,M&&b.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),a.body.appendChild(D));var i="callback=flash_loaded"+f(c.replace(/[\-.]/g,"_"))+"&proto="+G.location.protocol+"&domain="+
f(G.location.href.match(I)[3])+"&port="+f(G.location.href.match(I)[4]||"")+"&ns="+f(E);D.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+e+"' data='"+d+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+d+"'></param><param name='flashvars' value='"+i+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+i+"' allowScriptAccess='always' wmode='transparent' src='"+d+"' height='1' width='1'></embed></object>"}
var i,h,x,y,D;return i={outgoing:function(a,c,d){y.postMessage(b.channel,a.toString());d&&d()},destroy:function(){try{y.destroyChannel(b.channel)}catch(a){}y=null;h&&(h.parentNode.removeChild(h),h=null)},onDOMReady:function(){x=b.remote;k.Fn.set("flash_"+b.channel+"_init",function(){d(function(){i.up.callback(!0)})});k.Fn.set("flash_"+b.channel+"_onMessage",e);b.swf=o(b.swf);var a=b.swf.match(I)[3],f=function(){k.stack.FlashTransport[a].init=!0;y=k.stack.FlashTransport[a].swf;y.createChannel(b.channel,
b.secret,n(b.remote),b.isHost);b.isHost&&(M&&b.swfNoThrottle&&m(b.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),m(b.props,{src:p(b.remote,{xdm_e:n(c.href),xdm_c:b.channel,xdm_p:6,xdm_s:b.secret}),name:v+b.channel+"_provider"}),h=q(b))};k.stack.FlashTransport[a]&&k.stack.FlashTransport[a].init?f():k.stack.FlashTransport[a]?k.stack.FlashTransport[a].queue.push(f):(k.stack.FlashTransport[a]={queue:[f]},g(a))},init:function(){j(i.onDOMReady,i)}}};k.stack.PostMessageTransport=function(a){function e(b){var d;
if(b.origin)d=n(b.origin);else if(b.uri)d=n(b.uri);else if(b.domain)d=c.protocol+"//"+b.domain;else throw"Unable to retrieve the origin of the event";d==h&&b.data.substring(0,a.channel.length+1)==a.channel+" "&&f.up.incoming(b.data.substring(a.channel.length+1),d)}var f,g,i,h;return f={outgoing:function(c,b,d){i.postMessage(a.channel+" "+c,b||h);d&&d()},destroy:function(){C(b,"message",e);g&&(i=null,g.parentNode.removeChild(g),g=null)},onDOMReady:function(){h=n(a.remote);if(a.isHost){var j=function(c){c.data==
a.channel+"-ready"&&(i="postMessage"in g.contentWindow?g.contentWindow:g.contentWindow.document,C(b,"message",j),w(b,"message",e),d(function(){f.up.callback(!0)},0))};w(b,"message",j);m(a.props,{src:p(a.remote,{xdm_e:n(c.href),xdm_c:a.channel,xdm_p:1}),name:v+a.channel+"_provider"});g=q(a)}else w(b,"message",e),i="postMessage"in b.parent?b.parent:b.parent.document,i.postMessage(a.channel+"-ready",h),d(function(){f.up.callback(!0)},0)},init:function(){j(f.onDOMReady,f)}}};k.stack.FrameElementTransport=
function(e){var f,g,i,h;return f={outgoing:function(a,c,b){i.call(this,a);b&&b()},destroy:function(){g&&(g.parentNode.removeChild(g),g=null)},onDOMReady:function(){h=n(e.remote);if(e.isHost)m(e.props,{src:p(e.remote,{xdm_e:n(c.href),xdm_c:e.channel,xdm_p:5}),name:v+e.channel+"_provider"}),g=q(e),g.fn=function(a){delete g.fn;i=a;d(function(){f.up.callback(!0)},0);return function(a){f.up.incoming(a,h)}};else{if(a.referrer&&n(a.referrer)!=u.xdm_e)b.top.location=u.xdm_e;i=b.frameElement.fn(function(a){f.up.incoming(a,
h)});f.up.callback(!0)}},init:function(){j(f.onDOMReady,f)}}};k.stack.NameTransport=function(a){function c(b){h.contentWindow.sendMessage(b,a.remoteHelper+(i?"#_3":"#_2")+a.channel)}function b(){i?(2===++t||!i)&&g.up.callback(!0):(c("ready"),g.up.callback(!0))}function e(a){g.up.incoming(a,F)}function f(){z&&d(function(){z(!0)},0)}var g,i,h,l,t,z,F,T;return g={outgoing:function(a,b,d){z=d;c(a)},destroy:function(){h.parentNode.removeChild(h);h=null;i&&(l.parentNode.removeChild(l),l=null)},onDOMReady:function(){i=
a.isHost;t=0;F=n(a.remote);a.local=o(a.local);i?(k.Fn.set(a.channel,function(c){i&&"ready"===c&&(k.Fn.set(a.channel,e),b())}),T=p(a.remote,{xdm_e:a.local,xdm_c:a.channel,xdm_p:2}),m(a.props,{src:T+"#"+a.channel,name:v+a.channel+"_provider"}),l=q(a)):(a.remoteHelper=a.remote,k.Fn.set(a.channel,e));var c=function(){var e=h||this;C(e,"load",c);k.Fn.set(a.channel+"_load",f);(function Y(){"function"==typeof e.contentWindow.sendMessage?b():d(Y,50)})()};h=q({props:{src:a.local+"#_4"+a.channel},onLoad:c})},
init:function(){j(g.onDOMReady,g)}}};k.stack.HashTransport=function(a){function c(){if(l){var a=l.location.href,b="",d=a.indexOf("#");-1!=d&&(b=a.substring(d));b&&b!=h&&(h=b,e.up.incoming(h.substring(h.indexOf("_")+1),F))}}var e,f,g,i,h,k,l,t,z,F;return e={outgoing:function(c){if(t)c=a.remote+"#"+k++ +"_"+c,(f||!z?t.contentWindow:t).location=c},destroy:function(){b.clearInterval(g);(f||!z)&&t.parentNode.removeChild(t);t=null},onDOMReady:function(){f=a.isHost;i=a.interval;h="#"+a.channel;k=0;z=a.useParent;
F=n(a.remote);if(f){m(a.props,{src:a.remote,name:v+a.channel+"_provider"});if(z)a.onLoad=function(){l=b;g=setInterval(c,i);e.up.callback(!0)};else{var j=0,o=a.delay/50;(function X(){if(++j>o)throw Error("Unable to reference listenerwindow");try{l=t.contentWindow.frames[v+a.channel+"_consumer"]}catch(b){}l?(g=setInterval(c,i),e.up.callback(!0)):d(X,50)})()}t=q(a)}else l=b,g=setInterval(c,i),z?(t=parent,e.up.callback(!0)):(m(a,{props:{src:a.remote+"#"+a.channel+new Date,name:v+a.channel+"_consumer"},
onLoad:function(){e.up.callback(!0)}}),t=q(a))},init:function(){j(e.onDOMReady,e)}}};k.stack.ReliableBehavior=function(){var a,c,b=0,d=0,e="";return a={incoming:function(f,g){var i=f.indexOf("_"),h=f.substring(0,i).split(","),f=f.substring(i+1);h[0]==b&&(e="",c&&c(!0));0<f.length&&(a.down.outgoing(h[1]+","+b+"_"+e,g),d!=h[1]&&(d=h[1],a.up.incoming(f,g)))},outgoing:function(f,g,i){e=f;c=i;a.down.outgoing(d+","+ ++b+"_"+f,g)}}};k.stack.QueueBehavior=function(a){function c(){if(a.remove&&0===g.length)U(b);
else if(!i&&!(0===g.length||j)){i=!0;var e=g.shift();b.down.outgoing(e.data,e.origin,function(a){i=!1;e.callback&&d(function(){e.callback(a)},0);c()})}}var b,g=[],i=!0,h="",j,k=0,l=!1,t=!1;return b={init:function(){s(a)&&(a={});if(a.maxLength)k=a.maxLength,t=!0;a.lazy?l=!0:b.down.init()},callback:function(a){i=!1;var d=b.up;c();d.callback(a)},incoming:function(c,d){if(t){var f=c.indexOf("_"),g=parseInt(c.substring(0,f),10);h+=c.substring(f+1);0===g&&(a.encode&&(h=e(h)),b.up.incoming(h,d),h="")}else b.up.incoming(c,
d)},outgoing:function(d,e,i){a.encode&&(d=f(d));var h=[],j;if(t){for(;0!==d.length;)j=d.substring(0,k),d=d.substring(j.length),h.push(j);for(;j=h.shift();)g.push({data:h.length+"_"+j,origin:e,callback:0===h.length?i:null})}else g.push({data:d,origin:e,callback:i});l?b.down.init():c()},destroy:function(){j=!0;b.down.destroy()}}};k.stack.VerifyBehavior=function(a){function c(){d=Math.random().toString(16).substring(2);b.down.outgoing(d)}var b,d,e;return b={incoming:function(f,g){var i=f.indexOf("_");
-1===i?f===d?b.up.callback(!0):e||(e=f,a.initiate||c(),b.down.outgoing(f)):f.substring(0,i)===e&&b.up.incoming(f.substring(i+1),g)},outgoing:function(a,c,e){b.down.outgoing(d+"_"+a,c,e)},callback:function(){a.initiate&&c()}}};k.stack.RpcBehavior=function(a,c){function b(a){a.jsonrpc="2.0";f.down.outgoing(g.stringify(a))}function d(a,c){var e=Array.prototype.slice;return function(){var d=arguments.length,f,g={method:c};0<d&&"function"===typeof arguments[d-1]?(1<d&&"function"===typeof arguments[d-2]?
(f={success:arguments[d-2],error:arguments[d-1]},g.params=e.call(arguments,0,d-2)):(f={success:arguments[d-1]},g.params=e.call(arguments,0,d-1)),h[""+ ++i]=f,g.id=i):g.params=e.call(arguments,0);if(a.namedParams&&1===g.params.length)g.params=g.params[0];b(g)}}function e(a,c,d,f){if(d){var g,i;c?(g=function(a){g=L;b({id:c,result:a})},i=function(a,d){i=L;var e={id:c,error:{code:-32099,message:a}};if(d)e.error.data=d;b(e)}):g=i=L;"[object Array]"===Object.prototype.toString.call(f)||(f=[f]);try{var h=
d.method.apply(d.scope,f.concat([g,i]));s(h)||g(h)}catch(j){i(j.message)}}else c&&b({id:c,error:{code:-32601,message:"Procedure not found."}})}var f,g=c.serializer||N(),i=0,h={};return f={incoming:function(a){a=g.parse(a);if(a.method)c.handle?c.handle(a,b):e(a.method,a.id,c.local[a.method],a.params);else{var d=h[a.id];a.error?d.error&&d.error(a.error):d.success&&d.success(a.result);delete h[a.id]}},init:function(){if(c.remote)for(var b in c.remote)c.remote.hasOwnProperty(b)&&(a[b]=d(c.remote[b],b));
f.down.init()},destroy:function(){for(var b in c.remote)c.remote.hasOwnProperty(b)&&a.hasOwnProperty(b)&&delete a[b];f.down.destroy()}}};G.easyXDM=k})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);"undefined"==typeof CFW&&(CFW={});"undefined"==typeof CFW_OPTIONS&&(CFW_OPTIONS={});CFW.domain=/[.]local/.test(window.location.host)||/yestech/.test(window.location.host)||/asqua/.test(window.location.host)?"http://tameron.herokuapp.com":"http://cfwhiteboard.com";CFW.important=jQuery.important.noConflict();CFW.oxygenTank=function(){var b=Array.prototype.slice.call(arguments),a=b.pop(),b=_.inject(b,function(a,b){return"undefined"!=typeof a?a[b]:a},b.shift());return"undefined"!=typeof b?b:a};
CFW.tunnel=new easyXDM.Rpc({remote:CFW.domain+"/tunnel"},{remote:{request:{}}});CFW.ajax=function(b){var a=jQuery.Deferred();a.done(function(){b.success&&b.success.apply(this,arguments)});a.fail(function(a){a=a.message;b.error&&b.error.apply(this,[a])});a.always(function(){b.complete&&b.complete.apply(this)});b.method=b.type;CFW.tunnel.request(_.extend({},b,{model:null,collection:null}),function(){a.resolveWith(this,arguments)},function(){a.rejectWith(this,arguments)});return a.promise()};
Backbone.ajax=CFW.ajax;
CFW.fixEmbeds=function(b){var a=function(){var a=b(this);setTimeout(function(){var d=!1,e=a.attr("wmode");"opaque"!=e&&"transparent"!=e&&(a.attr("wmode","opaque"),d=!0);var f=a.closest("object"),e=f.children('param[name="wmode"]').val();"opaque"!=e&&"transparent"!=e&&(f.prepend(b('<param name="wmode" value="opaque" />')),d=!0);d&&(f=f.length?f:a,d=b('<span class="cfw-placeholder" />'),f.wrap(d),d.html(d.html()),d.children().unwrap())},0)};b(document.embeds).each(a);b("object").each(a);b("iframe").each(function(){/youtube/.test(this.src)&&
(this.src+=(0<=this.src.indexOf("?")?"&":"?")+"wmode=opaque")})};jQuery(window).load(function(){CFW.fixEmbeds(jQuery)});
CFW.init=function(b){if(!Modernizr.csstransitions)Modernizr.csstransforms=!1,Modernizr.csstransforms3d=!1;if(/AppleWebKit/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent))Modernizr.csstransforms3d=!1;(function(a){function c(){a(".dropdown-backdrop").remove();a(e).each(function(){b(a(this)).removeClass("open")})}function b(c){var d=c.attr("data-target");d||(d=(d=c.attr("href"))&&/#/.test(d)&&d.replace(/.*(?=#[^\s]*$)/,""));d=d&&a(d);if(!d||!d.length)d=c.parent();return d}var e='[data-toggle="dropdown"]',
f=function(c){var b=a(c).on("click.dropdown.data-api",this.toggle);a("html").on("click.dropdown.data-api",function(){b.parent().removeClass("open")})};f.prototype={constructor:f,toggle:function(){var e=a(this),f,h;if(!e.is(".disabled, :disabled")){f=b(e);h=f.hasClass("open");c();if(!h){if("ontouchstart"in document.documentElement)a('<div class="dropdown-backdrop"/>').insertBefore(a(this)).on("click",c);f.toggleClass("open")}e.focus();return!1}},keydown:function(c){var f,h,r;if(/(38|40|27)/.test(c.keyCode)&&
(f=a(this),c.preventDefault(),c.stopPropagation(),!f.is(".disabled, :disabled"))){h=b(f);r=h.hasClass("open");if(!r||r&&27==c.keyCode)return 27==c.which&&h.find(e).focus(),f.click();f=a('[role="menu"] li:not(.divider):visible a',h);f.length&&(h=f.index(f.filter(":focus")),38==c.keyCode&&0<h&&h--,40==c.keyCode&&h<f.length-1&&h++,~h||(h=0),f.eq(h).focus())}}};var h=a.fn.dropdown;a.fn.dropdown=function(c){return this.each(function(){var b=a(this),d=b.data("dropdown");d||b.data("dropdown",d=new f(this));
"string"==typeof c&&d[c].call(b)})};a.fn.dropdown.Constructor=f;a.fn.dropdown.noConflict=function(){a.fn.dropdown=h;return this};a.fn.dropdown.initContainerEvents=function(b){a(b).on("click.dropdown.data-api",c).on("click.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.dropdown.data-api",e,f.prototype.toggle).on("keydown.dropdown.data-api",e+', [role="menu"]',f.prototype.keydown)}})(window.jQuery);b.fn.cfwDropdown=b.fn.dropdown.noConflict();CFW.User=Backbone.Model.extend({defaults:function(){return{email:"",
known_as:"",count:0,highlightColor:CFW.User.prototype.randomColor()}},randomColor:function(){return[[255,75,105],[255,105,75],[75,105,255],[105,75,255],[75,255,105],[105,255,75],[123,6,226],[226,6,123],[6,226,123],[6,123,226]][Math.floor(10*Math.random()+0)]}});CFW.UserList=Backbone.Collection.extend({model:CFW.User,initialize:function(){this.localStorage=new Store("cfw-users");return this},comparator:function(a){return-a.get("count")}});CFW.users=new CFW.UserList;CFW.users.fetch();CFW.Entry=Backbone.Model.extend({idAttribute:"_id",
defaults:{athlete_id:"",known_as:"",email:"",component_results:[],notes:"",facebook_url:""},emailRegex:/^\S+@\S+\.\S+$/,validate:function(a){var c=[];!(a.athlete_id||this.attributes&&this.get("athlete_id"))&&!this.emailRegex.test(a.email)&&c.push("email");(!a.known_as||!a.known_as.replace(/^\s+/,"").replace(/\s+$/,"").length)&&c.push("known_as");if(c.length)return c},setUrlHash:function(){if(this.collection&&this.collection.whiteboardId&&this.collection.wpId){var a="cfwhiteboard-"+this.collection.whiteboardId+
"-"+this.collection.wpId+"-"+this.get("athlete_slug");b(document.body).append(b('<span id="'+a+'" style="position:absolute; top:'+b(document.body).scrollTop()+'px; display:none;"></span>'));window.location.hash=a}}});CFW.EntryList=Backbone.Collection.extend({model:CFW.Entry,url:function(){return CFW.domain+"/affiliates/"+(this.affiliateId||"")+"/wods/"+(this.wodId||"")+"/posts"},initialize:function(a,c){if(c)this.affiliateId=c.affiliateId,this.wodId=c.wodId,this.whiteboardId=c.whiteboardId,this.wpId=
c.wpId;return this},comparator:function(a){return a.get("known_as").replace(/^\s+/,"").toLowerCase()}});CFW.Component=Backbone.Model.extend({idAttribute:"_id",defaults:{description:"",label:"",result_type:"",result_notes:""}});CFW.ComponentList=Backbone.Collection.extend({model:CFW.Component});CFW.Wod=Backbone.Model.extend({idAttribute:"_id",defaults:function(){return{affiliate_id:"",whiteboard_id:"",wp_id:"",components:new CFW.ComponentList,entries:new CFW.EntryList}},initialize:function(){return this},
parse:function(a){a.name=a.name.replace(/workout of the day/ig,"WOD");a.entries=new CFW.EntryList(a.posts,{affiliateId:a.affiliate_id,wodId:a._id,whiteboardId:a.whiteboard_id,wpId:a.wp_id});delete a.posts;a.components=new CFW.ComponentList(a.components);return a}});CFW.WodList=Backbone.Collection.extend({model:CFW.Wod,url:function(){return this.affiliateId?CFW.domain+"/affiliates/"+this.affiliateId+"/wods":""},fetchData:function(){var a={format:"json",wods:"",d:"_"};this.chain().uniq(function(a){return a.get("whiteboard_id")}).each(function(c,
b){0<b&&(a.wods+=a.d+a.d);a.wods+=c.get("whiteboard_id")+a.d+c.get("post_modified")});return a},initialize:function(){var a=this;this.on("add",function(c){a.affiliateId=c.get("affiliate_id")});return this},wodsQuery:function(){var a="";this.each(function(c,b){a+=(0==b?"":",")+c.get("post_id")+"["+c.get("wp_id")+"]"});return a}});CFW.EntryItemView=Backbone.View.extend({tagName:"tr",template:_.template('            <td class="cfw-known-as">                <a href="<%- athlete_url %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash"><%- known_as %></a>            </td>            <%             if (wod.components && wod.components.length > 1) {                wod.components.each(function(component, i, components) {                    var componentResult = _.find(component_results, function(cr) {                        return cr.component_id == component.id;                    }) || {                        result: "",                        rx: false,                        mods: ""                    };                    var isLast = (i + 1 == components.length);                    %>                     <td class="cfw-component" title="<%- componentResult.result %><%- componentResult.rx ? " [Rx]" : "" %><%- componentResult.mods ? " ("+componentResult.mods+")" : "" %>">                        <%= isLast ? "<div>" : "" %>                        <span class="cfw-result"><%- componentResult.result %></span>                        <span class="cfw-mods">                            <%= componentResult.rx ? "<strong>Rx</strong>" : "" %>                            <%- componentResult.mods %>                        </span>                        <% if (isLast) { %>                            <% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %>                            <span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                        <% } %>                        <%= isLast ? "</div>" : "" %>                    </td>                <%                 });            } else {                var componentResult = _.find(component_results, function(cr) {                    return cr.component_id == (wod.components.at(0) || {id: "uh oh"}).id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                 <td class="cfw-result" title="<%- componentResult.result %>"><%- componentResult.result %></td>                <td class="cfw-mods" title="<%- componentResult.rx ? "[Rx] " : "" %><%- componentResult.mods %>">                    <div>                        <%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %><% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %><span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                    </div>                </td>            <%             }            %>         '),
events:{click:"showDetail","click .cfw-set-url-hash":"setUrlHash"},initialize:function(){this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this);this.model.on("show",this.lookSelected,this);this.model.on("unshow",this.unlookSelected,this);this.model.on("highlight",this.highlight,this);return this.render()},render:function(){var a=_.extend({wod:this.options.wod.toJSON()},this.model.toJSON());if(!a.athlete_url)a.athlete_url=CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink",
"")+this.model.get("athlete_slug");this.$el.html(this.template(a));return this},lookSelected:function(){this.$el.addClass("cfw-selected")},unlookSelected:function(){this.$el.removeClass("cfw-selected")},highlight:function(){this.$el.addClass("cfw-highlighted").trigger("scrollToEntry");if(Modernizr.csstransitions)this.$el.addClass("cfw-highlighted-transition").removeClass("cfw-highlighted").one("mouseenter touchstart",function(){b(this).removeClass("cfw-highlighted-transition")});else{var a=this.$el,
c=function(){a.toggleClass("cfw-highlighted")};setTimeout(c,300);setTimeout(c,600);setTimeout(c,900);setTimeout(c,1200);setTimeout(function(){a.removeClass("cfw-highlighted")},1500)}},showDetail:function(a){this.itemClickDisabled||0<b(a.target).closest("a").length||(a.stopPropagation(),this.model.trigger("show",this.model))},setUrlHash:function(){this.model.setUrlHash()}});CFW.WhiteboardPage=Backbone.View.extend({tagName:"div",className:"cfw-page",show:function(){this.$el.addClass("active");var a=
this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),a.scrollbarReady=!0;a.showScrollbar()},Modernizr.csstransitions?400:0)},hide:function(){this.freezeScrollbar();this.$el.removeClass("active");var a=this;setTimeout(function(){a.hideScrollbar();a.thawScrollbar();a.$el.trigger("cfwhide")},Modernizr.csstransitions?300:0)},isActive:function(){return this.$el.hasClass("active")},initScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,
show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("show")},hideScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("hide")},freezeScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("freeze")},thawScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("thaw")}});CFW.EntryListView=CFW.WhiteboardPage.extend({template:_.template('            <table class="cfw-components-<%= wod.components && wod.components.length || 1 %>" cellspacing="0">                <thead>                    <tr>                        <th class="cfw-known-as">Name</th>                        <% wod.components.each(function(component) { %>                            <th class="cfw-component" <%= wod.components.length == 1 ? \'colspan="2"\' : "" %> title="<%- component.get("description") %>"><%- component.get("label") %></th>                        <% }); %>                    </tr>                </thead>            </table>            <div class="cfw-scrollable">                <table cellspacing="0" class="cfw-components-<%= wod.components && wod.components.length || 1 %>">                    <tbody>                    </tbody>                </table>            </div>        '),
events:{"scrollToEntry tr":"scrollToEntry","touchmove .cfw-scrollable":"disableItemClicks","touchstart .cfw-scrollable":"enableItemClicks","click .cfw-retry-fetch-wods":"retryFetchWods"},initialize:function(){this.entryItemViews=[];this.resetModel(this.model)},resetModel:function(a){this.model=a;this.render();if(this.isActive()){var c=this;setTimeout(function(){c.initScrollbar();c.showScrollbar()},0)}else this.scrollbarReady=!1;this.model.get("entries").on("add change:known_as remove reset",this.addAll,
this);this.model.get("entries").trigger("reset")},render:function(){this.$el.html(this.template({wod:this.model.toJSON()}));this.isActive()&&this.setComponentsClass();return this},addOne:function(a){a=new CFW.EntryItemView({model:a,wod:this.model});this.entryItemViews.push(a);this.$("tbody").append(a.el)},addAll:function(){_.each(this.entryItemViews,function(a,c,b){a.remove();delete b[c]});this.$("tbody").empty();this.model.get("entries").length?this.model.get("entries").each(this.addOne,this):CFW.wods.fetchAttempted&&
CFW.wods.fetchFailed?this.$("tbody").append(b('                    <tr class="cfw-no-entries">                        <td colspan="100">Error communicating with the server.<br /><a class="cfw-retry-fetch-wods">Retry Now<a></td>                    </tr>                ')):CFW.wods.fetchAttempted?this.$("tbody").append(b('                    <tr class="cfw-no-entries">                        <td colspan="100">No one has added an entry yet.<br /><a class="cfw-new-entry">Add yours now!<a></td>                    </tr>                ')):
this.$("tbody").append(b('                    <tr class="cfw-no-entries">                        <td colspan="100">Loading...</td>                    </tr>                '))},retryFetchWods:function(){this.$("tbody td").text("Loading...");CFW.fetchWods()},setComponentsClass:function(){var a=this.$("table").attr("class"),c=this.$el.closest(".cfw-contents");setTimeout(function(){c.addClass(a).data("componentsclass",a);c.siblings(".cfw-classes").addClass(a)},Modernizr.csstransitions?300:0)},unsetComponentsClass:function(){var a=
this.$("table").attr("class");this.$el.closest(".cfw-contents").removeClass(a).removeData("componentsclass").siblings(".cfw-classes").removeClass(a)},show:function(){this.setComponentsClass();CFW.WhiteboardPage.prototype.show.apply(this,arguments)},hide:function(){this.unsetComponentsClass();CFW.WhiteboardPage.prototype.hide.apply(this,arguments)},scrollToEntry:function(a){var c=this.$(".cfw-scrollable").scrollTop(0);(a=b(a.target).position())&&a.top&&c.scrollTop(a.top-15-(c.height()||0)/2)},disableItemClicks:function(){_.each(this.entryItemViews,
function(a){a.itemClickDisabled=!0})},enableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!1})}});CFW.EntryDetailView=CFW.WhiteboardPage.extend({template:_.template('            <div class="cfw-entry-detail">                <a class="cfw-back">back</a><a class="cfw-edit">edit</a>                <dl class="cfw-scrollable">                    <dt class="cfw-hidden">Name</dt>                    <dd class="cfw-known-as">                        <%- known_as %>                        <a href="<%- athlete_url %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash">view profile</a>                    </dd>                    <%                    wod.components.each(function(component) {                        var componentResult = _.find(component_results, function(cr) {                            return cr.component_id == component.id;                        }) || {                            result: "",                            rx: false,                            mods: ""                        };                    %>                        <dt title="<%- component.get("description") %>"><%= component.get("label") %></dt>                        <dd class="cfw-component">                            <span class="cfw-result"><%- componentResult.result %></span>                            <span class="cfw-mods"><%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %></span>                        </dd>                    <%                    });                    %>                    <dt>Notes</dt>                    <dd class="cfw-notes"><%- notes || "(no data)" %></dd>                </dl>            </div>        '),
events:{"click .cfw-set-url-hash":"setUrlHash","click a.cfw-edit":"edit","click a.cfw-back":"back",cfwhide:"cleanup"},initialize:function(a){this.wod=a.wod;this.model.on("change",this.render,this);this.model.on("change",function(){var a=this;setTimeout(function(){a.initScrollbar();a.showScrollbar()},300)},this);this.model.on("destroy",this.back,this);return this.render()},render:function(){var a=_.extend({wod:this.wod.toJSON()},this.model.toJSON());if(!a.athlete_url)a.athlete_url=CFW.oxygenTank(CFW_OPTIONS,
"athletes_page_permalink","")+this.model.get("athlete_slug");this.$el.html(this.template(a));return this},setUrlHash:function(){this.model.setUrlHash()},edit:function(){this.model.trigger("edit",this.model)},back:function(){this.$el.trigger("hideEntryDetails")},cleanup:function(){var a=this;setTimeout(function(){a.model.trigger("unshow",a.model);a.remove()},0)}});CFW.ModalPage=Backbone.View.extend({tagName:"div",className:"cfw-scrollable cfw-modal",events:{"focus :input":"scrollToInput","click .cfw-close-modal":"remove"},
initScrollbar:function(){this.$el.scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$el.scrollbarPaper("show")},hideScrollbar:function(){this.$el.scrollbarPaper("hide")},freezeScrollbar:function(){this.$el.scrollbarPaper("freeze")},thawScrollbar:function(){this.$el.scrollbarPaper("thaw")},scrollToInput:function(a){if(!this.height)this.height=this.$el.parent().height();
(a=(b(a.target).position()||{}).top)&&this.$el.animate({scrollTop:a+this.$el.scrollTop()-this.height/2},300)},show:function(){var a=this.$el.closest(".cfw-contents"),c=a.data("componentsclass");c&&(a.removeClass(c),a.siblings(".cfw-classes").removeClass(c));var b=this;setTimeout(function(){b.$el.addClass("cfw-translate-oldfashioned")},0);setTimeout(function(){if(!b.scrollbarReady)b.initScrollbar(),b.scrollbarReady=!0;b.showScrollbar();var a=b.$el.find(":input[type!=hidden]:first")[0];a&&a.focus&&
a.focus()},Modernizr.csstransitions?400:0)},remove:function(a,c){this.freezeScrollbar();var b=this,e=this.$el.closest(".cfw-contents");this.$el.removeClass("cfw-translate-oldfashioned");setTimeout(function(){b.hideScrollbar();var f=e.data("componentsclass");f&&(e.addClass(f),e.siblings(".cfw-classes").addClass(f));"object"==typeof a&&a.silent?b.$el.remove():b.$el.trigger("cfwremove").remove();_.isFunction(c)&&c()},Modernizr.csstransitions?300:0)}});CFW.EntryFormView=CFW.ModalPage.extend({tagName:"form",
template:_.template('            <fieldset>                <\!--<h2><%= new_record ? "Add Your Entry" : "Edit Your Entry" %></h2>--\>                <h2><label for="cfw-email">Email Address</label></h2>                <input type="hidden" name="<%= new_record ? "decoy" : "email" %>" value="<%- email %>" />                <input type="email" id="cfw-email" name="<%= new_record ? "email" : "decoy" %>" placeholder="name@example.com" <%= new_record ? "" : \'value="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" disabled="disabled"\' %> />                <h2><label for="cfw-known-as">Name</label></h2>                <input type="text" id="cfw-known-as" name="known_as" placeholder="Guest" value="<%- known_as %>" />            </fieldset>            <%            wod.components.each(function(component) {                var componentResult = _.find(component_results, function(cr) {                    return cr.component_id == component.id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                <fieldset><%                    switch (component.get("result_type")) {                    case "time":                        if ("seconds" in componentResult) {                            componentResult.minutes = Math.floor(componentResult.seconds / 60);                            componentResult.seconds = (componentResult.seconds % 60);                        }                    %>                        <h2><label for="cfw-component-<%= component.id %>-minutes" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <% if (component.get("result_notes")) { %><p class="cfw-result-notes"><%- component.get("result_notes") %></p><% } %>                        <div class="cfw-nobr">                            <input type="text" pattern="[0-9]*" id="cfw-component-<%= component.id %>-minutes" name="component-<%= component.id %>-minutes" placeholder="0" value="<%- componentResult.minutes || "" %>" size="3" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-minutes" class="cfw-inline">minutes</label>                            <input type="text" pattern="[0-9]*" id="cfw-component-<%= component.id %>-seconds" name="component-<%= component.id %>-seconds" placeholder="0" value="<%- componentResult.seconds || "" %>" size="2" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-seconds" class="cfw-inline">seconds</label>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "load":                    %>                        <h2><label for="cfw-component-<%= component.id %>-mass" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" pattern="[0-9.]*" id="cfw-component-<%= component.id %>-mass" name="component-<%= component.id %>-mass" placeholder="0" value="<%- componentResult.mass || "" %>" size="10" class="cfw-minority" />                            <% unit_options = component.get("unit_options") || [{name: "lbs", value: "lbs"}]; %>                            <div class="cfw-dropdown">                                <input type="hidden" id="cfw-component-<%= component.id %>-units" name="component-<%= component.id %>-units" value="<%- componentResult.units || unit_options[0].value %>" size="10" class="cfw-minority" />                                <a href="javascript:// Select Units" class="cfw-dropdown-toggle" data-toggle="dropdown" data-target=".cfw-dummy-selector"><span class="cfw-text"><%- componentResult.units || unit_options[0].name %></span> <span class="cfw-caret"></span></a>                                <ul class="cfw-dropdown-menu cfw-units-select">                                    <% for (var i = 0; i < unit_options.length; i++) { %>                                        <li><a href="javascript://" data-value="<%- unit_options[i].value || "" %>"><%- unit_options[i].name || "" %></a></li>                                    <% } %>                                </ul>                            </div>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "rounds":                        if ("reps" in componentResult) {                            componentResult.rounds = Math.floor(componentResult.reps / component.get("reps_per_round"));                            componentResult.reps = (componentResult.reps % component.get("reps_per_round"));                        }                    %>                        <h2><label for="cfw-component-<%= component.id %>-rounds" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" pattern="[0-9]*" id="cfw-component-<%= component.id %>-rounds" name="component-<%= component.id %>-rounds" placeholder="0" value="<%- componentResult.rounds || "" %>" size="3" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-rounds" class="cfw-inline">rounds</label>                            <label class="cfw-inline">+</label>                            <input type="text" pattern="[0-9]*" id="cfw-component-<%= component.id %>-reps" name="component-<%= component.id %>-reps" placeholder="0" value="<%- componentResult.reps || "" %>" size="3" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-reps" class="cfw-inline">reps</label>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "reps":                    %>                        <h2><label for="cfw-component-<%= component.id %>-reps" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" pattern="[0-9]*" id="cfw-component-<%= component.id %>-reps" name="component-<%= component.id %>-reps" placeholder="0" value="<%- componentResult.reps || "" %>" size="5" class="cfw-minority" />                            <label for="cfw-component-<%= component.id %>-reps" class="cfw-inline">reps</label>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "distance":                    %>                        <h2><label for="cfw-component-<%= component.id %>-distance" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <div class="cfw-nobr">                            <input type="text" pattern="[0-9.]*" id="cfw-component-<%= component.id %>-distance" name="component-<%= component.id %>-distance" placeholder="0" value="<%- componentResult.distance || "" %>" size="10" class="cfw-minority" />                            <% unit_options = component.get("unit_options") || [{name: "error", value: "error"}]; %>                            <div class="cfw-dropdown">                                <input type="hidden" id="cfw-component-<%= component.id %>-units" name="component-<%= component.id %>-units" value="<%- componentResult.units || unit_options[0].value %>" size="10" class="cfw-minority" />                                <a href="javascript:// Select Units" class="cfw-dropdown-toggle" data-toggle="dropdown" data-target=".cfw-dummy-selector"><span class="cfw-text"><%- componentResult.units || unit_options[0].name %></span> <span class="cfw-caret"></span></a>                                <ul class="cfw-dropdown-menu cfw-units-select">                                    <% for (var i = 0; i < unit_options.length; i++) { %>                                        <li><a href="javascript://" data-value="<%- unit_options[i].value || "" %>"><%- unit_options[i].name || "" %></a></li>                                    <% } %>                                </ul>                            </div>                        </div>                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <%                    break;                    case "text":                    default:                    %>                        <h2><label for="cfw-component-<%= component.id %>-result" title="<%= component.get("description") %>"><%= component.get("label") %></label></h2>                        <input type="text" id="cfw-component-<%= component.id %>-result" name="component-<%= component.id %>-result" placeholder="What was your result?" value="<%- componentResult.result %>" />                        <div class="cfw-nobr">                            <label for="cfw-component-<%= component.id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.id %>-mods" class="cfw-majority">Modifications</label>                        </div>                        <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                            <input type="checkbox" id="cfw-component-<%= component.id %>-rx" class="cfw-minority" name="component-<%= component.id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                            /><span>or</span><input type="text" id="cfw-component-<%= component.id %>-mods" class="cfw-majority" name="component-<%= component.id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                        </div>                    <% } %>                </fieldset>            <%            });            %>            <fieldset class="cfw-last">                <div class="cfw-notes <%= notes ? "cfw-open cfw-opaque" : "" %>">                    <h2><label for="cfw-notes">Notes</label></h2>                    <textarea rows="3" id="cfw-notes" name="notes" placeholder="Notes or Tips for next time?"><%- notes %></textarea>                </div>                <div class="cfw-footer">                    <a class="cfw-add-notes <%= notes ? "cfw-hidden" : "" %>"><label for="cfw-notes"><strong>+</strong> add notes</label></a>                    <input type="submit" value="<%= new_record ? "Submit" : "Save" %>" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                    <% if (!new_record) { %><div><a href="javascript://" class="cfw-delete-entry cfw-btn cfw-btn-danger" style="margin-top:5px !important;">Delete</a></div><% } %>                </div>            </fieldset>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{'keyup input[name="email"]':"guessName",'change input[name="email"]':"guessName",'blur input[name="known_as"]':"guessName","click .cfw-units-select a":"selectUnits","click .cfw-add-notes":"showNotesFields",submit:"save","click .cfw-delete-entry":"destroyEntry"}),initialize:function(a){this.wod=a.wod;return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(_.extend({wod:this.wod.toJSON(),new_record:!this.model},
(this.model||new CFW.Entry).toJSON())));return this},guessName:function(){var a=this.$('input[name="email"]'),c=this.$('input[name="known_as"]');if(!(c.val().length&&this.lastGuess&&c.val()!=this.lastGuess||c.val().length&&!this.lastGuess)){var b=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.val().toLowerCase()});if(b)c.val(this.lastGuess=b.get("known_as"));else{b=a.val();if(!_.capitalize)_.capitalize=function(a){return a.substring(0,1).toUpperCase()+a.substring(1)};this.lastGuess=
_.capitalize((/[^.@0-9]+/.exec(b)||[""])[0]);c.val(this.lastGuess)}}},selectUnits:function(a){a.preventDefault();a=b(a.target);a.closest(".cfw-dropdown").find("input").val(a.data("value")).end().find(".cfw-dropdown-toggle .cfw-text").text(a.text())},showNotesFields:function(){var a=this.$(".cfw-notes").addClass("cfw-open"),b=this.$(".cfw-add-notes").addClass("cfw-transparent");setTimeout(function(){a.addClass("cfw-opaque");b.addClass("cfw-hidden")},Modernizr.csstransitions?200:0)},save:function(a){a&&
a.preventDefault&&a.preventDefault();if(!this.isLoading()){var c={email:this.$('input[name="email"]').val(),known_as:this.$('input[name="known_as"]').val(),component_results:[],notes:this.$('textarea[name="notes"]').val(),no_auto_registration:!0},d={};this.$('input[name^="component-"]').each(function(){var a=b(this),c=a.attr("name").split("-"),a="checkbox"==a.attr("type")?a.is(":checked"):a.val();d[c[1]]||(d[c[1]]={component_id:c[1]});d[c[1]][c[2]]=a});_.each(d,function(a){c.component_results.push(a)});
var a=_.bind(function(){this.showLoading();this.$(".ajax-error-notice, .cfw-field-errors").remove()},this),e=_.bind(function(){this.hideLoading()},this),f=_.bind(this.model?function(){e();this.remove()}:function(a){e();this.$el.trigger("showEntryShare",a)},this),h=_.bind(function(a,c){e();var d=b.parseJSON(c.responseText);if(449==c.status){if(d&&d.registration_url)this.registrationUrl=d.registration_url;this.confirmNewAthlete()}else d&&d.length?this.showValidationErrors(d):this.$(".cfw-footer").after(b('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Click <strong>'+
this.$('input[type="submit"]').val()+"</strong> to try again or contact athlete support if the problem persists.</label>"))},this);a();a={success:f,error:h,wait:!0};this.model?this.model.save(c,a):this.wod.get("entries").create(c,a)||this.showValidationErrors(CFW.Entry.prototype.validate(c))}},showLoading:function(a){_.isUndefined(a)&&(a=this.$('input[type="submit"]'));a.addClass("loading");this._loadingButton=a},isLoading:function(){return!!this._loadingButton},hideLoading:function(){if(_.isUndefined(this._loadingButton))this._loadingButton=
this.$('input[type="submit"]');this._loadingButton.removeClass("loading").removeAttr("disabled");delete this._loadingButton},showValidationErrors:function(a){_.isArray(a)?_(a).each(function(a,d){this.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+b(this).attr("id")+'"]').addClass("cfw-invalid");0==d&&b(this).focus()}).one("keydown change",function(){b(this).removeClass("cfw-invalid");b('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid")})},this):_.isObject(a)&&
_(a).each(function(a,d){var e=_(a).inject(function(a,b,c){0<c&&(a+=", ");return a+b},"");this.$('input[name="'+d+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+b(this).attr("id")+'"]').addClass("cfw-invalid").after('<p class="cfw-field-errors">'+e+"</p>")}).one("keydown change",function(){b(this).removeClass("cfw-invalid").closest(".cfw-contents").find('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid").siblings(".cfw-field-errors").addClass("cfw-muted")})},this)},confirmNewAthlete:function(){var a=
new CFW.ConfirmNewAthleteView({email:this.$('input[name="email"]').val()});this.$el.closest(".cfw-contents").append(a.el);this.hideScrollbar();var b=_.bind(function(b){a.remove({silent:!0},_.bind(function(){this.showScrollbar();_.isFunction(b)&&b()},this))},this);a.on("done",_.bind(function(){b(_.bind(this.signupNewAthlete,this))},this));a.on("fail",_.bind(function(){b();var a=this.$('[name="email"]')[0];a&&a.focus()},this));setTimeout(function(){a.show()},0)},signupNewAthlete:function(){var a=new CFW.AthleteSignupView({action:this.registrationUrl,
email:this.$('[name="email"]').val(),name:this.$('[name="known_as"]').val()});this.$el.closest(".cfw-contents").append(a.el);this.hideScrollbar();var b=_.bind(function(){a.remove({silent:!0},_.bind(function(){this.showScrollbar()},this))},this);a.on("done",_.bind(function(){b();this.save()},this));a.on("fail",_.bind(function(){b();var a=this.$('[name="email"]')[0];a&&a.focus()},this));setTimeout(function(){a.show()},0)},destroyEntry:function(){if(confirm("Are you sure?")){var a=this.$(".cfw-delete-entry"),
c=_.bind(function(){this.showLoading(a);this.$(".ajax-error-notice, .cfw-field-errors").remove()},this),d=_.bind(function(){this.hideLoading()},this),e=_.bind(function(){d();this.remove()},this),f=_.bind(function(a,c){d();var e=b.parseJSON(c.responseText);e&&e.length?this.showValidationErrors(e):this.$(".cfw-footer").after(b('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Please try again or contact athlete support if the problem persists.</label>'))},
this);c();this.model.destroy({success:e,error:f,wait:!0,data:{email:this.model.get("email"),password:this.model.get("password")},processData:!0})}}});CFW.AthleteAuthView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <h2><label style="white-space:normal !important;">Enter <%- known_as %>\'s email & password to edit:</label></h2>            </fieldset>            <fieldset>                <h2><label for="cfw-email">Email</label></h2>                <input type="email" id="cfw-email" name="email" value="" />                <h2><label for="cfw-password">Password</label></h2>                <input type="password" id="cfw-password" name="password" value="" />            </fieldset>            <fieldset class="cfw-last">                <div class="cfw-footer">                    <a href="javascript://" class="cfw-reset-password js-reset-password">forgot password?</a>                    <input type="submit" value="Unlock" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{submit:"submit","click .js-reset-password":"resetPassword"}),initialize:function(){return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(this.model.toJSON()));return this},submit:function(a){a.preventDefault();if(!this.isLoading()){var c={email:this.$('[name="email"]').val(),password:this.$('[name="password"]').val()},a=_.bind(function(){this.showLoading();this.$(".ajax-error-notice, .cfw-field-errors").remove()},
this),d=_.bind(function(){this.hideLoading()},this),e=_.bind(function(){this.options.success(c)},this),f=_.bind(function(){this.showValidationErrors(["email","password"]);var a='<a href="mailto:'+(CFW_OPTIONS.custom_branding_email||"athletesupport@cfwhiteboard.com")+'" target="_blank">athlete support</a>';this.$(".cfw-footer").after(b('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! Incorrect email or password. Please try again or contact '+a+" so we can help!</label>"))},
this);a();a={url:CFW.domain+"/athletes/"+this.model.get("athlete_id")+"/verify_creds",complete:d,success:e,error:f,type:"POST",data:c,dataType:"json",cache:!1};CFW.ajax(a)}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){_.isArray(a)?_(a).each(function(a,d){this.$('input[name="'+
a+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+b(this).attr("id")+'"]').addClass("cfw-invalid");0==d&&b(this).focus()}).one("keydown change",function(){b(this).removeClass("cfw-invalid");b('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid")})},this):_.isObject(a)&&_(a).each(function(a,d){var e=_(a).inject(function(a,b,c){0<c&&(a+=", ");return a+b},"");this.$('input[name="'+d+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+b(this).attr("id")+'"]').addClass("cfw-invalid").after('<p class="cfw-field-errors">'+
e+"</p>")}).one("keydown change",function(){b(this).removeClass("cfw-invalid").closest(".cfw-contents").find('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid").siblings(".cfw-field-errors").addClass("cfw-muted")})},this)},resetPassword:function(){this.$el.trigger("showResetPassword",[{email:this.$('[name="email"]').val()}])}});CFW.ResetPasswordView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <h2><label style="white-space:normal !important;">Enter your email to reset your password:</label></h2>            </fieldset>            <fieldset>                <h2><label for="cfw-email">Email</label></h2>                <input type="email" id="cfw-email" name="email" value="<%- email %>" />            </fieldset>            <fieldset class="cfw-last">                <div class="cfw-footer">                    <input type="submit" value="Send Reset Link" />                    <input type="reset" value="Cancel" class="cfw-cancel" />                </div>            </fieldset>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{submit:"submit","click .cfw-cancel":"cancel"}),initialize:function(){return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template({email:this.options.email||""}));return this},submit:function(a){a.preventDefault();if(!this.isLoading()){var c={email:this.$('[name="email"]').val()},a=_.bind(function(){this.showLoading();this.$(".ajax-error-notice, .cfw-field-errors").remove()},this),d=_.bind(function(){this.hideLoading()},
this),e=_.bind(function(){this.$el.html('<fieldset><h2 style="white-space:normal !important;">Check your email for a link to reset your password.</h2></fieldset><fieldset class="cfw-last"><a href="javascript://" class="cfw-js-done cfw-btn cfw-btn-block cfw-btn-primary">Cool. Thanks!</a></fieldset>');this.options.success&&this.$el.find(".cfw-js-done").click(_.bind(function(){this.options.success(c)},this));this.options.always&&this.$el.find(".cfw-js-done").click(this.options.always);!this.options.success&&
!this.options.always&&this.$el.find(".cfw-js-done").addClass("cfw-close-modal")},this),f=_.bind(function(){this.showValidationErrors(["email"]);var a='<a href="mailto:'+(CFW_OPTIONS.custom_branding_email||"athletesupport@cfwhiteboard.com")+'" target="_blank">athlete support</a>';this.$(".cfw-footer").after(b('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! Incorrect email or password. Please try again or contact '+a+" so we can help!</label>"))},this);
a();a={url:CFW.domain+"/account/password",complete:d,success:e,error:f,type:"POST",data:function(a){var b={},c;for(c in a)b["athlete["+c+"]"]=a[c];return b}(c),dataType:"json",cache:!1};CFW.ajax(a)}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){_.isArray(a)?
_(a).each(function(a,d){this.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+b(this).attr("id")+'"]').addClass("cfw-invalid");0==d&&b(this).focus()}).one("keydown change",function(){b(this).removeClass("cfw-invalid");b('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid")})},this):_.isObject(a)&&_(a).each(function(a,d){var e=_(a).inject(function(a,b,c){0<c&&(a+=", ");return a+b},"");this.$('input[name="'+d+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+
b(this).attr("id")+'"]').addClass("cfw-invalid").after('<p class="cfw-field-errors">'+e+"</p>")}).one("keydown change",function(){b(this).removeClass("cfw-invalid").closest(".cfw-contents").find('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid").siblings(".cfw-field-errors").addClass("cfw-muted")})},this)},cancel:function(){this.options.always&&this.options.always()}});CFW.EntryShareView=CFW.ModalPage.extend({template:_.template('            <div class="cfw-facebook-card">                <p>                    <a href="<%- fbShareUrl %>" class="cfw-fb-action cfw-set-url-hash cfw-close-modal">Share on Facebook</a>                </p>                <p>                    <a href="javascript://" class="cfw-fb-inaction cfw-close-modal">Not this time</a>                </p>                <div class="cfw-fb-footer"></div>                <div class="cfw-fb-logo"></div>            </div>            <p class="cfw-facebook-links">                <a href="javascript://" class="cfw-never-again cfw-close-modal">Don\'t show this message again on this computer</a>            </p>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{"click .cfw-never-again":"neverAgain","click .cfw-set-url-hash":"setUrlHash"}),initialize:function(){return this.render()},render:function(){this.$el.html(this.template({fbShareUrl:this.model.url()+"/share"}));return this},setUrlHash:function(){this.model.setUrlHash()},neverAgain:function(){b.cookie("CFW",b.extend(b.cookie("CFW"),{no_facebook_share_dialog:!0}),{expires:365,path:"/"})}});CFW.ConfirmNewAthleteView=CFW.ModalPage.extend({tagName:"form",
template:_.template('            <fieldset>                <h2><label style="white-space:normal !important;">Email not recognized:</label></h2>                <p class="cfw-email-display"><%- email %></p>            </fieldset>            <fieldset class="cfw-last">                <a href="javascript://" class="cfw-btn cfw-btn-block cfw-btn-orange js-join" style="margin-bottom:5px !important;">This is my first time.</a>                <a href="javascript://" class="cfw-btn cfw-btn-block js-back">Let me fix my email.</a>            </fieldset>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{"click .js-join":"join","click .js-back":"back"}),initialize:function(){return this.render()},render:function(){this.$el.html(this.template({email:this.options.email||""}));return this},join:function(){this.trigger("done")},back:function(){this.trigger("fail")}});CFW.AthleteSignupView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <h2><label style="white-space:normal !important;">Welcome! Please create a password.</label></h2>            </fieldset>            <fieldset>                <h2><label>Email</label></h2>                <input type="email" value="<%- email %>" disabled="disabled" />            </fieldset>            <fieldset>                <h2><label for="cfw-name">Name</label></h2>                <input type="text" id="cfw-name" name="name" placeholder="Guest" value="<%- name %>" />            </fieldset>            <fieldset>                <h2><label for="cfw-new-password">New Password</label></h2>                <input type="password" id="cfw-new-password" name="password" value="" />                <h2><label for="cfw-new-password-confirmation">Re-enter Password</label></h2>                <input type="password" id="cfw-new-password-confirmation" name="password_confirmation" value="" />            </fieldset>            <fieldset class="cfw-last">                <div class="cfw-footer">                    <input type="submit" value="Sign Up" />                    <input type="reset" value="Cancel" class="js-cancel" />                </div>            </fieldset>        '),
events:b.extend({},CFW.ModalPage.prototype.events,{submit:"submit","click .js-cancel":"cancel"}),initialize:function(){return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template({email:this.options.email,name:this.options.name}));return this},submit:function(a){a.preventDefault();if(!this.isLoading()){var c={affiliate_id:CFW.wods.affiliateId,email:this.options.email,name:this.$('input[name="name"]').val(),password:this.$('input[name="password"]').val(),
password_confirmation:this.$('input[name="password_confirmation"]').val()},a=_.bind(function(){this.showLoading();this.$(".ajax-error-notice, .cfw-field-errors").remove()},this),d=_.bind(function(){this.hideLoading()},this),e=_.bind(function(){this.trigger("done")},this),f=_.bind(function(a){(a=b.parseJSON(a.responseText))&&a.errors&&this.showValidationErrors(a.errors);a='<a href="mailto:'+(CFW_OPTIONS.custom_branding_email||"athletesupport@cfwhiteboard.com")+'" target="_blank">athlete support</a>';
this.$(".cfw-footer").after(b('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! That didn\'t work. Please try again or contact '+a+" so we can help!</label>"))},this),c={url:this.options.action,complete:d,success:e,error:f,type:"POST",data:function(a){var b={},c;for(c in a)b["athlete["+c+"]"]=a[c];return b}(c),dataType:"json",cache:!1};a();CFW.ajax(c)}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},
hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){_.isArray(a)?_(a).each(function(a,d){this.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+b(this).attr("id")+'"]').addClass("cfw-invalid");0==d&&b(this).focus()}).one("keydown change",function(){b(this).removeClass("cfw-invalid");b('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid")})},this):_.isObject(a)&&_(a).each(function(a,
d){var e=_(a).inject(function(a,b,c){0<c&&(a+=", ");return a+b},"");this.$('input[name="'+d+'"]').addClass("cfw-invalid").each(function(){b('label[for="'+b(this).attr("id")+'"]').addClass("cfw-invalid").after('<p class="cfw-field-errors">'+e+"</p>")}).one("keydown change",function(){b(this).removeClass("cfw-invalid").closest(".cfw-contents").find('label[for="'+b(this).attr("id")+'"]').removeClass("cfw-invalid").siblings(".cfw-field-errors").addClass("cfw-muted")})},this)},cancel:function(){this.trigger("fail")}});
CFW.WhiteboardView=Backbone.View.extend({className:"cfw-pane",template:_.template('            <div>                <div class="cfw-window">                    <h2>Entries</h2>                    <a class="cfw-new-entry">+</a>                    <ul class="cfw-classes cfw-<%- allWods.length || 1 %>-classes cfw-components-<%= wod.components && wod.components.length || 1 %>">                        <%                        _.each(allWods, function(w) {                            %><li class="<%- w.wp_id == wod.wp_id ? "cfw-selected" : "" %>"><div>                                <a href="javascript://" data-wp_id="<%- w.wp_id %>" title="<%- w.name %>">                                    <span class="cfw-centered">                                        <span class="cfw-entry-count" data-wp_id="<%- w.wp_id %>"></span>                                        <span class="cfw-link-text"><%- w.name.replace(/workout of the day/ig, "WOD") %></span>                                    </span>                                    <span class="cfw-separator"></span>                                </a>                            </div></li><%                        });                        %>                    </ul>                    <div class="cfw-contents"></div>                    <div class="cfw-footer">                        <a href="<%- brandUrl %>" target="_blank" class="cfw-hook-what-is-this">                            What Is This?                        </a><a href="mailto:<%- supportEmail %>">                            Email Athlete Support                        </a>                    </div>                </div>            </div>            <a class="cfw-print cfw-admin-tool cfw-hidden" target="_blank">Print</a>        '),
events:{"click .cfw-new-entry:not([disabled])":"newEntry",hideEntryDetails:"hideEntry","cfwremove .cfw-modal":"cleanupModal",showEntryShare:"showEntryShare",showResetPassword:"showResetPassword","click .cfw-classes a":"returnToEntryList"},initialize:function(a){this.model=new CFW.Wod({affiliate_id:a.affiliateId,whiteboard_id:a.whiteboardId,wp_id:a.wpId,post_modified:a.postModified});CFW.wods.push(this.model);CFW.wods.on("reset",this.resetModel,this);this.render();this.disableEntriesUntilLoaded();
CFW.wods.on("reset",this.disableEntriesUntilLoaded,this);a.hidden&&this.hide();return this},resetModel:function(){var a=this;if(this.model=CFW.wods.find(function(b){return b.get("whiteboard_id")==a.options.whiteboardId&&b.get("wp_id")==a.options.wpId}))this.model.get("entries").on("add remove reset",this.newEntryCount,this),this.model.get("entries").on("edit",this.editEntry,this),this.model.get("entries").on("show",this.showEntry,this),this.model.get("entries").on("add change:known_as",this.updateUsers,
this),this.entryListView.resetModel(this.model)},render:function(){this.$el.html(this.template({wod:this.model.toJSON(),allWods:this.options.allWods,brandUrl:CFW_OPTIONS.custom_branding_url||"http://cfwhiteboard.com",supportEmail:CFW_OPTIONS.custom_branding_email||"athletesupport@cfwhiteboard.com"}));b.fn.cfwDropdown.initContainerEvents(this.$el);this.entryListView=new CFW.EntryListView({model:this.model});this.$(".cfw-contents").append(this.entryListView.el);this.entryListView.show();"admin"==this.options.authorization&&
this.$(".cfw-admin-tool").removeClass("cfw-hidden");return this},attach:function(){this.$children&&this.$el.append(this.$children)},detach:function(){this.$children=this.$el.children();this.$children.detach()},show:function(){this.$el.removeClass("cfw-hidden")},hide:function(){this.$el.addClass("cfw-hidden")},newEntry:function(){this.showEntryForm()},editEntry:function(a){this.showEmailAuth(a,_.bind(function(b){this.modalView.remove({silent:!0});a.set(b,{silent:!0});this.showEntryForm(a)},this))},
highlightEntry:function(a){var b=this,d=function(){(b.model.get("entries").get(a)||b.model.get("entries").find(function(b){return b.get("athlete_slug")==a})).trigger("highlight")};if(this.model.get("entries").length)d();else this.model.get("entries").on("reset",d)},showEmailAuth:function(a,b){this.disableNewEntries();this.modalView=new CFW.AthleteAuthView({model:a,success:b});this.$(".cfw-contents").append(this.modalView.el);var d=this;setTimeout(function(){d.detailView?d.detailView.hideScrollbar():
d.entryListView.hideScrollbar();d.modalView.show()},0)},showResetPassword:function(a,b){this.disableNewEntries();var d=new CFW.ResetPasswordView({email:b&&b.email,always:_.bind(function(){d.remove({silent:!0});this.modalView&&this.modalView.showScrollbar()},this)});this.$(".cfw-contents").append(d.el);setTimeout(_.bind(function(){this.modalView?this.modalView.hideScrollbar():this.detailView?this.detailView.hideScrollbar():this.entryListView.hideScrollbar();d.show()},this),0)},showEntryForm:function(a){this.modalView=
new CFW.EntryFormView({model:a,wod:this.model});this.$(".cfw-contents").append(this.modalView.el);var b=this;setTimeout(function(){a||(b.detailView?b.detailView.hideScrollbar():b.entryListView.hideScrollbar());b.disableNewEntries();b.modalView.show()},0)},showEntryShare:function(a,c){var d=b.cookie("CFW");if(d&&d.no_facebook_share_dialog)this.modalView.remove();else{var e=new CFW.EntryShareView({model:c,wod:this.options.wod,whiteboardId:this.options.whiteboardId,postPermalink:this.options.postPermalink});
this.$(".cfw-contents").append(e.el);this.modalView.remove({silent:!0},function(){e.show()});this.modalView=e}},cleanupModal:function(){this.enableNewEntries();this.detailView?this.detailView.showScrollbar():this.entryListView.showScrollbar();delete this.modalView},disableNewEntries:function(){this.$el.children().length?this.$el.find(".cfw-new-entry").attr("disabled",!0):this.$children.find(".cfw-new-entry").attr("disabled",!0)},enableNewEntries:function(){this.$el.children().length?this.$el.find(".cfw-new-entry").removeAttr("disabled"):
this.$children.find(".cfw-new-entry").removeAttr("disabled")},disableEntriesUntilLoaded:function(){CFW.wods.fetchAttempted&&!CFW.wods.fetchFailed?this.enableNewEntries():this.disableNewEntries()},showEntry:function(a){this.detailView=new CFW.EntryDetailView({model:a,wod:this.model});this.$(".cfw-contents").append(this.detailView.el);var b=this;setTimeout(function(){b.entryListView.hide();b.detailView.show()},0)},hideEntry:function(){this.detailView.hide();this.entryListView.show();var a=this;setTimeout(function(){delete a.detailView},
Modernizr.csstransitions?400:100)},newEntryCount:function(){this.$el.trigger("newEntryCount",[this.options.wpId,this.model.get("entries").length])},updateEntryCount:function(a,c){var d=this.$(".cfw-entry-count");0==d.length&&(d=this.$children.find(".cfw-entry-count"));(1<d.length||"embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1))&&d.each(function(){var d=b(this);d.data("wp_id")==a&&d.text(c).attr("title",""+c+" entries")})},updateUsers:function(a){var b=CFW.users.find(function(b){return b.get("email").toLowerCase()==
a.get("email").toLowerCase()});b?b.save({known_as:a.get("known_as"),count:b.get("count")+1}):b=CFW.users.create({email:a.get("email"),known_as:a.get("known_as"),count:1})},returnToEntryList:function(){this.modalView?this.modalView.remove():this.detailView&&this.hideEntry()}});CFW.WhiteboardButtonView=Backbone.View.extend({template:_.template('            <h1><%= buttonText %> <span class="cfw-entry-count-all cfw-hidden"></span></h1>        '),events:{"click h1":"toggleWhiteboard","click .cfw-classes a":"showClass",
"newEntryCount .cfw-pane":"updateEntryCounts","mouseenter h1":"hoverButton","mouseleave h1":"unhoverButton"},initialize:function(){var a=this.$el.data("cfwhiteboard");this.affiliateId=a.affiliateId;this.whiteboardId=a.whiteboardId;this.postId=a.postId;this.postPermalink=a.postPermalink;this.postModified=a.postModified;this.wods=a.wods;this.authorization=this.$el.data("authorization");if(-1<_(CFW.instances).chain().pluck("whiteboardId").indexOf(this.whiteboardId).value())this.duplicate=!0;else return this.render()},
render:function(){var a="embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1);if(a){this.$el.last().addClass("cfw-display-embed");1<this.$el.length&&this.$el.first().replaceWith(this.$el.last());var c=b("<div />").addClass("cfw-clearer");this.$el.last().parent().append(c)}this.$el.first().html(this.template({buttonText:CFW_OPTIONS.custom_branding_button_text||"Whiteboard"}));this.whiteboardViews={};var d=this;_.each(d.wods,function(a,b){var c=new CFW.WhiteboardView({affiliateId:d.affiliateId,
whiteboardId:d.whiteboardId,wpId:a.wp_id,postPermalink:d.postPermalink,postModified:d.postModified,allWods:d.wods,authorization:d.authorization,hidden:0==b?!1:!0});d.$el.last().append(c.el);d.whiteboardViews[a.wp_id]=c});a||setTimeout(function(){d.positionWhiteboard();_.each(d.whiteboardViews,function(a){a.detach()})},0);return this},hoverButton:function(){this.$el.first().find("h1").addClass("cfw-hovering");this.attachWhiteboard();this.positionWhiteboard()},unhoverButton:function(a){this.$el.first().find("h1").removeClass("cfw-hovering");
this.detachWhiteboard(a)},attachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")||(this.$el.first().addClass("cfw-attached"),_.each(this.whiteboardViews,function(a){a.attach()}))},detachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")&&!this.$el.first().hasClass("cfw-active")&&!this.$el.first().find("h1").hasClass("cfw-hovering")&&(this.$el.first().removeClass("cfw-attached"),_.each(this.whiteboardViews,function(a){a.detach()}))},toggleWhiteboard:function(a){this.$el.is(".cfw-active")?
this.closeWhiteboard():this.openWhiteboard();a.preventDefault()},openWhiteboard:function(){this.$el.addClass("cfw-active").removeClass("cfw-postactive");var a=this;setTimeout(function(){var b=a.$el.first().offset(),b=a.$el.first().outerWidth(!1)+b.left;a.$el.last().find(".cfw-pane:visible").outerWidth(!1)>=b&&(a.$el.last().addClass("position-inline"),CFW.important.css.apply(a.$el.last(),[{left:"0",margin:"0 10px 10px",right:"auto"},!0]))},0)},closeWhiteboard:function(){this.$el.addClass("cfw-postactive").removeClass("cfw-active");
var a=this;setTimeout(function(){a.$el.removeClass("cfw-postactive");a.detachWhiteboard()},Modernizr.csstransitions?300:0)},positionWhiteboard:function(){if("embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1))this.$el.last().addClass("cfw-active");else if(this.$el.last().parent().is("body")){var a=this.$el.first().offset(),c={position:"absolute",margin:"0",top:a.top+"px"};this.$el.last().is(".position-inline, .position-block, .position-floatleft")?c.left=a.left+"px":(a=this.$el.first().outerWidth(!1)+
a.left,c.right=b(document.body).width()-a,c.right+="px");CFW.important.css.apply(this.$el.last(),[c,!0])}},showClass:function(a){var c=a.target?b(a.target).closest("a").data("wp_id"):a;_.each(this.whiteboardViews,function(a,b){b==c?a.show():a.hide()})},updateEntryCounts:function(a,b,d){this.whiteboardViews[b.toString()].entryCount=d;_.each(this.whiteboardViews,function(a){a.updateEntryCount(b,d)});a=_.inject(this.whiteboardViews,function(a,b){return a+(b.entryCount||0)},0);this.$(".cfw-entry-count-all").text(a).attr("title",
""+a+" entries").removeClass("cfw-hidden")}});CFW.goToHash=function(a){var c=a.split("-");_.each(CFW.instances,function(d){if(!(d.whiteboardId!=c[1]&&d.postId!=c[1])){c[2]&&d.showClass(c[2]);var e=d.$el.offset().top-100;b(document.body).append(b('<span id="'+a.replace(/^#/,"")+'" style="position:absolute; top:'+e+'px; display:none;"></span>'));b("html, body").animate({scrollTop:e},800,function(){d.attachWhiteboard();d.positionWhiteboard();d.openWhiteboard();c[2]&&c[3]&&d.whiteboardViews[c[2]].highlightEntry(c[3])})}})};
CFW.instances=[];setTimeout(function(){CFW.wods=new CFW.WodList;b(".cfwhiteboard").each(function(){var a=b(this),c=a.closest("a");c.length&&c.before(a);if(!1!=CFW.oxygenTank(CFW_OPTIONS,"position",!1)){c=a.closest(CFW_OPTIONS.position.parent).find(CFW_OPTIONS.position.target);if(c.length)switch(CFW_OPTIONS.position.insertion){case "append":c.append(a);break;case "before":c.before(a);break;case "after":c.after(a);break;default:c.prepend(a)}switch(CFW_OPTIONS.position.alignment){case "inline":a.addClass("position-inline");
break;case "block":a.addClass("position-block");break;case "floatleft":a.addClass("position-floatleft")}CFW_OPTIONS.position.margin&&CFW.important.css.apply(a,[{margin:CFW_OPTIONS.position.margin},!0])}a=a.add(a.clone().appendTo(document.body));a=new CFW.WhiteboardButtonView({el:a});a.duplicate||CFW.instances.push(a)});CFW.fetchWods=function(){CFW.wods.fetchFailed=!1;CFW.wods.fetchAttempted=!0;return CFW.wods.fetch({reset:!0,data:CFW.wods.fetchData(),error:function(){CFW.wods.fetchFailed=!0;CFW.wods.trigger("reset")},
cache:!1})};CFW.instances.length&&CFW.fetchWods();"embed"!=CFW.oxygenTank(CFW_OPTIONS,"position","display",!1)&&(_.each(CFW.instances,function(a){a.$el.on("click",function(a){a.stopPropagation()})}),b(document.body).on("click",function(){_.each(CFW.instances,function(a){a.closeWhiteboard()})}));0==window.location.hash.indexOf("#cfwhiteboard")&&CFW.goToHash(window.location.hash)},0)};jQuery(CFW.init);
