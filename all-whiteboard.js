var JSON;JSON||(JSON={});
(function(){function c(a){return 10>a?"0"+a:a}function a(a){b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(a){var c=j[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function e(c,b){var i,o,j,u,r=g,s,n=b[c];n&&"object"===typeof n&&"function"===typeof n.toJSON&&(n=n.toJSON(c));"function"===typeof m&&(n=m.call(b,c,n));switch(typeof n){case "string":return a(n);case "number":return isFinite(n)?""+n:"null";case "boolean":case "null":return""+n;
case "object":if(!n)return"null";g+=l;s=[];if("[object Array]"===Object.prototype.toString.apply(n)){u=n.length;for(i=0;i<u;i+=1)s[i]=e(i,n)||"null";j=0===s.length?"[]":g?"[\n"+g+s.join(",\n"+g)+"\n"+r+"]":"["+s.join(",")+"]";g=r;return j}if(m&&"object"===typeof m){u=m.length;for(i=0;i<u;i+=1)"string"===typeof m[i]&&(o=m[i],(j=e(o,n))&&s.push(a(o)+(g?": ":":")+j))}else for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(j=e(o,n))&&s.push(a(o)+(g?": ":":")+j);j=0===s.length?"{}":g?"{\n"+g+s.join(",\n"+
g)+"\n"+r+"}":"{"+s.join(",")+"}";g=r;return j}}if("function"!==typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var i=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,l,j={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;if("function"!==typeof JSON.stringify)JSON.stringify=function(a,c,b){var i;l=g="";if("number"===typeof b)for(i=0;i<b;i+=1)l+=" ";else"string"===typeof b&&(l=b);if((m=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return e("",
{"":a})};if("function"!==typeof JSON.parse)JSON.parse=function(a,c){function g(a,b){var i,e,m=a[b];if(m&&"object"===typeof m)for(i in m)Object.prototype.hasOwnProperty.call(m,i)&&(e=g(m,i),void 0!==e?m[i]=e:delete m[i]);return c.call(a,b,m)}var b,a=""+a;i.lastIndex=0;i.test(a)&&(a=a.replace(i,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return b=eval("("+a+")"),"function"===typeof c?g({"":b},""):b;throw new SyntaxError("JSON.parse");}})();(function(c){function a(a,g,b){var i,b=b||"",e=b.match(RegExp("(?:^|\\s|;)("+a+")\\s*:\\s*([^;]*(?:;|$))","i"));e&&(e[0]=e[0].replace(/^;/,""));null===g?i="":"string"===typeof g&&(i=a+":"+g+" !important;");e?("boolean"===typeof g&&(i=c.important(a+":"+e[2],g)),b=b.replace(e[0],i)):"undefined"!==typeof i&&(b=c.trim(b),""!==b&&(";"!==b.slice(-1)&&(b+=";"),b+=" "),b+=i);return b}function e(a,c){var b=e.re;if(!b)b=e.re=/\s*(! ?important)?[\s\r\t\n]*;/g;return!1===c?a.replace(b,";"):a.replace(b,function(a,
c){return c?a:" !important;"})}function i(a,c){var b=i.re;if(!b)b=i.re=/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g;return a.replace(b,function(a,b){return e(b,c)})}var b=!1,g={},l={},j=c.each({css:function(b,i){var e={},l=c(this),j=l.attr("style");if("string"===typeof b){if("undefined"===typeof i)return g.css.apply(this,arguments);e[b]=i}else if("object"===typeof b)e=b;else return l;c.each(e,function(b,c){j=a(b,c,j)});return l.attr("style",j)}},function(a,i){g[a]=c.fn[a];i.overridden=!0;l[a]=function(){var e=
c.makeArray(arguments),l=e[e.length-1],j=c(this);return!0===l?i.apply(j,e.slice(0,-1)):b&&!1!==l?i.apply(j,e):g[a].apply(j,e)}});c.extend(c.fn,l);c.important=c.extend(function(){var a=c.makeArray(arguments),g;if("string"===typeof a[0]){if("undefined"===typeof a[1]||"boolean"===typeof a[1])return g=!1!==a[1],/<\w+.*>/.test(a[0])?i(a[0],g):e(a[0],g)}else if(c.isFunction(a[0]))g=b,c.important.status=b=!0,a[0].call(this),c.important.status=b=g;else if("undefined"===typeof a[0]||"boolean"===typeof a[0])c.important.status=
b=!1!==a[0];return b},{status:b,noConflict:function(){c.each(g,function(a,b){c.fn[a]=b});return j},declaration:a});c.fn.important=function(b){var g=c(this),i=c.makeArray(arguments).concat(!0),j=g.data("nodeName"),o;if("undefined"===typeof b||"boolean"===typeof b)j||(j=g.attr("nodeName").toLowerCase(),g.data("nodeName",j)),"style"===j?(o=!1!==b,g.html(e(g.html(),o)),i=g.attr("sheet"),_("stylesheet",i),i&&i.cssRules&&(_("cssRules",i.cssRules),c.each(i.cssRules,function(a,b){_("rule",b,b.cssText);_(c.important(b.style.cssText,
o));if(b.type===CSSRule.STYLE_RULE)b.style.cssText=c.important(b.style.cssText,o)}))):g.attr("style",c.important(g.attr("style"),b));else{if("object"===typeof b)return i.unshift("css"),g.important.apply(this,i);if("string"===typeof b)if(c.isFunction(l[b]))i=i.slice(1),l[b].apply(g,i);else{if("undefined"===typeof i[1]||"boolean"===typeof i[1])o=!1!==i[1],g.attr("style",a(b,o,g.attr("style")))}else c.isFunction(b)&&c.important.call(this,b)}return g}})(jQuery);(function(c){var a=function(a){var b=a.data("scrollbarPaper")||a.data("scrollbar-paper"),c=a.innerHeight(),e=c-a.height();return{height:c,ratio:c/(b.clearer.position().top-((b.content.children(":visible").eq(0).position()||{}).top||0)+e),offset:a.offset()}},e={_init:function(i){i=c.extend({parentSelector:"",css:c.css,show:function(a){a.show()},hide:function(a){a.hide()}},i);return this.each(function(){var b=c(this),g=b.data("scrollbarPaper")||b.data("scrollbar-paper");if(!g){i.css.apply(b,[{"overflow-x":"hidden",
"overflow-y":"auto"},!0]);g=b.closest(i.parentSelector);g.length||(g=b.offsetParent());var e=c('<div class="scrollbarpaper-container"></div>').appendTo(g);i.hide(e);var j=c('<div class="scrollbarpaper-track"></div>').appendTo(e),m=c('<div class="scrollbarpaper-drag"></div>').appendTo(j),g={options:i,offsetParent:g,paper:e,track:j,drag:m,dragTop:c('<div class="scrollbarpaper-drag-top"></div>').appendTo(m),dragBottom:c('<div class="scrollbarpaper-drag-bottom"></div>').appendTo(m),content:b,clearer:c('<div style="clear:both;"></div>').appendTo(b),
offsetHeight:j.outerHeight()-j.height()};b.data("scrollbarPaper",g).data("scrollbar-paper",g);var q=a(b),t=setInterval(function(){if(b.closest(i.parentSelector).length){if(b.is(":visible")){var c=a(b);if(c.height!=q.height||c.ratio!=q.ratio||c.offset.left!=q.offset.left||c.offset.top!=q.offset.top)b.scrollbarPaper("update"),q=c}}else clearInterval(t),e.remove(),b.removeData("scrollbarPaper").removeData("scrollbar-paper")},250)}b.scrollbarPaper("update")})},update:function(i){return this.each(function(){var b=
c(this);if(b.is(":visible")&&!b.data("scrollbarpaperfrozen")){var g=b.data("scrollbarPaper")||b.data("scrollbar-paper");i=i||a(b);b.unbind(".scrollbarPaper");var e=b.innerHeight()-g.offsetHeight;g.options.css.apply(g.track,[{height:e+"px"},!0]);var j=0<g.offsetParent.not("html, body").length?g.offsetParent.offset():{left:0,top:0};g.options.css.apply(g.paper,[{left:-j.left+i.offset.left+b.innerWidth()-g.paper.width()+"px",top:-j.top+i.offset.top+"px"},!0]);var m=Math.max(Math.round(e*i.ratio),g.dragTop.height()+
g.dragBottom.height());g.options.css.apply(g.drag,[{height:m+"px"},!0]);j=function(){g.options.css.apply(g.drag,[{top:Math.min(Math.round(b.scrollTop()*i.ratio),e-m)+"px"},!0])};j();b.bind("scroll.scrollbarPaper",j);var q=function(a){return a.pageY||(a.originalEvent&&(a.originalEvent.targetTouches||a.originalEvent.touches||[])[0]||a).pageY},t=function(){c("body").unbind("mousemove.scrollbarPaper touchmove.scrollbarPaper")};g.drag.bind("mousedown.scrollbarPaper touchstart.scrollbarPaper",function(a){t();
var e=q(a)-g.drag.offset().top;c("body").bind("mousemove.scrollbarPaper touchmove.scrollbarPaper",function(a){a.preventDefault();b.scrollTop((q(a)-b.offset().top-e)/i.ratio);return!1}).bind("mouseup.scrollbarPaper touchend.scrollbarPaper",t);return!1});1>i.ratio?(g.options.show(g.drag),g.content.addClass("scrollbarpaper-visible")):(g.options.hide(g.drag),g.content.removeClass("scrollbarpaper-visible"))}})},show:function(){return this.each(function(){var a=c(this),b=a.data("scrollbarPaper")||a.data("scrollbar-paper");
b&&(a.scrollbarPaper("update"),"function"==typeof b.options.show?b.options.show(b.paper):b.paper.show())})},hide:function(){return this.each(function(){var a=c(this);(a=a.data("scrollbarPaper")||a.data("scrollbar-paper"))&&("function"==typeof a.options.hide?a.options.hide(a.paper):a.paper.hide())})},freeze:function(){return this.each(function(){c(this).data("scrollbarpaperfrozen",!0)})},thaw:function(){return this.each(function(){c(this).data("scrollbarpaperfrozen",!1)})}};c.fn.scrollbarPaper=function(a){if(e[a])return e[a].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return e._init.apply(this,arguments);throw"Method "+a+" does not exist on jQuery.scrollbarPaper.";}})(jQuery);(function(){function c(k,a,h){if(k===a)return 0!==k||1/k==1/a;if(null==k||null==a)return k===a;k._chain&&(k=k._wrapped);a._chain&&(a=a._wrapped);if(k.isEqual&&f.isFunction(k.isEqual))return k.isEqual(a);if(a.isEqual&&f.isFunction(a.isEqual))return a.isEqual(k);var d=m.call(k);if(d!=m.call(a))return!1;switch(d){case "[object String]":return k==""+a;case "[object Number]":return k!=+k?a!=+a:0==k?1/k==1/a:k==+a;case "[object Date]":case "[object Boolean]":return+k==+a;case "[object RegExp]":return k.source==
a.source&&k.global==a.global&&k.multiline==a.multiline&&k.ignoreCase==a.ignoreCase}if("object"!=typeof k||"object"!=typeof a)return!1;for(var b=h.length;b--;)if(h[b]==k)return!0;h.push(k);var b=0,g=!0;if("[object Array]"==d){if(b=k.length,g=b==a.length)for(;b--&&(g=b in k==b in a&&c(k[b],a[b],h)););}else{if("constructor"in k!="constructor"in a||k.constructor!=a.constructor)return!1;for(var e in k)if(f.has(k,e)&&(b++,!(g=f.has(a,e)&&c(k[e],a[e],h))))break;if(g){for(e in a)if(f.has(a,e)&&!b--)break;
g=!b}}h.pop();return g}var a=this,e=a._,i={},b=Array.prototype,g=Object.prototype,l=b.slice,j=b.unshift,m=g.toString,q=g.hasOwnProperty,t=b.forEach,w=b.map,o=b.reduce,x=b.reduceRight,u=b.filter,r=b.every,s=b.some,n=b.indexOf,B=b.lastIndexOf,g=Array.isArray,E=Object.keys,z=Function.prototype.bind,f=function(a){return new y(a)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=f),exports._=f):a._=f;f.VERSION="1.3.3";var p=f.each=f.forEach=function(a,
h,d){if(null!=a)if(t&&a.forEach===t)a.forEach(h,d);else if(a.length===+a.length)for(var b=0,c=a.length;b<c&&!(b in a&&h.call(d,a[b],b,a)===i);b++);else for(b in a)if(f.has(a,b)&&h.call(d,a[b],b,a)===i)break};f.map=f.collect=function(a,h,b){var d=[];if(null==a)return d;if(w&&a.map===w)return a.map(h,b);p(a,function(a,k,c){d[d.length]=h.call(b,a,k,c)});if(a.length===+a.length)d.length=a.length;return d};f.reduce=f.foldl=f.inject=function(a,h,b,d){var c=2<arguments.length;null==a&&(a=[]);if(o&&a.reduce===
o)return d&&(h=f.bind(h,d)),c?a.reduce(h,b):a.reduce(h);p(a,function(a,k,g){c?b=h.call(d,b,a,k,g):(b=a,c=!0)});if(!c)throw new TypeError("Reduce of empty array with no initial value");return b};f.reduceRight=f.foldr=function(a,h,b,d){var c=2<arguments.length;null==a&&(a=[]);if(x&&a.reduceRight===x)return d&&(h=f.bind(h,d)),c?a.reduceRight(h,b):a.reduceRight(h);var g=f.toArray(a).reverse();d&&!c&&(h=f.bind(h,d));return c?f.reduce(g,h,b,d):f.reduce(g,h)};f.find=f.detect=function(a,h,b){var d;C(a,function(a,
k,c){if(h.call(b,a,k,c))return d=a,!0});return d};f.filter=f.select=function(a,h,d){var b=[];if(null==a)return b;if(u&&a.filter===u)return a.filter(h,d);p(a,function(a,k,c){h.call(d,a,k,c)&&(b[b.length]=a)});return b};f.reject=function(a,h,b){var d=[];if(null==a)return d;p(a,function(a,k,c){h.call(b,a,k,c)||(d[d.length]=a)});return d};f.every=f.all=function(a,h,d){var b=!0;if(null==a)return b;if(r&&a.every===r)return a.every(h,d);p(a,function(a,k,c){if(!(b=b&&h.call(d,a,k,c)))return i});return!!b};
var C=f.some=f.any=function(a,h,b){h||(h=f.identity);var d=!1;if(null==a)return d;if(s&&a.some===s)return a.some(h,b);p(a,function(a,k,c){if(d||(d=h.call(b,a,k,c)))return i});return!!d};f.include=f.contains=function(a,h){var d;return null==a?!1:n&&a.indexOf===n?-1!=a.indexOf(h):d=C(a,function(a){return a===h})};f.invoke=function(a,h){var d=l.call(arguments,2);return f.map(a,function(a){return(f.isFunction(h)?h||a:a[h]).apply(a,d)})};f.pluck=function(a,h){return f.map(a,function(a){return a[h]})};
f.max=function(a,h,d){if(!h&&f.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!h&&f.isEmpty(a))return-Infinity;var b={computed:-Infinity};p(a,function(a,k,c){k=h?h.call(d,a,k,c):a;k>=b.computed&&(b={value:a,computed:k})});return b.value};f.min=function(a,h,d){if(!h&&f.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!h&&f.isEmpty(a))return Infinity;var b={computed:Infinity};p(a,function(a,k,c){k=h?h.call(d,a,k,c):a;k<b.computed&&(b={value:a,computed:k})});return b.value};f.shuffle=
function(a){var h=[],d;p(a,function(a,k){d=Math.floor(Math.random()*(k+1));h[k]=h[d];h[d]=a});return h};f.sortBy=function(a,h,d){var b=f.isFunction(h)?h:function(a){return a[h]};return f.pluck(f.map(a,function(a,h,k){return{value:a,criteria:b.call(d,a,h,k)}}).sort(function(a,h){var k=a.criteria,d=h.criteria;return void 0===k?1:void 0===d?-1:k<d?-1:k>d?1:0}),"value")};f.groupBy=function(a,h){var d={},b=f.isFunction(h)?h:function(a){return a[h]};p(a,function(a,h){var k=b(a,h);(d[k]||(d[k]=[])).push(a)});
return d};f.sortedIndex=function(a,h,d){d||(d=f.identity);for(var b=0,c=a.length;b<c;){var g=b+c>>1;d(a[g])<d(h)?b=g+1:c=g}return b};f.toArray=function(a){return!a?[]:f.isArray(a)||f.isArguments(a)?l.call(a):a.toArray&&f.isFunction(a.toArray)?a.toArray():f.values(a)};f.size=function(a){return f.isArray(a)?a.length:f.keys(a).length};f.first=f.head=f.take=function(a,h,d){return null!=h&&!d?l.call(a,0,h):a[0]};f.initial=function(a,h,d){return l.call(a,0,a.length-(null==h||d?1:h))};f.last=function(a,
h,d){return null!=h&&!d?l.call(a,Math.max(a.length-h,0)):a[a.length-1]};f.rest=f.tail=function(a,h,d){return l.call(a,null==h||d?1:h)};f.compact=function(a){return f.filter(a,function(a){return!!a})};f.flatten=function(a,h){return f.reduce(a,function(a,d){if(f.isArray(d))return a.concat(h?d:f.flatten(d));a[a.length]=d;return a},[])};f.without=function(a){return f.difference(a,l.call(arguments,1))};f.uniq=f.unique=function(a,h,d){var d=d?f.map(a,d):a,b=[];3>a.length&&(h=!0);f.reduce(d,function(d,c,
g){if(h?f.last(d)!==c||!d.length:!f.include(d,c))d.push(c),b.push(a[g]);return d},[]);return b};f.union=function(){return f.uniq(f.flatten(arguments,!0))};f.intersection=f.intersect=function(a){var h=l.call(arguments,1);return f.filter(f.uniq(a),function(a){return f.every(h,function(h){return 0<=f.indexOf(h,a)})})};f.difference=function(a){var h=f.flatten(l.call(arguments,1),!0);return f.filter(a,function(a){return!f.include(h,a)})};f.zip=function(){for(var a=l.call(arguments),h=f.max(f.pluck(a,"length")),
d=Array(h),b=0;b<h;b++)d[b]=f.pluck(a,""+b);return d};f.indexOf=function(a,h,d){if(null==a)return-1;var b;if(d)return d=f.sortedIndex(a,h),a[d]===h?d:-1;if(n&&a.indexOf===n)return a.indexOf(h);d=0;for(b=a.length;d<b;d++)if(d in a&&a[d]===h)return d;return-1};f.lastIndexOf=function(a,h){if(null==a)return-1;if(B&&a.lastIndexOf===B)return a.lastIndexOf(h);for(var d=a.length;d--;)if(d in a&&a[d]===h)return d;return-1};f.range=function(a,h,d){1>=arguments.length&&(h=a||0,a=0);for(var d=arguments[2]||1,
b=Math.max(Math.ceil((h-a)/d),0),c=0,g=Array(b);c<b;)g[c++]=a,a+=d;return g};var v=function(){};f.bind=function(a,h){var d,b;if(a.bind===z&&z)return z.apply(a,l.call(arguments,1));if(!f.isFunction(a))throw new TypeError;b=l.call(arguments,2);return d=function(){if(!(this instanceof d))return a.apply(h,b.concat(l.call(arguments)));v.prototype=a.prototype;var c=new v,g=a.apply(c,b.concat(l.call(arguments)));return Object(g)===g?g:c}};f.bindAll=function(a){var h=l.call(arguments,1);0==h.length&&(h=f.functions(a));
p(h,function(h){a[h]=f.bind(a[h],a)});return a};f.memoize=function(a,h){var d={};h||(h=f.identity);return function(){var b=h.apply(this,arguments);return f.has(d,b)?d[b]:d[b]=a.apply(this,arguments)}};f.delay=function(a,h){var d=l.call(arguments,2);return setTimeout(function(){return a.apply(null,d)},h)};f.defer=function(a){return f.delay.apply(f,[a,1].concat(l.call(arguments,1)))};f.throttle=function(a,h){var d,b,c,g,e,A,i=f.debounce(function(){e=g=!1},h);return function(){d=this;b=arguments;c||
(c=setTimeout(function(){c=null;e&&a.apply(d,b);i()},h));g?e=!0:A=a.apply(d,b);i();g=!0;return A}};f.debounce=function(a,h,d){var b;return function(){var c=this,g=arguments;d&&!b&&a.apply(c,g);clearTimeout(b);b=setTimeout(function(){b=null;d||a.apply(c,g)},h)}};f.once=function(a){var h=!1,d;return function(){if(h)return d;h=!0;return d=a.apply(this,arguments)}};f.wrap=function(a,h){return function(){var d=[a].concat(l.call(arguments,0));return h.apply(this,d)}};f.compose=function(){var a=arguments;
return function(){for(var h=arguments,d=a.length-1;0<=d;d--)h=[a[d].apply(this,h)];return h[0]}};f.after=function(a,h){return 0>=a?h():function(){if(1>--a)return h.apply(this,arguments)}};f.keys=E||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var h=[],d;for(d in a)f.has(a,d)&&(h[h.length]=d);return h};f.values=function(a){return f.map(a,f.identity)};f.functions=f.methods=function(a){var h=[],d;for(d in a)f.isFunction(a[d])&&h.push(d);return h.sort()};f.extend=function(a){p(l.call(arguments,
1),function(h){for(var d in h)a[d]=h[d]});return a};f.pick=function(a){var h={};p(f.flatten(l.call(arguments,1)),function(d){d in a&&(h[d]=a[d])});return h};f.defaults=function(a){p(l.call(arguments,1),function(h){for(var d in h)null==a[d]&&(a[d]=h[d])});return a};f.clone=function(a){return!f.isObject(a)?a:f.isArray(a)?a.slice():f.extend({},a)};f.tap=function(a,h){h(a);return a};f.isEqual=function(a,h){return c(a,h,[])};f.isEmpty=function(a){if(null==a)return!0;if(f.isArray(a)||f.isString(a))return 0===
a.length;for(var h in a)if(f.has(a,h))return!1;return!0};f.isElement=function(a){return!!(a&&1==a.nodeType)};f.isArray=g||function(a){return"[object Array]"==m.call(a)};f.isObject=function(a){return a===Object(a)};f.isArguments=function(a){return"[object Arguments]"==m.call(a)};f.isArguments(arguments)||(f.isArguments=function(a){return!(!a||!f.has(a,"callee"))});f.isFunction=function(a){return"[object Function]"==m.call(a)};f.isString=function(a){return"[object String]"==m.call(a)};f.isNumber=function(a){return"[object Number]"==
m.call(a)};f.isFinite=function(a){return f.isNumber(a)&&isFinite(a)};f.isNaN=function(a){return a!==a};f.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==m.call(a)};f.isDate=function(a){return"[object Date]"==m.call(a)};f.isRegExp=function(a){return"[object RegExp]"==m.call(a)};f.isNull=function(a){return null===a};f.isUndefined=function(a){return void 0===a};f.has=function(a,h){return q.call(a,h)};f.noConflict=function(){a._=e;return this};f.identity=function(a){return a};f.times=
function(a,h,d){for(var b=0;b<a;b++)h.call(d,b)};f.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};f.result=function(a,h){if(null==a)return null;var d=a[h];return f.isFunction(d)?d.call(a):d};f.mixin=function(a){p(f.functions(a),function(h){H(h,f[h]=a[h])})};var D=0;f.uniqueId=function(a){var h=D++;return a?a+h:h};f.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,
escape:/<%-([\s\S]+?)%>/g};var h=/.^/,d={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},A;for(A in d)d[d[A]]=A;var I=/\\|'|\r|\n|\t|\u2028|\u2029/g,J=/\\(\\|'|r|n|t|u2028|u2029)/g,F=function(a){return a.replace(J,function(a,h){return d[h]})};f.template=function(a,b,c){c=f.defaults(c||{},f.templateSettings);a="__p+='"+a.replace(I,function(a){return"\\"+d[a]}).replace(c.escape||h,function(a,h){return"'+\n_.escape("+F(h)+")+\n'"}).replace(c.interpolate||h,function(a,h){return"'+\n("+
F(h)+")+\n'"}).replace(c.evaluate||h,function(a,h){return"';\n"+F(h)+"\n;__p+='"})+"';\n";c.variable||(a="with(obj||{}){\n"+a+"}\n");var a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n",g=new Function(c.variable||"obj","_",a);if(b)return g(b,f);b=function(a){return g.call(this,a,f)};b.source="function("+(c.variable||"obj")+"){\n"+a+"}";return b};f.chain=function(a){return f(a).chain()};var y=function(a){this._wrapped=a};f.prototype=y.prototype;
var G=function(a,h){return h?f(a).chain():a},H=function(a,h){y.prototype[a]=function(){var a=l.call(arguments);j.call(a,this._wrapped);return G(h.apply(f,a),this._chain)}};f.mixin(f);p("pop,push,reverse,shift,sort,splice,unshift".split(","),function(a){var h=b[a];y.prototype[a]=function(){var d=this._wrapped;h.apply(d,arguments);var b=d.length;("shift"==a||"splice"==a)&&0===b&&delete d[0];return G(d,this._chain)}});p(["concat","join","slice"],function(a){var h=b[a];y.prototype[a]=function(){return G(h.apply(this._wrapped,
arguments),this._chain)}});y.prototype.chain=function(){this._chain=!0;return this};y.prototype.value=function(){return this._wrapped}}).call(this);(function(){var c=this,a=c.Backbone,e=Array.prototype.slice,i=Array.prototype.splice,b;b="undefined"!==typeof exports?exports:c.Backbone={};b.VERSION="0.9.2";var g=c._;!g&&"undefined"!==typeof require&&(g=require("underscore"));var l=c.jQuery||c.Zepto||c.ender;b.setDomLibrary=function(a){l=a};b.noConflict=function(){c.Backbone=a;return this};b.emulateHTTP=!1;b.emulateJSON=!1;var j=/\s+/,m=b.Events={on:function(a,d,b){var c,g,e,f,i;if(!d)return this;a=a.split(j);for(c=this._callbacks||(this._callbacks=
{});g=a.shift();)e=(i=c[g])?i.tail:{},e.next=f={},e.context=b,e.callback=d,c[g]={tail:f,next:i?i.next:e};return this},off:function(a,d,b){var c,e,f,i,l,m;if(e=this._callbacks){if(!a&&!d&&!b)return delete this._callbacks,this;for(a=a?a.split(j):g.keys(e);c=a.shift();)if(f=e[c],delete e[c],f&&(d||b))for(i=f.tail;(f=f.next)!==i;)if(l=f.callback,m=f.context,d&&l!==d||b&&m!==b)this.on(c,l,m);return this}},trigger:function(a){var d,b,c,g,f,i;if(!(c=this._callbacks))return this;f=c.all;a=a.split(j);for(i=
e.call(arguments,1);d=a.shift();){if(b=c[d])for(g=b.tail;(b=b.next)!==g;)b.callback.apply(b.context||this,i);if(b=f){g=b.tail;for(d=[d].concat(i);(b=b.next)!==g;)b.callback.apply(b.context||this,d)}}return this}};m.bind=m.on;m.unbind=m.off;var q=b.Model=function(a,d){var b;a||(a={});d&&d.parse&&(a=this.parse(a));if(b=v(this,"defaults"))a=g.extend({},b,a);d&&d.collection&&(this.collection=d.collection);this.attributes={};this._escapedAttributes={};this.cid=g.uniqueId("c");this.changed={};this._silent=
{};this._pending={};this.set(a,{silent:!0});this.changed={};this._silent={};this._pending={};this._previousAttributes=g.clone(this.attributes);this.initialize.apply(this,arguments)};g.extend(q.prototype,m,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return g.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var d;if(d=this._escapedAttributes[a])return d;d=this.get(a);return this._escapedAttributes[a]=g.escape(null==
d?"":""+d)},has:function(a){return null!=this.get(a)},set:function(a,d,b){var c,e;g.isObject(a)||null==a?(c=a,b=d):(c={},c[a]=d);b||(b={});if(!c)return this;c instanceof q&&(c=c.attributes);if(b.unset)for(e in c)c[e]=void 0;if(!this._validate(c,b))return!1;this.idAttribute in c&&(this.id=c[this.idAttribute]);var d=b.changes={},f=this.attributes,i=this._escapedAttributes,l=this._previousAttributes||{};for(e in c){a=c[e];if(!g.isEqual(f[e],a)||b.unset&&g.has(f,e))delete i[e],(b.silent?this._silent:
d)[e]=!0;b.unset?delete f[e]:f[e]=a;!g.isEqual(l[e],a)||g.has(f,e)!=g.has(l,e)?(this.changed[e]=a,b.silent||(this._pending[e]=!0)):(delete this.changed[e],delete this._pending[e])}b.silent||this.change(b);return this},unset:function(a,d){(d||(d={})).unset=!0;return this.set(a,null,d)},clear:function(a){(a||(a={})).unset=!0;return this.set(g.clone(this.attributes),a)},fetch:function(a){var a=a?g.clone(a):{},d=this,c=a.success;a.success=function(b,g,e){if(!d.set(d.parse(b,e),a))return!1;c&&c(d,b)};
a.error=b.wrapError(a.error,d,a);return(this.sync||b.sync).call(this,"read",this,a)},save:function(a,d,c){var e,f;g.isObject(a)||null==a?(e=a,c=d):(e={},e[a]=d);c=c?g.clone(c):{};if(c.wait){if(!this._validate(e,c))return!1;f=g.clone(this.attributes)}a=g.extend({},c,{silent:!0});if(e&&!this.set(e,c.wait?a:c))return!1;var i=this,l=c.success;c.success=function(a,h,d){h=i.parse(a,d);c.wait&&(delete c.wait,h=g.extend(e||{},h));if(!i.set(h,c))return!1;l?l(i,a):i.trigger("sync",i,a,c)};c.error=b.wrapError(c.error,
i,c);d=this.isNew()?"create":"update";d=(this.sync||b.sync).call(this,d,this,c);c.wait&&this.set(f,a);return d},destroy:function(a){var a=a?g.clone(a):{},d=this,c=a.success,e=function(){d.trigger("destroy",d,d.collection,a)};if(this.isNew())return e(),!1;a.success=function(b){a.wait&&e();c?c(d,b):d.trigger("sync",d,b,a)};a.error=b.wrapError(a.error,d,a);var f=(this.sync||b.sync).call(this,"delete",this,a);a.wait||e();return f},url:function(){var a=v(this,"urlRoot")||v(this.collection,"url")||D();
return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(a){a||(a={});var d=this._changing;this._changing=!0;for(var b in this._silent)this._pending[b]=!0;var c=g.extend({},a.changes,this._silent);this._silent={};for(b in c)this.trigger("change:"+b,this,this.get(b),a);if(d)return this;for(;!g.isEmpty(this._pending);){this._pending=
{};this.trigger("change",this,a);for(b in this.changed)!this._pending[b]&&!this._silent[b]&&delete this.changed[b];this._previousAttributes=g.clone(this.attributes)}this._changing=!1;return this},hasChanged:function(a){return!arguments.length?!g.isEmpty(this.changed):g.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?g.clone(this.changed):!1;var d,b=!1,c=this._previousAttributes,e;for(e in a)if(!g.isEqual(c[e],d=a[e]))(b||(b={}))[e]=d;return b},previous:function(a){return!arguments.length||
!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return g.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,d){if(d.silent||!this.validate)return!0;var a=g.extend({},this.attributes,a),b=this.validate(a,d);if(!b)return!0;d&&d.error?d.error(this,b,d):this.trigger("error",this,b,d);return!1}});var t=b.Collection=function(a,d){d||(d={});d.model&&(this.model=d.model);d.comparator&&(this.comparator=d.comparator);
this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,{silent:!0,parse:d.parse})};g.extend(t.prototype,m,{model:q,initialize:function(){},toJSON:function(a){return this.map(function(d){return d.toJSON(a)})},add:function(a,d){var b,c,e,f,l,j={},m={},k=[];d||(d={});a=g.isArray(a)?a.slice():[a];b=0;for(c=a.length;b<c;b++){if(!(e=a[b]=this._prepareModel(a[b],d)))throw Error("Can't add an invalid model to a collection");f=e.cid;l=e.id;j[f]||this._byCid[f]||null!=l&&(m[l]||this._byId[l])?
k.push(b):j[f]=m[l]=e}for(b=k.length;b--;)a.splice(k[b],1);b=0;for(c=a.length;b<c;b++)(e=a[b]).on("all",this._onModelEvent,this),this._byCid[e.cid]=e,null!=e.id&&(this._byId[e.id]=e);this.length+=c;i.apply(this.models,[null!=d.at?d.at:this.models.length,0].concat(a));this.comparator&&this.sort({silent:!0});if(d.silent)return this;b=0;for(c=this.models.length;b<c;b++)if(j[(e=this.models[b]).cid])d.index=b,e.trigger("add",e,this,d);return this},remove:function(a,b){var c,e,f,i;b||(b={});a=g.isArray(a)?
a.slice():[a];c=0;for(e=a.length;c<e;c++)if(i=this.getByCid(a[c])||this.get(a[c]))delete this._byId[i.id],delete this._byCid[i.cid],f=this.indexOf(i),this.models.splice(f,1),this.length--,b.silent||(b.index=f,i.trigger("remove",i,this,b)),this._removeReference(i);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,b);return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,g.extend({at:0},b));return a},
shift:function(a){var b=this.at(0);this.remove(b,a);return b},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return g.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var b=g.bind(this.comparator,this);1==this.comparator.length?
this.models=this.sortBy(b):this.models.sort(b);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return g.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});for(var c=0,e=this.models.length;c<e;c++)this._removeReference(this.models[c]);this._reset();this.add(a,g.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a=a?g.clone(a):{};void 0===a.parse&&(a.parse=!0);var d=this,c=a.success;a.success=function(b,
e,g){d[a.add?"add":"reset"](d.parse(b,g),a);c&&c(d,b)};a.error=b.wrapError(a.error,d,a);return(this.sync||b.sync).call(this,"read",this,a)},create:function(a,b){var c=this,b=b?g.clone(b):{},a=this._prepareModel(a,b);if(!a)return!1;b.wait||c.add(a,b);var e=b.success;b.success=function(g,f){b.wait&&c.add(g,b);e?e(g,f):g.trigger("sync",a,f,b)};a.save(null,b);return a},parse:function(a){return a},chain:function(){return g(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId=
{};this._byCid={}},_prepareModel:function(a,b){b||(b={});a instanceof q?a.collection||(a.collection=this):(b.collection=this,a=new this.model(a,b),a._validate(a.attributes,b)||(a=!1));return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,e){("add"==a||"remove"==a)&&c!=this||("destroy"==a&&this.remove(b,e),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,
arguments))}});g.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(a){t.prototype[a]=function(){return g[a].apply(g,[this.models].concat(g.toArray(arguments)))}});var w=b.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},o=/:\w+/g,
x=/\*\w+/g,u=/[-[\]{}()+?.,\\^$|#\s]/g;g.extend(w.prototype,m,{initialize:function(){},route:function(a,c,e){b.history||(b.history=new r);g.isRegExp(a)||(a=this._routeToRegExp(a));e||(e=this[c]);b.history.route(a,g.bind(function(g){g=this._extractParameters(a,g);e&&e.apply(this,g);this.trigger.apply(this,["route:"+c].concat(g));b.history.trigger("route",this,c,g)},this));return this},navigate:function(a,c){b.history.navigate(a,c)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,
this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(u,"\\$&").replace(o,"([^/]+)").replace(x,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var r=b.History=function(){this.handlers=[];g.bindAll(this,"checkUrl")},s=/^[#\/]/,n=/msie [\w.]+/;r.started=!1;g.extend(r.prototype,m,{interval:50,getHash:function(a){return(a=(a?a.location:window.location).href.match(/#(.*)$/))?a[1]:
""},getFragment:function(a,b){if(null==a)if(this._hasPushState||b){var a=window.location.pathname,c=window.location.search;c&&(a+=c)}else a=this.getHash();a.indexOf(this.options.root)||(a=a.substr(this.options.root.length));return a.replace(s,"")},start:function(a){if(r.started)throw Error("Backbone.history has already been started");r.started=!0;this.options=g.extend({},{root:"/"},this.options,a);this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=
!(!this.options.pushState||!window.history||!window.history.pushState);var a=this.getFragment(),b=document.documentMode;if(b=n.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b))this.iframe=l('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?l(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!b?l(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,
this.interval));this.fragment=a;a=window.location;b=a.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&b&&a.hash&&(this.fragment=this.getHash().replace(s,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},
stop:function(){l(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);r.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a==this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return g.any(this.handlers,
function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!r.started)return!1;if(!b||!0===b)b={trigger:b};var c=(a||"").replace(s,"");this.fragment!=c&&(this._hasPushState?(0!=c.indexOf(this.options.root)&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||
this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a))},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});var B=b.View=function(a){this.cid=g.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},E=/^(\S+)\s*(.*)$/,z="model,collection,el,id,attributes,className,tagName".split(",");
g.extend(B.prototype,m,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(a,b,c){a=document.createElement(a);b&&l(a).attr(b);c&&l(a).html(c);return a},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof l?a:l(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=v(this,"events"))){this.undelegateEvents();
for(var b in a){var c=a[b];g.isFunction(c)||(c=this[a[b]]);if(!c)throw Error('Method "'+a[b]+'" does not exist');var e=b.match(E),f=e[1],e=e[2],c=g.bind(c,this),f=f+(".delegateEvents"+this.cid);""===e?this.$el.bind(f,c):this.$el.delegate(e,f,c)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=g.extend({},this.options,a));for(var b=0,c=z.length;b<c;b++){var e=z[b];a[e]&&(this[e]=a[e])}this.options=a},_ensureElement:function(){if(this.el)this.setElement(this.el,
!1);else{var a=v(this,"attributes")||{};this.id&&(a.id=this.id);this.className&&(a["class"]=this.className);this.setElement(this.make(this.tagName,a),!1)}}});q.extend=t.extend=w.extend=B.extend=function(a,b){var c=C(this,a,b);c.extend=this.extend;return c};var f={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};b.sync=function(a,c,e){var i=f[a];e||(e={});var j={type:i,dataType:"json"};e.url||(j.url=v(c,"url")||D());if(!e.data&&c&&("create"==a||"update"==a))j.contentType="application/json",
j.data=JSON.stringify(c.toJSON());b.emulateJSON&&(j.contentType="application/x-www-form-urlencoded",j.data=j.data?{model:j.data}:{});if(b.emulateHTTP&&("PUT"===i||"DELETE"===i))b.emulateJSON&&(j.data._method=i),j.type="POST",j.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",i)};"GET"!==j.type&&!b.emulateJSON&&(j.processData=!1);return l.ajax(g.extend(j,e))};b.wrapError=function(a,b,c){return function(e,g){g=e===b?g:e;a?a(b,g,c):b.trigger("error",b,g,c)}};var p=function(){},C=function(a,
b,c){var e;e=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)};g.extend(e,a);p.prototype=a.prototype;e.prototype=new p;b&&g.extend(e.prototype,b);c&&g.extend(e,c);e.prototype.constructor=e;e.__super__=a.prototype;return e},v=function(a,b){return!a||!a[b]?null:g.isFunction(a[b])?a[b]():a[b]},D=function(){throw Error('A "url" property or function must be specified');}}).call(this);function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}window.Store=function(c){this.name=c;this.records=(c=localStorage.getItem(this.name))&&c.split(",")||[]};
_.extend(Store.prototype,{save:function(){localStorage.setItem(this.name,this.records.join(","))},create:function(c){if(!c.id)c.id=c.attributes.id=guid();localStorage.setItem(this.name+"-"+c.id,JSON.stringify(c));this.records.push(c.id.toString());this.save();return c},update:function(c){localStorage.setItem(this.name+"-"+c.id,JSON.stringify(c));_.include(this.records,c.id.toString())||this.records.push(c.id.toString());this.save();return c},find:function(c){return JSON.parse(localStorage.getItem(this.name+
"-"+c.id))},findAll:function(){return _.map(this.records,function(c){return JSON.parse(localStorage.getItem(this.name+"-"+c))},this)},destroy:function(c){localStorage.removeItem(this.name+"-"+c.id);this.records=_.reject(this.records,function(a){return a==c.id.toString()});this.save();return c}});Backbone.remoteSync=Backbone.sync;
Backbone.sync=function(c,a,e,i){"function"==typeof e&&(e={success:e,error:i});var b,g=a.localStorage||a.collection&&a.collection.localStorage;if(!g)return Backbone.remoteSync(c,a,e,i);switch(c){case "read":b=a.id?g.find(a):g.findAll();break;case "create":b=g.create(a);break;case "update":b=g.update(a);break;case "delete":b=g.destroy(a)}b?e.success(b):e.error("Record not found")};window.Modernizr=function(c,a,e){function i(a,c){var e=a.charAt(0).toUpperCase()+a.substr(1),e=(a+" "+q.join(e+" ")+e).split(" ");return b(e,c)}function b(a,b){for(var c in a)if(m[a[c]]!==e)return"pfx"==b?a[c]:!0;return!1}var g={},l=a.documentElement;a.head||a.getElementsByTagName("head");var j=a.createElement("modernizr"),m=j.style,c=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),q="Webkit Moz O ms Khtml".split(" "),j={},t=[],w=function(b,c,e,g){var i,f,j=a.createElement("div");if(parseInt(e,10))for(;e--;)f=
a.createElement("div"),f.id=g?g[e]:"modernizr"+(e+1),j.appendChild(f);i=["&shy;<style>",b,"</style>"].join("");j.id="modernizr";j.innerHTML+=i;l.appendChild(j);b=c(j,b);j.parentNode.removeChild(j);return!!b},o,x={}.hasOwnProperty,u;typeof x!==e&&typeof x.call!==e?u=function(a,b){return x.call(a,b)}:u=function(a,b){return b in a&&typeof a.constructor.prototype[b]===e};(function(a,b){var c=a.join(""),e=b.length;w(c,function(a){for(var a=a.childNodes,b={};e--;)b[a[e].id]=a[e];g.csstransforms3d=9===b.csstransforms3d.offsetLeft},
e,b)})([,["@media (",c.join("transform-3d),("),"modernizr){#csstransforms3d{left:9px;position:absolute}}"].join("")],[,"csstransforms3d"]);j.csstransforms=function(){return!!b(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])};j.csstransforms3d=function(){var a=!!b(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);a&&"webkitPerspective"in l.style&&(a=g.csstransforms3d);return a};j.csstransitions=function(){return i("transitionProperty")};
for(var r in j)u(j,r)&&(o=r.toLowerCase(),g[o]=j[r](),t.push((g[o]?"":"no-")+o));m.cssText="";j=null;g._version="2.0.6";g._prefixes=c;g._domPrefixes=q;g.testProp=function(a){return b([a])};g.testAllProps=i;g.testStyles=w;return g}(this,this.document);"undefined"==typeof CFW&&(CFW={});"undefined"==typeof CFW_OPTIONS&&(CFW_OPTIONS={});CFW.domain=/[.]local/.test(window.location.host)||/rinkl/.test(window.location.host)||/squatc/.test(window.location.host)?"http://tameron.herokuapp.com":"http://cfwhiteboard.com";CFW.important=jQuery.important.noConflict();CFW.oxygenTank=function(){var c=Array.prototype.slice.call(arguments),a=c.pop(),c=_.reduceRight(c,function(a,c){return"undefined"!=typeof a?a[c]:a},c.shift());return"undefined"!=typeof c?c:a};
CFW.ajaxOptions=!jQuery.browser.msie||!window.XDomainRequest?{}:{xhr:function(){try{var c=new XDomainRequest;c.timeout=5E3;var a;c.getAllResponseHeaders=function(){return""};var e=function(b,e){c.onload=c.onerror=c.ontimeout=jQuery.noop;c.status=b;c.statusText=e;c.readyState=4;if(a)c.responseText=a.responseText;c.onreadystatechange&&c.onreadystatechange()},i=function(){a=new XDomainRequest;a.timeout=c.timeout;a.onload=c.onload;a.onerror=c.onerror;a.ontimeout=c.ontimeout;a.open(c.openArgs[0],c.openArgs[1]);
a.send(c.sendArgs[0])};c.onload=function(){e(200,"OK")};c.onerror=function(){a?e(400,"Error"):i()};c.ontimeout=function(){a?e(0,"timeout"):i()};c.originalOpen=c.open;c.open=function(a,b){"PUT"===a?(b+="/revise",a="POST"):"DELETE"===a&&(b+="/annihilate",a="POST");c.openArgs=[a,b];c.originalOpen(a,b)};c.originalSend=c.send;c.send=function(a){var b=function(a){for(var c in a)a[c]="object"==typeof a[c]?b(a[c]):encodeURIComponent(a[c]);return a},a=JSON.stringify(b(JSON.parse(a)));c.sendArgs=[a];setTimeout(function(){c.originalSend(a)},
0)};return c}catch(b){return jQuery.ajaxSettings.xhr()}}};
jQuery(function(c){c(document.embeds).each(function(){var a=c(this);setTimeout(function(){var e=!1,i=a.attr("wmode");"opaque"!=i&&"transparent"!=i&&(a.attr("wmode","opaque"),e=!0);var b=a.closest("object"),i=b.children("param[name=wmode]").val();"opaque"!=i&&"transparent"!=i&&(b.prepend(c('<param name="wmode" value="opaque" />')),e=!0);e&&(b=b.length?b:a,e=b.wrap(c('<span class="cfw-placeholder" />')),e.html(e.html()),e.children().unwrap())},c.browser.msie?300:0)});c("iframe").each(function(){/youtube/.test(this.src)&&
(this.src+=(0<=this.src.indexOf("?")?"&":"?")+"wmode=opaque")})});jQuery(function(c){c.fn.bindBefore=function(a,e){a=a.split(/\s+/);this.each(function(){for(var i=a.length;i--;){c(this).bind(a[i],e);var b=c.data(this,"events")[a[i]];b.splice(0,0,b.pop())}})};c.fn.oneBefore=function(a,e){a=a.split(/\s+/);this.each(function(){for(var i=a.length;i--;){c(this).one(a[i],e);var b=c.data(this,"events")[a[i]];b.splice(0,0,b.pop())}})}});
jQuery(function(c){if(!Modernizr.csstransitions)Modernizr.csstransforms=!1,Modernizr.csstransforms3d=!1;if(/AppleWebKit/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent))Modernizr.csstransforms3d=!1;if(c.browser.msie&&window.XDomainRequest)jQuery.support.cors=!0;CFW.User=Backbone.Model.extend({defaults:function(){return{email:"",known_as:"",count:0,highlightColor:CFW.User.prototype.randomColor()}},randomColor:function(){return[[255,75,105],[255,105,75],[75,105,255],[105,75,255],[75,
255,105],[105,255,75],[123,6,226],[226,6,123],[6,226,123],[6,123,226]][Math.floor(10*Math.random()+0)]}});CFW.UserList=Backbone.Collection.extend({model:CFW.User,initialize:function(){this.localStorage=new Store("cfw-users");return this},comparator:function(a){return-a.get("count")}});CFW.users=new CFW.UserList;CFW.users.fetch();CFW.Entry=Backbone.Model.extend({idAttribute:"_id",defaults:{athlete_id:"",known_as:"",email:"",component_results:[],notes:""},emailRegex:/^\S+@\S+\.\S+$/,validate:function(a){var c=
[];!(a.athlete_id||this.attributes&&this.get("athlete_id"))&&!this.emailRegex.test(a.email)&&c.push("email");_.each(a.component_results,function(a){(!a.result||!a.result.length)&&c.push("component-"+a.wp_id+"-result")});(!a.known_as||!a.known_as.replace(/^\s+/,"").replace(/\s+$/,"").length)&&c.push("known_as");if(c.length)return c}});CFW.EntryList=Backbone.Collection.extend({model:CFW.Entry,url:function(){return CFW.domain+"/affiliates/"+this.affiliateId+"/wods/"+this.postId+"/"+this.wod.wp_id+"/posts"},
initialize:function(a,c){this.affiliateId=c.affiliateId;this.postId=c.postId;this.wod=c.wod;return this},comparator:function(a){return a.get("known_as").replace(/^\s+/,"").toLowerCase()}});CFW.EntryItemView=Backbone.View.extend({tagName:"tr",template:_.template('            <td class="cfw-known-as">                <a href="'+CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink","")+'<%- athlete_slug %>" title="view <%- known_as %>\'s profile" target="_blank"><%- known_as %></a>            </td>            <%             if (wod.components && wod.components.length > 1) {                _.each(wod.components, function(component, i, components) {                    var componentResult = _.find(component_results, function(cr) {                        return cr.wp_id == component.wp_id;                    }) || {                        result: "",                        rx: false,                        mods: ""                    };                    var isLast = (i + 1 == components.length);                    %>                     <td class="cfw-component" title="<%- componentResult.result %><%- componentResult.rx ? " [Rx]" : "" %><%- componentResult.mods ? " ("+componentResult.mods+")" : "" %>">                        <%= isLast ? "<div>" : "" %>                        <span class="cfw-result"><%- componentResult.result %></span>                        <span class="cfw-mods">                            <%= componentResult.rx ? "<strong>Rx</strong>" : "" %>                            <%- componentResult.mods %>                        </span>                        <% if (isLast) { %>                            <span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                        <% } %>                        <%= isLast ? "</div>" : "" %>                    </td>                <%                 });            } else {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == (wod.components[0] || {wp_id: "uh oh"}).wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                 <td class="cfw-result" title="<%- componentResult.result %>"><%- componentResult.result %></td>                <td class="cfw-mods" title="<%- componentResult.rx ? "[Rx] " : "" %><%- componentResult.mods %>">                    <div>                        <%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %><span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                    </div>                </td>            <%             }            %>         '),
events:{"click :not(a)":"showDetail"},initialize:function(){this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this);this.model.on("show",this.lookSelected,this);this.model.on("unshow",this.unlookSelected,this);return this.render()},render:function(){this.$el.html(this.template(_.extend({wod:this.options.wod},this.model.toJSON())));return this},lookSelected:function(){this.$el.addClass("cfw-selected")},unlookSelected:function(){this.$el.removeClass("cfw-selected")},addHighlight:function(a){this.$el.addClass("cfw-highlighted").css({backgroundColor:"rgba("+
a.join(",")+",.2)",borderColor:"rgba("+a.join(",")+",.2)"})},removeHighlight:function(){this.$el.removeClass("cfw-highlighted").css({backgroundColor:"transparent",borderColor:"#888"})},showDetail:function(a){this.itemClickDisabled||(a.stopPropagation(),this.model.trigger("show",this.model))}});CFW.WhiteboardPage=Backbone.View.extend({tagName:"div",className:"cfw-page",show:function(){this.$el.addClass("active");var a=this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),a.scrollbarReady=
!0;a.showScrollbar()},Modernizr.csstransitions?400:0)},hide:function(){this.freezeScrollbar();this.$el.removeClass("active");var a=this;setTimeout(function(){a.hideScrollbar();a.thawScrollbar();a.$el.trigger("cfwhide")},Modernizr.csstransitions?300:0)},initScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("show")},
hideScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("hide")},freezeScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("freeze")},thawScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("thaw")}});CFW.EntryListView=CFW.WhiteboardPage.extend({template:_.template('            <table class="cfw-components-<%= wod.components && wod.components.length || 1 %>" cellspacing="0">                <thead>                    <tr>                        <th class="cfw-known-as">Name</th>                        <% _.each(wod.components, function(component) { %>                            <th class="cfw-component" <%= wod.components.length == 1 ? \'colspan="2"\' : "" %> title="<%- component.description %>"><%- component.label %></th>                        <% }); %>                    </tr>                </thead>            </table>            <div class="cfw-scrollable">                <table cellspacing="0" class="cfw-components-<%= wod.components && wod.components.length || 1 %>">                    <tbody>                    </tbody>                </table>            </div>        '),
events:{"touchmove .cfw-scrollable":"disableItemClicks","touchstart .cfw-scrollable":"enableItemClicks"},initialize:function(a){this.entries=a.entries;this.wod=a.wod;this.entryItemViews=[];this.entries.on("add change:known_as remove reset",this.addAll,this);return this.render()},render:function(){this.$el.html(this.template({wod:this.wod}));return this},addOne:function(a){a=new CFW.EntryItemView({model:a,wod:this.wod});this.entryItemViews.push(a);this.$("tbody").append(a.el)},addAll:function(){_.each(this.entryItemViews,
function(a,c,i){a.remove();delete i[c]});this.$("tbody").empty();this.entries.length?this.entries.each(this.addOne,this):this.$("tbody").append(c('                    <tr class="cfw-no-entries">                        <td colspan="100">No one has added an entry yet.<br /><a class="cfw-new-entry">Add yours now!<a></td>                    </tr>                '));this.updateHighlightedUsers()},show:function(){var a=this.$("table").attr("class"),c=this.$el.closest(".cfw-contents");setTimeout(function(){c.addClass(a).data("componentsclass",
a);c.siblings(".cfw-classes").addClass(a)},Modernizr.csstransitions?300:0);CFW.WhiteboardPage.prototype.show.apply(this,arguments)},hide:function(){var a=this.$("table").attr("class");this.$el.closest(".cfw-contents").removeClass(a).removeData("componentsclass").siblings(".cfw-classes").removeClass(a);CFW.WhiteboardPage.prototype.hide.apply(this,arguments)},disableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!0})},enableItemClicks:function(){_.each(this.entryItemViews,
function(a){a.itemClickDisabled=!1})},updateHighlightedUsers:function(){this.entries.each(function(a){a.trigger("removeHighlight")});CFW.users.each(this.addHighlightedUser,this)},addHighlightedUser:function(a){_.each(this.entries.select(function(c){return c.get("email").toLowerCase()==a.get("email").toLowerCase()}),function(c){c.trigger("addHighlight",a.get("highlightColor"))})},removeHighlightedUser:function(a){_.each(this.entries.select(function(c){return c.get("email").toLowerCase()==a.get("email").toLowerCase()}),
function(a){a.trigger("removeHighlight")})}});CFW.EntryDetailView=CFW.WhiteboardPage.extend({template:_.template('            <div class="cfw-entry-detail">                <a class="cfw-back">back</a><a class="cfw-edit">edit</a>                <dl class="cfw-scrollable">                    <dt class="cfw-hidden">Name</dt>                    <dd class="cfw-known-as">                        <%- known_as %>                        <a href="'+CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink","")+'<%- athlete_slug %>" title="view <%- known_as %>\'s profile" target="_blank">view profile</a>                    </dd>                    <%                    _.each(wod.components, function(component) {                        var componentResult = _.find(component_results, function(cr) {                            return cr.wp_id == component.wp_id;                        }) || {                            result: "",                            rx: false,                            mods: ""                        };                    %>                        <dt><%= component.label %></dt>                        <dd class="cfw-component">                            <span class="cfw-result"><%- componentResult.result %></span>                            <span class="cfw-mods"><%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %></span>                        </dd>                    <%                    });                    %>                    <dt>Notes</dt>                    <dd class="cfw-notes"><%- notes || "(no data)" %></dd>                </dl>            </div>        '),
events:{"click a.cfw-edit":"edit","click a.cfw-back":"back",cfwhide:"cleanup"},initialize:function(a){this.wod=a.wod;this.model.on("change",this.render,this);this.model.on("change",function(){var a=this;setTimeout(function(){a.initScrollbar();a.showScrollbar()},300)},this);this.model.on("destroy",this.hide,this);return this.render()},render:function(){this.$el.html(this.template(_.extend({wod:this.wod},this.model.toJSON())));return this},edit:function(){this.model.trigger("edit",this.model)},back:function(){this.$el.trigger("hideEntryDetails")},
cleanup:function(){var a=this;setTimeout(function(){a.model.trigger("unshow",a.model);a.remove()},0)}});CFW.ModalPage=Backbone.View.extend({tagName:"div",className:"cfw-scrollable cfw-modal",events:{"focus :input":"scrollToInput","click .cfw-close-modal":"remove"},initScrollbar:function(){this.$el.scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$el.scrollbarPaper("show")},
hideScrollbar:function(){this.$el.scrollbarPaper("hide")},freezeScrollbar:function(){this.$el.scrollbarPaper("freeze")},thawScrollbar:function(){this.$el.scrollbarPaper("thaw")},scrollToInput:function(a){if(!this.height)this.height=this.$el.parent().height();(a=(c(a.target).position()||{}).top)&&this.$el.animate({scrollTop:a+this.$el.scrollTop()-this.height/2},300)},show:function(){var a=this.$el.closest(".cfw-contents"),c=a.data("componentsclass");c&&(a.removeClass(c),a.siblings(".cfw-classes").removeClass(c));
var i=this;setTimeout(function(){i.$el.addClass("cfw-translate-oldfashioned")},0);setTimeout(function(){if(!i.scrollbarReady)i.initScrollbar(),i.scrollbarReady=!0;i.showScrollbar();var a=i.$el.find(":input:first")[0];a&&a.focus&&a.focus()},Modernizr.csstransitions?400:0)},remove:function(a){this.freezeScrollbar();var c=this,i=this.$el.closest(".cfw-contents");this.$el.removeClass("cfw-translate-oldfashioned");setTimeout(function(){c.hideScrollbar();var b=i.data("componentsclass");b&&(i.addClass(b),
i.siblings(".cfw-classes").addClass(b));"object"==typeof a&&a.silent?c.$el.remove():c.$el.trigger("cfwremove").remove()},Modernizr.csstransitions?300:0)}});CFW.EntryFormView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <\!--<h2><%= new_record ? "Add Your Entry" : "Edit Your Entry" %></h2>--\>                <h2><label for="cfw-email">Email Address</label></h2>                <input type="hidden" name="<%= new_record ? "decoy" : "email" %>" value="<%- email %>" />                <input type="email" id="cfw-email" name="<%= new_record ? "email" : "decoy" %>" placeholder="name@example.com" <%= new_record ? "" : \'value="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" disabled="disabled"\' %> />            </fieldset>            <fieldset>                <h2><label for="cfw-known-as">Name</label></h2>                <input type="text" id="cfw-known-as" name="known_as" placeholder="Guest" value="<%- known_as %>" />            </fieldset>            <%            _.each(wod.components, function(component) {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == component.wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                <fieldset>                    <h2><label for="cfw-component-<%= component.wp_id %>-result"><%= component.label %></label></h2>                    <input type="text" id="cfw-component-<%= component.wp_id %>-result" name="component-<%= component.wp_id %>-result" placeholder="What was your result?" value="<%- componentResult.result %>" />                    <div class="cfw-nobr">                        <label for="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority">Modifications</label>                    </div>                    <div class="cfw-nobr">                        <input type="checkbox" id="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority" name="component-<%= component.wp_id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                        /><span>or</span><input type="text" id="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority" name="component-<%= component.wp_id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                    </div>                </fieldset>            <%            });            %>            <fieldset class="cfw-last">                <div class="cfw-notes <%= notes ? "cfw-open cfw-opaque" : "" %>">                    <h2><label for="cfw-notes">Notes</label></h2>                    <textarea rows="3" id="cfw-notes" name="notes" placeholder="Notes or Tips for next time?"><%- notes %></textarea>                </div>                <div class="cfw-footer">                    <a class="cfw-add-notes <%= notes ? "cfw-hidden" : "" %>"><label for="cfw-notes"><strong>+</strong> add notes</label></a>                    <input type="submit" value="<%= new_record ? "Submit" : "Save" %>" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:c.extend({},CFW.ModalPage.prototype.events,{'keyup input[name="email"]':"guessName",'change input[name="email"]':"guessName",'blur input[name="known_as"]':"guessName","click .cfw-add-notes":"showNotesFields",submit:"save"}),initialize:function(a){this.entries=a.entries;this.wod=a.wod;return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(_.extend({wod:this.wod,new_record:!this.model},(this.model||new CFW.Entry).toJSON())));return this},guessName:function(){var a=
this.$('input[name="email"]'),c=this.$('input[name="known_as"]');if(!(c.val().length&&this.lastGuess&&c.val()!=this.lastGuess||c.val().length&&!this.lastGuess)){var i=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.val().toLowerCase()});if(i)c.val(this.lastGuess=i.get("known_as"));else{i=a.val();if(!_.capitalize)_.capitalize=function(a){return a.substring(0,1).toUpperCase()+a.substring(1)};this.lastGuess=_.capitalize((/[^.@0-9]+/.exec(i)||[""])[0]);c.val(this.lastGuess)}}},showNotesFields:function(){var a=
this.$(".cfw-notes").addClass("cfw-open"),c=this.$(".cfw-add-notes").addClass("cfw-transparent");setTimeout(function(){a.addClass("cfw-opaque");c.addClass("cfw-hidden")},Modernizr.csstransitions?200:0)},save:function(a){a.preventDefault();if(!this.isLoading()){var e={email:this.$('input[name="email"]').val(),known_as:this.$('input[name="known_as"]').val(),component_results:[],notes:this.$('textarea[name="notes"]').val()},i={};this.$('input[name^="component-"]').each(function(){var a=c(this),b=a.attr("name").split("-"),
a="checkbox"==a.attr("type")?a.is(":checked"):a.val();i[b[1]]||(i[b[1]]={wp_id:b[1]});i[b[1]][b[2]]=a});_.each(i,function(a){e.component_results.push(a)});var b=this;b.showLoading();b.$(".ajax-error-notice").remove();a=c.extend({},CFW.ajaxOptions,{success:function(){b.hideLoading();b.remove()},error:function(a,e){b.hideLoading();e&&e.length?b.showValidationErrors(e):b.$(".cfw-footer").after(c('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Click <strong>'+
b.$('input[type="submit"]').val()+"</strong> to try again or contact athlete support if the problem persists.</label>"))},wait:!0});this.model?this.model.save(e,a):this.entries.create(e,a)||this.showValidationErrors(CFW.Entry.prototype.validate(e))}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},
showValidationErrors:function(a){var e=this;_.each(a,function(a){e.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){c('label[for="'+c(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){c(this).removeClass("cfw-invalid");c('label[for="'+c(this).attr("id")+'"]').removeClass("cfw-invalid")})})}});CFW.EmailAuthView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <h2><label for="cfw-email" title="Enter <%- known_as %>&apos;s Email to Edit" style="white-space:normal;">Enter <%= known_as %>&apos;s Email to Edit</label></h2>                <input type="email" id="cfw-email" name="email" placeholder="name@example.com" value="" />            </fieldset>            <fieldset class="cfw-last">                <div class="cfw-footer">                    <input type="submit" value="Unlock" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:c.extend({},CFW.ModalPage.prototype.events,{submit:"submit"}),initialize:function(){return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(this.model.toJSON()));return this},submit:function(a){a.preventDefault();if(!this.isLoading()){var e=this.$('input[name="email"]').val(),i=this;i.showLoading();i.$(".ajax-error-notice").remove();a=c.extend({},CFW.ajaxOptions,{complete:function(){i.hideLoading()},success:function(){i.options.success(e)},
error:function(){i.showValidationErrors(["email"]);i.$(".cfw-footer").after(c('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! That email doesn&apos;t match. Please try again or contact <a href="mailto:athletesupport@cfwhiteboard.com">athlete support</a> if there&apos;s any way we can help.</label>'))},type:"POST",data:{email:e}});c.ajax(CFW.domain+"/athletes/"+this.model.get("athlete_id")+"/verify_email",a)}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},
isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){var e=this;_.each(a,function(a){e.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){c('label[for="'+c(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){c(this).removeClass("cfw-invalid");c('label[for="'+c(this).attr("id")+'"]').removeClass("cfw-invalid")})})}});
CFW.WhiteboardView=Backbone.View.extend({className:"cfw-pane",template:_.template('            <div>                <div class="cfw-window">                    <h2>Entries</h2>                    <a class="cfw-new-entry">+</a>                    <ul class="cfw-classes cfw-<%- allWods.length || 1 %>-classes cfw-components-<%= wod.components && wod.components.length || 1 %>">                        <%                        _.each(allWods, function(w) {                            %><li class="<%- w.wp_id == wod.wp_id ? "cfw-selected" : "" %>"><div>                                <a href="javascript://" data-wp_id="<%- w.wp_id %>" title="<%- w.name %>">                                    <span class="cfw-centered">                                        <span class="cfw-entry-count" data-wp_id="<%- w.wp_id %>"></span>                                        <span class="cfw-link-text"><%- w.name %></span>                                    </span>                                    <span class="cfw-separator"></span>                                </a>                            </div></li><%                        });                        %>                    </ul>                    <div class="cfw-contents"></div>                    <div class="cfw-footer">                        <a href="http://cfwhiteboard.com" target="_blank">                            What Is This?                        </a><a href="mailto:athletesupport@cfwhiteboard.com">                            Email Athlete Support                        </a>                    </div>                </div>            </div>            <a class="cfw-print cfw-admin-tool cfw-hidden" target="_blank">Print</a>        '),
events:{"click .cfw-new-entry:not([disabled])":"newEntry",hideEntryDetails:"hideEntry","cfwremove .cfw-modal":"cleanupModal","click .cfw-classes a:not(.cfw-selected)":"returnToEntryList"},initialize:function(a){this.entries=new CFW.EntryList([],{affiliateId:a.affiliateId,postId:a.postId,wod:a.wod});this.entries.on("add remove reset",this.newEntryCount,this);this.entries.on("edit",this.editEntry,this);this.entries.on("show",this.showEntry,this);this.entries.on("add change:known_as",this.updateUsers,
this);this.render();a.hidden&&this.hide();this.entries.fetch(c.extend({},CFW.ajaxOptions,{data:{postModified:a.postModified}}))},render:function(){this.$el.html(this.template({wod:this.options.wod,allWods:this.options.allWods}));this.entryListView=new CFW.EntryListView({entries:this.entries,wod:this.options.wod});this.$(".cfw-contents").append(this.entryListView.el);this.entryListView.show();"admin"==this.options.authorization&&(this.$(".cfw-print").attr("href",this.entries.url()),this.$(".cfw-admin-tool").removeClass("cfw-hidden"));
return this},attach:function(){this.$children&&this.$el.append(this.$children)},detach:function(){this.$children=this.$el.children();this.$children.detach()},show:function(){this.$el.removeClass("cfw-hidden")},hide:function(){this.$el.addClass("cfw-hidden")},newEntry:function(){this.showEntryForm()},editEntry:function(a){var c=this;this.showEmailAuth(a,function(i){c.modalView.remove({silent:!0});a.set({email:i},{silent:!0});c.showEntryForm(a)})},showEmailAuth:function(a,c){this.disableNewEntries();
this.modalView=new CFW.EmailAuthView({model:a,success:c});this.$(".cfw-contents").append(this.modalView.el);var i=this;setTimeout(function(){i.detailView?i.detailView.hideScrollbar():i.entryListView.hideScrollbar();i.modalView.show()},0)},showEntryForm:function(a){this.modalView=new CFW.EntryFormView({entries:this.entries,model:a,wod:this.options.wod});this.$(".cfw-contents").append(this.modalView.el);var c=this;setTimeout(function(){a||(c.detailView?c.detailView.hideScrollbar():c.entryListView.hideScrollbar());
c.disableNewEntries();c.modalView.show()},0)},cleanupModal:function(){this.enableNewEntries();this.detailView?this.detailView.showScrollbar():this.entryListView.showScrollbar();delete this.modalView},disableNewEntries:function(){this.$el.find(".cfw-new-entry").attr("disabled",!0)},enableNewEntries:function(){this.$el.find(".cfw-new-entry").removeAttr("disabled")},showEntry:function(a){this.detailView=new CFW.EntryDetailView({model:a,wod:this.options.wod});this.$(".cfw-contents").append(this.detailView.el);
var c=this;setTimeout(function(){c.entryListView.hide();c.detailView.show()},0)},hideEntry:function(){this.detailView.hide();this.entryListView.show();var a=this;setTimeout(function(){delete a.detailView},Modernizr.csstransitions?400:100)},newEntryCount:function(){this.$el.trigger("newEntryCount",[this.options.wod.wp_id,this.entries.length])},updateEntryCount:function(a,e){var i=this.$(".cfw-entry-count");0==i.length&&(i=this.$children.find(".cfw-entry-count"));1<i.length&&i.each(function(){var b=
c(this);b.data("wp_id")==a&&b.text(e).attr("title",""+e+" entries")})},updateUsers:function(a){var c=CFW.users.find(function(c){return c.get("email").toLowerCase()==a.get("email").toLowerCase()});c?c.save({known_as:a.get("known_as"),count:c.get("count")+1}):c=CFW.users.create({email:a.get("email"),known_as:a.get("known_as"),count:1})},returnToEntryList:function(){this.modalView?this.modalView.remove():this.detailView&&this.hideEntry()}});CFW.WhiteboardButtonView=Backbone.View.extend({template:_.template('            <h1>Whiteboard <span class="cfw-entry-count-all cfw-hidden"></span></h1>        '),
events:{"click h1":"toggleWhiteboard","click .cfw-classes a":"showClass","newEntryCount .cfw-pane":"updateEntryCounts","mouseenter h1":"hoverButton","mouseleave h1":"unhoverButton"},initialize:function(){var a=this.$el.data("cfwhiteboard");this.affiliateId=a.affiliateId;this.postId=a.postId;this.postModified=a.postModified;this.wods=a.wods;this.authorization=this.$el.data("authorization");return-1<_.indexOf(_.pluck(CFW.instances,"postId"),this.postId)?void 0:this.render()},render:function(){if("embed"==
CFW.oxygenTank(CFW_OPTIONS,"position","display",!1)&&1<this.$el.length){this.$el.first().replaceWith(this.$el.last().addClass("cfw-display-embed"));var a=c("<div />").addClass("cfw-clearer");this.$el.last().parent().append(a)}this.$el.first().html(this.template());this.positionWhiteboard();this.whiteboardViews={};var e=this;_.each(e.wods,function(a,b){a.name=a.name.replace(/workout of the day/ig,"WOD");var c=new CFW.WhiteboardView({affiliateId:e.affiliateId,postId:e.postId,postModified:e.postModified,
wod:a,allWods:e.wods,authorization:e.authorization,hidden:0==b?!1:!0});e.$el.last().append(c.el);e.whiteboardViews[a.wp_id]=c;setTimeout(function(){c.detach()},0)});return this},hoverButton:function(a){this.$el.first().find("h1").addClass("cfw-hovering");this.attachWhiteboard(a);this.positionWhiteboard(a)},unhoverButton:function(a){this.$el.first().find("h1").removeClass("cfw-hovering");this.detachWhiteboard(a)},attachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")||(this.$el.first().addClass("cfw-attached"),
_.each(this.whiteboardViews,function(a){a.attach()}))},detachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")&&!this.$el.first().hasClass("cfw-active")&&!this.$el.first().find("h1").hasClass("cfw-hovering")&&(this.$el.first().removeClass("cfw-attached"),_.each(this.whiteboardViews,function(a){a.detach()}))},toggleWhiteboard:function(a){this.$el.is(".cfw-active")?this.closeWhiteboard():this.openWhiteboard();a.preventDefault()},openWhiteboard:function(){this.$el.addClass("cfw-active").removeClass("cfw-postactive")},
closeWhiteboard:function(){this.$el.addClass("cfw-postactive").removeClass("cfw-active");var a=this;setTimeout(function(){a.$el.removeClass("cfw-postactive");a.detachWhiteboard()},Modernizr.csstransitions?300:0)},positionWhiteboard:function(){if("embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1))this.$el.last().addClass("cfw-active");else if(this.$el.last().parent().is("body")){var a=this.$el.first().offset(),e={position:"absolute",margin:"0",top:a.top+"px"};this.$el.last().is(".position-inline, .position-block, .position-floatleft")?
e.left=a.left+"px":(e.right=c(document).width()-this.$el.first().outerWidth()-a.left,e.right+="px");CFW.important.css.apply(this.$el.last(),[e,!0])}},showClass:function(a){var e=c(a.target).closest("a").data("wp_id");_.each(this.whiteboardViews,function(a,b){b==e?a.show():a.hide()})},updateEntryCounts:function(a,c,i){this.whiteboardViews[c.toString()].entryCount=i;_.each(this.whiteboardViews,function(a){a.updateEntryCount(c,i)});a=_.inject(this.whiteboardViews,function(a,c){return a+(c.entryCount||
0)},0);this.$(".cfw-entry-count-all").text(a).attr("title",""+a+" entries").removeClass("cfw-hidden")}});CFW.instances=[];setTimeout(function(){c(".cfwhiteboard").each(function(){var a=c(this),e=a.closest("a");e.length&&e.before(a);if(!1!=CFW.oxygenTank(CFW_OPTIONS,"position",!1)){e=a.closest(CFW_OPTIONS.position.parent).find(CFW_OPTIONS.position.target);if(e.length)switch(CFW_OPTIONS.position.insertion){case "append":e.append(a);break;case "before":e.before(a);break;case "after":e.after(a);break;
default:e.prepend(a)}switch(CFW_OPTIONS.position.alignment){case "inline":a.addClass("position-inline");break;case "block":a.addClass("position-block");break;case "floatleft":a.addClass("position-floatleft")}CFW_OPTIONS.position.margin&&CFW.important.css.apply(a,[{margin:CFW_OPTIONS.position.margin},!0])}a=a.add(a.clone().appendTo(document.body));CFW.instances.push(new CFW.WhiteboardButtonView({el:a}))});"embed"!=CFW.oxygenTank(CFW_OPTIONS,"position","display",!1)&&(_.each(CFW.instances,function(a){a.$el.on("click",
function(a){a.stopPropagation()})}),c(document.body).on("click",function(){_.each(CFW.instances,function(a){a.closeWhiteboard()})}))},c.browser.msie?1500:0)});
