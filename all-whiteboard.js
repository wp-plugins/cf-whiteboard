var JSON;JSON||(JSON={});
(function(){function d(a){return 10>a?"0"+a:a}function a(a){h.lastIndex=0;return h.test(a)?'"'+a.replace(h,function(a){var d=m[a];return"string"===typeof d?d:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(d,g){var h,o,m,v,t=b,r,p=g[d];p&&"object"===typeof p&&"function"===typeof p.toJSON&&(p=p.toJSON(d));"function"===typeof l&&(p=l.call(g,d,p));switch(typeof p){case "string":return a(p);case "number":return isFinite(p)?""+p:"null";case "boolean":case "null":return""+p;
case "object":if(!p)return"null";b+=k;r=[];if("[object Array]"===Object.prototype.toString.apply(p)){v=p.length;for(h=0;h<v;h+=1)r[h]=c(h,p)||"null";m=0===r.length?"[]":b?"[\n"+b+r.join(",\n"+b)+"\n"+t+"]":"["+r.join(",")+"]";b=t;return m}if(l&&"object"===typeof l){v=l.length;for(h=0;h<v;h+=1)"string"===typeof l[h]&&(o=l[h],(m=c(o,p))&&r.push(a(o)+(b?": ":":")+m))}else for(o in p)Object.prototype.hasOwnProperty.call(p,o)&&(m=c(o,p))&&r.push(a(o)+(b?": ":":")+m);m=0===r.length?"{}":b?"{\n"+b+r.join(",\n"+
b)+"\n"+t+"}":"{"+r.join(",")+"}";b=t;return m}}if("function"!==typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+d(this.getUTCMonth()+1)+"-"+d(this.getUTCDate())+"T"+d(this.getUTCHours())+":"+d(this.getUTCMinutes())+":"+d(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var g=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,k,m={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;if("function"!==typeof JSON.stringify)JSON.stringify=function(a,d,g){var h;k=b="";if("number"===typeof g)for(h=0;h<g;h+=1)k+=" ";else"string"===typeof g&&(k=g);if((l=d)&&"function"!==typeof d&&("object"!==typeof d||"number"!==typeof d.length))throw Error("JSON.stringify");return c("",
{"":a})};if("function"!==typeof JSON.parse)JSON.parse=function(a,d){function c(a,g){var b,h,l=a[g];if(l&&"object"===typeof l)for(b in l)Object.prototype.hasOwnProperty.call(l,b)&&(h=c(l,b),void 0!==h?l[b]=h:delete l[b]);return d.call(a,g,l)}var b,a=""+a;g.lastIndex=0;g.test(a)&&(a=a.replace(g,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return b=eval("("+a+")"),"function"===typeof d?c({"":b},""):b;throw new SyntaxError("JSON.parse");}})();(function(d){function a(a,g,b){var c,b=b||"",h=b.match(RegExp("(?:^|\\s|;)("+a+")\\s*:\\s*([^;]*(?:;|$))","i"));h&&(h[0]=h[0].replace(/^;/,""));null===g?c="":"string"===typeof g&&(c=a+":"+g+" !important;");h?("boolean"===typeof g&&(c=d.important(a+":"+h[2],g)),b=b.replace(h[0],c)):"undefined"!==typeof c&&(b=d.trim(b),""!==b&&(";"!==b.slice(-1)&&(b+=";"),b+=" "),b+=c);return b}function c(a,d){var b=c.re;if(!b)b=c.re=/\s*(! ?important)?[\s\r\t\n]*;/g;return!1===d?a.replace(b,";"):a.replace(b,function(a,
d){return d?a:" !important;"})}function g(a,d){var b=g.re;if(!b)b=g.re=/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g;return a.replace(b,function(a,b){return c(b,d)})}var h=!1,b={},k={},m=d.each({css:function(g,c){var h={},k=d(this),m=k.attr("style");if("string"===typeof g){if("undefined"===typeof c)return b.css.apply(this,arguments);h[g]=c}else if("object"===typeof g)h=g;else return k;d.each(h,function(d,b){m=a(d,b,m)});return k.attr("style",m)}},function(a,g){b[a]=d.fn[a];g.overridden=!0;k[a]=function(){var c=
d.makeArray(arguments),k=c[c.length-1],m=d(this);return!0===k?g.apply(m,c.slice(0,-1)):h&&!1!==k?g.apply(m,c):b[a].apply(m,c)}});d.extend(d.fn,k);d.important=d.extend(function(){var a=d.makeArray(arguments),b;if("string"===typeof a[0]){if("undefined"===typeof a[1]||"boolean"===typeof a[1])return b=!1!==a[1],/<\w+.*>/.test(a[0])?g(a[0],b):c(a[0],b)}else if(d.isFunction(a[0]))b=h,d.important.status=h=!0,a[0].call(this),d.important.status=h=b;else if("undefined"===typeof a[0]||"boolean"===typeof a[0])d.important.status=
h=!1!==a[0];return h},{status:h,noConflict:function(){d.each(b,function(a,b){d.fn[a]=b});return m},declaration:a});d.fn.important=function(b){var g=d(this),h=d.makeArray(arguments).concat(!0),m=g.data("nodeName"),o;if("undefined"===typeof b||"boolean"===typeof b)m||(m=g.attr("nodeName").toLowerCase(),g.data("nodeName",m)),"style"===m?(o=!1!==b,g.html(c(g.html(),o)),h=g.attr("sheet"),_("stylesheet",h),h&&h.cssRules&&(_("cssRules",h.cssRules),d.each(h.cssRules,function(a,b){_("rule",b,b.cssText);_(d.important(b.style.cssText,
o));if(b.type===CSSRule.STYLE_RULE)b.style.cssText=d.important(b.style.cssText,o)}))):g.attr("style",d.important(g.attr("style"),b));else{if("object"===typeof b)return h.unshift("css"),g.important.apply(this,h);if("string"===typeof b)if(d.isFunction(k[b]))h=h.slice(1),k[b].apply(g,h);else{if("undefined"===typeof h[1]||"boolean"===typeof h[1])o=!1!==h[1],g.attr("style",a(b,o,g.attr("style")))}else d.isFunction(b)&&d.important.call(this,b)}return g}})(jQuery);(function(d){var a=function(a){var d=a.data("scrollbarPaper")||a.data("scrollbar-paper"),b=a.innerHeight(),c=b-a.height();return{height:b,ratio:b/(d.clearer.position().top-((d.content.children(":visible").eq(0).position()||{}).top||0)+c),offset:a.offset()}},c={_init:function(g){g=d.extend({parentSelector:"",css:d.css,show:function(a){a.show()},hide:function(a){a.hide()}},g);return this.each(function(){var c=d(this),b=c.data("scrollbarPaper")||c.data("scrollbar-paper");if(!b){g.css.apply(c,[{"overflow-x":"hidden",
"overflow-y":"auto"},!0]);b=c.closest(g.parentSelector);b.length||(b=c.offsetParent());var k=d('<div class="scrollbarpaper-container"></div>').appendTo(b);g.hide(k);var m=d('<div class="scrollbarpaper-track"></div>').appendTo(k),l=d('<div class="scrollbarpaper-drag"></div>').appendTo(m),b={options:g,offsetParent:b,paper:k,track:m,drag:l,dragTop:d('<div class="scrollbarpaper-drag-top"></div>').appendTo(l),dragBottom:d('<div class="scrollbarpaper-drag-bottom"></div>').appendTo(l),content:c,clearer:d('<div style="clear:both;"></div>').appendTo(c),
offsetHeight:m.outerHeight()-m.height()};c.data("scrollbarPaper",b).data("scrollbar-paper",b);var n=a(c),s=setInterval(function(){if(c.closest(g.parentSelector).length){if(c.is(":visible")){var b=a(c);if(b.height!=n.height||b.ratio!=n.ratio||b.offset.left!=n.offset.left||b.offset.top!=n.offset.top)c.scrollbarPaper("update"),n=b}}else clearInterval(s),k.remove(),c.removeData("scrollbarPaper").removeData("scrollbar-paper")},250)}c.scrollbarPaper("update")})},update:function(c){return this.each(function(){var h=
d(this);if(h.is(":visible")&&!h.data("scrollbarpaperfrozen")){var b=h.data("scrollbarPaper")||h.data("scrollbar-paper");c=c||a(h);h.unbind(".scrollbarPaper");var k=h.innerHeight()-b.offsetHeight;b.options.css.apply(b.track,[{height:k+"px"},!0]);var m=0<b.offsetParent.not("html, body").length?b.offsetParent.offset():{left:0,top:0};b.options.css.apply(b.paper,[{left:-m.left+c.offset.left+h.innerWidth()-b.paper.width()+"px",top:-m.top+c.offset.top+"px"},!0]);var l=Math.max(Math.round(k*c.ratio),b.dragTop.height()+
b.dragBottom.height());b.options.css.apply(b.drag,[{height:l+"px"},!0]);m=function(){b.options.css.apply(b.drag,[{top:Math.min(Math.round(h.scrollTop()*c.ratio),k-l)+"px"},!0])};m();h.bind("scroll.scrollbarPaper",m);var n=function(a){return a.pageY||(a.originalEvent&&(a.originalEvent.targetTouches||a.originalEvent.touches||[])[0]||a).pageY},s=function(){d("body").unbind("mousemove.scrollbarPaper touchmove.scrollbarPaper")};b.drag.bind("mousedown.scrollbarPaper touchstart.scrollbarPaper",function(a){s();
var k=n(a)-b.drag.offset().top;d("body").bind("mousemove.scrollbarPaper touchmove.scrollbarPaper",function(a){a.preventDefault();h.scrollTop((n(a)-h.offset().top-k)/c.ratio);return!1}).bind("mouseup.scrollbarPaper touchend.scrollbarPaper",s);return!1});1>c.ratio?(b.options.show(b.drag),b.content.addClass("scrollbarpaper-visible")):(b.options.hide(b.drag),b.content.removeClass("scrollbarpaper-visible"))}})},show:function(){return this.each(function(){var a=d(this),c=a.data("scrollbarPaper")||a.data("scrollbar-paper");
c&&(a.scrollbarPaper("update"),"function"==typeof c.options.show?c.options.show(c.paper):c.paper.show())})},hide:function(){return this.each(function(){var a=d(this);(a=a.data("scrollbarPaper")||a.data("scrollbar-paper"))&&("function"==typeof a.options.hide?a.options.hide(a.paper):a.paper.hide())})},freeze:function(){return this.each(function(){d(this).data("scrollbarpaperfrozen",!0)})},thaw:function(){return this.each(function(){d(this).data("scrollbarpaperfrozen",!1)})}};d.fn.scrollbarPaper=function(a){if(c[a])return c[a].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return c._init.apply(this,arguments);throw"Method "+a+" does not exist on jQuery.scrollbarPaper.";}})(jQuery);(function(d,a,c){function g(a){return a}function h(a){return decodeURIComponent(a.replace(b," "))}var b=/\+/g,k=d.cookie=function(b,l,n){if(l!==c){n=d.extend({},k.defaults,n);if(null===l)n.expires=-1;if("number"===typeof n.expires){var s=n.expires,u=n.expires=new Date;u.setDate(u.getDate()+s)}l=k.json?JSON.stringify(l):""+l;return a.cookie=[encodeURIComponent(b),"=",k.raw?l:encodeURIComponent(l),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:
"",n.secure?"; secure":""].join("")}l=k.raw?g:h;n=a.cookie.split("; ");s=0;for(u=n.length;s<u;s++){var o=n[s].split("=");if(l(o.shift())===b)return b=l(o.join("=")),k.json?JSON.parse(b):b}return null};k.defaults={};d.removeCookie=function(a,b){return null!==d.cookie(a)?(d.cookie(a,null,b),!0):!1}})(jQuery,document);jQuery.cookie.json=!0;(function(){var d=this,a=d._,c={},g=Array.prototype,h=Object.prototype,b=g.push,k=g.slice,m=g.concat,l=h.toString,n=h.hasOwnProperty,s=g.forEach,u=g.map,o=g.reduce,z=g.reduceRight,v=g.filter,t=g.every,r=g.some,p=g.indexOf,B=g.lastIndexOf,h=Array.isArray,E=Object.keys,A=Function.prototype.bind,e=function(j){if(j instanceof e)return j;if(!(this instanceof e))return new e(j);this._wrapped=j};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports._=
e):d._=e;e.VERSION="1.4.2";var q=e.each=e.forEach=function(j,a,f){if(null!=j)if(s&&j.forEach===s)j.forEach(a,f);else if(j.length===+j.length)for(var b=0,i=j.length;b<i&&!(a.call(f,j[b],b,j)===c);b++);else for(b in j)if(e.has(j,b)&&a.call(f,j[b],b,j)===c)break};e.map=e.collect=function(j,a,f){var b=[];return null==j?b:u&&j.map===u?j.map(a,f):(q(j,function(j,c,i){b[b.length]=a.call(f,j,c,i)}),b)};e.reduce=e.foldl=e.inject=function(j,a,f,b){var c=2<arguments.length;null==j&&(j=[]);if(o&&j.reduce===o)return b&&
(a=e.bind(a,b)),c?j.reduce(a,f):j.reduce(a);q(j,function(j,i,d){c?f=a.call(b,f,j,i,d):(f=j,c=!0)});if(!c)throw new TypeError("Reduce of empty array with no initial value");return f};e.reduceRight=e.foldr=function(j,a,f,b){var c=2<arguments.length;null==j&&(j=[]);if(z&&j.reduceRight===z)return b&&(a=e.bind(a,b)),2<arguments.length?j.reduceRight(a,f):j.reduceRight(a);var i=j.length;if(i!==+i)var d=e.keys(j),i=d.length;q(j,function(e,g,y){g=d?d[--i]:--i;c?f=a.call(b,f,j[g],g,y):(f=j[g],c=!0)});if(!c)throw new TypeError("Reduce of empty array with no initial value");
return f};e.find=e.detect=function(j,a,f){var b;return D(j,function(j,c,i){if(a.call(f,j,c,i))return b=j,!0}),b};e.filter=e.select=function(j,a,f){var b=[];return null==j?b:v&&j.filter===v?j.filter(a,f):(q(j,function(j,c,i){a.call(f,j,c,i)&&(b[b.length]=j)}),b)};e.reject=function(j,a,f){var b=[];return null==j?b:(q(j,function(j,c,i){a.call(f,j,c,i)||(b[b.length]=j)}),b)};e.every=e.all=function(j,a,f){a||(a=e.identity);var b=!0;return null==j?b:t&&j.every===t?j.every(a,f):(q(j,function(j,i,d){if(!(b=
b&&a.call(f,j,i,d)))return c}),!!b)};var D=e.some=e.any=function(j,a,f){a||(a=e.identity);var b=!1;return null==j?b:r&&j.some===r?j.some(a,f):(q(j,function(j,i,d){if(b||(b=a.call(f,j,i,d)))return c}),!!b)};e.contains=e.include=function(j,a){var f=!1;return null==j?f:p&&j.indexOf===p?-1!=j.indexOf(a):(f=D(j,function(j){return j===a}),f)};e.invoke=function(j,a){var f=k.call(arguments,2);return e.map(j,function(j){return(e.isFunction(a)?a:j[a]).apply(j,f)})};e.pluck=function(j,a){return e.map(j,function(j){return j[a]})};
e.where=function(j,a){return e.isEmpty(a)?[]:e.filter(j,function(j){for(var f in a)if(a[f]!==j[f])return!1;return!0})};e.max=function(j,a,f){if(!a&&e.isArray(j)&&j[0]===+j[0]&&65535>j.length)return Math.max.apply(Math,j);if(!a&&e.isEmpty(j))return-Infinity;var b={computed:-Infinity};return q(j,function(j,i,c){i=a?a.call(f,j,i,c):j;i>=b.computed&&(b={value:j,computed:i})}),b.value};e.min=function(a,f,b){if(!f&&e.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!f&&e.isEmpty(a))return Infinity;
var i={computed:Infinity};return q(a,function(a,j,c){j=f?f.call(b,a,j,c):a;j<i.computed&&(i={value:a,computed:j})}),i.value};e.shuffle=function(a){var f,b=0,i=[];return q(a,function(a){f=e.random(b++);i[b-1]=i[f];i[f]=a}),i};var x=function(a){return e.isFunction(a)?a:function(f){return f[a]}};e.sortBy=function(a,f,b){var i=x(f);return e.pluck(e.map(a,function(a,f,j){return{value:a,index:f,criteria:i.call(b,a,f,j)}}).sort(function(a,f){var j=a.criteria,b=f.criteria;if(j!==b){if(j>b||void 0===j)return 1;
if(j<b||void 0===b)return-1}return a.index<f.index?-1:1}),"value")};var C=function(a,f,b,i){var c={},d=x(f);return q(a,function(f,e){var g=d.call(b,f,e,a);i(c,g,f)}),c};e.groupBy=function(a,f,b){return C(a,f,b,function(a,f,j){(e.has(a,f)?a[f]:a[f]=[]).push(j)})};e.countBy=function(a,f,b){return C(a,f,b,function(a,f){e.has(a,f)||(a[f]=0);a[f]++})};e.sortedIndex=function(a,f,b,i){for(var b=null==b?e.identity:x(b),f=b.call(i,f),c=0,d=a.length;c<d;){var g=c+d>>>1;b.call(i,a[g])<f?c=g+1:d=g}return c};
e.toArray=function(a){return a?a.length===+a.length?k.call(a):e.values(a):[]};e.size=function(a){return a.length===+a.length?a.length:e.keys(a).length};e.first=e.head=e.take=function(a,f,b){return null!=f&&!b?k.call(a,0,f):a[0]};e.initial=function(a,f,b){return k.call(a,0,a.length-(null==f||b?1:f))};e.last=function(a,f,b){return null!=f&&!b?k.call(a,Math.max(a.length-f,0)):a[a.length-1]};e.rest=e.tail=e.drop=function(a,f,b){return k.call(a,null==f||b?1:f)};e.compact=function(a){return e.filter(a,
function(a){return!!a})};var f=function(a,i,c){return q(a,function(a){e.isArray(a)?i?b.apply(c,a):f(a,i,c):c.push(a)}),c};e.flatten=function(a,b){return f(a,b,[])};e.without=function(a){return e.difference(a,k.call(arguments,1))};e.uniq=e.unique=function(a,f,b,i){var b=b?e.map(a,b,i):a,c=[],d=[];return q(b,function(b,i){if(f?!i||d[d.length-1]!==b:!e.contains(d,b))d.push(b),c.push(a[i])}),c};e.union=function(){return e.uniq(m.apply(g,arguments))};e.intersection=function(a){var f=k.call(arguments,1);
return e.filter(e.uniq(a),function(a){return e.every(f,function(f){return 0<=e.indexOf(f,a)})})};e.difference=function(a){var f=m.apply(g,k.call(arguments,1));return e.filter(a,function(a){return!e.contains(f,a)})};e.zip=function(){for(var a=k.call(arguments),f=e.max(e.pluck(a,"length")),b=Array(f),i=0;i<f;i++)b[i]=e.pluck(a,""+i);return b};e.object=function(a,f){for(var b={},i=0,c=a.length;i<c;i++)f?b[a[i]]=f[i]:b[a[i][0]]=a[i][1];return b};e.indexOf=function(a,f,b){if(null==a)return-1;var i=0,c=
a.length;if(b){if("number"!=typeof b)return i=e.sortedIndex(a,f),a[i]===f?i:-1;i=0>b?Math.max(0,c+b):b}if(p&&a.indexOf===p)return a.indexOf(f,b);for(;i<c;i++)if(a[i]===f)return i;return-1};e.lastIndexOf=function(a,f,b){if(null==a)return-1;var i=null!=b;if(B&&a.lastIndexOf===B)return i?a.lastIndexOf(f,b):a.lastIndexOf(f);for(b=i?b:a.length;b--;)if(a[b]===f)return b;return-1};e.range=function(a,f,b){1>=arguments.length&&(f=a||0,a=0);b=arguments[2]||1;for(var i=Math.max(Math.ceil((f-a)/b),0),c=0,d=Array(i);c<
i;)d[c++]=a,a+=b;return d};var i=function(){};e.bind=function(a,f){var b,c;if(a.bind===A&&A)return A.apply(a,k.call(arguments,1));if(!e.isFunction(a))throw new TypeError;return c=k.call(arguments,2),b=function(){if(this instanceof b){i.prototype=a.prototype;var d=new i,e=a.apply(d,c.concat(k.call(arguments)));return Object(e)===e?e:d}return a.apply(f,c.concat(k.call(arguments)))}};e.bindAll=function(a){var f=k.call(arguments,1);return 0==f.length&&(f=e.functions(a)),q(f,function(f){a[f]=e.bind(a[f],
a)}),a};e.memoize=function(a,f){var b={};return f||(f=e.identity),function(){var i=f.apply(this,arguments);return e.has(b,i)?b[i]:b[i]=a.apply(this,arguments)}};e.delay=function(a,f){var b=k.call(arguments,2);return setTimeout(function(){return a.apply(null,b)},f)};e.defer=function(a){return e.delay.apply(e,[a,1].concat(k.call(arguments,1)))};e.throttle=function(a,f){var b,i,c,d,g,y,h=e.debounce(function(){g=d=!1},f);return function(){b=this;i=arguments;var e;return c||(c=setTimeout(function(){c=
null;g&&(y=a.apply(b,i));h()},f)),d?g=!0:(d=!0,y=a.apply(b,i)),h(),y}};e.debounce=function(a,f,b){var i,c;return function(){var d=this,e=arguments,g=b&&!i;return clearTimeout(i),i=setTimeout(function(){i=null;b||(c=a.apply(d,e))},f),g&&(c=a.apply(d,e)),c}};e.once=function(a){var f=!1,b;return function(){return f?b:(f=!0,b=a.apply(this,arguments),a=null,b)}};e.wrap=function(a,f){return function(){var i=[a];return b.apply(i,arguments),f.apply(this,i)}};e.compose=function(){var a=arguments;return function(){for(var f=
arguments,b=a.length-1;0<=b;b--)f=[a[b].apply(this,f)];return f[0]}};e.after=function(a,f){return 0>=a?f():function(){if(1>--a)return f.apply(this,arguments)}};e.keys=E||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var f=[],b;for(b in a)e.has(a,b)&&(f[f.length]=b);return f};e.values=function(a){var f=[],b;for(b in a)e.has(a,b)&&f.push(a[b]);return f};e.pairs=function(a){var f=[],b;for(b in a)e.has(a,b)&&f.push([b,a[b]]);return f};e.invert=function(a){var f={},b;for(b in a)e.has(a,
b)&&(f[a[b]]=b);return f};e.functions=e.methods=function(a){var f=[],b;for(b in a)e.isFunction(a[b])&&f.push(b);return f.sort()};e.extend=function(a){return q(k.call(arguments,1),function(f){for(var b in f)a[b]=f[b]}),a};e.pick=function(a){var f={},b=m.apply(g,k.call(arguments,1));return q(b,function(b){b in a&&(f[b]=a[b])}),f};e.omit=function(a){var f={},b=m.apply(g,k.call(arguments,1)),i;for(i in a)e.contains(b,i)||(f[i]=a[i]);return f};e.defaults=function(a){return q(k.call(arguments,1),function(f){for(var b in f)null==
a[b]&&(a[b]=f[b])}),a};e.clone=function(a){return e.isObject(a)?e.isArray(a)?a.slice():e.extend({},a):a};e.tap=function(a,f){return f(a),a};var y=function(a,f,b,i){if(a===f)return 0!==a||1/a==1/f;if(null==a||null==f)return a===f;a instanceof e&&(a=a._wrapped);f instanceof e&&(f=f._wrapped);var c=l.call(a);if(c!=l.call(f))return!1;switch(c){case "[object String]":return a==""+f;case "[object Number]":return a!=+a?f!=+f:0==a?1/a==1/f:a==+f;case "[object Date]":case "[object Boolean]":return+a==+f;case "[object RegExp]":return a.source==
f.source&&a.global==f.global&&a.multiline==f.multiline&&a.ignoreCase==f.ignoreCase}if("object"!=typeof a||"object"!=typeof f)return!1;for(var d=b.length;d--;)if(b[d]==a)return i[d]==f;b.push(a);i.push(f);var d=0,g=!0;if("[object Array]"==c){if(d=a.length,g=d==f.length,g)for(;d--&&(g=y(a[d],f[d],b,i)););}else{var c=a.constructor,h=f.constructor;if(c!==h&&(!e.isFunction(c)||!(c instanceof c&&e.isFunction(h)&&h instanceof h)))return!1;for(var w in a)if(e.has(a,w)&&(d++,!(g=e.has(f,w)&&y(a[w],f[w],b,
i))))break;if(g){for(w in f)if(e.has(f,w)&&!d--)break;g=!d}}return b.pop(),i.pop(),g};e.isEqual=function(a,f){return y(a,f,[],[])};e.isEmpty=function(a){if(null==a)return!0;if(e.isArray(a)||e.isString(a))return 0===a.length;for(var f in a)if(e.has(a,f))return!1;return!0};e.isElement=function(a){return!!a&&1===a.nodeType};e.isArray=h||function(a){return"[object Array]"==l.call(a)};e.isObject=function(a){return a===Object(a)};q("Arguments,Function,String,Number,Date,RegExp".split(","),function(a){e["is"+
a]=function(f){return l.call(f)=="[object "+a+"]"}});e.isArguments(arguments)||(e.isArguments=function(a){return!!a&&!!e.has(a,"callee")});"function"!=typeof/./&&(e.isFunction=function(a){return"function"==typeof a});e.isFinite=function(a){return e.isNumber(a)&&isFinite(a)};e.isNaN=function(a){return e.isNumber(a)&&a!=+a};e.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==l.call(a)};e.isNull=function(a){return null===a};e.isUndefined=function(a){return void 0===a};e.has=function(a,
f){return n.call(a,f)};e.noConflict=function(){return d._=a,this};e.identity=function(a){return a};e.times=function(a,f,b){for(var i=0;i<a;i++)f.call(b,i)};e.random=function(a,f){return null==f&&(f=a,a=0),a+(0|Math.random()*(f-a+1))};var w={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};w.unescape=e.invert(w.escape);var G={escape:RegExp("["+e.keys(w.escape).join("")+"]","g"),unescape:RegExp("("+e.keys(w.unescape).join("|")+")","g")};e.each(["escape","unescape"],
function(a){e[a]=function(f){return null==f?"":(""+f).replace(G[a],function(f){return w[a][f]})}});e.result=function(a,f){if(null==a)return null;var b=a[f];return e.isFunction(b)?b.call(a):b};e.mixin=function(a){q(e.functions(a),function(f){var i=e[f]=a[f];e.prototype[f]=function(){var a=[this._wrapped];b.apply(a,arguments);a=i.apply(e,a);return this._chain?e(a).chain():a}})};var H=0;e.uniqueId=function(a){var f=H++;return a?a+f:f};e.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,
escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},J=/\\|'|\r|\n|\t|\u2028|\u2029/g;e.template=function(a,f,b){var b=e.defaults({},b,e.templateSettings),i=RegExp([(b.escape||F).source,(b.interpolate||F).source,(b.evaluate||F).source].join("|")+"|$","g"),c=0,d="__p+='";a.replace(i,function(f,b,i,e,g){d+=a.slice(c,g).replace(J,function(a){return"\\"+I[a]});d+=b?"'+\n((__t=("+b+"))==null?'':_.escape(__t))+\n'":i?"'+\n((__t=("+i+
"))==null?'':__t)+\n'":e?"';\n"+e+"\n__p+='":"";c=g+f.length});d+="';\n";b.variable||(d="with(obj||{}){\n"+d+"}\n");d="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+d+"return __p;\n";try{var g=new Function(b.variable||"obj","_",d)}catch(h){throw h.source=d,h;}if(f)return g(f,e);f=function(a){return g.call(this,a,e)};return f.source="function("+(b.variable||"obj")+"){\n"+d+"}",f};e.chain=function(a){return e(a).chain()};e.mixin(e);q("pop,push,reverse,shift,sort,splice,unshift".split(","),
function(a){var f=g[a];e.prototype[a]=function(){var b=this._wrapped;return f.apply(b,arguments),("shift"==a||"splice"==a)&&0===b.length&&delete b[0],this._chain?e(b).chain():b}});q(["concat","join","slice"],function(a){var f=g[a];e.prototype[a]=function(){var a=f.apply(this._wrapped,arguments);return this._chain?e(a).chain():a}});e.extend(e.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);(function(){var d=this,a=d.Backbone,c=Array.prototype.slice,g=Array.prototype.splice,h;h="undefined"!==typeof exports?exports:d.Backbone={};h.VERSION="0.9.2";var b=d._;!b&&"undefined"!==typeof require&&(b=require("underscore"));var k=d.jQuery||d.Zepto||d.ender;h.setDomLibrary=function(a){k=a};h.noConflict=function(){d.Backbone=a;return this};h.emulateHTTP=!1;h.emulateJSON=!1;var m=/\s+/,l=h.Events={on:function(a,b,c){var d,e,g,h,k;if(!b)return this;a=a.split(m);for(d=this._callbacks||(this._callbacks=
{});e=a.shift();)g=(k=d[e])?k.tail:{},g.next=h={},g.context=c,g.callback=b,d[e]={tail:h,next:k?k.next:g};return this},off:function(a,i,c){var d,e,g,h,k,l;if(e=this._callbacks){if(!a&&!i&&!c)return delete this._callbacks,this;for(a=a?a.split(m):b.keys(e);d=a.shift();)if(g=e[d],delete e[d],g&&(i||c))for(h=g.tail;(g=g.next)!==h;)if(k=g.callback,l=g.context,i&&k!==i||c&&l!==c)this.on(d,k,l);return this}},trigger:function(a){var b,d,e,g,h,k;if(!(e=this._callbacks))return this;h=e.all;a=a.split(m);for(k=
c.call(arguments,1);b=a.shift();){if(d=e[b])for(g=d.tail;(d=d.next)!==g;)d.callback.apply(d.context||this,k);if(d=h){g=d.tail;for(b=[b].concat(k);(d=d.next)!==g;)d.callback.apply(d.context||this,b)}}return this}};l.bind=l.on;l.unbind=l.off;var n=h.Model=function(a,i){var c;a||(a={});i&&i.parse&&(a=this.parse(a));if(c=x(this,"defaults"))a=b.extend({},c,a);i&&i.collection&&(this.collection=i.collection);this.attributes={};this._escapedAttributes={};this.cid=b.uniqueId("c");this.changed={};this._silent=
{};this._pending={};this.set(a,{silent:!0});this.changed={};this._silent={};this._pending={};this._previousAttributes=b.clone(this.attributes);this.initialize.apply(this,arguments)};b.extend(n.prototype,l,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return b.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var i;if(i=this._escapedAttributes[a])return i;i=this.get(a);return this._escapedAttributes[a]=b.escape(null==
i?"":""+i)},has:function(a){return null!=this.get(a)},set:function(a,i,c){var d,e;b.isObject(a)||null==a?(d=a,c=i):(d={},d[a]=i);c||(c={});if(!d)return this;d instanceof n&&(d=d.attributes);if(c.unset)for(e in d)d[e]=void 0;if(!this._validate(d,c))return!1;this.idAttribute in d&&(this.id=d[this.idAttribute]);var i=c.changes={},g=this.attributes,h=this._escapedAttributes,k=this._previousAttributes||{};for(e in d){a=d[e];if(!b.isEqual(g[e],a)||c.unset&&b.has(g,e))delete h[e],(c.silent?this._silent:
i)[e]=!0;c.unset?delete g[e]:g[e]=a;!b.isEqual(k[e],a)||b.has(g,e)!=b.has(k,e)?(this.changed[e]=a,c.silent||(this._pending[e]=!0)):(delete this.changed[e],delete this._pending[e])}c.silent||this.change(c);return this},unset:function(a,b){(b||(b={})).unset=!0;return this.set(a,null,b)},clear:function(a){(a||(a={})).unset=!0;return this.set(b.clone(this.attributes),a)},fetch:function(a){var a=a?b.clone(a):{},i=this,c=a.success;a.success=function(b,d,e){if(!i.set(i.parse(b,e),a))return!1;c&&c(i,b)};
a.error=h.wrapError(a.error,i,a);return(this.sync||h.sync).call(this,"read",this,a)},save:function(a,i,c){var d,e;b.isObject(a)||null==a?(d=a,c=i):(d={},d[a]=i);c=c?b.clone(c):{};if(c.wait){if(!this._validate(d,c))return!1;e=b.clone(this.attributes)}a=b.extend({},c,{silent:!0});if(d&&!this.set(d,c.wait?a:c))return!1;var g=this,k=c.success;c.success=function(a,f,i){f=g.parse(a,i);c.wait&&(delete c.wait,f=b.extend(d||{},f));if(!g.set(f,c))return!1;k?k(g,a):g.trigger("sync",g,a,c)};c.error=h.wrapError(c.error,
g,c);i=this.isNew()?"create":"update";i=(this.sync||h.sync).call(this,i,this,c);c.wait&&this.set(e,a);return i},destroy:function(a){var a=a?b.clone(a):{},c=this,d=a.success,e=function(){c.trigger("destroy",c,c.collection,a)};if(this.isNew())return e(),!1;a.success=function(b){a.wait&&e();d?d(c,b):c.trigger("sync",c,b,a)};a.error=h.wrapError(a.error,c,a);var g=(this.sync||h.sync).call(this,"delete",this,a);a.wait||e();return g},url:function(){var a=x(this,"urlRoot")||x(this.collection,"url")||C();
return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(a){a||(a={});var c=this._changing;this._changing=!0;for(var d in this._silent)this._pending[d]=!0;var e=b.extend({},a.changes,this._silent);this._silent={};for(d in e)this.trigger("change:"+d,this,this.get(d),a);if(c)return this;for(;!b.isEmpty(this._pending);){this._pending=
{};this.trigger("change",this,a);for(d in this.changed)!this._pending[d]&&!this._silent[d]&&delete this.changed[d];this._previousAttributes=b.clone(this.attributes)}this._changing=!1;return this},hasChanged:function(a){return!arguments.length?!b.isEmpty(this.changed):b.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?b.clone(this.changed):!1;var c,d=!1,e=this._previousAttributes,g;for(g in a)if(!b.isEqual(e[g],c=a[g]))(d||(d={}))[g]=c;return d},previous:function(a){return!arguments.length||
!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return b.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,c){if(c.silent||!this.validate)return!0;var a=b.extend({},this.attributes,a),d=this.validate(a,c);if(!d)return!0;c&&c.error?c.error(this,d,c):this.trigger("error",this,d,c);return!1}});var s=h.Collection=function(a,b){b||(b={});b.model&&(this.model=b.model);b.comparator&&(this.comparator=b.comparator);
this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,{silent:!0,parse:b.parse})};b.extend(s.prototype,l,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,c){var d,e,h,k,l,m={},r={},j=[];c||(c={});a=b.isArray(a)?a.slice():[a];d=0;for(e=a.length;d<e;d++){if(!(h=a[d]=this._prepareModel(a[d],c)))throw Error("Can't add an invalid model to a collection");k=h.cid;l=h.id;m[k]||this._byCid[k]||null!=l&&(r[l]||this._byId[l])?
j.push(d):m[k]=r[l]=h}for(d=j.length;d--;)a.splice(j[d],1);d=0;for(e=a.length;d<e;d++)(h=a[d]).on("all",this._onModelEvent,this),this._byCid[h.cid]=h,null!=h.id&&(this._byId[h.id]=h);this.length+=e;g.apply(this.models,[null!=c.at?c.at:this.models.length,0].concat(a));this.comparator&&this.sort({silent:!0});if(c.silent)return this;d=0;for(e=this.models.length;d<e;d++)if(m[(h=this.models[d]).cid])c.index=d,h.trigger("add",h,this,c);return this},remove:function(a,c){var d,e,g,h;c||(c={});a=b.isArray(a)?
a.slice():[a];d=0;for(e=a.length;d<e;d++)if(h=this.getByCid(a[d])||this.get(a[d]))delete this._byId[h.id],delete this._byCid[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,c.silent||(c.index=g,h.trigger("remove",h,this,c)),this._removeReference(h);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,b);return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,c){a=this._prepareModel(a,c);this.add(a,b.extend({at:0},c));return a},
shift:function(a){var b=this.at(0);this.remove(b,a);return b},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return b.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var c=b.bind(this.comparator,this);1==this.comparator.length?
this.models=this.sortBy(c):this.models.sort(c);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return b.map(this.models,function(b){return b.get(a)})},reset:function(a,c){a||(a=[]);c||(c={});for(var d=0,e=this.models.length;d<e;d++)this._removeReference(this.models[d]);this._reset();this.add(a,b.extend({silent:!0},c));c.silent||this.trigger("reset",this,c);return this},fetch:function(a){a=a?b.clone(a):{};void 0===a.parse&&(a.parse=!0);var c=this,d=a.success;a.success=function(b,
e,g){c[a.add?"add":"reset"](c.parse(b,g),a);d&&d(c,b)};a.error=h.wrapError(a.error,c,a);return(this.sync||h.sync).call(this,"read",this,a)},create:function(a,c){var d=this,c=c?b.clone(c):{},a=this._prepareModel(a,c);if(!a)return!1;c.wait||d.add(a,c);var e=c.success;c.success=function(b,g){c.wait&&d.add(b,c);e?e(b,g):b.trigger("sync",a,g,c)};a.save(null,c);return a},parse:function(a){return a},chain:function(){return b(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId=
{};this._byCid={}},_prepareModel:function(a,b){b||(b={});a instanceof n?a.collection||(a.collection=this):(b.collection=this,a=new this.model(a,b),a._validate(a.attributes,b)||(a=!1));return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"==a||"remove"==a)&&c!=this||("destroy"==a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,
arguments))}});b.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(a){s.prototype[a]=function(){return b[a].apply(b,[this.models].concat(b.toArray(arguments)))}});var u=h.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},o=/:\w+/g,
z=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;b.extend(u.prototype,l,{initialize:function(){},route:function(a,c,d){h.history||(h.history=new t);b.isRegExp(a)||(a=this._routeToRegExp(a));d||(d=this[c]);h.history.route(a,b.bind(function(b){b=this._extractParameters(a,b);d&&d.apply(this,b);this.trigger.apply(this,["route:"+c].concat(b));h.history.trigger("route",this,c,b)},this));return this},navigate:function(a,b){h.history.navigate(a,b)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,
this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(v,"\\$&").replace(o,"([^/]+)").replace(z,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var t=h.History=function(){this.handlers=[];b.bindAll(this,"checkUrl")},r=/^[#\/]/,p=/msie [\w.]+/;t.started=!1;b.extend(t.prototype,l,{interval:50,getHash:function(a){return(a=(a?a.location:window.location).href.match(/#(.*)$/))?a[1]:
""},getFragment:function(a,b){if(null==a)if(this._hasPushState||b){var a=window.location.pathname,c=window.location.search;c&&(a+=c)}else a=this.getHash();a.indexOf(this.options.root)||(a=a.substr(this.options.root.length));return a.replace(r,"")},start:function(a){if(t.started)throw Error("Backbone.history has already been started");t.started=!0;this.options=b.extend({},{root:"/"},this.options,a);this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=
!(!this.options.pushState||!window.history||!window.history.pushState);var a=this.getFragment(),c=document.documentMode;if(c=p.exec(navigator.userAgent.toLowerCase())&&(!c||7>=c))this.iframe=k('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?k(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!c?k(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,
this.interval));this.fragment=a;a=window.location;c=a.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!c)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&c&&a.hash&&(this.fragment=this.getHash().replace(r,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},
stop:function(){k(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);t.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a==this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var c=this.fragment=this.getFragment(a);return b.any(this.handlers,
function(a){if(a.route.test(c))return a.callback(c),!0})},navigate:function(a,b){if(!t.started)return!1;if(!b||!0===b)b={trigger:b};var c=(a||"").replace(r,"");this.fragment!=c&&(this._hasPushState?(0!=c.indexOf(this.options.root)&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||
this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a))},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});var B=h.View=function(a){this.cid=b.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},E=/^(\S+)\s*(.*)$/,A="model,collection,el,id,attributes,className,tagName".split(",");
b.extend(B.prototype,l,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(a,b,c){a=document.createElement(a);b&&k(a).attr(b);c&&k(a).html(c);return a},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof k?a:k(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=x(this,"events"))){this.undelegateEvents();
for(var c in a){var d=a[c];b.isFunction(d)||(d=this[a[c]]);if(!d)throw Error('Method "'+a[c]+'" does not exist');var e=c.match(E),g=e[1],e=e[2],d=b.bind(d,this),g=g+(".delegateEvents"+this.cid);""===e?this.$el.bind(g,d):this.$el.delegate(e,g,d)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=b.extend({},this.options,a));for(var c=0,d=A.length;c<d;c++){var e=A[c];a[e]&&(this[e]=a[e])}this.options=a},_ensureElement:function(){if(this.el)this.setElement(this.el,
!1);else{var a=x(this,"attributes")||{};this.id&&(a.id=this.id);this.className&&(a["class"]=this.className);this.setElement(this.make(this.tagName,a),!1)}}});n.extend=s.extend=u.extend=B.extend=function(a,b){var c=D(this,a,b);c.extend=this.extend;return c};var e={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};h.sync=function(a,c,d){var g=e[a];d||(d={});var l={type:g,dataType:"json"};d.url||(l.url=x(c,"url")||C());if(!d.data&&c&&("create"==a||"update"==a))l.contentType="application/json",
l.data=JSON.stringify(c.toJSON());h.emulateJSON&&(l.contentType="application/x-www-form-urlencoded",l.data=l.data?{model:l.data}:{});if(h.emulateHTTP&&("PUT"===g||"DELETE"===g))h.emulateJSON&&(l.data._method=g),l.type="POST",l.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",g)};"GET"!==l.type&&!h.emulateJSON&&(l.processData=!1);return k.ajax(b.extend(l,d))};h.wrapError=function(a,b,c){return function(d,e){e=d===b?e:d;a?a(b,e,c):b.trigger("error",b,e,c)}};var q=function(){},D=function(a,
c,d){var e;e=c&&c.hasOwnProperty("constructor")?c.constructor:function(){a.apply(this,arguments)};b.extend(e,a);q.prototype=a.prototype;e.prototype=new q;c&&b.extend(e.prototype,c);d&&b.extend(e,d);e.prototype.constructor=e;e.__super__=a.prototype;return e},x=function(a,c){return!a||!a[c]?null:b.isFunction(a[c])?a[c]():a[c]},C=function(){throw Error('A "url" property or function must be specified');}}).call(this);function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}window.Store=function(d){this.name=d;this.records=(d=localStorage.getItem(this.name))&&d.split(",")||[]};
_.extend(Store.prototype,{save:function(){localStorage.setItem(this.name,this.records.join(","))},create:function(d){if(!d.id)d.id=d.attributes.id=guid();localStorage.setItem(this.name+"-"+d.id,JSON.stringify(d));this.records.push(d.id.toString());this.save();return d},update:function(d){localStorage.setItem(this.name+"-"+d.id,JSON.stringify(d));_.include(this.records,d.id.toString())||this.records.push(d.id.toString());this.save();return d},find:function(d){return JSON.parse(localStorage.getItem(this.name+
"-"+d.id))},findAll:function(){return _.map(this.records,function(d){return JSON.parse(localStorage.getItem(this.name+"-"+d))},this)},destroy:function(d){localStorage.removeItem(this.name+"-"+d.id);this.records=_.reject(this.records,function(a){return a==d.id.toString()});this.save();return d}});Backbone.remoteSync=Backbone.sync;
Backbone.sync=function(d,a,c,g){"function"==typeof c&&(c={success:c,error:g});var h,b=a.localStorage||a.collection&&a.collection.localStorage;if(!b)return Backbone.remoteSync(d,a,c,g);switch(d){case "read":h=a.id?b.find(a):b.findAll();break;case "create":h=b.create(a);break;case "update":h=b.update(a);break;case "delete":h=b.destroy(a)}h?c.success(h):c.error("Record not found")};window.Modernizr=function(d,a,c){function g(a,b){var c=a.charAt(0).toUpperCase()+a.substr(1),c=(a+" "+n.join(c+" ")+c).split(" ");return h(c,b)}function h(a,b){for(var d in a)if(l[a[d]]!==c)return"pfx"==b?a[d]:!0;return!1}var b={},k=a.documentElement;a.head||a.getElementsByTagName("head");var m=a.createElement("modernizr"),l=m.style,d=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),n="Webkit Moz O ms Khtml".split(" "),m={},s=[],u=function(b,c,d,g){var h,e,l=a.createElement("div");if(parseInt(d,10))for(;d--;)e=
a.createElement("div"),e.id=g?g[d]:"modernizr"+(d+1),l.appendChild(e);h=["&shy;<style>",b,"</style>"].join("");l.id="modernizr";l.innerHTML+=h;k.appendChild(l);b=c(l,b);l.parentNode.removeChild(l);return!!b},o,z={}.hasOwnProperty,v;typeof z!==c&&typeof z.call!==c?v=function(a,b){return z.call(a,b)}:v=function(a,b){return b in a&&typeof a.constructor.prototype[b]===c};(function(a,c){var d=a.join(""),g=c.length;u(d,function(a){for(var a=a.childNodes,c={};g--;)c[a[g].id]=a[g];b.csstransforms3d=9===c.csstransforms3d.offsetLeft},
g,c)})([,["@media (",d.join("transform-3d),("),"modernizr){#csstransforms3d{left:9px;position:absolute}}"].join("")],[,"csstransforms3d"]);m.csstransforms=function(){return!!h(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])};m.csstransforms3d=function(){var a=!!h(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);a&&"webkitPerspective"in k.style&&(a=b.csstransforms3d);return a};m.csstransitions=function(){return g("transitionProperty")};
for(var t in m)v(m,t)&&(o=t.toLowerCase(),b[o]=m[t](),s.push((b[o]?"":"no-")+o));l.cssText="";m=null;b._version="2.0.6";b._prefixes=d;b._domPrefixes=n;b.testProp=function(a){return h([a])};b.testAllProps=g;b.testStyles=u;return b}(this,this.document);"undefined"==typeof CFW&&(CFW={});"undefined"==typeof CFW_OPTIONS&&(CFW_OPTIONS={});CFW.domain=/[.]local/.test(window.location.host)||/rinkl/.test(window.location.host)||/squatc/.test(window.location.host)?"http://tameron.herokuapp.com":"http://cfwhiteboard.com";CFW.important=jQuery.important.noConflict();CFW.oxygenTank=function(){var d=Array.prototype.slice.call(arguments),a=d.pop(),d=_.reduceRight(d,function(a,d){return"undefined"!=typeof a?a[d]:a},d.shift());return"undefined"!=typeof d?d:a};
CFW.ajaxOptions=!jQuery.browser.msie||!window.XDomainRequest?{}:{xhr:function(){try{var d=new XDomainRequest;d.timeout=5E3;var a;d.getAllResponseHeaders=function(){return""};var c=function(b,c){d.onload=d.onerror=d.ontimeout=jQuery.noop;d.status=b;d.statusText=c;d.readyState=4;if(a)d.responseText=a.responseText;d.onreadystatechange&&d.onreadystatechange()},g=function(){a=new XDomainRequest;a.timeout=d.timeout;a.onload=d.onload;a.onerror=d.onerror;a.ontimeout=d.ontimeout;a.open(d.openArgs[0],d.openArgs[1]);
a.send(d.sendArgs[0])};d.onload=function(){c(200,"OK")};d.onerror=function(){a?c(400,"Error"):g()};d.ontimeout=function(){a?c(0,"timeout"):g()};d.originalOpen=d.open;d.open=function(a,c){"PUT"===a?(c+="/revise",a="POST"):"DELETE"===a&&(c+="/annihilate",a="POST");d.openArgs=[a,c];d.originalOpen(a,c)};d.originalSend=d.send;d.send=function(a){var c=function(a){for(var b in a)a[b]="object"==typeof a[b]?c(a[b]):encodeURIComponent(a[b]);return a},a=JSON.stringify(c(JSON.parse(a)));d.sendArgs=[a];setTimeout(function(){d.originalSend(a)},
0)};return d}catch(h){return jQuery.ajaxSettings.xhr()}}};
jQuery(function(d){d(document.embeds).each(function(){var a=d(this);setTimeout(function(){var c=!1,g=a.attr("wmode");"opaque"!=g&&"transparent"!=g&&(a.attr("wmode","opaque"),c=!0);var h=a.closest("object"),g=h.children("param[name=wmode]").val();"opaque"!=g&&"transparent"!=g&&(h.prepend(d('<param name="wmode" value="opaque" />')),c=!0);c&&(h=h.length?h:a,c=h.wrap(d('<span class="cfw-placeholder" />')),c.html(c.html()),c.children().unwrap())},d.browser.msie?300:0)});d("iframe").each(function(){/youtube/.test(this.src)&&
(this.src+=(0<=this.src.indexOf("?")?"&":"?")+"wmode=opaque")})});jQuery(function(d){d.fn.bindBefore=function(a,c){a=a.split(/\s+/);this.each(function(){for(var g=a.length;g--;){d(this).bind(a[g],c);var h=d.data(this,"events")[a[g]];h.splice(0,0,h.pop())}})};d.fn.oneBefore=function(a,c){a=a.split(/\s+/);this.each(function(){for(var g=a.length;g--;){d(this).one(a[g],c);var h=d.data(this,"events")[a[g]];h.splice(0,0,h.pop())}})}});
jQuery(function(d){if(!Modernizr.csstransitions)Modernizr.csstransforms=!1,Modernizr.csstransforms3d=!1;if(/AppleWebKit/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent))Modernizr.csstransforms3d=!1;if(d.browser.msie&&window.XDomainRequest)jQuery.support.cors=!0;CFW.User=Backbone.Model.extend({defaults:function(){return{email:"",known_as:"",count:0,highlightColor:CFW.User.prototype.randomColor()}},randomColor:function(){return[[255,75,105],[255,105,75],[75,105,255],[105,75,255],[75,
255,105],[105,255,75],[123,6,226],[226,6,123],[6,226,123],[6,123,226]][Math.floor(10*Math.random()+0)]}});CFW.UserList=Backbone.Collection.extend({model:CFW.User,initialize:function(){this.localStorage=new Store("cfw-users");return this},comparator:function(a){return-a.get("count")}});CFW.users=new CFW.UserList;CFW.users.fetch();CFW.Entry=Backbone.Model.extend({idAttribute:"_id",defaults:{athlete_id:"",known_as:"",email:"",component_results:[],notes:"",facebook_url:""},emailRegex:/^\S+@\S+\.\S+$/,
validate:function(a){var c=[];!(a.athlete_id||this.attributes&&this.get("athlete_id"))&&!this.emailRegex.test(a.email)&&c.push("email");_.each(a.component_results,function(a){(!a.result||!a.result.length)&&c.push("component-"+a.wp_id+"-result")});(!a.known_as||!a.known_as.replace(/^\s+/,"").replace(/\s+$/,"").length)&&c.push("known_as");if(c.length)return c},setUrlHash:function(){if(this.collection&&this.collection.postId&&this.collection.wod&&this.collection.wod.wp_id){var a="cfwhiteboard-"+this.collection.postId+
"-"+this.collection.wod.wp_id+"-"+this.get("athlete_slug");d(document.body).append(d('<span id="'+a+'" style="position:absolute; top:'+d(document.body).scrollTop()+'px; display:none;"></span>'));window.location.hash=a}}});CFW.EntryList=Backbone.Collection.extend({model:CFW.Entry,url:function(){return CFW.domain+"/affiliates/"+this.affiliateId+"/wods/"+this.postId+"/"+this.wod.wp_id+"/posts"},initialize:function(a,c){this.affiliateId=c.affiliateId;this.postId=c.postId;this.wod=c.wod;return this},comparator:function(a){return a.get("known_as").replace(/^\s+/,
"").toLowerCase()}});CFW.EntryItemView=Backbone.View.extend({tagName:"tr",template:_.template('            <td class="cfw-known-as">                <a href="'+CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink","")+'<%- athlete_slug %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash"><%- known_as %></a>            </td>            <%             if (wod.components && wod.components.length > 1) {                _.each(wod.components, function(component, i, components) {                    var componentResult = _.find(component_results, function(cr) {                        return cr.wp_id == component.wp_id;                    }) || {                        result: "",                        rx: false,                        mods: ""                    };                    var isLast = (i + 1 == components.length);                    %>                     <td class="cfw-component" title="<%- componentResult.result %><%- componentResult.rx ? " [Rx]" : "" %><%- componentResult.mods ? " ("+componentResult.mods+")" : "" %>">                        <%= isLast ? "<div>" : "" %>                        <span class="cfw-result"><%- componentResult.result %></span>                        <span class="cfw-mods">                            <%= componentResult.rx ? "<strong>Rx</strong>" : "" %>                            <%- componentResult.mods %>                        </span>                        <% if (isLast) { %>                            <% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %>                            <span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                        <% } %>                        <%= isLast ? "</div>" : "" %>                    </td>                <%                 });            } else {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == (wod.components[0] || {wp_id: "uh oh"}).wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                 <td class="cfw-result" title="<%- componentResult.result %>"><%- componentResult.result %></td>                <td class="cfw-mods" title="<%- componentResult.rx ? "[Rx] " : "" %><%- componentResult.mods %>">                    <div>                        <%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %><% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %><span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                    </div>                </td>            <%             }            %>         '),
events:{"click *:not(a, a *)":"showDetail","click .cfw-set-url-hash":"setUrlHash"},initialize:function(){this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this);this.model.on("show",this.lookSelected,this);this.model.on("unshow",this.unlookSelected,this);this.model.on("highlight",this.highlight,this);return this.render()},render:function(){this.$el.html(this.template(_.extend({wod:this.options.wod},this.model.toJSON())));return this},lookSelected:function(){this.$el.addClass("cfw-selected")},
unlookSelected:function(){this.$el.removeClass("cfw-selected")},highlight:function(){this.$el.addClass("cfw-highlighted").trigger("scrollToEntry");if(Modernizr.csstransitions)this.$el.addClass("cfw-highlighted-transition").removeClass("cfw-highlighted").one("mouseenter touchstart",function(){d(this).removeClass("cfw-highlighted-transition")});else{var a=this.$el,c=function(){a.toggleClass("cfw-highlighted")};setTimeout(c,300);setTimeout(c,600);setTimeout(c,900);setTimeout(c,1200);setTimeout(function(){a.removeClass("cfw-highlighted")},
1500)}},showDetail:function(a){this.itemClickDisabled||(a.stopPropagation(),this.model.trigger("show",this.model))},setUrlHash:function(){this.model.setUrlHash()}});CFW.WhiteboardPage=Backbone.View.extend({tagName:"div",className:"cfw-page",show:function(){this.$el.addClass("active");var a=this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),a.scrollbarReady=!0;a.showScrollbar()},Modernizr.csstransitions?400:0)},hide:function(){this.freezeScrollbar();this.$el.removeClass("active");var a=
this;setTimeout(function(){a.hideScrollbar();a.thawScrollbar();a.$el.trigger("cfwhide")},Modernizr.csstransitions?300:0)},initScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("show")},hideScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("hide")},freezeScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("freeze")},
thawScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("thaw")}});CFW.EntryListView=CFW.WhiteboardPage.extend({template:_.template('            <table class="cfw-components-<%= wod.components && wod.components.length || 1 %>" cellspacing="0">                <thead>                    <tr>                        <th class="cfw-known-as">Name</th>                        <% _.each(wod.components, function(component) { %>                            <th class="cfw-component" <%= wod.components.length == 1 ? \'colspan="2"\' : "" %> title="<%- component.description %>"><%- component.label %></th>                        <% }); %>                    </tr>                </thead>            </table>            <div class="cfw-scrollable">                <table cellspacing="0" class="cfw-components-<%= wod.components && wod.components.length || 1 %>">                    <tbody>                    </tbody>                </table>            </div>        '),
events:{"scrollToEntry tr":"scrollToEntry","touchmove .cfw-scrollable":"disableItemClicks","touchstart .cfw-scrollable":"enableItemClicks"},initialize:function(a){this.entries=a.entries;this.wod=a.wod;this.entryItemViews=[];this.entries.on("add change:known_as remove reset",this.addAll,this);return this.render()},render:function(){this.$el.html(this.template({wod:this.wod}));return this},addOne:function(a){a=new CFW.EntryItemView({model:a,wod:this.wod});this.entryItemViews.push(a);this.$("tbody").append(a.el)},
addAll:function(){_.each(this.entryItemViews,function(a,c,d){a.remove();delete d[c]});this.$("tbody").empty();this.entries.length?this.entries.each(this.addOne,this):this.$("tbody").append(d('                    <tr class="cfw-no-entries">                        <td colspan="100">No one has added an entry yet.<br /><a class="cfw-new-entry">Add yours now!<a></td>                    </tr>                '))},show:function(){var a=this.$("table").attr("class"),c=this.$el.closest(".cfw-contents");setTimeout(function(){c.addClass(a).data("componentsclass",
a);c.siblings(".cfw-classes").addClass(a)},Modernizr.csstransitions?300:0);CFW.WhiteboardPage.prototype.show.apply(this,arguments)},hide:function(){var a=this.$("table").attr("class");this.$el.closest(".cfw-contents").removeClass(a).removeData("componentsclass").siblings(".cfw-classes").removeClass(a);CFW.WhiteboardPage.prototype.hide.apply(this,arguments)},scrollToEntry:function(a){var c=this.$(".cfw-scrollable").scrollTop(0);(a=d(a.target).position())&&a.top&&c.scrollTop(a.top-15-(c.height()||0)/
2)},disableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!0})},enableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!1})}});CFW.EntryDetailView=CFW.WhiteboardPage.extend({template:_.template('            <div class="cfw-entry-detail">                <a class="cfw-back">back</a><a class="cfw-edit">edit</a>                <dl class="cfw-scrollable">                    <dt class="cfw-hidden">Name</dt>                    <dd class="cfw-known-as">                        <%- known_as %>                        <a href="'+
CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink","")+'<%- athlete_slug %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash">view profile</a>                    </dd>                    <%                    _.each(wod.components, function(component) {                        var componentResult = _.find(component_results, function(cr) {                            return cr.wp_id == component.wp_id;                        }) || {                            result: "",                            rx: false,                            mods: ""                        };                    %>                        <dt><%= component.label %></dt>                        <dd class="cfw-component">                            <span class="cfw-result"><%- componentResult.result %></span>                            <span class="cfw-mods"><%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %></span>                        </dd>                    <%                    });                    %>                    <dt>Notes</dt>                    <dd class="cfw-notes"><%- notes || "(no data)" %></dd>                </dl>            </div>        '),
events:{"click .cfw-set-url-hash":"setUrlHash","click a.cfw-edit":"edit","click a.cfw-back":"back",cfwhide:"cleanup"},initialize:function(a){this.wod=a.wod;this.model.on("change",this.render,this);this.model.on("change",function(){var a=this;setTimeout(function(){a.initScrollbar();a.showScrollbar()},300)},this);this.model.on("destroy",this.hide,this);return this.render()},render:function(){this.$el.html(this.template(_.extend({wod:this.wod},this.model.toJSON())));return this},setUrlHash:function(){this.model.setUrlHash()},
edit:function(){this.model.trigger("edit",this.model)},back:function(){this.$el.trigger("hideEntryDetails")},cleanup:function(){var a=this;setTimeout(function(){a.model.trigger("unshow",a.model);a.remove()},0)}});CFW.ModalPage=Backbone.View.extend({tagName:"div",className:"cfw-scrollable cfw-modal",events:{"focus :input":"scrollToInput","click .cfw-close-modal":"remove"},initScrollbar:function(){this.$el.scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},
hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$el.scrollbarPaper("show")},hideScrollbar:function(){this.$el.scrollbarPaper("hide")},freezeScrollbar:function(){this.$el.scrollbarPaper("freeze")},thawScrollbar:function(){this.$el.scrollbarPaper("thaw")},scrollToInput:function(a){if(!this.height)this.height=this.$el.parent().height();(a=(d(a.target).position()||{}).top)&&this.$el.animate({scrollTop:a+this.$el.scrollTop()-this.height/2},300)},show:function(){var a=this.$el.closest(".cfw-contents"),
c=a.data("componentsclass");c&&(a.removeClass(c),a.siblings(".cfw-classes").removeClass(c));var d=this;setTimeout(function(){d.$el.addClass("cfw-translate-oldfashioned")},0);setTimeout(function(){if(!d.scrollbarReady)d.initScrollbar(),d.scrollbarReady=!0;d.showScrollbar();var a=d.$el.find(":input:first")[0];a&&a.focus&&a.focus()},Modernizr.csstransitions?400:0)},remove:function(a){this.freezeScrollbar();var c=this,d=this.$el.closest(".cfw-contents");this.$el.removeClass("cfw-translate-oldfashioned");
setTimeout(function(){c.hideScrollbar();var h=d.data("componentsclass");h&&(d.addClass(h),d.siblings(".cfw-classes").addClass(h));"object"==typeof a&&a.silent?c.$el.remove():c.$el.trigger("cfwremove").remove()},Modernizr.csstransitions?300:0)}});CFW.EntryFormView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <\!--<h2><%= new_record ? "Add Your Entry" : "Edit Your Entry" %></h2>--\>                <h2><label for="cfw-email">Email Address</label></h2>                <input type="hidden" name="<%= new_record ? "decoy" : "email" %>" value="<%- email %>" />                <input type="email" id="cfw-email" name="<%= new_record ? "email" : "decoy" %>" placeholder="name@example.com" <%= new_record ? "" : \'value="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" disabled="disabled"\' %> />            </fieldset>            <fieldset>                <h2><label for="cfw-known-as">Name</label></h2>                <input type="text" id="cfw-known-as" name="known_as" placeholder="Guest" value="<%- known_as %>" />            </fieldset>            <%            _.each(wod.components, function(component) {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == component.wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                <fieldset>                    <h2><label for="cfw-component-<%= component.wp_id %>-result"><%= component.label %></label></h2>                    <input type="text" id="cfw-component-<%= component.wp_id %>-result" name="component-<%= component.wp_id %>-result" placeholder="What was your result?" value="<%- componentResult.result %>" />                    <div class="cfw-nobr">                        <label for="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority">Modifications</label>                    </div>                    <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                        <input type="checkbox" id="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority" name="component-<%= component.wp_id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                        /><span>or</span><input type="text" id="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority" name="component-<%= component.wp_id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                    </div>                </fieldset>            <%            });            %>            <fieldset class="cfw-last">                <div class="cfw-notes <%= notes ? "cfw-open cfw-opaque" : "" %>">                    <h2><label for="cfw-notes">Notes</label></h2>                    <textarea rows="3" id="cfw-notes" name="notes" placeholder="Notes or Tips for next time?"><%- notes %></textarea>                </div>                <div class="cfw-footer">                    <a class="cfw-add-notes <%= notes ? "cfw-hidden" : "" %>"><label for="cfw-notes"><strong>+</strong> add notes</label></a>                    <input type="submit" value="<%= new_record ? "Submit" : "Save" %>" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:d.extend({},CFW.ModalPage.prototype.events,{'keyup input[name="email"]':"guessName",'change input[name="email"]':"guessName",'blur input[name="known_as"]':"guessName","click .cfw-add-notes":"showNotesFields",submit:"save"}),initialize:function(a){this.entries=a.entries;this.wod=a.wod;return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(_.extend({wod:this.wod,new_record:!this.model},(this.model||new CFW.Entry).toJSON())));return this},guessName:function(){var a=
this.$('input[name="email"]'),c=this.$('input[name="known_as"]');if(!(c.val().length&&this.lastGuess&&c.val()!=this.lastGuess||c.val().length&&!this.lastGuess)){var d=CFW.users.find(function(c){return c.get("email").toLowerCase()==a.val().toLowerCase()});if(d)c.val(this.lastGuess=d.get("known_as"));else{d=a.val();if(!_.capitalize)_.capitalize=function(a){return a.substring(0,1).toUpperCase()+a.substring(1)};this.lastGuess=_.capitalize((/[^.@0-9]+/.exec(d)||[""])[0]);c.val(this.lastGuess)}}},showNotesFields:function(){var a=
this.$(".cfw-notes").addClass("cfw-open"),c=this.$(".cfw-add-notes").addClass("cfw-transparent");setTimeout(function(){a.addClass("cfw-opaque");c.addClass("cfw-hidden")},Modernizr.csstransitions?200:0)},save:function(a){a.preventDefault();if(!this.isLoading()){var c={email:this.$('input[name="email"]').val(),known_as:this.$('input[name="known_as"]').val(),component_results:[],notes:this.$('textarea[name="notes"]').val()},g={};this.$('input[name^="component-"]').each(function(){var a=d(this),c=a.attr("name").split("-"),
a="checkbox"==a.attr("type")?a.is(":checked"):a.val();g[c[1]]||(g[c[1]]={wp_id:c[1]});g[c[1]][c[2]]=a});_.each(g,function(a){c.component_results.push(a)});var h=this,a=this.model?function(){h.hideLoading();h.remove()}:function(a){h.hideLoading();h.$el.trigger("showEntryShare",a)};h.showLoading();h.$(".ajax-error-notice").remove();a=d.extend({},CFW.ajaxOptions,{success:a,error:function(a,c){h.hideLoading();c&&c.length?h.showValidationErrors(c):h.$(".cfw-footer").after(d('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Click <strong>'+
h.$('input[type="submit"]').val()+"</strong> to try again or contact athlete support if the problem persists.</label>"))},wait:!0});this.model?this.model.save(c,a):this.entries.create(c,a)||this.showValidationErrors(CFW.Entry.prototype.validate(c))}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},
showValidationErrors:function(a){var c=this;_.each(a,function(a){c.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){d('label[for="'+d(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){d(this).removeClass("cfw-invalid");d('label[for="'+d(this).attr("id")+'"]').removeClass("cfw-invalid")})})}});CFW.EmailAuthView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <h2><label for="cfw-email" title="Enter <%- known_as %>&apos;s Email to Edit" style="white-space:normal;">Enter <%= known_as %>&apos;s Email to Edit</label></h2>                <input type="email" id="cfw-email" name="email" placeholder="name@example.com" value="" />            </fieldset>            <fieldset class="cfw-last">                <div class="cfw-footer">                    <input type="submit" value="Unlock" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:d.extend({},CFW.ModalPage.prototype.events,{submit:"submit"}),initialize:function(){return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(this.model.toJSON()));return this},submit:function(a){a.preventDefault();if(!this.isLoading()){var c=this.$('input[name="email"]').val(),g=this;g.showLoading();g.$(".ajax-error-notice").remove();a=d.extend({},CFW.ajaxOptions,{complete:function(){g.hideLoading()},success:function(){g.options.success(c)},
error:function(){g.showValidationErrors(["email"]);g.$(".cfw-footer").after(d('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! That email doesn&apos;t match. Please try again or contact <a href="mailto:athletesupport@cfwhiteboard.com">athlete support</a> if there&apos;s any way we can help.</label>'))},type:"POST",data:JSON.stringify({email:c}),cache:!1});d.ajax(CFW.domain+"/athletes/"+this.model.get("athlete_id")+"/verify_email",a)}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},
isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){var c=this;_.each(a,function(a){c.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){d('label[for="'+d(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){d(this).removeClass("cfw-invalid");d('label[for="'+d(this).attr("id")+'"]').removeClass("cfw-invalid")})})}});
CFW.EntryShareView=CFW.ModalPage.extend({template:_.template('            <div class="cfw-facebook-card">                <p>                    <a href="<%- fbShareUrl %>" class="cfw-fb-action cfw-set-url-hash cfw-close-modal">Share on Facebook</a>                </p>                <p>                    <a href="javascript://" class="cfw-fb-inaction cfw-close-modal">Not this time</a>                </p>                <div class="cfw-fb-footer"></div>                <div class="cfw-fb-logo"></div>            </div>            <p class="cfw-facebook-links">                <a href="javascript://" class="cfw-never-again cfw-close-modal">Don\'t show this message again on this computer</a>            </p>        '),
events:d.extend({},CFW.ModalPage.prototype.events,{"click .cfw-never-again":"neverAgain","click .cfw-set-url-hash":"setUrlHash"}),initialize:function(){return this.render()},render:function(){this.$el.html(this.template({fbShareUrl:this.model.url()+"/share"}));return this},setUrlHash:function(){this.model.setUrlHash()},neverAgain:function(){d.cookie("CFW",d.extend(d.cookie("CFW"),{no_facebook_share_dialog:!0}),{expires:365,path:"/"})}});CFW.WhiteboardView=Backbone.View.extend({className:"cfw-pane",
template:_.template('            <div>                <div class="cfw-window">                    <h2>Entries</h2>                    <a class="cfw-new-entry">+</a>                    <ul class="cfw-classes cfw-<%- allWods.length || 1 %>-classes cfw-components-<%= wod.components && wod.components.length || 1 %>">                        <%                        _.each(allWods, function(w) {                            %><li class="<%- w.wp_id == wod.wp_id ? "cfw-selected" : "" %>"><div>                                <a href="javascript://" data-wp_id="<%- w.wp_id %>" title="<%- w.name %>">                                    <span class="cfw-centered">                                        <span class="cfw-entry-count" data-wp_id="<%- w.wp_id %>"></span>                                        <span class="cfw-link-text"><%- w.name %></span>                                    </span>                                    <span class="cfw-separator"></span>                                </a>                            </div></li><%                        });                        %>                    </ul>                    <div class="cfw-contents"></div>                    <div class="cfw-footer">                        <a href="http://cfwhiteboard.com" target="_blank">                            What Is This?                        </a><a href="mailto:athletesupport@cfwhiteboard.com">                            Email Athlete Support                        </a>                    </div>                </div>            </div>            <a class="cfw-print cfw-admin-tool cfw-hidden" target="_blank">Print</a>        '),
events:{"click .cfw-new-entry:not([disabled])":"newEntry",hideEntryDetails:"hideEntry","cfwremove .cfw-modal":"cleanupModal",showEntryShare:"showEntryShare","click .cfw-classes a":"returnToEntryList"},initialize:function(a){this.entries=new CFW.EntryList([],{affiliateId:a.affiliateId,postId:a.postId,wod:a.wod});this.entries.on("add remove reset",this.newEntryCount,this);this.entries.on("edit",this.editEntry,this);this.entries.on("show",this.showEntry,this);this.entries.on("add change:known_as",this.updateUsers,
this);this.render();a.hidden&&this.hide();this.entries.fetch(d.extend({},CFW.ajaxOptions,{data:{postModified:a.postModified}}))},render:function(){this.$el.html(this.template({wod:this.options.wod,allWods:this.options.allWods}));this.entryListView=new CFW.EntryListView({entries:this.entries,wod:this.options.wod});this.$(".cfw-contents").append(this.entryListView.el);this.entryListView.show();"admin"==this.options.authorization&&(this.$(".cfw-print").attr("href",this.entries.url()),this.$(".cfw-admin-tool").removeClass("cfw-hidden"));
return this},attach:function(){this.$children&&this.$el.append(this.$children)},detach:function(){this.$children=this.$el.children();this.$children.detach()},show:function(){this.$el.removeClass("cfw-hidden")},hide:function(){this.$el.addClass("cfw-hidden")},newEntry:function(){this.showEntryForm()},editEntry:function(a){var c=this;this.showEmailAuth(a,function(d){c.modalView.remove({silent:!0});a.set({email:d},{silent:!0});c.showEntryForm(a)})},highlightEntry:function(a){var c=this,d=function(){(c.entries.get(a)||
c.entries.find(function(c){return c.get("athlete_slug")==a})).trigger("highlight")};if(this.entries.length)d();else this.entries.on("reset",d)},showEmailAuth:function(a,c){this.disableNewEntries();this.modalView=new CFW.EmailAuthView({model:a,success:c});this.$(".cfw-contents").append(this.modalView.el);var d=this;setTimeout(function(){d.detailView?d.detailView.hideScrollbar():d.entryListView.hideScrollbar();d.modalView.show()},0)},showEntryForm:function(a){this.modalView=new CFW.EntryFormView({entries:this.entries,
model:a,wod:this.options.wod});this.$(".cfw-contents").append(this.modalView.el);var c=this;setTimeout(function(){a||(c.detailView?c.detailView.hideScrollbar():c.entryListView.hideScrollbar());c.disableNewEntries();c.modalView.show()},0)},showEntryShare:function(a,c){var g=d.cookie("CFW");if(g&&g.no_facebook_share_dialog)this.modalView.remove();else{this.modalView.remove({silent:!0});this.modalView=new CFW.EntryShareView({model:c,wod:this.options.wod,postId:this.options.postId,postPermalink:this.options.postPermalink});
this.$(".cfw-contents").append(this.modalView.el);var h=this;setTimeout(function(){h.modalView.show()},0)}},cleanupModal:function(){this.enableNewEntries();this.detailView?this.detailView.showScrollbar():this.entryListView.showScrollbar();delete this.modalView},disableNewEntries:function(){this.$el.find(".cfw-new-entry").attr("disabled",!0)},enableNewEntries:function(){this.$el.find(".cfw-new-entry").removeAttr("disabled")},showEntry:function(a){this.detailView=new CFW.EntryDetailView({model:a,wod:this.options.wod});
this.$(".cfw-contents").append(this.detailView.el);var c=this;setTimeout(function(){c.entryListView.hide();c.detailView.show()},0)},hideEntry:function(){this.detailView.hide();this.entryListView.show();var a=this;setTimeout(function(){delete a.detailView},Modernizr.csstransitions?400:100)},newEntryCount:function(){this.$el.trigger("newEntryCount",[this.options.wod.wp_id,this.entries.length])},updateEntryCount:function(a,c){var g=this.$(".cfw-entry-count");0==g.length&&(g=this.$children.find(".cfw-entry-count"));
1<g.length&&g.each(function(){var g=d(this);g.data("wp_id")==a&&g.text(c).attr("title",""+c+" entries")})},updateUsers:function(a){var c=CFW.users.find(function(c){return c.get("email").toLowerCase()==a.get("email").toLowerCase()});c?c.save({known_as:a.get("known_as"),count:c.get("count")+1}):c=CFW.users.create({email:a.get("email"),known_as:a.get("known_as"),count:1})},returnToEntryList:function(){this.modalView?this.modalView.remove():this.detailView&&this.hideEntry()}});CFW.WhiteboardButtonView=
Backbone.View.extend({template:_.template('            <h1>Whiteboard <span class="cfw-entry-count-all cfw-hidden"></span></h1>        '),events:{"click h1":"toggleWhiteboard","click .cfw-classes a":"showClass","newEntryCount .cfw-pane":"updateEntryCounts","mouseenter h1":"hoverButton","mouseleave h1":"unhoverButton"},initialize:function(){var a=this.$el.data("cfwhiteboard");this.affiliateId=a.affiliateId;this.postId=a.postId;this.postPermalink=a.postPermalink;this.postModified=a.postModified;this.wods=
a.wods;this.authorization=this.$el.data("authorization");return-1<_.indexOf(_.pluck(CFW.instances,"postId"),this.postId)?void 0:this.render()},render:function(){if("embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1)&&1<this.$el.length){this.$el.first().replaceWith(this.$el.last().addClass("cfw-display-embed"));var a=d("<div />").addClass("cfw-clearer");this.$el.last().parent().append(a)}this.$el.first().html(this.template());this.positionWhiteboard();this.whiteboardViews={};var c=this;_.each(c.wods,
function(a,d){a.name=a.name.replace(/workout of the day/ig,"WOD");var b=new CFW.WhiteboardView({affiliateId:c.affiliateId,postId:c.postId,postPermalink:c.postPermalink,postModified:c.postModified,wod:a,allWods:c.wods,authorization:c.authorization,hidden:0==d?!1:!0});c.$el.last().append(b.el);c.whiteboardViews[a.wp_id]=b;setTimeout(function(){b.detach()},0)});return this},hoverButton:function(){this.$el.first().find("h1").addClass("cfw-hovering");this.attachWhiteboard();this.positionWhiteboard()},
unhoverButton:function(a){this.$el.first().find("h1").removeClass("cfw-hovering");this.detachWhiteboard(a)},attachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")||(this.$el.first().addClass("cfw-attached"),_.each(this.whiteboardViews,function(a){a.attach()}))},detachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")&&!this.$el.first().hasClass("cfw-active")&&!this.$el.first().find("h1").hasClass("cfw-hovering")&&(this.$el.first().removeClass("cfw-attached"),_.each(this.whiteboardViews,
function(a){a.detach()}))},toggleWhiteboard:function(a){this.$el.is(".cfw-active")?this.closeWhiteboard():this.openWhiteboard();a.preventDefault()},openWhiteboard:function(){this.$el.addClass("cfw-active").removeClass("cfw-postactive")},closeWhiteboard:function(){this.$el.addClass("cfw-postactive").removeClass("cfw-active");var a=this;setTimeout(function(){a.$el.removeClass("cfw-postactive");a.detachWhiteboard()},Modernizr.csstransitions?300:0)},positionWhiteboard:function(){if("embed"==CFW.oxygenTank(CFW_OPTIONS,
"position","display",!1))this.$el.last().addClass("cfw-active");else if(this.$el.last().parent().is("body")){var a=this.$el.first().offset(),c={position:"absolute",margin:"0",top:a.top+"px"};this.$el.last().is(".position-inline, .position-block, .position-floatleft")?c.left=a.left+"px":(c.right=d(document).width()-this.$el.first().outerWidth(!1)-a.left,c.right+="px");CFW.important.css.apply(this.$el.last(),[c,!0])}},showClass:function(a){var c=a.target?d(a.target).closest("a").data("wp_id"):a;_.each(this.whiteboardViews,
function(a,d){d==c?a.show():a.hide()})},updateEntryCounts:function(a,c,d){this.whiteboardViews[c.toString()].entryCount=d;_.each(this.whiteboardViews,function(a){a.updateEntryCount(c,d)});a=_.inject(this.whiteboardViews,function(a,b){return a+(b.entryCount||0)},0);this.$(".cfw-entry-count-all").text(a).attr("title",""+a+" entries").removeClass("cfw-hidden")}});CFW.instances=[];setTimeout(function(){d(".cfwhiteboard").each(function(){var a=d(this),g=a.closest("a");g.length&&g.before(a);if(!1!=CFW.oxygenTank(CFW_OPTIONS,
"position",!1)){g=a.closest(CFW_OPTIONS.position.parent).find(CFW_OPTIONS.position.target);if(g.length)switch(CFW_OPTIONS.position.insertion){case "append":g.append(a);break;case "before":g.before(a);break;case "after":g.after(a);break;default:g.prepend(a)}switch(CFW_OPTIONS.position.alignment){case "inline":a.addClass("position-inline");break;case "block":a.addClass("position-block");break;case "floatleft":a.addClass("position-floatleft")}CFW_OPTIONS.position.margin&&CFW.important.css.apply(a,[{margin:CFW_OPTIONS.position.margin},
!0])}a=a.add(a.clone().appendTo(document.body));CFW.instances.push(new CFW.WhiteboardButtonView({el:a}))});"embed"!=CFW.oxygenTank(CFW_OPTIONS,"position","display",!1)&&(_.each(CFW.instances,function(a){a.$el.on("click",function(a){a.stopPropagation()})}),d(document.body).on("click",function(){_.each(CFW.instances,function(a){a.closeWhiteboard()})}));if(0==window.location.hash.indexOf("#cfwhiteboard")){var a=window.location.hash.split("-");_.each(CFW.instances,function(c){if(c.postId==a[1]){a[2]&&
c.showClass(a[2]);var g=c.$el.offset().top-100;d(document.body).append(d('<span id="'+window.location.hash.replace(/^#/,"")+'" style="position:absolute; top:'+g+'px; display:none;"></span>'));d("html, body").animate({scrollTop:g},800,function(){c.attachWhiteboard();c.openWhiteboard();a[2]&&a[3]&&c.whiteboardViews[a[2]].highlightEntry(a[3])})}})}},d.browser.msie?1500:0)});
