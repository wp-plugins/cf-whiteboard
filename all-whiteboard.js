var JSON;JSON||(JSON={});
(function(){function c(a){return 10>a?"0"+a:a}function a(a){h.lastIndex=0;return h.test(a)?'"'+a.replace(h,function(a){var c=m[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(c,g){var h,o,m,v,t=e,q,p=g[c];p&&"object"===typeof p&&"function"===typeof p.toJSON&&(p=p.toJSON(c));"function"===typeof k&&(p=k.call(g,c,p));switch(typeof p){case "string":return a(p);case "number":return isFinite(p)?""+p:"null";case "boolean":case "null":return""+p;
case "object":if(!p)return"null";e+=j;q=[];if("[object Array]"===Object.prototype.toString.apply(p)){v=p.length;for(h=0;h<v;h+=1)q[h]=b(h,p)||"null";m=0===q.length?"[]":e?"[\n"+e+q.join(",\n"+e)+"\n"+t+"]":"["+q.join(",")+"]";e=t;return m}if(k&&"object"===typeof k){v=k.length;for(h=0;h<v;h+=1)"string"===typeof k[h]&&(o=k[h],(m=b(o,p))&&q.push(a(o)+(e?": ":":")+m))}else for(o in p)Object.prototype.hasOwnProperty.call(p,o)&&(m=b(o,p))&&q.push(a(o)+(e?": ":":")+m);m=0===q.length?"{}":e?"{\n"+e+q.join(",\n"+
e)+"\n"+t+"}":"{"+q.join(",")+"}";e=t;return m}}if("function"!==typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var g=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,j,m={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;if("function"!==typeof JSON.stringify)JSON.stringify=function(a,c,g){var h;j=e="";if("number"===typeof g)for(h=0;h<g;h+=1)j+=" ";else"string"===typeof g&&(j=g);if((k=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return b("",
{"":a})};if("function"!==typeof JSON.parse)JSON.parse=function(a,c){function b(a,g){var e,h,k=a[g];if(k&&"object"===typeof k)for(e in k)Object.prototype.hasOwnProperty.call(k,e)&&(h=b(k,e),void 0!==h?k[e]=h:delete k[e]);return c.call(a,g,k)}var e,a=""+a;g.lastIndex=0;g.test(a)&&(a=a.replace(g,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"===typeof c?b({"":e},""):e;throw new SyntaxError("JSON.parse");}})();(function(c){function a(a,g,b){var e,b=b||"",h=b.match(RegExp("(?:^|\\s|;)("+a+")\\s*:\\s*([^;]*(?:;|$))","i"));h&&(h[0]=h[0].replace(/^;/,""));null===g?e="":"string"===typeof g&&(e=a+":"+g+" !important;");h?("boolean"===typeof g&&(e=c.important(a+":"+h[2],g)),b=b.replace(h[0],e)):"undefined"!==typeof e&&(b=c.trim(b),""!==b&&(";"!==b.slice(-1)&&(b+=";"),b+=" "),b+=e);return b}function b(a,c){var g=b.re;if(!g)g=b.re=/\s*(! ?important)?[\s\r\t\n]*;/g;return!1===c?a.replace(g,";"):a.replace(g,function(a,
c){return c?a:" !important;"})}function g(a,c){var e=g.re;if(!e)e=g.re=/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g;return a.replace(e,function(a,g){return b(g,c)})}var h=!1,e={},j={},m=c.each({css:function(b,g){var h={},j=c(this),m=j.attr("style");if("string"===typeof b){if("undefined"===typeof g)return e.css.apply(this,arguments);h[b]=g}else if("object"===typeof b)h=b;else return j;c.each(h,function(c,b){m=a(c,b,m)});return j.attr("style",m)}},function(a,b){e[a]=c.fn[a];b.overridden=!0;j[a]=function(){var g=
c.makeArray(arguments),j=g[g.length-1],m=c(this);return!0===j?b.apply(m,g.slice(0,-1)):h&&!1!==j?b.apply(m,g):e[a].apply(m,g)}});c.extend(c.fn,j);c.important=c.extend(function(){var a=c.makeArray(arguments),e;if("string"===typeof a[0]){if("undefined"===typeof a[1]||"boolean"===typeof a[1])return e=!1!==a[1],/<\w+.*>/.test(a[0])?g(a[0],e):b(a[0],e)}else if(c.isFunction(a[0]))e=h,c.important.status=h=!0,a[0].call(this),c.important.status=h=e;else if("undefined"===typeof a[0]||"boolean"===typeof a[0])c.important.status=
h=!1!==a[0];return h},{status:h,noConflict:function(){c.each(e,function(a,b){c.fn[a]=b});return m},declaration:a});c.fn.important=function(g){var e=c(this),h=c.makeArray(arguments).concat(!0),m=e.data("nodeName"),o;if("undefined"===typeof g||"boolean"===typeof g)m||(m=e.attr("nodeName").toLowerCase(),e.data("nodeName",m)),"style"===m?(o=!1!==g,e.html(b(e.html(),o)),h=e.attr("sheet"),_("stylesheet",h),h&&h.cssRules&&(_("cssRules",h.cssRules),c.each(h.cssRules,function(a,g){_("rule",g,g.cssText);_(c.important(g.style.cssText,
o));if(g.type===CSSRule.STYLE_RULE)g.style.cssText=c.important(g.style.cssText,o)}))):e.attr("style",c.important(e.attr("style"),g));else{if("object"===typeof g)return h.unshift("css"),e.important.apply(this,h);if("string"===typeof g)if(c.isFunction(j[g]))h=h.slice(1),j[g].apply(e,h);else{if("undefined"===typeof h[1]||"boolean"===typeof h[1])o=!1!==h[1],e.attr("style",a(g,o,e.attr("style")))}else c.isFunction(g)&&c.important.call(this,g)}return e}})(jQuery);(function(c){var a=function(a){var c=a.data("scrollbarPaper")||a.data("scrollbar-paper"),e=a.innerHeight(),b=e-a.height();return{height:e,ratio:e/(c.clearer.position().top-((c.content.children(":visible").eq(0).position()||{}).top||0)+b),offset:a.offset()}},b={_init:function(g){g=c.extend({parentSelector:"",css:c.css,show:function(a){a.show()},hide:function(a){a.hide()}},g);return this.each(function(){var b=c(this),e=b.data("scrollbarPaper")||b.data("scrollbar-paper");if(!e){g.css.apply(b,[{"overflow-x":"hidden",
"overflow-y":"auto"},!0]);e=b.closest(g.parentSelector);e.length||(e=b.offsetParent());var j=c('<div class="scrollbarpaper-container"></div>').appendTo(e);g.hide(j);var m=c('<div class="scrollbarpaper-track"></div>').appendTo(j),k=c('<div class="scrollbarpaper-drag"></div>').appendTo(m),e={options:g,offsetParent:e,paper:j,track:m,drag:k,dragTop:c('<div class="scrollbarpaper-drag-top"></div>').appendTo(k),dragBottom:c('<div class="scrollbarpaper-drag-bottom"></div>').appendTo(k),content:b,clearer:c('<div style="clear:both;"></div>').appendTo(b),
offsetHeight:m.outerHeight()-m.height()};b.data("scrollbarPaper",e).data("scrollbar-paper",e);var n=a(b),s=setInterval(function(){if(b.closest(g.parentSelector).length){if(b.is(":visible")){var c=a(b);if(c.height!=n.height||c.ratio!=n.ratio||c.offset.left!=n.offset.left||c.offset.top!=n.offset.top)b.scrollbarPaper("update"),n=c}}else clearInterval(s),j.remove(),b.removeData("scrollbarPaper").removeData("scrollbar-paper")},250)}b.scrollbarPaper("update")})},update:function(b){return this.each(function(){var h=
c(this);if(h.is(":visible")&&!h.data("scrollbarpaperfrozen")){var e=h.data("scrollbarPaper")||h.data("scrollbar-paper");b=b||a(h);h.unbind(".scrollbarPaper");var j=h.innerHeight()-e.offsetHeight;e.options.css.apply(e.track,[{height:j+"px"},!0]);var m=0<e.offsetParent.not("html, body").length?e.offsetParent.offset():{left:0,top:0};e.options.css.apply(e.paper,[{left:-m.left+b.offset.left+h.innerWidth()-e.paper.width()+"px",top:-m.top+b.offset.top+"px"},!0]);var k=Math.max(Math.round(j*b.ratio),e.dragTop.height()+
e.dragBottom.height());e.options.css.apply(e.drag,[{height:k+"px"},!0]);m=function(){e.options.css.apply(e.drag,[{top:Math.min(Math.round(h.scrollTop()*b.ratio),j-k)+"px"},!0])};m();h.bind("scroll.scrollbarPaper",m);var n=function(a){return a.pageY||(a.originalEvent&&(a.originalEvent.targetTouches||a.originalEvent.touches||[])[0]||a).pageY},s=function(){c("body").unbind("mousemove.scrollbarPaper touchmove.scrollbarPaper")};e.drag.bind("mousedown.scrollbarPaper touchstart.scrollbarPaper",function(a){s();
var j=n(a)-e.drag.offset().top;c("body").bind("mousemove.scrollbarPaper touchmove.scrollbarPaper",function(a){a.preventDefault();h.scrollTop((n(a)-h.offset().top-j)/b.ratio);return!1}).bind("mouseup.scrollbarPaper touchend.scrollbarPaper",s);return!1});1>b.ratio?(e.options.show(e.drag),e.content.addClass("scrollbarpaper-visible")):(e.options.hide(e.drag),e.content.removeClass("scrollbarpaper-visible"))}})},show:function(){return this.each(function(){var a=c(this),b=a.data("scrollbarPaper")||a.data("scrollbar-paper");
b&&(a.scrollbarPaper("update"),"function"==typeof b.options.show?b.options.show(b.paper):b.paper.show())})},hide:function(){return this.each(function(){var a=c(this);(a=a.data("scrollbarPaper")||a.data("scrollbar-paper"))&&("function"==typeof a.options.hide?a.options.hide(a.paper):a.paper.hide())})},freeze:function(){return this.each(function(){c(this).data("scrollbarpaperfrozen",!0)})},thaw:function(){return this.each(function(){c(this).data("scrollbarpaperfrozen",!1)})}};c.fn.scrollbarPaper=function(a){if(b[a])return b[a].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return b._init.apply(this,arguments);throw"Method "+a+" does not exist on jQuery.scrollbarPaper.";}})(jQuery);(function(c,a,b){function g(a){return a}function h(a){return decodeURIComponent(a.replace(e," "))}var e=/\+/g,j=c.cookie=function(e,k,n){if(k!==b){n=c.extend({},j.defaults,n);if(null===k)n.expires=-1;if("number"===typeof n.expires){var s=n.expires,u=n.expires=new Date;u.setDate(u.getDate()+s)}k=j.json?JSON.stringify(k):""+k;return a.cookie=[encodeURIComponent(e),"=",j.raw?k:encodeURIComponent(k),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:
"",n.secure?"; secure":""].join("")}k=j.raw?g:h;n=a.cookie.split("; ");s=0;for(u=n.length;s<u;s++){var o=n[s].split("=");if(k(o.shift())===e)return e=k(o.join("=")),j.json?JSON.parse(e):e}return null};j.defaults={};c.removeCookie=function(a,b){return null!==c.cookie(a)?(c.cookie(a,null,b),!0):!1}})(jQuery,document);jQuery.cookie.json=!0;(function(){var c=this,a=c._,b={},g=Array.prototype,h=Object.prototype,e=g.push,j=g.slice,m=g.concat,k=h.toString,n=h.hasOwnProperty,s=g.forEach,u=g.map,o=g.reduce,y=g.reduceRight,v=g.filter,t=g.every,q=g.some,p=g.indexOf,B=g.lastIndexOf,h=Array.isArray,E=Object.keys,z=Function.prototype.bind,d=function(i){if(i instanceof d)return i;if(!(this instanceof d))return new d(i);this._wrapped=i};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=d),exports._=
d):c._=d;d.VERSION="1.4.2";var r=d.each=d.forEach=function(i,a,f){if(null!=i)if(s&&i.forEach===s)i.forEach(a,f);else if(i.length===+i.length)for(var c=0,l=i.length;c<l&&!(a.call(f,i[c],c,i)===b);c++);else for(c in i)if(d.has(i,c)&&a.call(f,i[c],c,i)===b)break};d.map=d.collect=function(i,a,f){var b=[];return null==i?b:u&&i.map===u?i.map(a,f):(r(i,function(i,c,l){b[b.length]=a.call(f,i,c,l)}),b)};d.reduce=d.foldl=d.inject=function(i,a,f,b){var c=2<arguments.length;null==i&&(i=[]);if(o&&i.reduce===o)return b&&
(a=d.bind(a,b)),c?i.reduce(a,f):i.reduce(a);r(i,function(i,l,e){c?f=a.call(b,f,i,l,e):(f=i,c=!0)});if(!c)throw new TypeError("Reduce of empty array with no initial value");return f};d.reduceRight=d.foldr=function(i,a,f,b){var c=2<arguments.length;null==i&&(i=[]);if(y&&i.reduceRight===y)return b&&(a=d.bind(a,b)),2<arguments.length?i.reduceRight(a,f):i.reduceRight(a);var l=i.length;if(l!==+l)var e=d.keys(i),l=e.length;r(i,function(d,g,h){g=e?e[--l]:--l;c?f=a.call(b,f,i[g],g,h):(f=i[g],c=!0)});if(!c)throw new TypeError("Reduce of empty array with no initial value");
return f};d.find=d.detect=function(i,a,f){var b;return D(i,function(i,c,l){if(a.call(f,i,c,l))return b=i,!0}),b};d.filter=d.select=function(i,a,f){var b=[];return null==i?b:v&&i.filter===v?i.filter(a,f):(r(i,function(i,c,l){a.call(f,i,c,l)&&(b[b.length]=i)}),b)};d.reject=function(i,a,f){var b=[];return null==i?b:(r(i,function(i,c,l){a.call(f,i,c,l)||(b[b.length]=i)}),b)};d.every=d.all=function(i,a,f){a||(a=d.identity);var c=!0;return null==i?c:t&&i.every===t?i.every(a,f):(r(i,function(i,l,e){if(!(c=
c&&a.call(f,i,l,e)))return b}),!!c)};var D=d.some=d.any=function(i,a,f){a||(a=d.identity);var c=!1;return null==i?c:q&&i.some===q?i.some(a,f):(r(i,function(i,l,e){if(c||(c=a.call(f,i,l,e)))return b}),!!c)};d.contains=d.include=function(i,a){var f=!1;return null==i?f:p&&i.indexOf===p?-1!=i.indexOf(a):(f=D(i,function(i){return i===a}),f)};d.invoke=function(i,a){var f=j.call(arguments,2);return d.map(i,function(i){return(d.isFunction(a)?a:i[a]).apply(i,f)})};d.pluck=function(i,a){return d.map(i,function(i){return i[a]})};
d.where=function(i,a){return d.isEmpty(a)?[]:d.filter(i,function(i){for(var f in a)if(a[f]!==i[f])return!1;return!0})};d.max=function(i,a,f){if(!a&&d.isArray(i)&&i[0]===+i[0]&&65535>i.length)return Math.max.apply(Math,i);if(!a&&d.isEmpty(i))return-Infinity;var b={computed:-Infinity};return r(i,function(i,c,l){c=a?a.call(f,i,c,l):i;c>=b.computed&&(b={value:i,computed:c})}),b.value};d.min=function(a,f,b){if(!f&&d.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!f&&d.isEmpty(a))return Infinity;
var c={computed:Infinity};return r(a,function(a,i,l){i=f?f.call(b,a,i,l):a;i<c.computed&&(c={value:a,computed:i})}),c.value};d.shuffle=function(a){var f,b=0,c=[];return r(a,function(a){f=d.random(b++);c[b-1]=c[f];c[f]=a}),c};var x=function(a){return d.isFunction(a)?a:function(f){return f[a]}};d.sortBy=function(a,f,b){var c=x(f);return d.pluck(d.map(a,function(a,f,i){return{value:a,index:f,criteria:c.call(b,a,f,i)}}).sort(function(a,f){var i=a.criteria,b=f.criteria;if(i!==b){if(i>b||void 0===i)return 1;
if(i<b||void 0===b)return-1}return a.index<f.index?-1:1}),"value")};var C=function(a,f,b,c){var l={},e=x(f);return r(a,function(f,d){var g=e.call(b,f,d,a);c(l,g,f)}),l};d.groupBy=function(a,f,b){return C(a,f,b,function(a,f,i){(d.has(a,f)?a[f]:a[f]=[]).push(i)})};d.countBy=function(a,f,b){return C(a,f,b,function(a,f){d.has(a,f)||(a[f]=0);a[f]++})};d.sortedIndex=function(a,f,b,c){for(var b=null==b?d.identity:x(b),f=b.call(c,f),l=0,e=a.length;l<e;){var g=l+e>>>1;b.call(c,a[g])<f?l=g+1:e=g}return l};
d.toArray=function(a){return a?a.length===+a.length?j.call(a):d.values(a):[]};d.size=function(a){return a.length===+a.length?a.length:d.keys(a).length};d.first=d.head=d.take=function(a,f,b){return null!=f&&!b?j.call(a,0,f):a[0]};d.initial=function(a,f,b){return j.call(a,0,a.length-(null==f||b?1:f))};d.last=function(a,f,b){return null!=f&&!b?j.call(a,Math.max(a.length-f,0)):a[a.length-1]};d.rest=d.tail=d.drop=function(a,f,b){return j.call(a,null==f||b?1:f)};d.compact=function(a){return d.filter(a,
function(a){return!!a})};var f=function(a,b,c){return r(a,function(a){d.isArray(a)?b?e.apply(c,a):f(a,b,c):c.push(a)}),c};d.flatten=function(a,b){return f(a,b,[])};d.without=function(a){return d.difference(a,j.call(arguments,1))};d.uniq=d.unique=function(a,f,b,c){var b=b?d.map(a,b,c):a,l=[],e=[];return r(b,function(b,c){if(f?!c||e[e.length-1]!==b:!d.contains(e,b))e.push(b),l.push(a[c])}),l};d.union=function(){return d.uniq(m.apply(g,arguments))};d.intersection=function(a){var f=j.call(arguments,1);
return d.filter(d.uniq(a),function(a){return d.every(f,function(f){return 0<=d.indexOf(f,a)})})};d.difference=function(a){var f=m.apply(g,j.call(arguments,1));return d.filter(a,function(a){return!d.contains(f,a)})};d.zip=function(){for(var a=j.call(arguments),f=d.max(d.pluck(a,"length")),b=Array(f),c=0;c<f;c++)b[c]=d.pluck(a,""+c);return b};d.object=function(a,f){for(var b={},c=0,l=a.length;c<l;c++)f?b[a[c]]=f[c]:b[a[c][0]]=a[c][1];return b};d.indexOf=function(a,f,b){if(null==a)return-1;var c=0,l=
a.length;if(b){if("number"!=typeof b)return c=d.sortedIndex(a,f),a[c]===f?c:-1;c=0>b?Math.max(0,l+b):b}if(p&&a.indexOf===p)return a.indexOf(f,b);for(;c<l;c++)if(a[c]===f)return c;return-1};d.lastIndexOf=function(a,f,b){if(null==a)return-1;var c=null!=b;if(B&&a.lastIndexOf===B)return c?a.lastIndexOf(f,b):a.lastIndexOf(f);for(b=c?b:a.length;b--;)if(a[b]===f)return b;return-1};d.range=function(a,f,b){1>=arguments.length&&(f=a||0,a=0);b=arguments[2]||1;for(var c=Math.max(Math.ceil((f-a)/b),0),l=0,e=Array(c);l<
c;)e[l++]=a,a+=b;return e};var l=function(){};d.bind=function(a,f){var b,c;if(a.bind===z&&z)return z.apply(a,j.call(arguments,1));if(!d.isFunction(a))throw new TypeError;return c=j.call(arguments,2),b=function(){if(this instanceof b){l.prototype=a.prototype;var e=new l,d=a.apply(e,c.concat(j.call(arguments)));return Object(d)===d?d:e}return a.apply(f,c.concat(j.call(arguments)))}};d.bindAll=function(a){var f=j.call(arguments,1);return 0==f.length&&(f=d.functions(a)),r(f,function(f){a[f]=d.bind(a[f],
a)}),a};d.memoize=function(a,f){var b={};return f||(f=d.identity),function(){var c=f.apply(this,arguments);return d.has(b,c)?b[c]:b[c]=a.apply(this,arguments)}};d.delay=function(a,f){var b=j.call(arguments,2);return setTimeout(function(){return a.apply(null,b)},f)};d.defer=function(a){return d.delay.apply(d,[a,1].concat(j.call(arguments,1)))};d.throttle=function(a,f){var b,c,l,e,g,h,A=d.debounce(function(){g=e=!1},f);return function(){b=this;c=arguments;var d;return l||(l=setTimeout(function(){l=
null;g&&(h=a.apply(b,c));A()},f)),e?g=!0:(e=!0,h=a.apply(b,c)),A(),h}};d.debounce=function(a,f,b){var c,l;return function(){var e=this,d=arguments,g=b&&!c;return clearTimeout(c),c=setTimeout(function(){c=null;b||(l=a.apply(e,d))},f),g&&(l=a.apply(e,d)),l}};d.once=function(a){var f=!1,b;return function(){return f?b:(f=!0,b=a.apply(this,arguments),a=null,b)}};d.wrap=function(a,f){return function(){var b=[a];return e.apply(b,arguments),f.apply(this,b)}};d.compose=function(){var a=arguments;return function(){for(var f=
arguments,b=a.length-1;0<=b;b--)f=[a[b].apply(this,f)];return f[0]}};d.after=function(a,f){return 0>=a?f():function(){if(1>--a)return f.apply(this,arguments)}};d.keys=E||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var f=[],b;for(b in a)d.has(a,b)&&(f[f.length]=b);return f};d.values=function(a){var f=[],b;for(b in a)d.has(a,b)&&f.push(a[b]);return f};d.pairs=function(a){var f=[],b;for(b in a)d.has(a,b)&&f.push([b,a[b]]);return f};d.invert=function(a){var f={},b;for(b in a)d.has(a,
b)&&(f[a[b]]=b);return f};d.functions=d.methods=function(a){var f=[],b;for(b in a)d.isFunction(a[b])&&f.push(b);return f.sort()};d.extend=function(a){return r(j.call(arguments,1),function(f){for(var b in f)a[b]=f[b]}),a};d.pick=function(a){var f={},b=m.apply(g,j.call(arguments,1));return r(b,function(b){b in a&&(f[b]=a[b])}),f};d.omit=function(a){var f={},b=m.apply(g,j.call(arguments,1)),c;for(c in a)d.contains(b,c)||(f[c]=a[c]);return f};d.defaults=function(a){return r(j.call(arguments,1),function(f){for(var b in f)null==
a[b]&&(a[b]=f[b])}),a};d.clone=function(a){return d.isObject(a)?d.isArray(a)?a.slice():d.extend({},a):a};d.tap=function(a,f){return f(a),a};var A=function(a,f,b,c){if(a===f)return 0!==a||1/a==1/f;if(null==a||null==f)return a===f;a instanceof d&&(a=a._wrapped);f instanceof d&&(f=f._wrapped);var l=k.call(a);if(l!=k.call(f))return!1;switch(l){case "[object String]":return a==""+f;case "[object Number]":return a!=+a?f!=+f:0==a?1/a==1/f:a==+f;case "[object Date]":case "[object Boolean]":return+a==+f;case "[object RegExp]":return a.source==
f.source&&a.global==f.global&&a.multiline==f.multiline&&a.ignoreCase==f.ignoreCase}if("object"!=typeof a||"object"!=typeof f)return!1;for(var e=b.length;e--;)if(b[e]==a)return c[e]==f;b.push(a);c.push(f);var e=0,g=!0;if("[object Array]"==l){if(e=a.length,g=e==f.length,g)for(;e--&&(g=A(a[e],f[e],b,c)););}else{var l=a.constructor,h=f.constructor;if(l!==h&&(!d.isFunction(l)||!(l instanceof l&&d.isFunction(h)&&h instanceof h)))return!1;for(var w in a)if(d.has(a,w)&&(e++,!(g=d.has(f,w)&&A(a[w],f[w],b,
c))))break;if(g){for(w in f)if(d.has(f,w)&&!e--)break;g=!e}}return b.pop(),c.pop(),g};d.isEqual=function(a,f){return A(a,f,[],[])};d.isEmpty=function(a){if(null==a)return!0;if(d.isArray(a)||d.isString(a))return 0===a.length;for(var f in a)if(d.has(a,f))return!1;return!0};d.isElement=function(a){return!!a&&1===a.nodeType};d.isArray=h||function(a){return"[object Array]"==k.call(a)};d.isObject=function(a){return a===Object(a)};r("Arguments,Function,String,Number,Date,RegExp".split(","),function(a){d["is"+
a]=function(f){return k.call(f)=="[object "+a+"]"}});d.isArguments(arguments)||(d.isArguments=function(a){return!!a&&!!d.has(a,"callee")});"function"!=typeof/./&&(d.isFunction=function(a){return"function"==typeof a});d.isFinite=function(a){return d.isNumber(a)&&isFinite(a)};d.isNaN=function(a){return d.isNumber(a)&&a!=+a};d.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==k.call(a)};d.isNull=function(a){return null===a};d.isUndefined=function(a){return void 0===a};d.has=function(a,
f){return n.call(a,f)};d.noConflict=function(){return c._=a,this};d.identity=function(a){return a};d.times=function(a,f,b){for(var c=0;c<a;c++)f.call(b,c)};d.random=function(a,f){return null==f&&(f=a,a=0),a+(0|Math.random()*(f-a+1))};var w={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};w.unescape=d.invert(w.escape);var G={escape:RegExp("["+d.keys(w.escape).join("")+"]","g"),unescape:RegExp("("+d.keys(w.unescape).join("|")+")","g")};d.each(["escape","unescape"],
function(a){d[a]=function(f){return null==f?"":(""+f).replace(G[a],function(f){return w[a][f]})}});d.result=function(a,f){if(null==a)return null;var b=a[f];return d.isFunction(b)?b.call(a):b};d.mixin=function(a){r(d.functions(a),function(f){var b=d[f]=a[f];d.prototype[f]=function(){var a=[this._wrapped];e.apply(a,arguments);a=b.apply(d,a);return this._chain?d(a).chain():a}})};var H=0;d.uniqueId=function(a){var f=H++;return a?a+f:f};d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,
escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},J=/\\|'|\r|\n|\t|\u2028|\u2029/g;d.template=function(a,f,b){var b=d.defaults({},b,d.templateSettings),c=RegExp([(b.escape||F).source,(b.interpolate||F).source,(b.evaluate||F).source].join("|")+"|$","g"),l=0,e="__p+='";a.replace(c,function(f,b,c,g,d){e+=a.slice(l,d).replace(J,function(a){return"\\"+I[a]});e+=b?"'+\n((__t=("+b+"))==null?'':_.escape(__t))+\n'":c?"'+\n((__t=("+c+
"))==null?'':__t)+\n'":g?"';\n"+g+"\n__p+='":"";l=d+f.length});e+="';\n";b.variable||(e="with(obj||{}){\n"+e+"}\n");e="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+e+"return __p;\n";try{var g=new Function(b.variable||"obj","_",e)}catch(h){throw h.source=e,h;}if(f)return g(f,d);f=function(a){return g.call(this,a,d)};return f.source="function("+(b.variable||"obj")+"){\n"+e+"}",f};d.chain=function(a){return d(a).chain()};d.mixin(d);r("pop,push,reverse,shift,sort,splice,unshift".split(","),
function(a){var f=g[a];d.prototype[a]=function(){var b=this._wrapped;return f.apply(b,arguments),("shift"==a||"splice"==a)&&0===b.length&&delete b[0],this._chain?d(b).chain():b}});r(["concat","join","slice"],function(a){var f=g[a];d.prototype[a]=function(){var a=f.apply(this._wrapped,arguments);return this._chain?d(a).chain():a}});d.extend(d.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);(function(){var c=this,a=c.Backbone,b=Array.prototype.slice,g=Array.prototype.splice,h;h="undefined"!==typeof exports?exports:c.Backbone={};h.VERSION="0.9.2";var e=c._;!e&&"undefined"!==typeof require&&(e=require("underscore"));var j=c.jQuery||c.Zepto||c.ender;h.setDomLibrary=function(a){j=a};h.noConflict=function(){c.Backbone=a;return this};h.emulateHTTP=!1;h.emulateJSON=!1;var m=/\s+/,k=h.Events={on:function(a,b,c){var e,g,d,h,j;if(!b)return this;a=a.split(m);for(e=this._callbacks||(this._callbacks=
{});g=a.shift();)d=(j=e[g])?j.tail:{},d.next=h={},d.context=c,d.callback=b,e[g]={tail:h,next:j?j.next:d};return this},off:function(a,b,c){var g,d,h,j,k,q;if(d=this._callbacks){if(!a&&!b&&!c)return delete this._callbacks,this;for(a=a?a.split(m):e.keys(d);g=a.shift();)if(h=d[g],delete d[g],h&&(b||c))for(j=h.tail;(h=h.next)!==j;)if(k=h.callback,q=h.context,b&&k!==b||c&&q!==c)this.on(g,k,q);return this}},trigger:function(a){var c,e,g,d,h,j;if(!(g=this._callbacks))return this;h=g.all;a=a.split(m);for(j=
b.call(arguments,1);c=a.shift();){if(e=g[c])for(d=e.tail;(e=e.next)!==d;)e.callback.apply(e.context||this,j);if(e=h){d=e.tail;for(c=[c].concat(j);(e=e.next)!==d;)e.callback.apply(e.context||this,c)}}return this}};k.bind=k.on;k.unbind=k.off;var n=h.Model=function(a,b){var c;a||(a={});b&&b.parse&&(a=this.parse(a));if(c=x(this,"defaults"))a=e.extend({},c,a);b&&b.collection&&(this.collection=b.collection);this.attributes={};this._escapedAttributes={};this.cid=e.uniqueId("c");this.changed={};this._silent=
{};this._pending={};this.set(a,{silent:!0});this.changed={};this._silent={};this._pending={};this._previousAttributes=e.clone(this.attributes);this.initialize.apply(this,arguments)};e.extend(n.prototype,k,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return e.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;b=this.get(a);return this._escapedAttributes[a]=e.escape(null==
b?"":""+b)},has:function(a){return null!=this.get(a)},set:function(a,b,c){var g,d;e.isObject(a)||null==a?(g=a,c=b):(g={},g[a]=b);c||(c={});if(!g)return this;g instanceof n&&(g=g.attributes);if(c.unset)for(d in g)g[d]=void 0;if(!this._validate(g,c))return!1;this.idAttribute in g&&(this.id=g[this.idAttribute]);var b=c.changes={},h=this.attributes,j=this._escapedAttributes,k=this._previousAttributes||{};for(d in g){a=g[d];if(!e.isEqual(h[d],a)||c.unset&&e.has(h,d))delete j[d],(c.silent?this._silent:
b)[d]=!0;c.unset?delete h[d]:h[d]=a;!e.isEqual(k[d],a)||e.has(h,d)!=e.has(k,d)?(this.changed[d]=a,c.silent||(this._pending[d]=!0)):(delete this.changed[d],delete this._pending[d])}c.silent||this.change(c);return this},unset:function(a,b){(b||(b={})).unset=!0;return this.set(a,null,b)},clear:function(a){(a||(a={})).unset=!0;return this.set(e.clone(this.attributes),a)},fetch:function(a){var a=a?e.clone(a):{},b=this,c=a.success;a.success=function(e,d,g){if(!b.set(b.parse(e,g),a))return!1;c&&c(b,e)};
a.error=h.wrapError(a.error,b,a);return(this.sync||h.sync).call(this,"read",this,a)},save:function(a,b,c){var d,g;e.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b);c=c?e.clone(c):{};if(c.wait){if(!this._validate(d,c))return!1;g=e.clone(this.attributes)}a=e.extend({},c,{silent:!0});if(d&&!this.set(d,c.wait?a:c))return!1;var j=this,k=c.success;c.success=function(a,f,b){f=j.parse(a,b);c.wait&&(delete c.wait,f=e.extend(d||{},f));if(!j.set(f,c))return!1;k?k(j,a):j.trigger("sync",j,a,c)};c.error=h.wrapError(c.error,
j,c);b=this.isNew()?"create":"update";b=(this.sync||h.sync).call(this,b,this,c);c.wait&&this.set(g,a);return b},destroy:function(a){var a=a?e.clone(a):{},b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(this.isNew())return d(),!1;a.success=function(e){a.wait&&d();c?c(b,e):b.trigger("sync",b,e,a)};a.error=h.wrapError(a.error,b,a);var g=(this.sync||h.sync).call(this,"delete",this,a);a.wait||d();return g},url:function(){var a=x(this,"urlRoot")||x(this.collection,"url")||C();
return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(a){a||(a={});var b=this._changing;this._changing=!0;for(var c in this._silent)this._pending[c]=!0;var d=e.extend({},a.changes,this._silent);this._silent={};for(c in d)this.trigger("change:"+c,this,this.get(c),a);if(b)return this;for(;!e.isEmpty(this._pending);){this._pending=
{};this.trigger("change",this,a);for(c in this.changed)!this._pending[c]&&!this._silent[c]&&delete this.changed[c];this._previousAttributes=e.clone(this.attributes)}this._changing=!1;return this},hasChanged:function(a){return!arguments.length?!e.isEmpty(this.changed):e.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?e.clone(this.changed):!1;var b,c=!1,d=this._previousAttributes,g;for(g in a)if(!e.isEqual(d[g],b=a[g]))(c||(c={}))[g]=b;return c},previous:function(a){return!arguments.length||
!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return e.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,b){if(b.silent||!this.validate)return!0;var a=e.extend({},this.attributes,a),c=this.validate(a,b);if(!c)return!0;b&&b.error?b.error(this,c,b):this.trigger("error",this,c,b);return!1}});var s=h.Collection=function(a,b){b||(b={});b.model&&(this.model=b.model);b.comparator&&(this.comparator=b.comparator);
this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,{silent:!0,parse:b.parse})};e.extend(s.prototype,k,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){var c,d,h,j,k,m={},q={},i=[];b||(b={});a=e.isArray(a)?a.slice():[a];c=0;for(d=a.length;c<d;c++){if(!(h=a[c]=this._prepareModel(a[c],b)))throw Error("Can't add an invalid model to a collection");j=h.cid;k=h.id;m[j]||this._byCid[j]||null!=k&&(q[k]||this._byId[k])?
i.push(c):m[j]=q[k]=h}for(c=i.length;c--;)a.splice(i[c],1);c=0;for(d=a.length;c<d;c++)(h=a[c]).on("all",this._onModelEvent,this),this._byCid[h.cid]=h,null!=h.id&&(this._byId[h.id]=h);this.length+=d;g.apply(this.models,[null!=b.at?b.at:this.models.length,0].concat(a));this.comparator&&this.sort({silent:!0});if(b.silent)return this;c=0;for(d=this.models.length;c<d;c++)if(m[(h=this.models[c]).cid])b.index=c,h.trigger("add",h,this,b);return this},remove:function(a,b){var c,d,g,h;b||(b={});a=e.isArray(a)?
a.slice():[a];c=0;for(d=a.length;c<d;c++)if(h=this.getByCid(a[c])||this.get(a[c]))delete this._byId[h.id],delete this._byCid[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,b);return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,e.extend({at:0},b));return a},
shift:function(a){var b=this.at(0);this.remove(b,a);return b},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return e.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var b=e.bind(this.comparator,this);1==this.comparator.length?
this.models=this.sortBy(b):this.models.sort(b);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return e.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);this._reset();this.add(a,e.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a=a?e.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;a.success=function(e,
d,g){b[a.add?"add":"reset"](b.parse(e,g),a);c&&c(b,e)};a.error=h.wrapError(a.error,b,a);return(this.sync||h.sync).call(this,"read",this,a)},create:function(a,b){var c=this,b=b?e.clone(b):{},a=this._prepareModel(a,b);if(!a)return!1;b.wait||c.add(a,b);var d=b.success;b.success=function(e,g){b.wait&&c.add(e,b);d?d(e,g):e.trigger("sync",a,g,b)};a.save(null,b);return a},parse:function(a){return a},chain:function(){return e(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId=
{};this._byCid={}},_prepareModel:function(a,b){b||(b={});a instanceof n?a.collection||(a.collection=this):(b.collection=this,a=new this.model(a,b),a._validate(a.attributes,b)||(a=!1));return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,e){("add"==a||"remove"==a)&&c!=this||("destroy"==a&&this.remove(b,e),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,
arguments))}});e.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(a){s.prototype[a]=function(){return e[a].apply(e,[this.models].concat(e.toArray(arguments)))}});var u=h.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},o=/:\w+/g,
y=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;e.extend(u.prototype,k,{initialize:function(){},route:function(a,b,c){h.history||(h.history=new t);e.isRegExp(a)||(a=this._routeToRegExp(a));c||(c=this[b]);h.history.route(a,e.bind(function(e){e=this._extractParameters(a,e);c&&c.apply(this,e);this.trigger.apply(this,["route:"+b].concat(e));h.history.trigger("route",this,b,e)},this));return this},navigate:function(a,b){h.history.navigate(a,b)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,
this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(v,"\\$&").replace(o,"([^/]+)").replace(y,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var t=h.History=function(){this.handlers=[];e.bindAll(this,"checkUrl")},q=/^[#\/]/,p=/msie [\w.]+/;t.started=!1;e.extend(t.prototype,k,{interval:50,getHash:function(a){return(a=(a?a.location:window.location).href.match(/#(.*)$/))?a[1]:
""},getFragment:function(a,b){if(null==a)if(this._hasPushState||b){var a=window.location.pathname,c=window.location.search;c&&(a+=c)}else a=this.getHash();a.indexOf(this.options.root)||(a=a.substr(this.options.root.length));return a.replace(q,"")},start:function(a){if(t.started)throw Error("Backbone.history has already been started");t.started=!0;this.options=e.extend({},{root:"/"},this.options,a);this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=
!(!this.options.pushState||!window.history||!window.history.pushState);var a=this.getFragment(),b=document.documentMode;if(b=p.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b))this.iframe=j('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?j(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!b?j(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,
this.interval));this.fragment=a;a=window.location;b=a.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&b&&a.hash&&(this.fragment=this.getHash().replace(q,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},
stop:function(){j(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);t.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a==this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return e.any(this.handlers,
function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!t.started)return!1;if(!b||!0===b)b={trigger:b};var c=(a||"").replace(q,"");this.fragment!=c&&(this._hasPushState?(0!=c.indexOf(this.options.root)&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||
this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a))},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});var B=h.View=function(a){this.cid=e.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},E=/^(\S+)\s*(.*)$/,z="model,collection,el,id,attributes,className,tagName".split(",");
e.extend(B.prototype,k,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(a,b,c){a=document.createElement(a);b&&j(a).attr(b);c&&j(a).html(c);return a},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof j?a:j(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=x(this,"events"))){this.undelegateEvents();
for(var b in a){var c=a[b];e.isFunction(c)||(c=this[a[b]]);if(!c)throw Error('Method "'+a[b]+'" does not exist');var d=b.match(E),g=d[1],d=d[2],c=e.bind(c,this),g=g+(".delegateEvents"+this.cid);""===d?this.$el.bind(g,c):this.$el.delegate(d,g,c)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=e.extend({},this.options,a));for(var b=0,c=z.length;b<c;b++){var d=z[b];a[d]&&(this[d]=a[d])}this.options=a},_ensureElement:function(){if(this.el)this.setElement(this.el,
!1);else{var a=x(this,"attributes")||{};this.id&&(a.id=this.id);this.className&&(a["class"]=this.className);this.setElement(this.make(this.tagName,a),!1)}}});n.extend=s.extend=u.extend=B.extend=function(a,b){var c=D(this,a,b);c.extend=this.extend;return c};var d={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};h.sync=function(a,b,c){var g=d[a];c||(c={});var k={type:g,dataType:"json"};c.url||(k.url=x(b,"url")||C());if(!c.data&&b&&("create"==a||"update"==a))k.contentType="application/json",
k.data=JSON.stringify(b.toJSON());h.emulateJSON&&(k.contentType="application/x-www-form-urlencoded",k.data=k.data?{model:k.data}:{});if(h.emulateHTTP&&("PUT"===g||"DELETE"===g))h.emulateJSON&&(k.data._method=g),k.type="POST",k.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",g)};"GET"!==k.type&&!h.emulateJSON&&(k.processData=!1);return j.ajax(e.extend(k,c))};h.wrapError=function(a,b,c){return function(e,d){d=e===b?d:e;a?a(b,d,c):b.trigger("error",b,d,c)}};var r=function(){},D=function(a,
b,c){var d;d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)};e.extend(d,a);r.prototype=a.prototype;d.prototype=new r;b&&e.extend(d.prototype,b);c&&e.extend(d,c);d.prototype.constructor=d;d.__super__=a.prototype;return d},x=function(a,b){return!a||!a[b]?null:e.isFunction(a[b])?a[b]():a[b]},C=function(){throw Error('A "url" property or function must be specified');}}).call(this);function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}window.Store=function(c){this.name=c;this.records=(c=localStorage.getItem(this.name))&&c.split(",")||[]};
_.extend(Store.prototype,{save:function(){localStorage.setItem(this.name,this.records.join(","))},create:function(c){if(!c.id)c.id=c.attributes.id=guid();localStorage.setItem(this.name+"-"+c.id,JSON.stringify(c));this.records.push(c.id.toString());this.save();return c},update:function(c){localStorage.setItem(this.name+"-"+c.id,JSON.stringify(c));_.include(this.records,c.id.toString())||this.records.push(c.id.toString());this.save();return c},find:function(c){return JSON.parse(localStorage.getItem(this.name+
"-"+c.id))},findAll:function(){return _.map(this.records,function(c){return JSON.parse(localStorage.getItem(this.name+"-"+c))},this)},destroy:function(c){localStorage.removeItem(this.name+"-"+c.id);this.records=_.reject(this.records,function(a){return a==c.id.toString()});this.save();return c}});Backbone.remoteSync=Backbone.sync;
Backbone.sync=function(c,a,b,g){"function"==typeof b&&(b={success:b,error:g});var h,e=a.localStorage||a.collection&&a.collection.localStorage;if(!e)return Backbone.remoteSync(c,a,b,g);switch(c){case "read":h=a.id?e.find(a):e.findAll();break;case "create":h=e.create(a);break;case "update":h=e.update(a);break;case "delete":h=e.destroy(a)}h?b.success(h):b.error("Record not found")};window.Modernizr=function(c,a,b){function g(a,b){var c=a.charAt(0).toUpperCase()+a.substr(1),c=(a+" "+n.join(c+" ")+c).split(" ");return h(c,b)}function h(a,c){for(var e in a)if(k[a[e]]!==b)return"pfx"==c?a[e]:!0;return!1}var e={},j=a.documentElement;a.head||a.getElementsByTagName("head");var m=a.createElement("modernizr"),k=m.style,c=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),n="Webkit Moz O ms Khtml".split(" "),m={},s=[],u=function(b,c,e,g){var h,d,k=a.createElement("div");if(parseInt(e,10))for(;e--;)d=
a.createElement("div"),d.id=g?g[e]:"modernizr"+(e+1),k.appendChild(d);h=["&shy;<style>",b,"</style>"].join("");k.id="modernizr";k.innerHTML+=h;j.appendChild(k);b=c(k,b);k.parentNode.removeChild(k);return!!b},o,y={}.hasOwnProperty,v;typeof y!==b&&typeof y.call!==b?v=function(a,b){return y.call(a,b)}:v=function(a,c){return c in a&&typeof a.constructor.prototype[c]===b};(function(a,b){var c=a.join(""),g=b.length;u(c,function(a){for(var a=a.childNodes,b={};g--;)b[a[g].id]=a[g];e.csstransforms3d=9===b.csstransforms3d.offsetLeft},
g,b)})([,["@media (",c.join("transform-3d),("),"modernizr){#csstransforms3d{left:9px;position:absolute}}"].join("")],[,"csstransforms3d"]);m.csstransforms=function(){return!!h(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])};m.csstransforms3d=function(){var a=!!h(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);a&&"webkitPerspective"in j.style&&(a=e.csstransforms3d);return a};m.csstransitions=function(){return g("transitionProperty")};
for(var t in m)v(m,t)&&(o=t.toLowerCase(),e[o]=m[t](),s.push((e[o]?"":"no-")+o));k.cssText="";m=null;e._version="2.0.6";e._prefixes=c;e._domPrefixes=n;e.testProp=function(a){return h([a])};e.testAllProps=g;e.testStyles=u;return e}(this,this.document);"undefined"==typeof CFW&&(CFW={});"undefined"==typeof CFW_OPTIONS&&(CFW_OPTIONS={});CFW.domain=/[.]local/.test(window.location.host)||/rinkl/.test(window.location.host)||/squatc/.test(window.location.host)?"http://tameron.herokuapp.com":"http://cfwhiteboard.com";CFW.important=jQuery.important.noConflict();CFW.oxygenTank=function(){var c=Array.prototype.slice.call(arguments),a=c.pop(),c=_.reduceRight(c,function(a,c){return"undefined"!=typeof a?a[c]:a},c.shift());return"undefined"!=typeof c?c:a};
CFW.ajaxOptions=!jQuery.browser.msie||!window.XDomainRequest?{}:{xhr:function(){try{var c=new XDomainRequest;c.timeout=5E3;var a;c.getAllResponseHeaders=function(){return""};var b=function(b,g){c.onload=c.onerror=c.ontimeout=jQuery.noop;c.status=b;c.statusText=g;c.readyState=4;if(a)c.responseText=a.responseText;c.onreadystatechange&&c.onreadystatechange()},g=function(){a=new XDomainRequest;a.timeout=c.timeout;a.onload=c.onload;a.onerror=c.onerror;a.ontimeout=c.ontimeout;a.open(c.openArgs[0],c.openArgs[1]);
a.send(c.sendArgs[0])};c.onload=function(){b(200,"OK")};c.onerror=function(){a?b(400,"Error"):g()};c.ontimeout=function(){a?b(0,"timeout"):g()};c.originalOpen=c.open;c.open=function(a,b){"PUT"===a?(b+="/revise",a="POST"):"DELETE"===a&&(b+="/annihilate",a="POST");c.openArgs=[a,b];c.originalOpen(a,b)};c.originalSend=c.send;c.send=function(a){var b=function(a){for(var c in a)a[c]="object"==typeof a[c]?b(a[c]):encodeURIComponent(a[c]);return a},a=JSON.stringify(b(JSON.parse(a)));c.sendArgs=[a];setTimeout(function(){c.originalSend(a)},
0)};return c}catch(h){return jQuery.ajaxSettings.xhr()}}};
jQuery(function(c){c(document.embeds).each(function(){var a=c(this);setTimeout(function(){var b=!1,g=a.attr("wmode");"opaque"!=g&&"transparent"!=g&&(a.attr("wmode","opaque"),b=!0);var h=a.closest("object"),g=h.children("param[name=wmode]").val();"opaque"!=g&&"transparent"!=g&&(h.prepend(c('<param name="wmode" value="opaque" />')),b=!0);b&&(h=h.length?h:a,b=h.wrap(c('<span class="cfw-placeholder" />')),b.html(b.html()),b.children().unwrap())},c.browser.msie?300:0)});c("iframe").each(function(){/youtube/.test(this.src)&&
(this.src+=(0<=this.src.indexOf("?")?"&":"?")+"wmode=opaque")})});jQuery(function(c){c.fn.bindBefore=function(a,b){a=a.split(/\s+/);this.each(function(){for(var g=a.length;g--;){c(this).bind(a[g],b);var h=c.data(this,"events")[a[g]];h.splice(0,0,h.pop())}})};c.fn.oneBefore=function(a,b){a=a.split(/\s+/);this.each(function(){for(var g=a.length;g--;){c(this).one(a[g],b);var h=c.data(this,"events")[a[g]];h.splice(0,0,h.pop())}})}});
jQuery(function(c){if(!Modernizr.csstransitions)Modernizr.csstransforms=!1,Modernizr.csstransforms3d=!1;if(/AppleWebKit/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent))Modernizr.csstransforms3d=!1;if(c.browser.msie&&window.XDomainRequest)jQuery.support.cors=!0;CFW.User=Backbone.Model.extend({defaults:function(){return{email:"",known_as:"",count:0,highlightColor:CFW.User.prototype.randomColor()}},randomColor:function(){return[[255,75,105],[255,105,75],[75,105,255],[105,75,255],[75,
255,105],[105,255,75],[123,6,226],[226,6,123],[6,226,123],[6,123,226]][Math.floor(10*Math.random()+0)]}});CFW.UserList=Backbone.Collection.extend({model:CFW.User,initialize:function(){this.localStorage=new Store("cfw-users");return this},comparator:function(a){return-a.get("count")}});CFW.users=new CFW.UserList;CFW.users.fetch();CFW.Entry=Backbone.Model.extend({idAttribute:"_id",defaults:{athlete_id:"",known_as:"",email:"",component_results:[],notes:"",facebook_url:""},emailRegex:/^\S+@\S+\.\S+$/,
validate:function(a){var b=[];!(a.athlete_id||this.attributes&&this.get("athlete_id"))&&!this.emailRegex.test(a.email)&&b.push("email");_.each(a.component_results,function(a){(!a.result||!a.result.length)&&b.push("component-"+a.wp_id+"-result")});(!a.known_as||!a.known_as.replace(/^\s+/,"").replace(/\s+$/,"").length)&&b.push("known_as");if(b.length)return b},setUrlHash:function(){if(this.collection&&this.collection.postId&&this.collection.wod&&this.collection.wod.wp_id){var a="cfwhiteboard-"+this.collection.postId+
"-"+this.collection.wod.wp_id+"-"+this.get("athlete_slug");c(document.body).append(c('<span id="'+a+'" style="position:absolute; top:'+c(document.body).scrollTop()+'px; display:none;"></span>'));window.location.hash=a}}});CFW.EntryList=Backbone.Collection.extend({model:CFW.Entry,url:function(){return CFW.domain+"/affiliates/"+this.affiliateId+"/wods/"+this.postId+"/"+this.wod.wp_id+"/posts"},initialize:function(a,b){this.affiliateId=b.affiliateId;this.postId=b.postId;this.wod=b.wod;return this},comparator:function(a){return a.get("known_as").replace(/^\s+/,
"").toLowerCase()}});CFW.EntryItemView=Backbone.View.extend({tagName:"tr",template:_.template('            <td class="cfw-known-as">                <a href="'+CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink","")+'<%- athlete_slug %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash"><%- known_as %></a>            </td>            <%             if (wod.components && wod.components.length > 1) {                _.each(wod.components, function(component, i, components) {                    var componentResult = _.find(component_results, function(cr) {                        return cr.wp_id == component.wp_id;                    }) || {                        result: "",                        rx: false,                        mods: ""                    };                    var isLast = (i + 1 == components.length);                    %>                     <td class="cfw-component" title="<%- componentResult.result %><%- componentResult.rx ? " [Rx]" : "" %><%- componentResult.mods ? " ("+componentResult.mods+")" : "" %>">                        <%= isLast ? "<div>" : "" %>                        <span class="cfw-result"><%- componentResult.result %></span>                        <span class="cfw-mods">                            <%= componentResult.rx ? "<strong>Rx</strong>" : "" %>                            <%- componentResult.mods %>                        </span>                        <% if (isLast) { %>                            <% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %>                            <span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                        <% } %>                        <%= isLast ? "</div>" : "" %>                    </td>                <%                 });            } else {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == (wod.components[0] || {wp_id: "uh oh"}).wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                 <td class="cfw-result" title="<%- componentResult.result %>"><%- componentResult.result %></td>                <td class="cfw-mods" title="<%- componentResult.rx ? "[Rx] " : "" %><%- componentResult.mods %>">                    <div>                        <%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %><% if (facebook_url) { %><a href="<%= facebook_url %>" class="cfw-view-facebook-post cfw-set-url-hash" title="view facebook post"><span class="cfw-facebook-icon">fb</span></a><% } %><span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                    </div>                </td>            <%             }            %>         '),
events:{"click *:not(a, a *)":"showDetail","click .cfw-set-url-hash":"setUrlHash"},initialize:function(){this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this);this.model.on("show",this.lookSelected,this);this.model.on("unshow",this.unlookSelected,this);this.model.on("highlight",this.highlight,this);return this.render()},render:function(){this.$el.html(this.template(_.extend({wod:this.options.wod},this.model.toJSON())));return this},lookSelected:function(){this.$el.addClass("cfw-selected")},
unlookSelected:function(){this.$el.removeClass("cfw-selected")},highlight:function(){this.$el.addClass("cfw-highlighted").trigger("scrollToEntry");if(Modernizr.csstransitions)this.$el.addClass("cfw-highlighted-transition").removeClass("cfw-highlighted").one("mouseenter touchstart",function(){c(this).removeClass("cfw-highlighted-transition")});else{var a=this.$el,b=function(){a.toggleClass("cfw-highlighted")};setTimeout(b,300);setTimeout(b,600);setTimeout(b,900);setTimeout(b,1200);setTimeout(function(){a.removeClass("cfw-highlighted")},
1500)}},showDetail:function(a){this.itemClickDisabled||(a.stopPropagation(),this.model.trigger("show",this.model))},setUrlHash:function(){this.model.setUrlHash()}});CFW.WhiteboardPage=Backbone.View.extend({tagName:"div",className:"cfw-page",show:function(){this.$el.addClass("active");var a=this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),a.scrollbarReady=!0;a.showScrollbar()},Modernizr.csstransitions?400:0)},hide:function(){this.freezeScrollbar();this.$el.removeClass("active");var a=
this;setTimeout(function(){a.hideScrollbar();a.thawScrollbar();a.$el.trigger("cfwhide")},Modernizr.csstransitions?300:0)},initScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("show")},hideScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("hide")},freezeScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("freeze")},
thawScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("thaw")}});CFW.EntryListView=CFW.WhiteboardPage.extend({template:_.template('            <table class="cfw-components-<%= wod.components && wod.components.length || 1 %>" cellspacing="0">                <thead>                    <tr>                        <th class="cfw-known-as">Name</th>                        <% _.each(wod.components, function(component) { %>                            <th class="cfw-component" <%= wod.components.length == 1 ? \'colspan="2"\' : "" %> title="<%- component.description %>"><%- component.label %></th>                        <% }); %>                    </tr>                </thead>            </table>            <div class="cfw-scrollable">                <table cellspacing="0" class="cfw-components-<%= wod.components && wod.components.length || 1 %>">                    <tbody>                    </tbody>                </table>            </div>        '),
events:{"scrollToEntry tr":"scrollToEntry","touchmove .cfw-scrollable":"disableItemClicks","touchstart .cfw-scrollable":"enableItemClicks"},initialize:function(a){this.entries=a.entries;this.wod=a.wod;this.entryItemViews=[];this.entries.on("add change:known_as remove reset",this.addAll,this);return this.render()},render:function(){this.$el.html(this.template({wod:this.wod}));return this},addOne:function(a){a=new CFW.EntryItemView({model:a,wod:this.wod});this.entryItemViews.push(a);this.$("tbody").append(a.el)},
addAll:function(){_.each(this.entryItemViews,function(a,b,c){a.remove();delete c[b]});this.$("tbody").empty();this.entries.length?this.entries.each(this.addOne,this):this.$("tbody").append(c('                    <tr class="cfw-no-entries">                        <td colspan="100">No one has added an entry yet.<br /><a class="cfw-new-entry">Add yours now!<a></td>                    </tr>                '))},show:function(){var a=this.$("table").attr("class"),b=this.$el.closest(".cfw-contents");setTimeout(function(){b.addClass(a).data("componentsclass",
a);b.siblings(".cfw-classes").addClass(a)},Modernizr.csstransitions?300:0);CFW.WhiteboardPage.prototype.show.apply(this,arguments)},hide:function(){var a=this.$("table").attr("class");this.$el.closest(".cfw-contents").removeClass(a).removeData("componentsclass").siblings(".cfw-classes").removeClass(a);CFW.WhiteboardPage.prototype.hide.apply(this,arguments)},scrollToEntry:function(a){var b=this.$(".cfw-scrollable").scrollTop(0);(a=c(a.target).position())&&a.top&&b.scrollTop(a.top-15-(b.height()||0)/
2)},disableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!0})},enableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!1})}});CFW.EntryDetailView=CFW.WhiteboardPage.extend({template:_.template('            <div class="cfw-entry-detail">                <a class="cfw-back">back</a><a class="cfw-edit">edit</a>                <dl class="cfw-scrollable">                    <dt class="cfw-hidden">Name</dt>                    <dd class="cfw-known-as">                        <%- known_as %>                        <a href="'+
CFW.oxygenTank(CFW_OPTIONS,"athletes_page_permalink","")+'<%- athlete_slug %>" title="view <%- known_as %>\'s profile" class="cfw-set-url-hash">view profile</a>                    </dd>                    <%                    _.each(wod.components, function(component) {                        var componentResult = _.find(component_results, function(cr) {                            return cr.wp_id == component.wp_id;                        }) || {                            result: "",                            rx: false,                            mods: ""                        };                    %>                        <dt><%= component.label %></dt>                        <dd class="cfw-component">                            <span class="cfw-result"><%- componentResult.result %></span>                            <span class="cfw-mods"><%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %></span>                        </dd>                    <%                    });                    %>                    <dt>Notes</dt>                    <dd class="cfw-notes"><%- notes || "(no data)" %></dd>                </dl>            </div>        '),
events:{"click .cfw-set-url-hash":"setUrlHash","click a.cfw-edit":"edit","click a.cfw-back":"back",cfwhide:"cleanup"},initialize:function(a){this.wod=a.wod;this.model.on("change",this.render,this);this.model.on("change",function(){var a=this;setTimeout(function(){a.initScrollbar();a.showScrollbar()},300)},this);this.model.on("destroy",this.hide,this);return this.render()},render:function(){this.$el.html(this.template(_.extend({wod:this.wod},this.model.toJSON())));return this},setUrlHash:function(){this.model.setUrlHash()},
edit:function(){this.model.trigger("edit",this.model)},back:function(){this.$el.trigger("hideEntryDetails")},cleanup:function(){var a=this;setTimeout(function(){a.model.trigger("unshow",a.model);a.remove()},0)}});CFW.ModalPage=Backbone.View.extend({tagName:"div",className:"cfw-scrollable cfw-modal",events:{"focus :input":"scrollToInput","click .cfw-close-modal":"remove"},initScrollbar:function(){this.$el.scrollbarPaper({parentSelector:".cfw-window",css:CFW.important.css,show:function(a){a.removeClass("cfw-hidden")},
hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$el.scrollbarPaper("show")},hideScrollbar:function(){this.$el.scrollbarPaper("hide")},freezeScrollbar:function(){this.$el.scrollbarPaper("freeze")},thawScrollbar:function(){this.$el.scrollbarPaper("thaw")},scrollToInput:function(a){if(!this.height)this.height=this.$el.parent().height();(a=(c(a.target).position()||{}).top)&&this.$el.animate({scrollTop:a+this.$el.scrollTop()-this.height/2},300)},show:function(){var a=this.$el.closest(".cfw-contents"),
b=a.data("componentsclass");b&&(a.removeClass(b),a.siblings(".cfw-classes").removeClass(b));var c=this;setTimeout(function(){c.$el.addClass("cfw-translate-oldfashioned")},0);setTimeout(function(){if(!c.scrollbarReady)c.initScrollbar(),c.scrollbarReady=!0;c.showScrollbar();var a=c.$el.find(":input:first")[0];a&&a.focus&&a.focus()},Modernizr.csstransitions?400:0)},remove:function(a){this.freezeScrollbar();var b=this,c=this.$el.closest(".cfw-contents");this.$el.removeClass("cfw-translate-oldfashioned");
setTimeout(function(){b.hideScrollbar();var h=c.data("componentsclass");h&&(c.addClass(h),c.siblings(".cfw-classes").addClass(h));"object"==typeof a&&a.silent?b.$el.remove():b.$el.trigger("cfwremove").remove()},Modernizr.csstransitions?300:0)}});CFW.EntryFormView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <\!--<h2><%= new_record ? "Add Your Entry" : "Edit Your Entry" %></h2>--\>                <h2><label for="cfw-email">Email Address</label></h2>                <input type="hidden" name="<%= new_record ? "decoy" : "email" %>" value="<%- email %>" />                <input type="email" id="cfw-email" name="<%= new_record ? "email" : "decoy" %>" placeholder="name@example.com" <%= new_record ? "" : \'value="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" disabled="disabled"\' %> />            </fieldset>            <fieldset>                <h2><label for="cfw-known-as">Name</label></h2>                <input type="text" id="cfw-known-as" name="known_as" placeholder="Guest" value="<%- known_as %>" />            </fieldset>            <%            _.each(wod.components, function(component) {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == component.wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                <fieldset>                    <h2><label for="cfw-component-<%= component.wp_id %>-result"><%= component.label %></label></h2>                    <input type="text" id="cfw-component-<%= component.wp_id %>-result" name="component-<%= component.wp_id %>-result" placeholder="What was your result?" value="<%- componentResult.result %>" />                    <div class="cfw-nobr">                        <label for="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority">Modifications</label>                    </div>                    <div class="cfw-nobr cfw-rx-mods-fields-css-hook">                        <input type="checkbox" id="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority" name="component-<%= component.wp_id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                        /><span>or</span><input type="text" id="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority" name="component-<%= component.wp_id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                    </div>                </fieldset>            <%            });            %>            <fieldset class="cfw-last">                <div class="cfw-notes <%= notes ? "cfw-open cfw-opaque" : "" %>">                    <h2><label for="cfw-notes">Notes</label></h2>                    <textarea rows="3" id="cfw-notes" name="notes" placeholder="Notes or Tips for next time?"><%- notes %></textarea>                </div>                <div class="cfw-footer">                    <a class="cfw-add-notes <%= notes ? "cfw-hidden" : "" %>"><label for="cfw-notes"><strong>+</strong> add notes</label></a>                    <input type="submit" value="<%= new_record ? "Submit" : "Save" %>" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:c.extend({},CFW.ModalPage.prototype.events,{'keyup input[name="email"]':"guessName",'change input[name="email"]':"guessName",'blur input[name="known_as"]':"guessName","click .cfw-add-notes":"showNotesFields",submit:"save"}),initialize:function(a){this.entries=a.entries;this.wod=a.wod;return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(_.extend({wod:this.wod,new_record:!this.model},(this.model||new CFW.Entry).toJSON())));return this},guessName:function(){var a=
this.$('input[name="email"]'),b=this.$('input[name="known_as"]');if(!(b.val().length&&this.lastGuess&&b.val()!=this.lastGuess||b.val().length&&!this.lastGuess)){var c=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.val().toLowerCase()});if(c)b.val(this.lastGuess=c.get("known_as"));else{c=a.val();if(!_.capitalize)_.capitalize=function(a){return a.substring(0,1).toUpperCase()+a.substring(1)};this.lastGuess=_.capitalize((/[^.@0-9]+/.exec(c)||[""])[0]);b.val(this.lastGuess)}}},showNotesFields:function(){var a=
this.$(".cfw-notes").addClass("cfw-open"),b=this.$(".cfw-add-notes").addClass("cfw-transparent");setTimeout(function(){a.addClass("cfw-opaque");b.addClass("cfw-hidden")},Modernizr.csstransitions?200:0)},save:function(a){a.preventDefault();if(!this.isLoading()){var b={email:this.$('input[name="email"]').val(),known_as:this.$('input[name="known_as"]').val(),component_results:[],notes:this.$('textarea[name="notes"]').val()},g={};this.$('input[name^="component-"]').each(function(){var a=c(this),b=a.attr("name").split("-"),
a="checkbox"==a.attr("type")?a.is(":checked"):a.val();g[b[1]]||(g[b[1]]={wp_id:b[1]});g[b[1]][b[2]]=a});_.each(g,function(a){b.component_results.push(a)});var h=this,a=this.model?function(){h.hideLoading();h.remove()}:function(a){h.hideLoading();h.$el.trigger("showEntryShare",a)};h.showLoading();h.$(".ajax-error-notice").remove();a=c.extend({},CFW.ajaxOptions,{success:a,error:function(a,b){h.hideLoading();b&&b.length?h.showValidationErrors(b):h.$(".cfw-footer").after(c('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Click <strong>'+
h.$('input[type="submit"]').val()+"</strong> to try again or contact athlete support if the problem persists.</label>"))},wait:!0});this.model?this.model.save(b,a):this.entries.create(b,a)||this.showValidationErrors(CFW.Entry.prototype.validate(b))}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},
showValidationErrors:function(a){var b=this;_.each(a,function(a){b.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){c('label[for="'+c(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){c(this).removeClass("cfw-invalid");c('label[for="'+c(this).attr("id")+'"]').removeClass("cfw-invalid")})})}});CFW.EmailAuthView=CFW.ModalPage.extend({tagName:"form",template:_.template('            <fieldset>                <h2><label for="cfw-email" title="Enter <%- known_as %>&apos;s Email to Edit" style="white-space:normal;">Enter <%= known_as %>&apos;s Email to Edit</label></h2>                <input type="email" id="cfw-email" name="email" placeholder="name@example.com" value="" />            </fieldset>            <fieldset class="cfw-last">                <div class="cfw-footer">                    <input type="submit" value="Unlock" />                    <input type="reset" value="Cancel" class="cfw-close-modal" />                </div>            </fieldset>        '),
events:c.extend({},CFW.ModalPage.prototype.events,{submit:"submit"}),initialize:function(){return this.render()},render:function(){this.$el.attr("action","javascript://");this.$el.html(this.template(this.model.toJSON()));return this},submit:function(a){a.preventDefault();if(!this.isLoading()){var b=this.$('input[name="email"]').val(),g=this;g.showLoading();g.$(".ajax-error-notice").remove();a=c.extend({},CFW.ajaxOptions,{complete:function(){g.hideLoading()},success:function(){g.options.success(b)},
error:function(){g.showValidationErrors(["email"]);g.$(".cfw-footer").after(c('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! That email doesn&apos;t match. Please try again or contact <a href="mailto:athletesupport@cfwhiteboard.com">athlete support</a> if there&apos;s any way we can help.</label>'))},type:"POST",data:JSON.stringify({email:b}),cache:!1});c.ajax(CFW.domain+"/athletes/"+this.model.get("athlete_id")+"/verify_email",a)}},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},
isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){var b=this;_.each(a,function(a){b.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){c('label[for="'+c(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){c(this).removeClass("cfw-invalid");c('label[for="'+c(this).attr("id")+'"]').removeClass("cfw-invalid")})})}});
CFW.EntryShareView=CFW.ModalPage.extend({template:_.template('            <div class="cfw-facebook-card">                <p>                    <a href="<%- fbShareUrl %>" class="cfw-fb-action cfw-set-url-hash cfw-close-modal">Share on Facebook</a>                </p>                <p>                    <a href="javascript://" class="cfw-fb-inaction cfw-close-modal">Not this time</a>                </p>                <div class="cfw-fb-footer"></div>                <div class="cfw-fb-logo"></div>            </div>            <p class="cfw-facebook-links">                <a href="javascript://" class="cfw-never-again cfw-close-modal">Don\'t show this message again on this computer</a>            </p>        '),
events:c.extend({},CFW.ModalPage.prototype.events,{"click .cfw-never-again":"neverAgain","click .cfw-set-url-hash":"setUrlHash"}),initialize:function(){return this.render()},render:function(){this.$el.html(this.template({fbShareUrl:this.model.url()+"/share"}));return this},setUrlHash:function(){this.model.setUrlHash()},neverAgain:function(){c.cookie("CFW",c.extend(c.cookie("CFW"),{no_facebook_share_dialog:!0}),{expires:365,path:"/"})}});CFW.WhiteboardView=Backbone.View.extend({className:"cfw-pane",
template:_.template('            <div>                <div class="cfw-window">                    <h2>Entries</h2>                    <a class="cfw-new-entry">+</a>                    <ul class="cfw-classes cfw-<%- allWods.length || 1 %>-classes cfw-components-<%= wod.components && wod.components.length || 1 %>">                        <%                        _.each(allWods, function(w) {                            %><li class="<%- w.wp_id == wod.wp_id ? "cfw-selected" : "" %>"><div>                                <a href="javascript://" data-wp_id="<%- w.wp_id %>" title="<%- w.name %>">                                    <span class="cfw-centered">                                        <span class="cfw-entry-count" data-wp_id="<%- w.wp_id %>"></span>                                        <span class="cfw-link-text"><%- w.name %></span>                                    </span>                                    <span class="cfw-separator"></span>                                </a>                            </div></li><%                        });                        %>                    </ul>                    <div class="cfw-contents"></div>                    <div class="cfw-footer">                        <a href="http://cfwhiteboard.com" target="_blank">                            What Is This?                        </a><a href="mailto:athletesupport@cfwhiteboard.com">                            Email Athlete Support                        </a>                    </div>                </div>            </div>            <a class="cfw-print cfw-admin-tool cfw-hidden" target="_blank">Print</a>        '),
events:{"click .cfw-new-entry:not([disabled])":"newEntry",hideEntryDetails:"hideEntry","cfwremove .cfw-modal":"cleanupModal",showEntryShare:"showEntryShare","click .cfw-classes a":"returnToEntryList"},initialize:function(a){this.entries=new CFW.EntryList([],{affiliateId:a.affiliateId,postId:a.postId,wod:a.wod});this.entries.on("add remove reset",this.newEntryCount,this);this.entries.on("edit",this.editEntry,this);this.entries.on("show",this.showEntry,this);this.entries.on("add change:known_as",this.updateUsers,
this);this.render();a.hidden&&this.hide();this.entries.fetch(c.extend({},CFW.ajaxOptions,{data:{postModified:a.postModified}}))},render:function(){this.$el.html(this.template({wod:this.options.wod,allWods:this.options.allWods}));this.entryListView=new CFW.EntryListView({entries:this.entries,wod:this.options.wod});this.$(".cfw-contents").append(this.entryListView.el);this.entryListView.show();"admin"==this.options.authorization&&(this.$(".cfw-print").attr("href",this.entries.url()),this.$(".cfw-admin-tool").removeClass("cfw-hidden"));
return this},attach:function(){this.$children&&this.$el.append(this.$children)},detach:function(){this.$children=this.$el.children();this.$children.detach()},show:function(){this.$el.removeClass("cfw-hidden")},hide:function(){this.$el.addClass("cfw-hidden")},newEntry:function(){this.showEntryForm()},editEntry:function(a){var b=this;this.showEmailAuth(a,function(c){b.modalView.remove({silent:!0});a.set({email:c},{silent:!0});b.showEntryForm(a)})},highlightEntry:function(a){var b=this,c=function(){(b.entries.get(a)||
b.entries.find(function(b){return b.get("athlete_slug")==a})).trigger("highlight")};if(this.entries.length)c();else this.entries.on("reset",c)},showEmailAuth:function(a,b){this.disableNewEntries();this.modalView=new CFW.EmailAuthView({model:a,success:b});this.$(".cfw-contents").append(this.modalView.el);var c=this;setTimeout(function(){c.detailView?c.detailView.hideScrollbar():c.entryListView.hideScrollbar();c.modalView.show()},0)},showEntryForm:function(a){this.modalView=new CFW.EntryFormView({entries:this.entries,
model:a,wod:this.options.wod});this.$(".cfw-contents").append(this.modalView.el);var b=this;setTimeout(function(){a||(b.detailView?b.detailView.hideScrollbar():b.entryListView.hideScrollbar());b.disableNewEntries();b.modalView.show()},0)},showEntryShare:function(a,b){var g=c.cookie("CFW");if(g&&g.no_facebook_share_dialog)this.modalView.remove();else{this.modalView.remove({silent:!0});this.modalView=new CFW.EntryShareView({model:b,wod:this.options.wod,postId:this.options.postId,postPermalink:this.options.postPermalink});
this.$(".cfw-contents").append(this.modalView.el);var h=this;setTimeout(function(){h.modalView.show()},0)}},cleanupModal:function(){this.enableNewEntries();this.detailView?this.detailView.showScrollbar():this.entryListView.showScrollbar();delete this.modalView},disableNewEntries:function(){this.$el.find(".cfw-new-entry").attr("disabled",!0)},enableNewEntries:function(){this.$el.find(".cfw-new-entry").removeAttr("disabled")},showEntry:function(a){this.detailView=new CFW.EntryDetailView({model:a,wod:this.options.wod});
this.$(".cfw-contents").append(this.detailView.el);var b=this;setTimeout(function(){b.entryListView.hide();b.detailView.show()},0)},hideEntry:function(){this.detailView.hide();this.entryListView.show();var a=this;setTimeout(function(){delete a.detailView},Modernizr.csstransitions?400:100)},newEntryCount:function(){this.$el.trigger("newEntryCount",[this.options.wod.wp_id,this.entries.length])},updateEntryCount:function(a,b){var g=this.$(".cfw-entry-count");0==g.length&&(g=this.$children.find(".cfw-entry-count"));
1<g.length&&g.each(function(){var g=c(this);g.data("wp_id")==a&&g.text(b).attr("title",""+b+" entries")})},updateUsers:function(a){var b=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.get("email").toLowerCase()});b?b.save({known_as:a.get("known_as"),count:b.get("count")+1}):b=CFW.users.create({email:a.get("email"),known_as:a.get("known_as"),count:1})},returnToEntryList:function(){this.modalView?this.modalView.remove():this.detailView&&this.hideEntry()}});CFW.WhiteboardButtonView=
Backbone.View.extend({template:_.template('            <h1>Whiteboard <span class="cfw-entry-count-all cfw-hidden"></span></h1>        '),events:{"click h1":"toggleWhiteboard","click .cfw-classes a":"showClass","newEntryCount .cfw-pane":"updateEntryCounts","mouseenter h1":"hoverButton","mouseleave h1":"unhoverButton"},initialize:function(){var a=this.$el.data("cfwhiteboard");this.affiliateId=a.affiliateId;this.postId=a.postId;this.postPermalink=a.postPermalink;this.postModified=a.postModified;this.wods=
a.wods;this.authorization=this.$el.data("authorization");return-1<_.indexOf(_.pluck(CFW.instances,"postId"),this.postId)?void 0:this.render()},render:function(){if("embed"==CFW.oxygenTank(CFW_OPTIONS,"position","display",!1)&&1<this.$el.length){this.$el.first().replaceWith(this.$el.last().addClass("cfw-display-embed"));var a=c("<div />").addClass("cfw-clearer");this.$el.last().parent().append(a)}this.$el.first().html(this.template());this.positionWhiteboard();this.whiteboardViews={};var b=this;_.each(b.wods,
function(a,c){b.wods[c].name=a.name=a.name.replace(/workout of the day/ig,"WOD");var e=new CFW.WhiteboardView({affiliateId:b.affiliateId,postId:b.postId,postPermalink:b.postPermalink,postModified:b.postModified,wod:a,allWods:b.wods,authorization:b.authorization,hidden:0==c?!1:!0});b.$el.last().append(e.el);b.whiteboardViews[a.wp_id]=e;setTimeout(function(){e.detach()},0)});return this},hoverButton:function(){this.$el.first().find("h1").addClass("cfw-hovering");this.attachWhiteboard();this.positionWhiteboard()},
unhoverButton:function(a){this.$el.first().find("h1").removeClass("cfw-hovering");this.detachWhiteboard(a)},attachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")||(this.$el.first().addClass("cfw-attached"),_.each(this.whiteboardViews,function(a){a.attach()}))},detachWhiteboard:function(){this.$el.first().hasClass("cfw-attached")&&!this.$el.first().hasClass("cfw-active")&&!this.$el.first().find("h1").hasClass("cfw-hovering")&&(this.$el.first().removeClass("cfw-attached"),_.each(this.whiteboardViews,
function(a){a.detach()}))},toggleWhiteboard:function(a){this.$el.is(".cfw-active")?this.closeWhiteboard():this.openWhiteboard();a.preventDefault()},openWhiteboard:function(){this.$el.addClass("cfw-active").removeClass("cfw-postactive")},closeWhiteboard:function(){this.$el.addClass("cfw-postactive").removeClass("cfw-active");var a=this;setTimeout(function(){a.$el.removeClass("cfw-postactive");a.detachWhiteboard()},Modernizr.csstransitions?300:0)},positionWhiteboard:function(){if("embed"==CFW.oxygenTank(CFW_OPTIONS,
"position","display",!1))this.$el.last().addClass("cfw-active");else if(this.$el.last().parent().is("body")){var a=this.$el.first().offset(),b={position:"absolute",margin:"0",top:a.top+"px"};this.$el.last().is(".position-inline, .position-block, .position-floatleft")?b.left=a.left+"px":(b.right=c(document).width()-this.$el.first().outerWidth(!1)-a.left,b.right+="px");CFW.important.css.apply(this.$el.last(),[b,!0])}},showClass:function(a){var b=a.target?c(a.target).closest("a").data("wp_id"):a;_.each(this.whiteboardViews,
function(a,c){c==b?a.show():a.hide()})},updateEntryCounts:function(a,b,c){this.whiteboardViews[b.toString()].entryCount=c;_.each(this.whiteboardViews,function(a){a.updateEntryCount(b,c)});a=_.inject(this.whiteboardViews,function(a,b){return a+(b.entryCount||0)},0);this.$(".cfw-entry-count-all").text(a).attr("title",""+a+" entries").removeClass("cfw-hidden")}});CFW.instances=[];setTimeout(function(){c(".cfwhiteboard").each(function(){var a=c(this),g=a.closest("a");g.length&&g.before(a);if(!1!=CFW.oxygenTank(CFW_OPTIONS,
"position",!1)){g=a.closest(CFW_OPTIONS.position.parent).find(CFW_OPTIONS.position.target);if(g.length)switch(CFW_OPTIONS.position.insertion){case "append":g.append(a);break;case "before":g.before(a);break;case "after":g.after(a);break;default:g.prepend(a)}switch(CFW_OPTIONS.position.alignment){case "inline":a.addClass("position-inline");break;case "block":a.addClass("position-block");break;case "floatleft":a.addClass("position-floatleft")}CFW_OPTIONS.position.margin&&CFW.important.css.apply(a,[{margin:CFW_OPTIONS.position.margin},
!0])}a=a.add(a.clone().appendTo(document.body));CFW.instances.push(new CFW.WhiteboardButtonView({el:a}))});"embed"!=CFW.oxygenTank(CFW_OPTIONS,"position","display",!1)&&(_.each(CFW.instances,function(a){a.$el.on("click",function(a){a.stopPropagation()})}),c(document.body).on("click",function(){_.each(CFW.instances,function(a){a.closeWhiteboard()})}));if(0==window.location.hash.indexOf("#cfwhiteboard")){var a=window.location.hash.split("-");_.each(CFW.instances,function(b){if(b.postId==a[1]){a[2]&&
b.showClass(a[2]);var g=b.$el.offset().top-100;c(document.body).append(c('<span id="'+window.location.hash.replace(/^#/,"")+'" style="position:absolute; top:'+g+'px; display:none;"></span>'));c("html, body").animate({scrollTop:g},800,function(){b.attachWhiteboard();b.openWhiteboard();a[2]&&a[3]&&b.whiteboardViews[a[2]].highlightEntry(a[3])})}})}},c.browser.msie?1500:0)});
