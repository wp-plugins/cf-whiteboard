var JSON;JSON||(JSON={});
(function(){function e(a){return 10>a?"0"+a:a}function a(a){i.lastIndex=0;return i.test(a)?'"'+a.replace(i,function(a){var f=j[a];return"string"===typeof f?f:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(e,b){var j,i,q,r,p=h,n,o=b[e];o&&"object"===typeof o&&"function"===typeof o.toJSON&&(o=o.toJSON(e));"function"===typeof m&&(o=m.call(b,e,o));switch(typeof o){case "string":return a(o);case "number":return isFinite(o)?""+o:"null";case "boolean":case "null":return""+o;
case "object":if(!o)return"null";h+=f;n=[];if("[object Array]"===Object.prototype.toString.apply(o)){r=o.length;for(j=0;j<r;j+=1)n[j]=c(j,o)||"null";q=0===n.length?"[]":h?"[\n"+h+n.join(",\n"+h)+"\n"+p+"]":"["+n.join(",")+"]";h=p;return q}if(m&&"object"===typeof m){r=m.length;for(j=0;j<r;j+=1)"string"===typeof m[j]&&(i=m[j],(q=c(i,o))&&n.push(a(i)+(h?": ":":")+q))}else for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(q=c(i,o))&&n.push(a(i)+(h?": ":":")+q);q=0===n.length?"{}":h?"{\n"+h+n.join(",\n"+
h)+"\n"+p+"}":"{"+n.join(",")+"}";h=p;return q}}if("function"!==typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h,f,j={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;if("function"!==typeof JSON.stringify)JSON.stringify=function(a,e,b){var j;f=h="";if("number"===typeof b)for(j=0;j<b;j+=1)f+=" ";else"string"===typeof b&&(f=b);if((m=e)&&"function"!==typeof e&&("object"!==typeof e||"number"!==typeof e.length))throw Error("JSON.stringify");return c("",
{"":a})};if("function"!==typeof JSON.parse)JSON.parse=function(a,e){function f(a,b){var c,j,m=a[b];if(m&&"object"===typeof m)for(c in m)Object.prototype.hasOwnProperty.call(m,c)&&(j=f(m,c),void 0!==j?m[c]=j:delete m[c]);return e.call(a,b,m)}var c,a=""+a;b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return c=eval("("+a+")"),"function"===typeof e?f({"":c},""):c;throw new SyntaxError("JSON.parse");}})();(function(e){function a(a,f,b){var c,b=b||"",j=b.match(RegExp("(?:^|\\s|;)("+a+")\\s*:\\s*([^;]*(?:;|$))","i"));j&&(j[0]=j[0].replace(/^;/,""));null===f?c="":"string"===typeof f&&(c=a+":"+f+" !important;");j?("boolean"===typeof f&&(c=e.important(a+":"+j[2],f)),b=b.replace(j[0],c)):"undefined"!==typeof c&&(b=e.trim(b),""!==b&&(";"!==b.slice(-1)&&(b+=";"),b+=" "),b+=c);return b}function c(a,f){var b=c.re;if(!b)b=c.re=/\s*(! ?important)?[\s\r\t\n]*;/g;return!1===f?a.replace(b,";"):a.replace(b,function(a,
b){return b?a:" !important;"})}function b(a,f){var e=b.re;if(!e)e=b.re=/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g;return a.replace(e,function(a,b){return c(b,f)})}var i=!1,h={},f={},j=e.each({css:function(b,f){var c={},j=e(this),i=j.attr("style");if("string"===typeof b){if("undefined"===typeof f)return h.css.apply(this,arguments);c[b]=f}else if("object"===typeof b)c=b;else return j;e.each(c,function(b,f){i=a(b,f,i)});return j.attr("style",i)}},function(a,b){h[a]=e.fn[a];b.overridden=!0;f[a]=function(){var f=
e.makeArray(arguments),c=f[f.length-1],j=e(this);return!0===c?b.apply(j,f.slice(0,-1)):i&&!1!==c?b.apply(j,f):h[a].apply(j,f)}});e.extend(e.fn,f);e.important=e.extend(function(){var a=e.makeArray(arguments),f;if("string"===typeof a[0]){if("undefined"===typeof a[1]||"boolean"===typeof a[1])return f=!1!==a[1],/<\w+.*>/.test(a[0])?b(a[0],f):c(a[0],f)}else if(e.isFunction(a[0]))f=i,e.important.status=i=!0,a[0].call(this),e.important.status=i=f;else if("undefined"===typeof a[0]||"boolean"===typeof a[0])e.important.status=
i=!1!==a[0];return i},{status:i,noConflict:function(){e.each(h,function(a,f){e.fn[a]=f});return j},declaration:a});e.fn.important=function(b){var j=e(this),i=e.makeArray(arguments).concat(!0),h=j.data("nodeName"),k;if("undefined"===typeof b||"boolean"===typeof b)h||(h=j.attr("nodeName").toLowerCase(),j.data("nodeName",h)),"style"===h?(k=!1!==b,j.html(c(j.html(),k)),i=j.attr("sheet"),_("stylesheet",i),i&&i.cssRules&&(_("cssRules",i.cssRules),e.each(i.cssRules,function(a,b){_("rule",b,b.cssText);_(e.important(b.style.cssText,
k));if(b.type===CSSRule.STYLE_RULE)b.style.cssText=e.important(b.style.cssText,k)}))):j.attr("style",e.important(j.attr("style"),b));else{if("object"===typeof b)return i.unshift("css"),j.important.apply(this,i);if("string"===typeof b)if(e.isFunction(f[b]))i=i.slice(1),f[b].apply(j,i);else{if("undefined"===typeof i[1]||"boolean"===typeof i[1])k=!1!==i[1],j.attr("style",a(b,k,j.attr("style")))}else e.isFunction(b)&&e.important.call(this,b)}return j}})(jQuery);(function(e){var a=function(a){var e=a.data("scrollbarPaper")||a.data("scrollbar-paper"),c=a.innerHeight(),f=c-a.height();return{height:c,ratio:c/(e.clearer.position().top-((e.content.children(":visible").eq(0).position()||{}).top||0)+f),offset:a.offset()}},c={_init:function(b){b=e.extend({parentSelector:"",important:!1,show:function(a){a.show()},hide:function(a){a.hide()}},b);return this.each(function(){var c=e(this),h=c.data("scrollbarPaper")||c.data("scrollbar-paper");if(!h){c.css({"overflow-x":"hidden",
"overflow-y":"auto"},!!b.important);h=c.closest(b.parentSelector);h.length||(h=c.offsetParent());var f=e('<div class="scrollbarpaper-container"></div>').appendTo(h);b.hide(f);var j=e('<div class="scrollbarpaper-track"></div>').appendTo(f),m=e('<div class="scrollbarpaper-drag"></div>').appendTo(j),h={options:b,offsetParent:h,paper:f,track:j,drag:m,dragTop:e('<div class="scrollbarpaper-drag-top"></div>').appendTo(m),dragBottom:e('<div class="scrollbarpaper-drag-bottom"></div>').appendTo(m),content:c,
clearer:e('<div style="clear:both;"></div>').appendTo(c),offsetHeight:j.outerHeight()-j.height()};c.data("scrollbarPaper",h).data("scrollbar-paper",h);var t=a(c),u=setInterval(function(){if(c.closest(".cfwhiteboard").length){var b=a(c);if(b.height!=t.height||b.ratio!=t.ratio||b.offset.left!=t.offset.left||b.offset.top!=t.offset.top)c.scrollbarPaper("update"),t=b}else clearInterval(u),f.remove()},200)}c.scrollbarPaper("update")})},update:function(b){return this.each(function(){var c=e(this);if(c.is(":visible")&&
!c.data("scrollbarpaperfrozen")){var h=c.data("scrollbarPaper")||c.data("scrollbar-paper");b=b||a(c);c.unbind(".scrollbarPaper");var f=c.innerHeight()-h.offsetHeight;h.track.css({height:f+"px"},!!h.options.important);var j=0<h.offsetParent.not("html, body").length?h.offsetParent.offset():{left:0,top:0};h.paper.css({left:-j.left+b.offset.left+c.innerWidth()-h.paper.width()+"px",top:-j.top+b.offset.top+"px"},!!h.options.important);var m=Math.max(Math.round(f*b.ratio),h.dragTop.height()+h.dragBottom.height());
h.drag.css({height:m+"px"},!!h.options.important);j=function(){h.drag.css({top:Math.min(Math.round(c.scrollTop()*b.ratio),f-m)+"px"},!!h.options.important)};j();c.bind("scroll.scrollbarPaper",j);var t=function(a){return a.pageY||(a.originalEvent&&(a.originalEvent.targetTouches||a.originalEvent.touches||[])[0]||a).pageY},u=function(){e("body").unbind("mousemove.scrollbarPaper touchmove.scrollbarPaper")};h.drag.bind("mousedown.scrollbarPaper touchstart.scrollbarPaper",function(a){u();var f=t(a)-h.drag.offset().top;
e("body").bind("mousemove.scrollbarPaper touchmove.scrollbarPaper",function(a){a.preventDefault();c.scrollTop((t(a)-c.offset().top-f)/b.ratio);return!1}).bind("mouseup.scrollbarPaper touchend.scrollbarPaper",u);return!1});1>b.ratio?(h.options.show(h.drag),h.content.addClass("scrollbarpaper-visible")):(h.options.hide(h.drag),h.content.removeClass("scrollbarpaper-visible"))}})},show:function(){return this.each(function(){var a=e(this),c=a.data("scrollbarPaper")||a.data("scrollbar-paper");c&&(a.scrollbarPaper("update"),
"function"==typeof c.options.show?c.options.show(c.paper):c.paper.show())})},hide:function(){return this.each(function(){var a=e(this);(a=a.data("scrollbarPaper")||a.data("scrollbar-paper"))&&("function"==typeof a.options.hide?a.options.hide(a.paper):a.paper.hide())})},freeze:function(){return this.each(function(){e(this).data("scrollbarpaperfrozen",!0)})},thaw:function(){return this.each(function(){e(this).data("scrollbarpaperfrozen",!1)})}};e.fn.scrollbarPaper=function(a){if(c[a])return c[a].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return c._init.apply(this,arguments);throw"Method "+a+" does not exist on jQuery.scrollbarPaper.";}})(jQuery);(function(){function e(l,a,g){if(l===a)return 0!==l||1/l==1/a;if(null==l||null==a)return l===a;if(l._chain)l=l._wrapped;if(a._chain)a=a._wrapped;if(l.isEqual&&d.isFunction(l.isEqual))return l.isEqual(a);if(a.isEqual&&d.isFunction(a.isEqual))return a.isEqual(l);var f=m.call(l);if(f!=m.call(a))return!1;switch(f){case "[object String]":return l==""+a;case "[object Number]":return l!=+l?a!=+a:0==l?1/l==1/a:l==+a;case "[object Date]":case "[object Boolean]":return+l==+a;case "[object RegExp]":return l.source==
a.source&&l.global==a.global&&l.multiline==a.multiline&&l.ignoreCase==a.ignoreCase}if("object"!=typeof l||"object"!=typeof a)return!1;for(var b=g.length;b--;)if(g[b]==l)return!0;g.push(l);var b=0,c=!0;if("[object Array]"==f){if(b=l.length,c=b==a.length)for(;b--&&(c=b in l==b in a&&e(l[b],a[b],g)););}else{if("constructor"in l!="constructor"in a||l.constructor!=a.constructor)return!1;for(var j in l)if(d.has(l,j)&&(b++,!(c=d.has(a,j)&&e(l[j],a[j],g))))break;if(c){for(j in a)if(d.has(a,j)&&!b--)break;
c=!b}}g.pop();return c}var a=this,c=a._,b={},i=Array.prototype,h=Object.prototype,f=i.slice,j=i.unshift,m=h.toString,t=h.hasOwnProperty,u=i.forEach,v=i.map,k=i.reduce,q=i.reduceRight,r=i.filter,p=i.every,n=i.some,o=i.indexOf,w=i.lastIndexOf,h=Array.isArray,g=Object.keys,y=Function.prototype.bind,d=function(a){return new x(a)};if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports)exports=module.exports=d;exports._=d}else a._=d;d.VERSION="1.3.1";var s=d.each=d.forEach=function(a,
g,f){if(null!=a)if(u&&a.forEach===u)a.forEach(g,f);else if(a.length===+a.length)for(var c=0,e=a.length;c<e&&!(c in a&&g.call(f,a[c],c,a)===b);c++);else for(c in a)if(d.has(a,c)&&g.call(f,a[c],c,a)===b)break};d.map=d.collect=function(a,g,d){var f=[];if(null==a)return f;if(v&&a.map===v)return a.map(g,d);s(a,function(a,l,b){f[f.length]=g.call(d,a,l,b)});if(a.length===+a.length)f.length=a.length;return f};d.reduce=d.foldl=d.inject=function(a,g,f,b){var c=2<arguments.length;null==a&&(a=[]);if(k&&a.reduce===
k)return b&&(g=d.bind(g,b)),c?a.reduce(g,f):a.reduce(g);s(a,function(a,d,l){c?f=g.call(b,f,a,d,l):(f=a,c=!0)});if(!c)throw new TypeError("Reduce of empty array with no initial value");return f};d.reduceRight=d.foldr=function(a,g,f,b){var c=2<arguments.length;null==a&&(a=[]);if(q&&a.reduceRight===q)return b&&(g=d.bind(g,b)),c?a.reduceRight(g,f):a.reduceRight(g);var e=d.toArray(a).reverse();b&&!c&&(g=d.bind(g,b));return c?d.reduce(e,g,f,b):d.reduce(e,g)};d.find=d.detect=function(a,g,d){var f;C(a,function(a,
l,b){if(g.call(d,a,l,b))return f=a,!0});return f};d.filter=d.select=function(a,g,d){var f=[];if(null==a)return f;if(r&&a.filter===r)return a.filter(g,d);s(a,function(a,l,b){g.call(d,a,l,b)&&(f[f.length]=a)});return f};d.reject=function(a,g,d){var f=[];if(null==a)return f;s(a,function(a,l,b){g.call(d,a,l,b)||(f[f.length]=a)});return f};d.every=d.all=function(a,g,d){var f=!0;if(null==a)return f;if(p&&a.every===p)return a.every(g,d);s(a,function(a,l,c){if(!(f=f&&g.call(d,a,l,c)))return b});return f};
var C=d.some=d.any=function(a,g,f){g||(g=d.identity);var c=!1;if(null==a)return c;if(n&&a.some===n)return a.some(g,f);s(a,function(a,d,l){if(c||(c=g.call(f,a,d,l)))return b});return!!c};d.include=d.contains=function(a,g){var d;return null==a?!1:o&&a.indexOf===o?-1!=a.indexOf(g):d=C(a,function(a){return a===g})};d.invoke=function(a,g){var b=f.call(arguments,2);return d.map(a,function(a){return(d.isFunction(g)?g||a:a[g]).apply(a,b)})};d.pluck=function(a,g){return d.map(a,function(a){return a[g]})};
d.max=function(a,g,f){if(!g&&d.isArray(a))return Math.max.apply(Math,a);if(!g&&d.isEmpty(a))return-Infinity;var b={computed:-Infinity};s(a,function(a,d,c){d=g?g.call(f,a,d,c):a;d>=b.computed&&(b={value:a,computed:d})});return b.value};d.min=function(a,g,f){if(!g&&d.isArray(a))return Math.min.apply(Math,a);if(!g&&d.isEmpty(a))return Infinity;var b={computed:Infinity};s(a,function(a,d,c){d=g?g.call(f,a,d,c):a;d<b.computed&&(b={value:a,computed:d})});return b.value};d.shuffle=function(a){var g=[],d;
s(a,function(a,f){0==f?g[0]=a:(d=Math.floor(Math.random()*(f+1)),g[f]=g[d],g[d]=a)});return g};d.sortBy=function(a,g,f){return d.pluck(d.map(a,function(a,d,b){return{value:a,criteria:g.call(f,a,d,b)}}).sort(function(a,g){var d=a.criteria,f=g.criteria;return d<f?-1:d>f?1:0}),"value")};d.groupBy=function(a,g){var f={},b=d.isFunction(g)?g:function(a){return a[g]};s(a,function(a,g){var d=b(a,g);(f[d]||(f[d]=[])).push(a)});return f};d.sortedIndex=function(a,g,f){f||(f=d.identity);for(var b=0,c=a.length;b<
c;){var e=b+c>>1;f(a[e])<f(g)?b=e+1:c=e}return b};d.toArray=function(a){return!a?[]:a.toArray?a.toArray():d.isArray(a)?f.call(a):d.isArguments(a)?f.call(a):d.values(a)};d.size=function(a){return d.toArray(a).length};d.first=d.head=function(a,g,d){return null!=g&&!d?f.call(a,0,g):a[0]};d.initial=function(a,g,d){return f.call(a,0,a.length-(null==g||d?1:g))};d.last=function(a,g,d){return null!=g&&!d?f.call(a,Math.max(a.length-g,0)):a[a.length-1]};d.rest=d.tail=function(a,g,d){return f.call(a,null==g||
d?1:g)};d.compact=function(a){return d.filter(a,function(a){return!!a})};d.flatten=function(a,g){return d.reduce(a,function(a,f){if(d.isArray(f))return a.concat(g?f:d.flatten(f));a[a.length]=f;return a},[])};d.without=function(a){return d.difference(a,f.call(arguments,1))};d.uniq=d.unique=function(a,g,f){var f=f?d.map(a,f):a,b=[];d.reduce(f,function(f,c,e){if(0==e||(!0===g?d.last(f)!=c:!d.include(f,c)))f[f.length]=c,b[b.length]=a[e];return f},[]);return b};d.union=function(){return d.uniq(d.flatten(arguments,
!0))};d.intersection=d.intersect=function(a){var g=f.call(arguments,1);return d.filter(d.uniq(a),function(a){return d.every(g,function(g){return 0<=d.indexOf(g,a)})})};d.difference=function(a){var g=d.flatten(f.call(arguments,1));return d.filter(a,function(a){return!d.include(g,a)})};d.zip=function(){for(var a=f.call(arguments),g=d.max(d.pluck(a,"length")),b=Array(g),c=0;c<g;c++)b[c]=d.pluck(a,""+c);return b};d.indexOf=function(a,g,f){if(null==a)return-1;var b;if(f)return f=d.sortedIndex(a,g),a[f]===
g?f:-1;if(o&&a.indexOf===o)return a.indexOf(g);for(f=0,b=a.length;f<b;f++)if(f in a&&a[f]===g)return f;return-1};d.lastIndexOf=function(a,g){if(null==a)return-1;if(w&&a.lastIndexOf===w)return a.lastIndexOf(g);for(var d=a.length;d--;)if(d in a&&a[d]===g)return d;return-1};d.range=function(a,g,d){1>=arguments.length&&(g=a||0,a=0);for(var d=arguments[2]||1,f=Math.max(Math.ceil((g-a)/d),0),b=0,c=Array(f);b<f;)c[b++]=a,a+=d;return c};var D=function(){};d.bind=function(a,g){var b,c;if(a.bind===y&&y)return y.apply(a,
f.call(arguments,1));if(!d.isFunction(a))throw new TypeError;c=f.call(arguments,2);return b=function(){if(!(this instanceof b))return a.apply(g,c.concat(f.call(arguments)));D.prototype=a.prototype;var d=new D,e=a.apply(d,c.concat(f.call(arguments)));return Object(e)===e?e:d}};d.bindAll=function(a){var g=f.call(arguments,1);0==g.length&&(g=d.functions(a));s(g,function(g){a[g]=d.bind(a[g],a)});return a};d.memoize=function(a,g){var f={};g||(g=d.identity);return function(){var b=g.apply(this,arguments);
return d.has(f,b)?f[b]:f[b]=a.apply(this,arguments)}};d.delay=function(a,g){var d=f.call(arguments,2);return setTimeout(function(){return a.apply(a,d)},g)};d.defer=function(a){return d.delay.apply(d,[a,1].concat(f.call(arguments,1)))};d.throttle=function(a,g){var f,b,c,e,j,y=d.debounce(function(){j=e=!1},g);return function(){f=this;b=arguments;c||(c=setTimeout(function(){c=null;j&&a.apply(f,b);y()},g));e?j=!0:a.apply(f,b);y();e=!0}};d.debounce=function(a,g){var d;return function(){var f=this,b=arguments;
clearTimeout(d);d=setTimeout(function(){d=null;a.apply(f,b)},g)}};d.once=function(a){var g=!1,d;return function(){if(g)return d;g=!0;return d=a.apply(this,arguments)}};d.wrap=function(a,g){return function(){var d=[a].concat(f.call(arguments,0));return g.apply(this,d)}};d.compose=function(){var a=arguments;return function(){for(var g=arguments,d=a.length-1;0<=d;d--)g=[a[d].apply(this,g)];return g[0]}};d.after=function(a,g){return 0>=a?g():function(){if(1>--a)return g.apply(this,arguments)}};d.keys=
g||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var g=[],f;for(f in a)d.has(a,f)&&(g[g.length]=f);return g};d.values=function(a){return d.map(a,d.identity)};d.functions=d.methods=function(a){var g=[],f;for(f in a)d.isFunction(a[f])&&g.push(f);return g.sort()};d.extend=function(a){s(f.call(arguments,1),function(g){for(var d in g)a[d]=g[d]});return a};d.defaults=function(a){s(f.call(arguments,1),function(g){for(var d in g)null==a[d]&&(a[d]=g[d])});return a};d.clone=function(a){return!d.isObject(a)?
a:d.isArray(a)?a.slice():d.extend({},a)};d.tap=function(a,g){g(a);return a};d.isEqual=function(a,g){return e(a,g,[])};d.isEmpty=function(a){if(d.isArray(a)||d.isString(a))return 0===a.length;for(var g in a)if(d.has(a,g))return!1;return!0};d.isElement=function(a){return!!(a&&1==a.nodeType)};d.isArray=h||function(a){return"[object Array]"==m.call(a)};d.isObject=function(a){return a===Object(a)};d.isArguments=function(a){return"[object Arguments]"==m.call(a)};if(!d.isArguments(arguments))d.isArguments=
function(a){return!(!a||!d.has(a,"callee"))};d.isFunction=function(a){return"[object Function]"==m.call(a)};d.isString=function(a){return"[object String]"==m.call(a)};d.isNumber=function(a){return"[object Number]"==m.call(a)};d.isNaN=function(a){return a!==a};d.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==m.call(a)};d.isDate=function(a){return"[object Date]"==m.call(a)};d.isRegExp=function(a){return"[object RegExp]"==m.call(a)};d.isNull=function(a){return null===a};d.isUndefined=
function(a){return void 0===a};d.has=function(a,g){return t.call(a,g)};d.noConflict=function(){a._=c;return this};d.identity=function(a){return a};d.times=function(a,g,d){for(var f=0;f<a;f++)g.call(d,f)};d.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};d.mixin=function(a){s(d.functions(a),function(g){E(g,d[g]=a[g])})};var F=0;d.uniqueId=function(a){var g=F++;return a?a+g:g};d.templateSettings=
{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/.^/,A=function(a){return a.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};d.template=function(a,g){var f=d.templateSettings,f="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(f.escape||z,function(a,g){return"',_.escape("+A(g)+"),'"}).replace(f.interpolate||z,function(a,g){return"',"+A(g)+",'"}).replace(f.evaluate||z,function(a,
g){return"');"+A(g).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",b=new Function("obj","_",f);return g?b(g,d):function(a){return b.call(this,a,d)}};d.chain=function(a){return d(a).chain()};var x=function(a){this._wrapped=a};d.prototype=x.prototype;var B=function(a,g){return g?d(a).chain():a},E=function(a,g){x.prototype[a]=function(){var a=f.call(arguments);j.call(a,this._wrapped);return B(g.apply(d,a),this._chain)}};
d.mixin(d);s("pop,push,reverse,shift,sort,splice,unshift".split(","),function(a){var g=i[a];x.prototype[a]=function(){var d=this._wrapped;g.apply(d,arguments);var f=d.length;("shift"==a||"splice"==a)&&0===f&&delete d[0];return B(d,this._chain)}});s(["concat","join","slice"],function(a){var g=i[a];x.prototype[a]=function(){return B(g.apply(this._wrapped,arguments),this._chain)}});x.prototype.chain=function(){this._chain=!0;return this};x.prototype.value=function(){return this._wrapped}}).call(this);
(function(e){var a=String.prototype.trim,c=function(a,b){for(var c=[];0<b;c[--b]=a);return c.join("")},b=function(a){return function(){for(var b=Array.prototype.slice.call(arguments),c=0;c<b.length;c++)b[c]=null==b[c]?"":""+b[c];return a.apply(null,b)}},i=function(){function a(f){return Object.prototype.toString.call(f).slice(8,-1).toLowerCase()}var b=function(){b.cache.hasOwnProperty(arguments[0])||(b.cache[arguments[0]]=b.parse(arguments[0]));return b.format.call(null,b.cache[arguments[0]],arguments)};
b.format=function(b,e){var j=1,h=b.length,k="",q=[],r,p,n,o;for(r=0;r<h;r++)if(k=a(b[r]),"string"===k)q.push(b[r]);else if("array"===k){n=b[r];if(n[2]){k=e[j];for(p=0;p<n[2].length;p++){if(!k.hasOwnProperty(n[2][p]))throw i('[_.sprintf] property "%s" does not exist',n[2][p]);k=k[n[2][p]]}}else k=n[1]?e[n[1]]:e[j++];if(/[^s]/.test(n[8])&&"number"!=a(k))throw i("[_.sprintf] expecting number but found %s",a(k));switch(n[8]){case "b":k=k.toString(2);break;case "c":k=String.fromCharCode(k);break;case "d":k=
parseInt(k,10);break;case "e":k=n[7]?k.toExponential(n[7]):k.toExponential();break;case "f":k=n[7]?parseFloat(k).toFixed(n[7]):parseFloat(k);break;case "o":k=k.toString(8);break;case "s":k=(k=""+k)&&n[7]?k.substring(0,n[7]):k;break;case "u":k=Math.abs(k);break;case "x":k=k.toString(16);break;case "X":k=k.toString(16).toUpperCase()}k=/[def]/.test(n[8])&&n[3]&&0<=k?"+"+k:k;p=n[4]?"0"==n[4]?"0":n[4].charAt(1):" ";o=n[6]-(""+k).length;p=n[6]?c(p,o):"";q.push(n[5]?k+p:p+k)}return q.join("")};b.cache={};
b.parse=function(a){for(var f=[],b=[],c=0;a;){if(null!==(f=/^[^\x25]+/.exec(a)))b.push(f[0]);else if(null!==(f=/^\x25{2}/.exec(a)))b.push("%");else if(null!==(f=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(a))){if(f[2]){var c=c|1,e=[],j=f[2],h=[];if(null!==(h=/^([a-z_][a-z_\d]*)/i.exec(j)))for(e.push(h[1]);""!==(j=j.substring(h[0].length));)if(null!==(h=/^\.([a-z_][a-z_\d]*)/i.exec(j)))e.push(h[1]);else if(null!==(h=/^\[(\d+)\]/.exec(j)))e.push(h[1]);
else throw"[_.sprintf] huh?";else throw"[_.sprintf] huh?";f[2]=e}else c|=2;if(3===c)throw"[_.sprintf] mixing positional and named placeholders is not (yet) supported";b.push(f)}else throw"[_.sprintf] huh?";a=a.substring(f[0].length)}return b};return b}(),h={VERSION:"1.2.0",isBlank:b(function(a){return/^\s*$/.test(a)}),stripTags:b(function(a){return a.replace(/<\/?[^>]+>/ig,"")}),capitalize:b(function(a){return a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()}),chop:b(function(a,b){for(var b=
1*b||a.length,c=[],e=0;e<a.length;)c.push(a.slice(e,e+b)),e+=b;return c}),clean:b(function(a){return h.strip(a.replace(/\s+/g," "))}),count:b(function(a,b){for(var c=0,e,h=0;h<a.length;)e=a.indexOf(b,h),0<=e&&c++,h=h+(0<=e?e:0)+b.length;return c}),chars:b(function(a){return a.split("")}),escapeHTML:b(function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}),unescapeHTML:b(function(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,
">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")}),escapeRegExp:b(function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")}),insert:b(function(a,b,c){a=a.split("");a.splice(1*b||0,0,c);return a.join("")}),include:b(function(a,b){return-1!==a.indexOf(b)}),join:b(function(a){var b=Array.prototype.slice.call(arguments);return b.join(b.shift())}),lines:b(function(a){return a.split("\n")}),reverse:b(function(a){return Array.prototype.reverse.apply((""+a).split("")).join("")}),
splice:b(function(a,b,c,e){a=a.split("");a.splice(1*b||0,1*c||0,e);return a.join("")}),startsWith:b(function(a,b){return a.length>=b.length&&a.substring(0,b.length)===b}),endsWith:b(function(a,b){return a.length>=b.length&&a.substring(a.length-b.length)===b}),succ:b(function(a){var b=a.split("");b.splice(a.length-1,1,String.fromCharCode(a.charCodeAt(a.length-1)+1));return b.join("")}),titleize:b(function(a){for(var a=a.split(" "),b,c=0;c<a.length;c++)b=a[c].split(""),"undefined"!==typeof b[0]&&(b[0]=
b[0].toUpperCase()),c+1===a.length?a[c]=b.join(""):a[c]=b.join("")+" ";return a.join("")}),camelize:b(function(a){return h.trim(a).replace(/(\-|_|\s)+(.)?/g,function(a,b,c){return c?c.toUpperCase():""})}),underscored:function(a){return h.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/\-|\s+/g,"_").toLowerCase()},dasherize:function(a){return h.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1-$2").replace(/^([A-Z]+)/,"-$1").replace(/\_|\s+/g,"-").toLowerCase()},humanize:function(a){return h.capitalize(this.underscored(a).replace(/_id$/,
"").replace(/_/g," "))},trim:b(function(b,c){if(!c&&a)return a.call(b);c=c?h.escapeRegExp(c):"\\s";return b.replace(RegExp("^["+c+"]+|["+c+"]+$","g"),"")}),ltrim:b(function(a,b){b=b?h.escapeRegExp(b):"\\s";return a.replace(RegExp("^["+b+"]+","g"),"")}),rtrim:b(function(a,b){b=b?h.escapeRegExp(b):"\\s";return a.replace(RegExp("["+b+"]+$","g"),"")}),truncate:b(function(a,b,c){b=1*b||0;return a.length>b?a.slice(0,b)+(c||"..."):a}),prune:b(function(a,b,c){var c=c||"...",b=1*b||0,e="",e=0===a.substring(b-
1,b+1).search(/^\w\w$/)?h.rtrim(a.slice(0,b).replace(/([\W][\w]*)$/,"")):h.rtrim(a.slice(0,b)),e=e.replace(/\W+$/,"");return e.length+c.length>a.length?a:e+c}),words:function(a,b){return(""+a).split(b||" ")},pad:b(function(a,b,e,h){var i="",i=0,b=1*b||0;e?1<e.length&&(e=e.charAt(0)):e=" ";switch(h){case "right":i=b-a.length;i=c(e,i);a+=i;break;case "both":i=b-a.length;i={left:c(e,Math.ceil(i/2)),right:c(e,Math.floor(i/2))};a=i.left+a+i.right;break;default:i=b-a.length,i=c(e,i),a=i+a}return a}),lpad:function(a,
b,c){return h.pad(a,b,c)},rpad:function(a,b,c){return h.pad(a,b,c,"right")},lrpad:function(a,b,c){return h.pad(a,b,c,"both")},sprintf:i,vsprintf:function(a,b){b.unshift(a);return i.apply(null,b)},toNumber:function(a,b){var c;c=1*(1*a||0).toFixed(1*b||0)||0;return!(0===c&&"0"!==a&&0!==a)?c:Number.NaN},strRight:b(function(a,b){var c=!b?-1:a.indexOf(b);return-1!=c?a.slice(c+b.length,a.length):a}),strRightBack:b(function(a,b){var c=!b?-1:a.lastIndexOf(b);return-1!=c?a.slice(c+b.length,a.length):a}),strLeft:b(function(a,
b){var c=!b?-1:a.indexOf(b);return-1!=c?a.slice(0,c):a}),strLeftBack:b(function(a,b){var c=a.lastIndexOf(b);return-1!=c?a.slice(0,c):a}),exports:function(){var a={},b;for(b in this)if(this.hasOwnProperty(b)&&!("include"==b||"contains"==b||"reverse"==b))a[b]=this[b];return a}};h.strip=h.trim;h.lstrip=h.ltrim;h.rstrip=h.rtrim;h.center=h.lrpad;h.ljust=h.lpad;h.rjust=h.rpad;h.contains=h.include;if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports)module.exports=h;exports._s=
h}else"undefined"!==typeof e._?(e._.string=h,e._.str=e._.string):e._={string:h,str:h}})(this||window);(function(){var e=this,a=e.Backbone,c;c="undefined"!==typeof exports?exports:e.Backbone={};c.VERSION="0.5.3";var b=e._;if(!b&&"undefined"!==typeof require)b=require("underscore")._;var i=e.jQuery||e.Zepto;c.noConflict=function(){e.Backbone=a;return this};c.emulateHTTP=!1;c.emulateJSON=!1;c.Events={bind:function(a,b,d){var c=this._callbacks||(this._callbacks={});(c[a]||(c[a]=[])).push([b,d]);return this},unbind:function(a,b){var d;if(a){if(d=this._callbacks)if(b){d=d[a];if(!d)return this;for(var c=
0,e=d.length;c<e;c++)if(d[c]&&b===d[c][0]){d[c]=null;break}}else d[a]=[]}else this._callbacks={};return this},trigger:function(a){var b,d,c,e,f=2;if(!(d=this._callbacks))return this;for(;f--;)if(b=f?a:"all",b=d[b])for(var h=0,i=b.length;h<i;h++)(c=b[h])?(e=f?Array.prototype.slice.call(arguments,1):arguments,c[0].apply(c[1]||this,e)):(b.splice(h,1),h--,i--);return this}};c.Model=function(a,c){var d;a||(a={});if(d=this.defaults)b.isFunction(d)&&(d=d.call(this)),a=b.extend({},d,a);this.attributes={};
this._escapedAttributes={};this.cid=b.uniqueId("c");this.set(a,{silent:!0});this._changed=!1;this._previousAttributes=b.clone(this.attributes);if(c&&c.collection)this.collection=c.collection;this.initialize(a,c)};b.extend(c.Model.prototype,c.Events,{_previousAttributes:null,_changed:!1,idAttribute:"id",initialize:function(){},toJSON:function(){return b.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;b=this.attributes[a];
return this._escapedAttributes[a]=(null==b?"":""+b).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},has:function(a){return null!=this.attributes[a]},set:function(a,c){c||(c={});if(!a)return this;if(a.attributes)a=a.attributes;var d=this.attributes,e=this._escapedAttributes;if(!c.silent&&this.validate&&!this._performValidation(a,c))return!1;if(this.idAttribute in a)this.id=a[this.idAttribute];
var f=this._changing;this._changing=!0;for(var h in a){var i=a[h];if(!b.isEqual(d[h],i))d[h]=i,delete e[h],this._changed=!0,c.silent||this.trigger("change:"+h,this,i,c)}!f&&!c.silent&&this._changed&&this.change(c);this._changing=!1;return this},unset:function(a,b){if(!(a in this.attributes))return this;b||(b={});var d={};d[a]=void 0;if(!b.silent&&this.validate&&!this._performValidation(d,b))return!1;delete this.attributes[a];delete this._escapedAttributes[a];a==this.idAttribute&&delete this.id;this._changed=
!0;b.silent||(this.trigger("change:"+a,this,void 0,b),this.change(b));return this},clear:function(a){a||(a={});var b,d=this.attributes,c={};for(b in d)c[b]=void 0;if(!a.silent&&this.validate&&!this._performValidation(c,a))return!1;this.attributes={};this._escapedAttributes={};this._changed=!0;if(!a.silent){for(b in d)this.trigger("change:"+b,this,void 0,a);this.change(a)}return this},fetch:function(a){a||(a={});var b=this,d=a.success;a.success=function(c,e,f){if(!b.set(b.parse(c,f),a))return!1;d&&
d(b,c)};a.error=w(a.error,b,a);return(this.sync||c.sync).call(this,"read",this,a)},save:function(a,b){b||(b={});if(a&&!this.set(a,b))return!1;var d=this,e=b.success;b.success=function(a,g,c){if(!d.set(d.parse(a,c),b))return!1;e&&e(d,a,c)};b.error=w(b.error,d,b);var f=this.isNew()?"create":"update";return(this.sync||c.sync).call(this,f,this,b)},destroy:function(a){a||(a={});if(this.isNew())return this.trigger("destroy",this,this.collection,a);var b=this,d=a.success;a.success=function(c){b.trigger("destroy",
b,b.collection,a);d&&d(b,c)};a.error=w(a.error,b,a);return(this.sync||c.sync).call(this,"delete",this,a)},url:function(){var a=n(this.collection)||this.urlRoot||o();return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this)},isNew:function(){return null==this.id},change:function(a){this.trigger("change",this,a);this._previousAttributes=b.clone(this.attributes);this._changed=!1},hasChanged:function(a){return a?
this._previousAttributes[a]!=this.attributes[a]:this._changed},changedAttributes:function(a){a||(a=this.attributes);var c=this._previousAttributes,d=!1,e;for(e in a)b.isEqual(c[e],a[e])||(d=d||{},d[e]=a[e]);return d},previous:function(a){return!a||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return b.clone(this._previousAttributes)},_performValidation:function(a,b){var c=this.validate(a);return c?(b.error?b.error(this,c,b):this.trigger("error",this,c,b),
!1):!0}});c.Collection=function(a,c){c||(c={});if(c.comparator)this.comparator=c.comparator;b.bindAll(this,"_onModelEvent","_removeReference");this._reset();a&&this.reset(a,{silent:!0});this.initialize.apply(this,arguments)};b.extend(c.Collection.prototype,c.Events,{model:c.Model,initialize:function(){},toJSON:function(){return this.map(function(a){return a.toJSON()})},add:function(a,c){if(b.isArray(a))for(var d=0,e=a.length;d<e;d++)this._add(a[d],c);else this._add(a,c);return this},remove:function(a,
c){if(b.isArray(a))for(var d=0,e=a.length;d<e;d++)this._remove(a[d],c);else this._remove(a,c);return this},get:function(a){return null==a?null:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");this.models=this.sortBy(this.comparator);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return b.map(this.models,
function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});this.each(this._removeReference);this._reset();this.add(a,{silent:!0});b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a||(a={});var b=this,d=a.success;a.success=function(c,e,f){b[a.add?"add":"reset"](b.parse(c,f),a);d&&d(b,c)};a.error=w(a.error,b,a);return(this.sync||c.sync).call(this,"read",this,a)},create:function(a,b){var c=this;b||(b={});a=this._prepareModel(a,b);if(!a)return!1;var e=b.success;b.success=
function(a,g,f){c.add(a,b);e&&e(a,g,f)};a.save(null,b);return a},parse:function(a){return a},chain:function(){return b(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,b){if(a instanceof c.Model){if(!a.collection)a.collection=this}else{var d=a,a=new this.model(d,{collection:this});a.validate&&!a._performValidation(d,b)&&(a=!1)}return a},_add:function(a,b){b||(b={});a=this._prepareModel(a,b);if(!a)return!1;var c=this.getByCid(a);
if(c)throw Error(["Can't add the same model to a set twice",c.id]);this._byId[a.id]=a;this._byCid[a.cid]=a;this.models.splice(null!=b.at?b.at:this.comparator?this.sortedIndex(a,this.comparator):this.length,0,a);a.bind("all",this._onModelEvent);this.length++;b.silent||a.trigger("add",a,this,b);return a},_remove:function(a,b){b||(b={});a=this.getByCid(a)||this.get(a);if(!a)return null;delete this._byId[a.id];delete this._byCid[a.cid];this.models.splice(this.indexOf(a),1);this.length--;b.silent||a.trigger("remove",
a,this,b);this._removeReference(a);return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.unbind("all",this._onModelEvent)},_onModelEvent:function(a,b,c,e){("add"==a||"remove"==a)&&c!=this||("destroy"==a&&this._remove(b,e),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments))}});b.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,rest,last,without,indexOf,lastIndexOf,isEmpty,groupBy".split(","),
function(a){c.Collection.prototype[a]=function(){return b[a].apply(b,[this.models].concat(b.toArray(arguments)))}});c.Router=function(a){a||(a={});if(a.routes)this.routes=a.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var h=/:([\w\d]+)/g,f=/\*([\w\d]+)/g,j=/[-[\]{}()+?.,\\^$|#\s]/g;b.extend(c.Router.prototype,c.Events,{initialize:function(){},route:function(a,e,d){c.history||(c.history=new c.History);b.isRegExp(a)||(a=this._routeToRegExp(a));c.history.route(a,b.bind(function(b){b=
this._extractParameters(a,b);d.apply(this,b);this.trigger.apply(this,["route:"+e].concat(b))},this))},navigate:function(a,b){c.history.navigate(a,b)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(j,"\\$&").replace(h,"([^/]*)").replace(f,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});
c.History=function(){this.handlers=[];b.bindAll(this,"checkUrl")};var m=/^#*/,t=/msie [\w.]+/,u=!1;b.extend(c.History.prototype,{interval:50,getFragment:function(a,b){if(null==a)if(this._hasPushState||b){var a=window.location.pathname,c=window.location.search;c&&(a+=c);0==a.indexOf(this.options.root)&&(a=a.substr(this.options.root.length))}else a=window.location.hash;return decodeURIComponent(a.replace(m,""))},start:function(a){if(u)throw Error("Backbone.history has already been started");this.options=
b.extend({},{root:"/"},this.options,a);this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var a=this.getFragment(),c=document.documentMode;if(c=t.exec(navigator.userAgent.toLowerCase())&&(!c||7>=c))this.iframe=i('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?i(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!c?i(window).bind("hashchange",
this.checkUrl):setInterval(this.checkUrl,this.interval);this.fragment=a;u=!0;a=window.location;c=a.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!c)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;if(this._wantsPushState&&this._hasPushState&&c&&a.hash)this.fragment=a.hash.replace(m,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment);if(!this.options.silent)return this.loadUrl()},
route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.iframe.location.hash));if(a==this.fragment||a==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(a){var c=this.fragment=this.getFragment(a);return b.any(this.handlers,function(a){if(a.route.test(c))return a.callback(c),!0})},navigate:function(a,
b){var c=(a||"").replace(m,"");if(!(this.fragment==c||this.fragment==decodeURIComponent(c))){if(this._hasPushState){var e=window.location;0!=c.indexOf(this.options.root)&&(c=this.options.root+c);this.fragment=c;window.history.pushState({},document.title,e.protocol+"//"+e.host+c)}else if(window.location.hash=this.fragment=c,this.iframe&&c!=this.getFragment(this.iframe.location.hash))this.iframe.document.open().close(),this.iframe.location.hash=c;b&&this.loadUrl(a)}}});c.View=function(a){this.cid=b.uniqueId("view");
this._configure(a||{});this._ensureElement();this.delegateEvents();this.initialize.apply(this,arguments)};var v=/^(\S+)\s*(.*)$/,k="model,collection,el,id,attributes,className,tagName".split(",");b.extend(c.View.prototype,c.Events,{tagName:"div",$:function(a){return i(a,this.el)},initialize:function(){},render:function(){return this},remove:function(){i(this.el).remove();return this},make:function(a,b,c){a=document.createElement(a);b&&i(a).attr(b);c&&i(a).html(c);return a},delegateEvents:function(a){if(a||
(a=this.events)){b.isFunction(a)&&(a=a.call(this));i(this.el).unbind(".delegateEvents"+this.cid);for(var c in a){var d=this[a[c]];if(!d)throw Error('Event "'+a[c]+'" does not exist');var e=c.match(v),f=e[1],e=e[2],d=b.bind(d,this),f=f+(".delegateEvents"+this.cid);""===e?i(this.el).bind(f,d):i(this.el).delegate(e,f,d)}}},_configure:function(a){this.options&&(a=b.extend({},this.options,a));for(var c=0,d=k.length;c<d;c++){var e=k[c];a[e]&&(this[e]=a[e])}this.options=a},_ensureElement:function(){if(this.el){if(b.isString(this.el))this.el=
i(this.el).get(0)}else{var a=this.attributes||{};if(this.id)a.id=this.id;if(this.className)a["class"]=this.className;this.el=this.make(this.tagName,a)}}});c.Model.extend=c.Collection.extend=c.Router.extend=c.View.extend=function(a,b){var c=p(this,a,b);c.extend=this.extend;return c};var q={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};c.sync=function(a,e,d){var f=q[a],d=b.extend({type:f,dataType:"json"},d);if(!d.url)d.url=n(e)||o();if(!d.data&&e&&("create"==a||"update"==a))d.contentType=
"application/json",d.data=JSON.stringify(e.toJSON());if(c.emulateJSON)d.contentType="application/x-www-form-urlencoded",d.data=d.data?{model:d.data}:{};if(c.emulateHTTP&&("PUT"===f||"DELETE"===f)){if(c.emulateJSON)d.data._method=f;d.type="POST";d.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",f)}}if("GET"!==d.type&&!c.emulateJSON)d.processData=!1;return i.ajax(d)};var r=function(){},p=function(a,c,d){var e;e=c&&c.hasOwnProperty("constructor")?c.constructor:function(){return a.apply(this,
arguments)};b.extend(e,a);r.prototype=a.prototype;e.prototype=new r;c&&b.extend(e.prototype,c);d&&b.extend(e,d);e.prototype.constructor=e;e.__super__=a.prototype;return e},n=function(a){return!a||!a.url?null:b.isFunction(a.url)?a.url():a.url},o=function(){throw Error('A "url" property or function must be specified');},w=function(a,b,c){return function(e){a?a(b,e,c):b.trigger("error",b,e,c)}}}).call(this);function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}window.Store=function(e){this.name=e;this.records=(e=localStorage.getItem(this.name))&&e.split(",")||[]};
_.extend(Store.prototype,{save:function(){localStorage.setItem(this.name,this.records.join(","))},create:function(e){if(!e.id)e.id=e.attributes.id=guid();localStorage.setItem(this.name+"-"+e.id,JSON.stringify(e));this.records.push(e.id.toString());this.save();return e},update:function(e){localStorage.setItem(this.name+"-"+e.id,JSON.stringify(e));_.include(this.records,e.id.toString())||this.records.push(e.id.toString());this.save();return e},find:function(e){return JSON.parse(localStorage.getItem(this.name+
"-"+e.id))},findAll:function(){return _.map(this.records,function(e){return JSON.parse(localStorage.getItem(this.name+"-"+e))},this)},destroy:function(e){localStorage.removeItem(this.name+"-"+e.id);this.records=_.reject(this.records,function(a){return a==e.id.toString()});this.save();return e}});Backbone.remoteSync=Backbone.sync;
Backbone.sync=function(e,a,c,b){"function"==typeof c&&(c={success:c,error:b});var i,h=a.localStorage||a.collection&&a.collection.localStorage;if(!h)return Backbone.remoteSync(e,a,c,b);switch(e){case "read":i=a.id?h.find(a):h.findAll();break;case "create":i=h.create(a);break;case "update":i=h.update(a);break;case "delete":i=h.destroy(a)}i?c.success(i):c.error("Record not found")};window.Modernizr=function(e,a,c){function b(a,b){var c=a.charAt(0).toUpperCase()+a.substr(1),c=(a+" "+t.join(c+" ")+c).split(" ");return i(c,b)}function i(a,b){for(var e in a)if(m[a[e]]!==c)return"pfx"==b?a[e]:!0;return!1}var h={},f=a.documentElement;a.head||a.getElementsByTagName("head");var j=a.createElement("modernizr"),m=j.style,e=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),t="Webkit Moz O ms Khtml".split(" "),j={},u=[],v=function(b,c,e,g){var h,d,i=a.createElement("div");if(parseInt(e,10))for(;e--;)d=
a.createElement("div"),d.id=g?g[e]:"modernizr"+(e+1),i.appendChild(d);h=["&shy;<style>",b,"</style>"].join("");i.id="modernizr";i.innerHTML+=h;f.appendChild(i);b=c(i,b);i.parentNode.removeChild(i);return!!b},k,q={}.hasOwnProperty,r;typeof q!==c&&typeof q.call!==c?r=function(a,b){return q.call(a,b)}:r=function(a,b){return b in a&&typeof a.constructor.prototype[b]===c};(function(a,b){var c=a.join(""),e=b.length;v(c,function(a){for(var a=a.childNodes,b={};e--;)b[a[e].id]=a[e];h.csstransforms3d=9===b.csstransforms3d.offsetLeft},
e,b)})([,["@media (",e.join("transform-3d),("),"modernizr){#csstransforms3d{left:9px;position:absolute}}"].join("")],[,"csstransforms3d"]);j.csstransforms=function(){return!!i(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])};j.csstransforms3d=function(){var a=!!i(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);a&&"webkitPerspective"in f.style&&(a=h.csstransforms3d);return a};j.csstransitions=function(){return b("transitionProperty")};
for(var p in j)r(j,p)&&(k=p.toLowerCase(),h[k]=j[p](),u.push((h[k]?"":"no-")+k));m.cssText="";j=null;h._version="2.0.6";h._prefixes=e;h._domPrefixes=t;h.testProp=function(a){return i([a])};h.testAllProps=b;h.testStyles=v;return h}(this,this.document);CFW={domain:/[.]local/.test(window.location.host)||/rinkl/.test(window.location.host)||/squatch/.test(window.location.host)?"http://tameron.heroku.com":"http://cfwhiteboard.com",important:jQuery.important.noConflict(),ajaxOptions:!$.browser.msie||!window.XDomainRequest?{}:{xhr:function(){try{var e=new XDomainRequest;e.timeout=5E3;var a;e.getAllResponseHeaders=function(){return""};var c=function(b,c){e.onload=e.onerror=e.ontimeout=jQuery.noop;e.status=b;e.statusText=c;e.readyState=4;if(a)e.responseText=
a.responseText;e.onreadystatechange&&e.onreadystatechange()},b=function(){a=new XDomainRequest;a.timeout=e.timeout;a.onload=e.onload;a.onerror=e.onerror;a.ontimeout=e.ontimeout;a.open(e.openArgs[0],e.openArgs[1]);a.send(e.sendArgs[0])};e.onload=function(){c(200,"OK")};e.onerror=function(){a?c(400,"Error"):b()};e.ontimeout=function(){a?c(0,"timeout"):b()};e.originalOpen=e.open;e.open=function(a,b){"PUT"===a?(b+="/revise",a="POST"):"DELETE"===a&&(b+="/annihilate",a="POST");e.openArgs=[a,b];e.originalOpen(a,
b)};e.originalSend=e.send;e.send=function(a){e.sendArgs=[a];setTimeout(function(){e.originalSend(a)},0)};return e}catch(i){return jQuery.ajaxSettings.xhr()}}}};
jQuery(function(e){e(document.embeds).each(function(){var a=e(this);setTimeout(function(){var c=!1,b=a.attr("wmode");"opaque"!=b&&"transparent"!=b&&(a.attr("wmode","opaque"),c=!0);var i=a.closest("object"),b=i.children("param[name=wmode]").val();"opaque"!=b&&"transparent"!=b&&(i.prepend(e('<param name="wmode" value="opaque" />')),c=!0);c&&(i=i.length?i:a,c=i.wrap(e('<span class="cfw-placeholder" />')),c.html(c.html()),c.children().unwrap())},e.browser.msie?300:0)});e("iframe").each(function(){/youtube/.test(this.src)&&
!/wmode=transparent/.test(this.src)&&!/wmode=opaque/.test(this.src)&&(this.src+=(0<=this.src.substring(this.src.lastIndexOf&&this.src.lastIndexOf("/")).indexOf("?")?"&":"?")+"wmode=opaque")})});
<<<<<<< HEAD
jQuery(function(g){g.fn.bindBefore=function(a,b){a=a.split(/\s+/);this.each(function(){for(var c=a.length;c--;){g(this).bind(a[c],b);var e=g.data(this,"events")[a[c]];e.splice(0,0,e.pop())}})};g.fn.oneBefore=function(a,b){a=a.split(/\s+/);this.each(function(){for(var c=a.length;c--;){g(this).one(a[c],b);var e=g.data(this,"events")[a[c]];e.splice(0,0,e.pop())}})}});
jQuery(function(g){if(!Modernizr.csstransitions)Modernizr.csstransforms=!1,Modernizr.csstransforms3d=!1;if(/AppleWebKit/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent))Modernizr.csstransforms3d=!1;if(g.browser.msie&&window.XDomainRequest)jQuery.ajaxSetup({xhr:function(){try{var a=new XDomainRequest;a.timeout=5E3;a.getAllResponseHeaders=function(){return""};var b=function(){var b=new XDomainRequest;b.timeout=a.timeout;b.onload=a.onload;b.onerror=a.onerror;b.ontimeout=a.ontimeout;
b.open(a.openArgs[0],a.openArgs[1]);b.send(a.sendArgs[0])};a.onload=function(){a.onload=a.onerror=a.ontimeout=jQuery.noop;a.status=200;a.statusText="OK";a.readyState=4;a.onreadystatechange&&a.onreadystatechange()};a.onerror=function(){b()};a.ontimeout=function(){b()};a.originalOpen=a.open;a.open=function(b,c){"PUT"===b?(c+="/revise",b="POST"):"DELETE"===b&&(c+="/annihilate",b="POST");a.openArgs=[b,c];a.originalOpen(b,c)};a.originalSend=a.send;a.send=function(b){a.sendArgs=[b];setTimeout(function(){a.originalSend(b)},
0)};return a}catch(c){return jQuery.ajaxSettings.xhr()}}}),jQuery.support.cors=!0;CFW.User=Backbone.Model.extend({defaults:function(){return{email:"",known_as:"",count:0,highlightColor:CFW.User.prototype.randomColor()}},randomColor:function(){return[[255,75,105],[255,105,75],[75,105,255],[105,75,255],[75,255,105],[105,255,75],[123,6,226],[226,6,123],[6,226,123],[6,123,226]][Math.floor(10*Math.random()+0)]}});CFW.UserList=Backbone.Collection.extend({model:CFW.User,initialize:function(){this.localStorage=
new Store("cfw-users");return this},comparator:function(a){return-a.get("count")}});CFW.users=new CFW.UserList;CFW.users.fetch();CFW.Entry=Backbone.Model.extend({defaults:{athlete_id:"",known_as:"",email:"",component_results:[],notes:""},emailRegex:/^\S+@\S+\.\S+$/,validate:function(a){var b=[];!(a.athlete_id||this.attributes&&this.get("athlete_id"))&&!this.emailRegex.test(a.email)&&b.push("email");_.each(a.component_results,function(a){(!a.result||!a.result.length)&&b.push("component-"+a.wp_id+"-result")});
if(b.length)return b}});CFW.EntryList=Backbone.Collection.extend({model:CFW.Entry,url:function(){return CFW.domain+"/affiliates/"+this.affiliateId+"/wods/"+this.postId+"+"+this.wod.wp_id+"/posts"},initialize:function(a,b){this.affiliateId=b.affiliateId;this.postId=b.postId;this.wod=b.wod;return this},comparator:function(a){return a.get("known_as").toLowerCase()}});CFW.EntryItemView=Backbone.View.extend({tagName:"tr",template:_.template('            <td class="cfw-known-as" title="<%- known_as %>"><%- known_as %></td>            <%             if (wod.components && wod.components.length > 1) {                _.each(wod.components, function(component, i, components) {                    var componentResult = _.find(component_results, function(cr) {                        return cr.wp_id == component.wp_id;                    }) || {                        result: "",                        rx: false,                        mods: ""                    };                    var isLast = (i + 1 == components.length);                    %>                     <td class="cfw-component" title="<%- componentResult.result %><%- componentResult.rx ? " [Rx]" : "" %><%- componentResult.mods ? " ("+componentResult.mods+")" : "" %>">                        <%= isLast ? "<div>" : "" %>                        <span class="cfw-result"><%- componentResult.result %></span>                        <span class="cfw-mods">                            <%= componentResult.rx ? "<strong>Rx</strong>" : "" %>                            <%- componentResult.mods %>                        </span>                        <% if (isLast) { %>                            <span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                        <% } %>                        <%= isLast ? "</div>" : "" %>                    </td>                <%                 });            } else {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == (wod.components[0] || {wp_id: "uh oh"}).wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                 <td class="cfw-result" title="<%- componentResult.result %>"><%- componentResult.result %></td>                <td class="cfw-mods" title="<%- componentResult.rx ? "[Rx] " : "" %><%- componentResult.mods %>">                    <div>                        <%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %><span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                    </div>                </td>            <%             }            %>         '),
events:{click:"showDetail"},initialize:function(){this.model.bind("change",this.render,this);this.model.bind("destroy",this.remove,this);this.model.bind("show",this.lookSelected,this);this.model.bind("unshow",this.unlookSelected,this);return this.render()},render:function(){g(this.el).html(this.template(_.extend({wod:this.options.wod},this.model.toJSON())));return this},lookSelected:function(){g(this.el).addClass("cfw-selected")},unlookSelected:function(){g(this.el);g(this.el).removeClass("cfw-selected")},
addHighlight:function(a){g(this.el).addClass("cfw-highlighted").css({backgroundColor:"rgba("+a.join(",")+",.2)",borderColor:"rgba("+a.join(",")+",.2)"})},removeHighlight:function(){g(this.el).removeClass("cfw-highlighted").css({backgroundColor:"transparent",borderColor:"#888"})},showDetail:function(){this.itemClickDisabled||this.model.trigger("show",this.model)}});CFW.WhiteboardPage=Backbone.View.extend({tagName:"div",className:"cfw-page",show:function(){g(this.el).addClass("active");var a=this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),
a.scrollbarReady=!0;a.showScrollbar()},Modernizr.csstransitions?400:0)},hide:function(){this.freezeScrollbar();var a=g(this.el).removeClass("active"),b=this;setTimeout(function(){b.hideScrollbar();b.thawScrollbar();a.trigger("cfwhide")},Modernizr.csstransitions?300:0)},initScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper({parentSelector:".cfw-window",important:!0,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("show")},
=======
jQuery(function(e){e.fn.bindBefore=function(a,c){a=a.split(/\s+/);this.each(function(){for(var b=a.length;b--;){e(this).bind(a[b],c);var i=e.data(this,"events")[a[b]];i.splice(0,0,i.pop())}})};e.fn.oneBefore=function(a,c){a=a.split(/\s+/);this.each(function(){for(var b=a.length;b--;){e(this).one(a[b],c);var i=e.data(this,"events")[a[b]];i.splice(0,0,i.pop())}})}});
jQuery(function(e){if(!Modernizr.csstransitions)Modernizr.csstransforms=!1,Modernizr.csstransforms3d=!1;if(/AppleWebKit/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent))Modernizr.csstransforms3d=!1;if(e.browser.msie&&window.XDomainRequest)jQuery.support.cors=!0;CFW.User=Backbone.Model.extend({defaults:function(){return{email:"",known_as:"",count:0,highlightColor:CFW.User.prototype.randomColor()}},randomColor:function(){return[[255,75,105],[255,105,75],[75,105,255],[105,75,255],[75,
255,105],[105,255,75],[123,6,226],[226,6,123],[6,226,123],[6,123,226]][Math.floor(10*Math.random()+0)]}});CFW.UserList=Backbone.Collection.extend({model:CFW.User,initialize:function(){this.localStorage=new Store("cfw-users");return this},comparator:function(a){return-a.get("count")}});CFW.users=new CFW.UserList;CFW.users.fetch();CFW.Entry=Backbone.Model.extend({defaults:{athlete_id:"",known_as:"",email:"",component_results:[],notes:""},emailRegex:/^\S+@\S+\.\S+$/,validate:function(a){var c=[];!(a.athlete_id||
this.attributes&&this.get("athlete_id"))&&!this.emailRegex.test(a.email)&&c.push("email");_.each(a.component_results,function(a){(!a.result||!a.result.length)&&c.push("component-"+a.wp_id+"-result")});if(c.length)return c}});CFW.EntryList=Backbone.Collection.extend({model:CFW.Entry,url:function(){return CFW.domain+"/affiliates/"+this.affiliateId+"/wods/"+this.postId+"+"+this.wod.wp_id+"/posts"},initialize:function(a,c){this.affiliateId=c.affiliateId;this.postId=c.postId;this.wod=c.wod;return this},
comparator:function(a){return a.get("known_as").toLowerCase()}});CFW.EntryItemView=Backbone.View.extend({tagName:"tr",template:_.template('            <td class="cfw-known-as" title="<%- known_as %>"><%- known_as %></td>            <%             if (wod.components && wod.components.length > 1) {                _.each(wod.components, function(component, i, components) {                    var componentResult = _.find(component_results, function(cr) {                        return cr.wp_id == component.wp_id;                    }) || {                        result: "",                        rx: false,                        mods: ""                    };                    var isLast = (i + 1 == components.length);                    %>                     <td class="cfw-component" title="<%- componentResult.result %><%- componentResult.rx ? " [Rx]" : "" %><%- componentResult.mods ? " ("+componentResult.mods+")" : "" %>">                        <%= isLast ? "<div>" : "" %>                        <span class="cfw-result"><%- componentResult.result %></span>                        <span class="cfw-mods">                            <%= componentResult.rx ? "<strong>Rx</strong>" : "" %>                            <%- componentResult.mods %>                        </span>                        <% if (isLast) { %>                            <span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                        <% } %>                        <%= isLast ? "</div>" : "" %>                    </td>                <%                 });            } else {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == (wod.components[0] || {wp_id: "uh oh"}).wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                 <td class="cfw-result" title="<%- componentResult.result %>"><%- componentResult.result %></td>                <td class="cfw-mods" title="<%- componentResult.rx ? "[Rx] " : "" %><%- componentResult.mods %>">                    <div>                        <%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %><span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                    </div>                </td>            <%             }            %>         '),
events:{click:"showDetail"},initialize:function(){this.model.bind("change",this.render,this);this.model.bind("destroy",this.remove,this);this.model.bind("show",this.lookSelected,this);this.model.bind("unshow",this.unlookSelected,this);return this.render()},render:function(){e(this.el).html(this.template(_.extend({wod:this.options.wod},this.model.toJSON())));return this},lookSelected:function(){e(this.el).addClass("cfw-selected")},unlookSelected:function(){e(this.el);e(this.el).removeClass("cfw-selected")},
addHighlight:function(a){e(this.el).addClass("cfw-highlighted").css({backgroundColor:"rgba("+a.join(",")+",.2)",borderColor:"rgba("+a.join(",")+",.2)"})},removeHighlight:function(){e(this.el).removeClass("cfw-highlighted").css({backgroundColor:"transparent",borderColor:"#888"})},showDetail:function(){this.itemClickDisabled||this.model.trigger("show",this.model)}});CFW.WhiteboardPage=Backbone.View.extend({tagName:"div",className:"cfw-page",show:function(){e(this.el).addClass("active");var a=this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),
a.scrollbarReady=!0;a.showScrollbar()},Modernizr.csstransitions?400:0)},hide:function(){this.freezeScrollbar();var a=e(this.el).removeClass("active"),c=this;setTimeout(function(){c.hideScrollbar();c.thawScrollbar();a.trigger("cfwhide")},Modernizr.csstransitions?300:0)},initScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper({parentSelector:".cfw-window",important:!0,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("show")},
>>>>>>> master
hideScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("hide")},freezeScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("freeze")},thawScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("thaw")}});CFW.EntryListView=CFW.WhiteboardPage.extend({template:_.template('            <table class="cfw-components-<%= wod.components && wod.components.length || 1 %>" cellspacing="0">                <thead>                    <tr>                        <th class="cfw-known-as">Name</th>                        <% _.each(wod.components, function(component) { %>                            <th class="cfw-component" <%= wod.components.length == 1 ? \'colspan="2"\' : "" %> title="<%- component.label %>"><%- component.label %></th>                        <% }); %>                    </tr>                </thead>            </table>            <div class="cfw-scrollable">                <table cellspacing="0" class="cfw-components-<%= wod.components && wod.components.length || 1 %>">                    <tbody>                    </tbody>                </table>            </div>        '),
events:{"touchmove .cfw-scrollable":"disableItemClicks","touchstart .cfw-scrollable":"enableItemClicks"},initialize:function(a){this.entries=a.entries;this.wod=a.wod;this.entryItemViews=[];this.entries.bind("add",this.addAll,this);this.entries.bind("change:known_as",this.addAll,this);this.entries.bind("remove",this.addAll,this);this.entries.bind("reset",this.addAll,this);CFW.users.bind("reset",this.updateHighlightedUsers,this);CFW.users.bind("change",this.updateHighlightedUsers,this);CFW.users.bind("add",
this.addHighlightedUser,this);CFW.users.bind("remove",this.removeHighlightedUser,this);return this.render()},render:function(){e(this.el).html(this.template({wod:this.wod}));return this},addOne:function(a){a=new CFW.EntryItemView({model:a,wod:this.wod});this.entryItemViews.push(a);this.$("tbody").append(a.el)},addAll:function(){_.each(this.entryItemViews,function(a,c,b){a.remove();delete b[c]});this.$("tbody").empty();this.entries.length?this.entries.each(this.addOne,this):this.$("tbody").append(e('                    <tr class="cfw-no-entries">                        <td colspan="100">No one has added an entry yet.<br /><a class="cfw-new-entry">Add yours now!<a></td>                    </tr>                '));
this.updateHighlightedUsers()},show:function(){var a=this.$("table").attr("class"),c=e(this.el).closest(".cfw-contents");setTimeout(function(){c.addClass(a).data("componentsclass",a)},Modernizr.csstransitions?300:0);CFW.WhiteboardPage.prototype.show.apply(this,arguments)},hide:function(){var a=this.$("table").attr("class");e(this.el).closest(".cfw-contents").removeClass(a).removeData("componentsclass");CFW.WhiteboardPage.prototype.hide.apply(this,arguments)},disableItemClicks:function(){_.each(this.entryItemViews,
function(a){a.itemClickDisabled=!0})},enableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!1})},updateHighlightedUsers:function(){this.entries.each(function(a){a.trigger("removeHighlight")});CFW.users.each(this.addHighlightedUser,this)},addHighlightedUser:function(a){_.each(this.entries.select(function(c){return c.get("email").toLowerCase()==a.get("email").toLowerCase()}),function(c){c.trigger("addHighlight",a.get("highlightColor"))})},removeHighlightedUser:function(a){_.each(this.entries.select(function(c){return c.get("email").toLowerCase()==
a.get("email").toLowerCase()}),function(a){a.trigger("removeHighlight")})}});CFW.EntryDetailView=CFW.WhiteboardPage.extend({template:_.template('            <div class="cfw-entry-detail">                <a class="cfw-back">back</a><a class="cfw-edit">edit</a>                <dl class="cfw-scrollable">                    <dt class="cfw-hidden">Name</dt>                    <dd class="cfw-known-as"><%- known_as %></dd>                    <%                    _.each(wod.components, function(component) {                        var componentResult = _.find(component_results, function(cr) {                            return cr.wp_id == component.wp_id;                        }) || {                            result: "",                            rx: false,                            mods: ""                        };                    %>                        <dt><%= component.label %></dt>                        <dd class="cfw-component">                            <span class="cfw-result"><%- componentResult.result %></span>                            <span class="cfw-mods"><%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %></span>                        </dd>                    <%                    });                    %>                    <dt>Notes</dt>                    <dd class="cfw-notes"><%- notes || "(no data)" %></dd>                </dl>            </div>        '),
events:{"click a.cfw-edit":"edit","click a.cfw-back":"back",cfwhide:"cleanup"},initialize:function(a){this.wod=a.wod;this.model.bind("change",this.render,this);this.model.bind("destroy",this.hide,this);return this.render()},render:function(){e(this.el).html(this.template(_.extend({wod:this.wod},this.model.toJSON())));return this},edit:function(){this.model.trigger("edit",this.model)},back:function(){e(this.el).trigger("hideEntryDetails")},cleanup:function(){var a=this;setTimeout(function(){a.model.trigger("unshow",
a.model);a.remove()},0)}});CFW.EntryFormView=Backbone.View.extend({tagName:"form",className:"cfw-scrollable",template:_.template('            <fieldset>                <\!--<h2><%= new_record ? "Add Your Entry" : "Edit Your Entry" %></h2>--\>                <h2><label for="cfw-email">Email Address</label></h2>                <input type="email" id="cfw-email" name="email" placeholder="name@example.com" <%= new_record ? "" : \'value="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" disabled="disabled"\' %> />            </fieldset>            <fieldset>                <h2><label for="cfw-known-as">Name</label></h2>                <input type="text" id="cfw-known-as" name="known_as" placeholder="Guest" value="<%- known_as %>" />            </fieldset>            <%            _.each(wod.components, function(component) {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == component.wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                <fieldset>                    <h2><label for="cfw-component-<%= component.wp_id %>-result"><%= component.label %></label></h2>                    <input type="text" id="cfw-component-<%= component.wp_id %>-result" name="component-<%= component.wp_id %>-result" placeholder="How did you do?" value="<%- componentResult.result %>" />                    <div class="cfw-nobr">                        <label for="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority">Modifications</label>                    </div>                    <div class="cfw-nobr">                        <input type="checkbox" id="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority" name="component-<%= component.wp_id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                        /><span>or</span><input type="text" id="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority" name="component-<%= component.wp_id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                    </div>                </fieldset>            <%            });            %>            <fieldset class="cfw-last">                <div class="cfw-notes <%= notes ? "cfw-open cfw-opaque" : "" %>">                    <h2><label for="cfw-notes">Notes</label></h2>                    <textarea rows="3" id="cfw-notes" name="notes" placeholder="Notes or Tips for next time?"><%- notes %></textarea>                </div>                <div class="cfw-footer">                    <a class="cfw-add-notes <%= notes ? "cfw-hidden" : "" %>"><label for="cfw-notes"><strong>+</strong> add notes</label></a>                    <input type="submit" value="<%= new_record ? "Submit" : "Save" %>" />                    <input type="reset" value="Cancel" />                </div>            </fieldset>        '),
events:{"focus :input":"scrollToInput",'keyup input[name="email"]':"guessName",'change input[name="email"]':"guessName",'blur input[name="known_as"]':"guessName","click .cfw-add-notes":"showNotesFields",submit:"save",'click input[type="reset"]':"remove"},initialize:function(a){this.entries=a.entries;this.wod=a.wod;return this.render()},render:function(){var a=e(this.el).attr("action","javascript://");CFW.important.css.apply(a,["position","absolute",!0]);a.html(this.template(_.extend({wod:this.wod,
new_record:!this.model},(this.model||new CFW.Entry).toJSON())));return this},initScrollbar:function(){e(this.el).scrollbarPaper({parentSelector:".cfw-window",important:!0,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){e(this.el).scrollbarPaper("show")},hideScrollbar:function(){e(this.el).scrollbarPaper("hide")},freezeScrollbar:function(){e(this.el).scrollbarPaper("freeze")},thawScrollbar:function(){e(this.el).scrollbarPaper("thaw")},
scrollToInput:function(a){var c=e(this.el);if(!this.height)this.height=c.parent().height();(a=(e(a.target).position()||{}).top)&&c.animate({scrollTop:a+c.scrollTop()-this.height/2},300)},guessName:function(){var a=this.$('input[name="email"]'),c=this.$('input[name="known_as"]');if(!(c.val().length&&this.lastGuess&&c.val()!=this.lastGuess||c.val().length&&!this.lastGuess)){var b=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.val().toLowerCase()});if(b)c.val(this.lastGuess=b.get("known_as"));
else{b=a.val();if(!_.capitalize)_.capitalize=function(a){return a.substring(0,1).toUpperCase()+a.substring(1)};this.lastGuess=_.capitalize((/[^.@0-9]+/.exec(b)||[""])[0]);c.val(this.lastGuess)}}},showNotesFields:function(){var a=this.$(".cfw-notes").addClass("cfw-open"),c=this.$(".cfw-add-notes").addClass("cfw-transparent");setTimeout(function(){a.addClass("cfw-opaque");c.addClass("cfw-hidden")},Modernizr.csstransitions?200:0)},save:function(a){a.preventDefault();if(!this.isLoading()){var c={email:this.$('input[name="email"]').val(),
known_as:this.$('input[name="known_as"]').val(),component_results:[],notes:this.$('textarea[name="notes"]').val()},b={};this.$('input[name^="component-"]').each(function(){var a=e(this),c=a.attr("name").split("-"),a="checkbox"==a.attr("type")?a.is(":checked"):a.val();b[c[1]]||(b[c[1]]={wp_id:c[1]});b[c[1]][c[2]]=a});_.each(b,function(a){c.component_results.push(a)});var i=this;i.showLoading();i.$(".ajax-error-notice").remove();a=e.extend({},CFW.ajaxOptions,{success:function(){i.hideLoading();i.remove()},
error:function(a,b){i.hideLoading();b&&b.length?i.showValidationErrors(b):i.$(".cfw-footer").after(e('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Click <strong>'+i.$('input[type="submit"]').val()+"</strong> to try again or contact athlete support if the problem persists.</label>"))}});this.model?this.model.save(c,a):this.entries.create(c,a)||this.showValidationErrors(CFW.Entry.prototype.validate(c))}},
show:function(){var a=e(this.el),c=a.closest(".cfw-contents"),b=c.data("componentsclass");b&&c.removeClass(b);setTimeout(function(){a.addClass("cfw-translate-oldfashioned")},0);var i=this;setTimeout(function(){if(!i.scrollbarReady)i.initScrollbar(),i.scrollbarReady=!0;i.showScrollbar();var b=a.find(":input:first")[0];b&&b.focus&&b.focus()},Modernizr.csstransitions?400:0)},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},
hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){var c=this;_.each(a,function(a){c.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){e('label[for="'+e(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){e(this).removeClass("cfw-invalid");e('label[for="'+e(this).attr("id")+'"]').removeClass("cfw-invalid")})})},remove:function(){this.freezeScrollbar();var a=this,c=e(this.el).closest(".cfw-contents");
e(this.el).removeClass("cfw-translate-oldfashioned");setTimeout(function(){a.hideScrollbar();var b=c.data("componentsclass");b&&c.addClass(b);e(a.el).trigger("cfwremove").remove()},Modernizr.csstransitions?300:0)}});CFW.WhiteboardView=Backbone.View.extend({className:"cfw-pane",template:_.template('            <div>                <div class="cfw-window">                    <h2>Entries</h2>                    <a class="cfw-new-entry">+</a>                    <ul class="cfw-classes cfw-<%- allWods.length || 1 %>-classes">                        <%                        _.each(allWods, function(w) {                            %><li class="<%- w.wp_id == wod.wp_id ? "cfw-selected" : "" %>"><div>                                <a href="javascript://" data-wp_id="<%- w.wp_id %>" title="<%- w.name %>">                                    <span class="cfw-centered">                                        <span class="cfw-entry-count" data-wp_id="<%- w.wp_id %>"></span>                                        <span class="cfw-link-text"><%- w.name %></span>                                    </span>                                    <span class="cfw-separator"></span>                                </a>                            </div></li><%                        });                        %>                    </ul>                    <div class="cfw-contents"></div>                    <div class="cfw-footer">                        <a href="http://cfwhiteboard.com" target="_blank">                            What Is This?                        </a><a href="mailto:athletesupport@cfwhiteboard.com">                            Email Athlete Support                        </a>                    </div>                </div>            </div>            <a class="cfw-print cfw-admin-tool cfw-hidden" target="_blank">Print</a>        '),
events:{"click .cfw-new-entry:not([disabled])":"newEntry",hideEntryDetails:"hideEntry","cfwremove form":"cleanupEntryForm","click .cfw-classes a:not(.cfw-selected)":"returnToEntryList"},initialize:function(a){this.entries=new CFW.EntryList([],{affiliateId:a.affiliateId,postId:a.postId,wod:a.wod});this.entries.bind("add",this.updateEntryCount,this);this.entries.bind("remove",this.updateEntryCount,this);this.entries.bind("reset",this.updateEntryCount,this);this.entries.bind("edit",this.editEntry,this);
this.entries.bind("show",this.showEntry,this);this.entries.bind("add",this.updateUsers,this);this.entries.bind("change:known_as",this.updateUsers,this);this.render();a.hidden&&this.hide();this.entries.fetch(e.extend({},CFW.ajaxOptions,{data:{postModified:a.postModified}}))},render:function(){e(this.el).html(this.template({wod:this.options.wod,allWods:this.options.allWods}));this.entryListView=new CFW.EntryListView({entries:this.entries,wod:this.options.wod});this.$(".cfw-contents").append(this.entryListView.el);
this.entryListView.show();"admin"==this.options.authorization&&(this.$(".cfw-print").attr("href",this.entries.url()),this.$(".cfw-admin-tool").removeClass("cfw-hidden"));return this},show:function(){e(this.el).removeClass("cfw-hidden")},hide:function(){e(this.el).addClass("cfw-hidden")},newEntry:function(){this.showEntryForm()},editEntry:function(a){this.showEntryForm(a)},showEntryForm:function(a){this.disableNewEntries();this.formView=new CFW.EntryFormView({entries:this.entries,model:a,wod:this.options.wod});
this.$(".cfw-contents").append(this.formView.el);this.detailView?this.detailView.hideScrollbar():this.entryListView.hideScrollbar();var c=this.formView;setTimeout(function(){c.show()},0)},cleanupEntryForm:function(){this.enableNewEntries();this.detailView?this.detailView.showScrollbar():this.entryListView.showScrollbar();delete this.formView},disableNewEntries:function(){e(this.el).find(".cfw-new-entry").attr("disabled",!0)},enableNewEntries:function(){e(this.el).find(".cfw-new-entry").removeAttr("disabled")},
showEntry:function(a){this.detailView=new CFW.EntryDetailView({model:a,wod:this.options.wod});this.$(".cfw-contents").append(this.detailView.el);var c=this;setTimeout(function(){c.entryListView.hide();c.detailView.show()},0)},hideEntry:function(){this.detailView.hide();this.entryListView.show();var a=this;setTimeout(function(){delete a.detailView},Modernizr.csstransitions?400:100)},updateEntryCount:function(){e(this.el).trigger("newEntryCount",[this.options.wod.wp_id,this.entries.length])},updateUsers:function(a){var c=
CFW.users.find(function(b){return b.get("email").toLowerCase()==a.get("email").toLowerCase()});c?c.save({known_as:a.get("known_as"),count:c.get("count")+1}):c=CFW.users.create({email:a.get("email"),known_as:a.get("known_as"),count:1})},returnToEntryList:function(){this.formView?this.formView.remove():this.detailView&&this.hideEntry()}});CFW.WhiteboardButtonView=Backbone.View.extend({template:_.template('            <h1>Whiteboard <span class="cfw-entry-count-all"></span></h1>            <div class="cfw-preload-images">                <span class="cfw-metal-tile-jpg"></span>                <span class="cfw-white-water-paper-jpg"></span>                <span class="cfw-loading-gif"></span>            </div>        '),
events:{"click h1":"toggleWhiteboard","click .cfw-classes a":"showClass","newEntryCount .cfw-pane":"updateEntryCounts","mouseover h1":"positionWhiteboard"},initialize:function(){var a=e(this.el).data("cfwhiteboard");this.affiliateId=a.affiliateId;this.postId=a.postId;this.postModified=a.postModified;this.wods=a.wods;this.authorization=e(this.el).data("authorization");return-1<_.indexOf(_.pluck(CFW.instances,"postId"),this.postId)?void 0:this.render()},render:function(){var a=e(this.el);if("undefined"!=
typeof CFW_POSITION&&"embed"==CFW_POSITION.display&&1<a.length){a.first().replaceWith(a.last().addClass("cfw-display-embed"));var c=e("<div />").addClass("cfw-clearer");a.last().parent().append(c)}a.first().html(this.template());this.positionWhiteboard();this.whiteboardViews={};var b=this;_.each(b.wods,function(a,c){a.name=a.name.replace(/workout of the day/ig,"WOD");var f=new CFW.WhiteboardView({affiliateId:b.affiliateId,postId:b.postId,postModified:b.postModified,wod:a,allWods:b.wods,authorization:b.authorization,
hidden:0==c?!1:!0});e(b.el).last().append(f.el);b.whiteboardViews[a.wp_id]=f});return this},toggleWhiteboard:function(a){e(this.el).is(".cfw-active")?this.closeWhiteboard():this.openWhiteboard();a.preventDefault()},openWhiteboard:function(){e(this.el).addClass("cfw-active").removeClass("cfw-postactive")},closeWhiteboard:function(){var a=e(this.el).addClass("cfw-postactive").removeClass("cfw-active");setTimeout(function(){a.removeClass("cfw-postactive")},Modernizr.csstransitions?300:0)},positionWhiteboard:function(){var a=
e(this.el);if("undefined"!=typeof CFW_POSITION&&"embed"==CFW_POSITION.display)a.last().addClass("cfw-active");else if(a.last().parent().is("body")){var c=a.first().offset(),b={position:"absolute",margin:"0",top:c.top+"px"};a.last().is(".position-inline, .position-block, .position-floatleft")?b.left=c.left+"px":(b.right=e(document).width()-a.first().outerWidth()-c.left,b.right+="px");CFW.important.css.apply(a.last(),[b,!0])}},showClass:function(a){var c=e(a.target).closest("a").data("wp_id");_.inject(this.whiteboardViews,
function(a,e,h){h==c?e.show():e.hide();return a},this)},updateEntryCounts:function(a,c,b){this.whiteboardViews[c.toString()].entryCount=b;this.$(".cfw-entry-count").each(function(){var a=e(this);a.data("wp_id")==c&&a.text("("+b+")")});a=_.inject(this.whiteboardViews,function(a,b){return a+(b.entryCount||0)},0);this.$(".cfw-entry-count-all").text("("+a+")")}});CFW.instances=[];e(".cfwhiteboard").each(function(){var a=e(this),c=a.closest("a");c.length&&c.before(a);if("undefined"!=typeof CFW_POSITION){c=
a.closest(CFW_POSITION.parent).find(CFW_POSITION.target);if(c.length)switch(CFW_POSITION.insertion){case "append":c.append(a);break;case "before":c.before(a);break;case "after":c.after(a);break;default:c.prepend(a)}switch(CFW_POSITION.alignment){case "inline":a.addClass("position-inline");break;case "block":a.addClass("position-block");break;case "floatleft":a.addClass("position-floatleft")}CFW_POSITION.margin&&CFW.important.css.apply(a,[{margin:CFW_POSITION.margin},!0])}a=a.add(a.clone().appendTo(document.body));
CFW.instances.push(new CFW.WhiteboardButtonView({el:a}))});if("undefined"==typeof CFW_POSITION||"embed"!=CFW_POSITION.display)_.each(CFW.instances,function(a){e(a.el).on("click",function(a){a.stopPropagation()})}),e("body").on("click",function(){_.each(CFW.instances,function(a){a.closeWhiteboard()})})});
