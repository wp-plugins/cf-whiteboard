var JSON;JSON||(JSON={});
(function(){function h(a){return 10>a?"0"+a:a}function a(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var f=j[a];return"string"===typeof f?f:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(c,h){var e,j,p,q,o=i,l,n=h[c];n&&"object"===typeof n&&"function"===typeof n.toJSON&&(n=n.toJSON(c));"function"===typeof m&&(n=m.call(h,c,n));switch(typeof n){case "string":return a(n);case "number":return isFinite(n)?""+n:"null";case "boolean":case "null":return""+n;
case "object":if(!n)return"null";i+=f;l=[];if("[object Array]"===Object.prototype.toString.apply(n)){q=n.length;for(e=0;e<q;e+=1)l[e]=b(e,n)||"null";p=0===l.length?"[]":i?"[\n"+i+l.join(",\n"+i)+"\n"+o+"]":"["+l.join(",")+"]";i=o;return p}if(m&&"object"===typeof m){q=m.length;for(e=0;e<q;e+=1)"string"===typeof m[e]&&(j=m[e],(p=b(j,n))&&l.push(a(j)+(i?": ":":")+p))}else for(j in n)Object.prototype.hasOwnProperty.call(n,j)&&(p=b(j,n))&&l.push(a(j)+(i?": ":":")+p);p=0===l.length?"{}":i?"{\n"+i+l.join(",\n"+
i)+"\n"+o+"}":"{"+l.join(",")+"}";i=o;return p}}if("function"!==typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+h(this.getUTCMonth()+1)+"-"+h(this.getUTCDate())+"T"+h(this.getUTCHours())+":"+h(this.getUTCMinutes())+":"+h(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i,f,j={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;if("function"!==typeof JSON.stringify)JSON.stringify=function(a,c,h){var e;f=i="";if("number"===typeof h)for(e=0;e<h;e+=1)f+=" ";else"string"===typeof h&&(f=h);if((m=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return b("",
{"":a})};if("function"!==typeof JSON.parse)JSON.parse=function(a,f){function h(a,c){var e,b,j=a[c];if(j&&"object"===typeof j)for(e in j)Object.prototype.hasOwnProperty.call(j,e)&&(b=h(j,e),void 0!==b?j[e]=b:delete j[e]);return f.call(a,c,j)}var e,a=""+a;c.lastIndex=0;c.test(a)&&(a=a.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"===typeof f?h({"":e},""):e;throw new SyntaxError("JSON.parse");}})();(function(h){function a(a,f,c){var e,c=c||"",b=c.match(RegExp("(?:^|\\s|;)("+a+")\\s*:\\s*([^;]*(?:;|$))","i"));b&&(b[0]=b[0].replace(/^;/,""));null===f?e="":"string"===typeof f&&(e=a+":"+f+" !important;");b?("boolean"===typeof f&&(e=h.important(a+":"+b[2],f)),c=c.replace(b[0],e)):"undefined"!==typeof e&&(c=h.trim(c),""!==c&&(";"!==c.slice(-1)&&(c+=";"),c+=" "),c+=e);return c}function b(a,f){var c=b.re;if(!c)c=b.re=/\s*(! ?important)?[\s\r\t\n]*;/g;return!1===f?a.replace(c,";"):a.replace(c,function(a,
f){return f?a:" !important;"})}function c(a,f){var e=c.re;if(!e)e=c.re=/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g;return a.replace(e,function(a,c){return b(c,f)})}var e=!1,i={},f={},j=h.each({css:function(f,c){var e={},b=h(this),j=b.attr("style");if("string"===typeof f){if("undefined"===typeof c)return i.css.apply(this,arguments);e[f]=c}else if("object"===typeof f)e=f;else return b;h.each(e,function(f,c){j=a(f,c,j)});return b.attr("style",j)}},function(a,c){i[a]=h.fn[a];c.overridden=!0;f[a]=function(){var f=
h.makeArray(arguments),b=f[f.length-1],j=h(this);return!0===b?c.apply(j,f.slice(0,-1)):e&&!1!==b?c.apply(j,f):i[a].apply(j,f)}});h.extend(h.fn,f);h.important=h.extend(function(){var a=h.makeArray(arguments),f;if("string"===typeof a[0]){if("undefined"===typeof a[1]||"boolean"===typeof a[1])return f=!1!==a[1],/<\w+.*>/.test(a[0])?c(a[0],f):b(a[0],f)}else if(h.isFunction(a[0]))f=e,h.important.status=e=!0,a[0].call(this),h.important.status=e=f;else if("undefined"===typeof a[0]||"boolean"===typeof a[0])h.important.status=
e=!1!==a[0];return e},{status:e,noConflict:function(){h.each(i,function(a,f){h.fn[a]=f});return j},declaration:a});h.fn.important=function(c){var e=h(this),j=h.makeArray(arguments).concat(!0),i=e.data("nodeName"),k;if("undefined"===typeof c||"boolean"===typeof c)i||(i=e.attr("nodeName").toLowerCase(),e.data("nodeName",i)),"style"===i?(k=!1!==c,e.html(b(e.html(),k)),j=e.attr("sheet"),_("stylesheet",j),j&&j.cssRules&&(_("cssRules",j.cssRules),h.each(j.cssRules,function(a,f){_("rule",f,f.cssText);_(h.important(f.style.cssText,
k));if(f.type===CSSRule.STYLE_RULE)f.style.cssText=h.important(f.style.cssText,k)}))):e.attr("style",h.important(e.attr("style"),c));else{if("object"===typeof c)return j.unshift("css"),e.important.apply(this,j);if("string"===typeof c)if(h.isFunction(f[c]))j=j.slice(1),f[c].apply(e,j);else{if("undefined"===typeof j[1]||"boolean"===typeof j[1])k=!1!==j[1],e.attr("style",a(c,k,e.attr("style")))}else h.isFunction(c)&&h.important.call(this,c)}return e}})(jQuery);(function(h){var a=function(a){var e=a.data("scrollbarPaper")||a.data("scrollbar-paper"),b=a.innerHeight(),f=b-a.height();return{height:b,ratio:b/(e.clearer.position().top-((e.content.children(":visible").eq(0).position()||{}).top||0)+f),offset:a.offset()}},b={_init:function(c){c=h.extend({parentSelector:"",important:!1,show:function(a){a.show()},hide:function(a){a.hide()}},c);return this.each(function(){var e=h(this),b=e.data("scrollbarPaper")||e.data("scrollbar-paper");if(!b){e.css({"overflow-x":"hidden",
"overflow-y":"auto"},!!c.important);b=e.closest(c.parentSelector);b.length||(b=e.offsetParent());var f=h('<div class="scrollbarpaper-container"></div>').appendTo(b);c.hide(f);var j=h('<div class="scrollbarpaper-track"></div>').appendTo(f),m=h('<div class="scrollbarpaper-drag"></div>').appendTo(j),b={options:c,offsetParent:b,paper:f,track:j,drag:m,dragTop:h('<div class="scrollbarpaper-drag-top"></div>').appendTo(m),dragBottom:h('<div class="scrollbarpaper-drag-bottom"></div>').appendTo(m),content:e,
clearer:h('<div style="clear:both;"></div>').appendTo(e),offsetHeight:j.outerHeight()-j.height()};e.data("scrollbarPaper",b).data("scrollbar-paper",b);var s=a(e),v=setInterval(function(){if(e.closest(".cfwhiteboard").length){var c=a(e);if(c.height!=s.height||c.ratio!=s.ratio||c.offset.left!=s.offset.left||c.offset.top!=s.offset.top)e.scrollbarPaper("update"),s=c}else clearInterval(v),f.remove()},200)}e.scrollbarPaper("update")})},update:function(c){return this.each(function(){var e=h(this);if(e.is(":visible")&&
!e.data("scrollbarpaperfrozen")){var b=e.data("scrollbarPaper")||e.data("scrollbar-paper");c=c||a(e);e.unbind(".scrollbarPaper");var f=e.innerHeight()-b.offsetHeight;b.track.css({height:f+"px"},!!b.options.important);var j=0<b.offsetParent.not("html, body").length?b.offsetParent.offset():{left:0,top:0};b.paper.css({left:-j.left+c.offset.left+e.innerWidth()-b.paper.width()+"px",top:-j.top+c.offset.top+"px"},!!b.options.important);var m=Math.max(Math.round(f*c.ratio),b.dragTop.height()+b.dragBottom.height());
b.drag.css({height:m+"px"},!!b.options.important);j=function(){b.drag.css({top:Math.min(Math.round(e.scrollTop()*c.ratio),f-m)+"px"},!!b.options.important)};j();e.bind("scroll.scrollbarPaper",j);var s=function(a){return a.pageY||(a.originalEvent&&(a.originalEvent.targetTouches||a.originalEvent.touches||[])[0]||a).pageY},v=function(){h("body").unbind("mousemove.scrollbarPaper touchmove.scrollbarPaper")};b.drag.bind("mousedown.scrollbarPaper touchstart.scrollbarPaper",function(a){v();var f=s(a)-b.drag.offset().top;
h("body").bind("mousemove.scrollbarPaper touchmove.scrollbarPaper",function(a){a.preventDefault();e.scrollTop((s(a)-e.offset().top-f)/c.ratio);return!1}).bind("mouseup.scrollbarPaper touchend.scrollbarPaper",v);return!1});1>c.ratio?(b.options.show(b.drag),b.content.addClass("scrollbarpaper-visible")):(b.options.hide(b.drag),b.content.removeClass("scrollbarpaper-visible"))}})},show:function(){return this.each(function(){var a=h(this),b=a.data("scrollbarPaper")||a.data("scrollbar-paper");b&&(a.scrollbarPaper("update"),
"function"==typeof b.options.show?b.options.show(b.paper):b.paper.show())})},hide:function(){return this.each(function(){var a=h(this);(a=a.data("scrollbarPaper")||a.data("scrollbar-paper"))&&("function"==typeof a.options.hide?a.options.hide(a.paper):a.paper.hide())})},freeze:function(){return this.each(function(){h(this).data("scrollbarpaperfrozen",!0)})},thaw:function(){return this.each(function(){h(this).data("scrollbarpaperfrozen",!1)})}};h.fn.scrollbarPaper=function(a){if(b[a])return b[a].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return b._init.apply(this,arguments);throw"Method "+a+" does not exist on jQuery.scrollbarPaper.";}})(jQuery);(function(){function h(a,g,f){if(a===g)return 0!==a||1/a==1/g;if(null==a||null==g)return a===g;if(a._chain)a=a._wrapped;if(g._chain)g=g._wrapped;if(a.isEqual&&d.isFunction(a.isEqual))return a.isEqual(g);if(g.isEqual&&d.isFunction(g.isEqual))return g.isEqual(a);var b=m.call(a);if(b!=m.call(g))return!1;switch(b){case "[object String]":return a==""+g;case "[object Number]":return a!=+a?g!=+g:0==a?1/a==1/g:a==+g;case "[object Date]":case "[object Boolean]":return+a==+g;case "[object RegExp]":return a.source==
g.source&&a.global==g.global&&a.multiline==g.multiline&&a.ignoreCase==g.ignoreCase}if("object"!=typeof a||"object"!=typeof g)return!1;for(var c=f.length;c--;)if(f[c]==a)return!0;f.push(a);var c=0,e=!0;if("[object Array]"==b){if(c=a.length,e=c==g.length)for(;c--&&(e=c in a==c in g&&h(a[c],g[c],f)););}else{if("constructor"in a!="constructor"in g||a.constructor!=g.constructor)return!1;for(var t in a)if(d.has(a,t)&&(c++,!(e=d.has(g,t)&&h(a[t],g[t],f))))break;if(e){for(t in g)if(d.has(g,t)&&!c--)break;
e=!c}}f.pop();return e}var a=this,b=a._,c={},e=Array.prototype,i=Object.prototype,f=e.slice,j=e.unshift,m=i.toString,s=i.hasOwnProperty,v=e.forEach,w=e.map,k=e.reduce,p=e.reduceRight,q=e.filter,o=e.every,l=e.some,n=e.indexOf,x=e.lastIndexOf,i=Array.isArray,g=Object.keys,t=Function.prototype.bind,d=function(a){return new y(a)};if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports)exports=module.exports=d;exports._=d}else a._=d;d.VERSION="1.3.1";var r=d.each=d.forEach=function(a,
g,f){if(null!=a)if(v&&a.forEach===v)a.forEach(g,f);else if(a.length===+a.length)for(var b=0,e=a.length;b<e&&!(b in a&&g.call(f,a[b],b,a)===c);b++);else for(b in a)if(d.has(a,b)&&g.call(f,a[b],b,a)===c)break};d.map=d.collect=function(a,g,d){var f=[];if(null==a)return f;if(w&&a.map===w)return a.map(g,d);r(a,function(a,u,b){f[f.length]=g.call(d,a,u,b)});if(a.length===+a.length)f.length=a.length;return f};d.reduce=d.foldl=d.inject=function(a,g,f,b){var c=2<arguments.length;null==a&&(a=[]);if(k&&a.reduce===
k)return b&&(g=d.bind(g,b)),c?a.reduce(g,f):a.reduce(g);r(a,function(a,d,u){c?f=g.call(b,f,a,d,u):(f=a,c=!0)});if(!c)throw new TypeError("Reduce of empty array with no initial value");return f};d.reduceRight=d.foldr=function(a,g,f,b){var c=2<arguments.length;null==a&&(a=[]);if(p&&a.reduceRight===p)return b&&(g=d.bind(g,b)),c?a.reduceRight(g,f):a.reduceRight(g);var e=d.toArray(a).reverse();b&&!c&&(g=d.bind(g,b));return c?d.reduce(e,g,f,b):d.reduce(e,g)};d.find=d.detect=function(a,g,d){var f;C(a,function(a,
b,u){if(g.call(d,a,b,u))return f=a,!0});return f};d.filter=d.select=function(a,g,d){var f=[];if(null==a)return f;if(q&&a.filter===q)return a.filter(g,d);r(a,function(a,b,u){g.call(d,a,b,u)&&(f[f.length]=a)});return f};d.reject=function(a,g,d){var f=[];if(null==a)return f;r(a,function(a,b,u){g.call(d,a,b,u)||(f[f.length]=a)});return f};d.every=d.all=function(a,g,d){var f=!0;if(null==a)return f;if(o&&a.every===o)return a.every(g,d);r(a,function(a,b,u){if(!(f=f&&g.call(d,a,b,u)))return c});return f};
var C=d.some=d.any=function(a,g,f){g||(g=d.identity);var b=!1;if(null==a)return b;if(l&&a.some===l)return a.some(g,f);r(a,function(a,d,u){if(b||(b=g.call(f,a,d,u)))return c});return!!b};d.include=d.contains=function(a,g){var d;return null==a?!1:n&&a.indexOf===n?-1!=a.indexOf(g):d=C(a,function(a){return a===g})};d.invoke=function(a,g){var b=f.call(arguments,2);return d.map(a,function(a){return(d.isFunction(g)?g||a:a[g]).apply(a,b)})};d.pluck=function(a,g){return d.map(a,function(a){return a[g]})};
d.max=function(a,g,f){if(!g&&d.isArray(a))return Math.max.apply(Math,a);if(!g&&d.isEmpty(a))return-Infinity;var b={computed:-Infinity};r(a,function(a,d,c){d=g?g.call(f,a,d,c):a;d>=b.computed&&(b={value:a,computed:d})});return b.value};d.min=function(a,g,f){if(!g&&d.isArray(a))return Math.min.apply(Math,a);if(!g&&d.isEmpty(a))return Infinity;var b={computed:Infinity};r(a,function(a,d,c){d=g?g.call(f,a,d,c):a;d<b.computed&&(b={value:a,computed:d})});return b.value};d.shuffle=function(a){var g=[],d;
r(a,function(a,f){0==f?g[0]=a:(d=Math.floor(Math.random()*(f+1)),g[f]=g[d],g[d]=a)});return g};d.sortBy=function(a,g,f){return d.pluck(d.map(a,function(a,d,b){return{value:a,criteria:g.call(f,a,d,b)}}).sort(function(a,g){var d=a.criteria,f=g.criteria;return d<f?-1:d>f?1:0}),"value")};d.groupBy=function(a,g){var f={},b=d.isFunction(g)?g:function(a){return a[g]};r(a,function(a,g){var d=b(a,g);(f[d]||(f[d]=[])).push(a)});return f};d.sortedIndex=function(a,g,f){f||(f=d.identity);for(var b=0,c=a.length;b<
c;){var e=b+c>>1;f(a[e])<f(g)?b=e+1:c=e}return b};d.toArray=function(a){return!a?[]:a.toArray?a.toArray():d.isArray(a)?f.call(a):d.isArguments(a)?f.call(a):d.values(a)};d.size=function(a){return d.toArray(a).length};d.first=d.head=function(a,g,d){return null!=g&&!d?f.call(a,0,g):a[0]};d.initial=function(a,g,d){return f.call(a,0,a.length-(null==g||d?1:g))};d.last=function(a,g,d){return null!=g&&!d?f.call(a,Math.max(a.length-g,0)):a[a.length-1]};d.rest=d.tail=function(a,g,d){return f.call(a,null==g||
d?1:g)};d.compact=function(a){return d.filter(a,function(a){return!!a})};d.flatten=function(a,g){return d.reduce(a,function(a,f){if(d.isArray(f))return a.concat(g?f:d.flatten(f));a[a.length]=f;return a},[])};d.without=function(a){return d.difference(a,f.call(arguments,1))};d.uniq=d.unique=function(a,g,f){var f=f?d.map(a,f):a,b=[];d.reduce(f,function(f,c,e){if(0==e||(!0===g?d.last(f)!=c:!d.include(f,c)))f[f.length]=c,b[b.length]=a[e];return f},[]);return b};d.union=function(){return d.uniq(d.flatten(arguments,
!0))};d.intersection=d.intersect=function(a){var g=f.call(arguments,1);return d.filter(d.uniq(a),function(a){return d.every(g,function(g){return 0<=d.indexOf(g,a)})})};d.difference=function(a){var g=d.flatten(f.call(arguments,1));return d.filter(a,function(a){return!d.include(g,a)})};d.zip=function(){for(var a=f.call(arguments),g=d.max(d.pluck(a,"length")),b=Array(g),c=0;c<g;c++)b[c]=d.pluck(a,""+c);return b};d.indexOf=function(a,g,f){if(null==a)return-1;var b;if(f)return f=d.sortedIndex(a,g),a[f]===
g?f:-1;if(n&&a.indexOf===n)return a.indexOf(g);for(f=0,b=a.length;f<b;f++)if(f in a&&a[f]===g)return f;return-1};d.lastIndexOf=function(a,g){if(null==a)return-1;if(x&&a.lastIndexOf===x)return a.lastIndexOf(g);for(var d=a.length;d--;)if(d in a&&a[d]===g)return d;return-1};d.range=function(a,g,d){1>=arguments.length&&(g=a||0,a=0);for(var d=arguments[2]||1,f=Math.max(Math.ceil((g-a)/d),0),b=0,c=Array(f);b<f;)c[b++]=a,a+=d;return c};var D=function(){};d.bind=function(a,g){var b,c;if(a.bind===t&&t)return t.apply(a,
f.call(arguments,1));if(!d.isFunction(a))throw new TypeError;c=f.call(arguments,2);return b=function(){if(!(this instanceof b))return a.apply(g,c.concat(f.call(arguments)));D.prototype=a.prototype;var d=new D,e=a.apply(d,c.concat(f.call(arguments)));return Object(e)===e?e:d}};d.bindAll=function(a){var g=f.call(arguments,1);0==g.length&&(g=d.functions(a));r(g,function(g){a[g]=d.bind(a[g],a)});return a};d.memoize=function(a,g){var f={};g||(g=d.identity);return function(){var b=g.apply(this,arguments);
return d.has(f,b)?f[b]:f[b]=a.apply(this,arguments)}};d.delay=function(a,g){var d=f.call(arguments,2);return setTimeout(function(){return a.apply(a,d)},g)};d.defer=function(a){return d.delay.apply(d,[a,1].concat(f.call(arguments,1)))};d.throttle=function(a,g){var f,b,c,e,t,j=d.debounce(function(){t=e=!1},g);return function(){f=this;b=arguments;c||(c=setTimeout(function(){c=null;t&&a.apply(f,b);j()},g));e?t=!0:a.apply(f,b);j();e=!0}};d.debounce=function(a,g){var d;return function(){var f=this,b=arguments;
clearTimeout(d);d=setTimeout(function(){d=null;a.apply(f,b)},g)}};d.once=function(a){var g=!1,d;return function(){if(g)return d;g=!0;return d=a.apply(this,arguments)}};d.wrap=function(a,g){return function(){var d=[a].concat(f.call(arguments,0));return g.apply(this,d)}};d.compose=function(){var a=arguments;return function(){for(var g=arguments,d=a.length-1;0<=d;d--)g=[a[d].apply(this,g)];return g[0]}};d.after=function(a,g){return 0>=a?g():function(){if(1>--a)return g.apply(this,arguments)}};d.keys=
g||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var g=[],f;for(f in a)d.has(a,f)&&(g[g.length]=f);return g};d.values=function(a){return d.map(a,d.identity)};d.functions=d.methods=function(a){var g=[],f;for(f in a)d.isFunction(a[f])&&g.push(f);return g.sort()};d.extend=function(a){r(f.call(arguments,1),function(g){for(var d in g)a[d]=g[d]});return a};d.defaults=function(a){r(f.call(arguments,1),function(g){for(var d in g)null==a[d]&&(a[d]=g[d])});return a};d.clone=function(a){return!d.isObject(a)?
a:d.isArray(a)?a.slice():d.extend({},a)};d.tap=function(a,g){g(a);return a};d.isEqual=function(a,g){return h(a,g,[])};d.isEmpty=function(a){if(d.isArray(a)||d.isString(a))return 0===a.length;for(var g in a)if(d.has(a,g))return!1;return!0};d.isElement=function(a){return!!(a&&1==a.nodeType)};d.isArray=i||function(a){return"[object Array]"==m.call(a)};d.isObject=function(a){return a===Object(a)};d.isArguments=function(a){return"[object Arguments]"==m.call(a)};if(!d.isArguments(arguments))d.isArguments=
function(a){return!(!a||!d.has(a,"callee"))};d.isFunction=function(a){return"[object Function]"==m.call(a)};d.isString=function(a){return"[object String]"==m.call(a)};d.isNumber=function(a){return"[object Number]"==m.call(a)};d.isNaN=function(a){return a!==a};d.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==m.call(a)};d.isDate=function(a){return"[object Date]"==m.call(a)};d.isRegExp=function(a){return"[object RegExp]"==m.call(a)};d.isNull=function(a){return null===a};d.isUndefined=
function(a){return void 0===a};d.has=function(a,g){return s.call(a,g)};d.noConflict=function(){a._=b;return this};d.identity=function(a){return a};d.times=function(a,g,d){for(var f=0;f<a;f++)g.call(d,f)};d.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};d.mixin=function(a){r(d.functions(a),function(g){E(g,d[g]=a[g])})};var F=0;d.uniqueId=function(a){var g=F++;return a?a+g:g};d.templateSettings=
{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/.^/,A=function(a){return a.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};d.template=function(a,g){var f=d.templateSettings,f="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(f.escape||z,function(a,g){return"',_.escape("+A(g)+"),'"}).replace(f.interpolate||z,function(a,g){return"',"+A(g)+",'"}).replace(f.evaluate||z,function(a,
g){return"');"+A(g).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",b=new Function("obj","_",f);return g?b(g,d):function(a){return b.call(this,a,d)}};d.chain=function(a){return d(a).chain()};var y=function(a){this._wrapped=a};d.prototype=y.prototype;var B=function(a,g){return g?d(a).chain():a},E=function(a,g){y.prototype[a]=function(){var a=f.call(arguments);j.call(a,this._wrapped);return B(g.apply(d,a),this._chain)}};
d.mixin(d);r("pop,push,reverse,shift,sort,splice,unshift".split(","),function(a){var g=e[a];y.prototype[a]=function(){var d=this._wrapped;g.apply(d,arguments);var f=d.length;("shift"==a||"splice"==a)&&0===f&&delete d[0];return B(d,this._chain)}});r(["concat","join","slice"],function(a){var g=e[a];y.prototype[a]=function(){return B(g.apply(this._wrapped,arguments),this._chain)}});y.prototype.chain=function(){this._chain=!0;return this};y.prototype.value=function(){return this._wrapped}}).call(this);
(function(h){var a=String.prototype.trim,b=function(a,b){for(var c=[];0<b;c[--b]=a);return c.join("")},c=function(a){return function(){for(var b=Array.prototype.slice.call(arguments),c=0;c<b.length;c++)b[c]=null==b[c]?"":""+b[c];return a.apply(null,b)}},e=function(){function a(f){return Object.prototype.toString.call(f).slice(8,-1).toLowerCase()}var c=function(){c.cache.hasOwnProperty(arguments[0])||(c.cache[arguments[0]]=c.parse(arguments[0]));return c.format.call(null,c.cache[arguments[0]],arguments)};
c.format=function(c,h){var j=1,i=c.length,k="",p=[],q,o,l,n;for(q=0;q<i;q++)if(k=a(c[q]),"string"===k)p.push(c[q]);else if("array"===k){l=c[q];if(l[2]){k=h[j];for(o=0;o<l[2].length;o++){if(!k.hasOwnProperty(l[2][o]))throw e('[_.sprintf] property "%s" does not exist',l[2][o]);k=k[l[2][o]]}}else k=l[1]?h[l[1]]:h[j++];if(/[^s]/.test(l[8])&&"number"!=a(k))throw e("[_.sprintf] expecting number but found %s",a(k));switch(l[8]){case "b":k=k.toString(2);break;case "c":k=String.fromCharCode(k);break;case "d":k=
parseInt(k,10);break;case "e":k=l[7]?k.toExponential(l[7]):k.toExponential();break;case "f":k=l[7]?parseFloat(k).toFixed(l[7]):parseFloat(k);break;case "o":k=k.toString(8);break;case "s":k=(k=""+k)&&l[7]?k.substring(0,l[7]):k;break;case "u":k=Math.abs(k);break;case "x":k=k.toString(16);break;case "X":k=k.toString(16).toUpperCase()}k=/[def]/.test(l[8])&&l[3]&&0<=k?"+"+k:k;o=l[4]?"0"==l[4]?"0":l[4].charAt(1):" ";n=l[6]-(""+k).length;o=l[6]?b(o,n):"";p.push(l[5]?k+o:o+k)}return p.join("")};c.cache={};
c.parse=function(a){for(var f=[],b=[],c=0;a;){if(null!==(f=/^[^\x25]+/.exec(a)))b.push(f[0]);else if(null!==(f=/^\x25{2}/.exec(a)))b.push("%");else if(null!==(f=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(a))){if(f[2]){var c=c|1,e=[],h=f[2],j=[];if(null!==(j=/^([a-z_][a-z_\d]*)/i.exec(h)))for(e.push(j[1]);""!==(h=h.substring(j[0].length));)if(null!==(j=/^\.([a-z_][a-z_\d]*)/i.exec(h)))e.push(j[1]);else if(null!==(j=/^\[(\d+)\]/.exec(h)))e.push(j[1]);
else throw"[_.sprintf] huh?";else throw"[_.sprintf] huh?";f[2]=e}else c|=2;if(3===c)throw"[_.sprintf] mixing positional and named placeholders is not (yet) supported";b.push(f)}else throw"[_.sprintf] huh?";a=a.substring(f[0].length)}return b};return c}(),i={VERSION:"1.2.0",isBlank:c(function(a){return/^\s*$/.test(a)}),stripTags:c(function(a){return a.replace(/<\/?[^>]+>/ig,"")}),capitalize:c(function(a){return a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()}),chop:c(function(a,b){for(var b=
1*b||a.length,c=[],e=0;e<a.length;)c.push(a.slice(e,e+b)),e+=b;return c}),clean:c(function(a){return i.strip(a.replace(/\s+/g," "))}),count:c(function(a,b){for(var c=0,e,h=0;h<a.length;)e=a.indexOf(b,h),0<=e&&c++,h=h+(0<=e?e:0)+b.length;return c}),chars:c(function(a){return a.split("")}),escapeHTML:c(function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}),unescapeHTML:c(function(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,
">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")}),escapeRegExp:c(function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")}),insert:c(function(a,b,c){a=a.split("");a.splice(1*b||0,0,c);return a.join("")}),include:c(function(a,b){return-1!==a.indexOf(b)}),join:c(function(a){var b=Array.prototype.slice.call(arguments);return b.join(b.shift())}),lines:c(function(a){return a.split("\n")}),reverse:c(function(a){return Array.prototype.reverse.apply((""+a).split("")).join("")}),
splice:c(function(a,b,c,e){a=a.split("");a.splice(1*b||0,1*c||0,e);return a.join("")}),startsWith:c(function(a,b){return a.length>=b.length&&a.substring(0,b.length)===b}),endsWith:c(function(a,b){return a.length>=b.length&&a.substring(a.length-b.length)===b}),succ:c(function(a){var b=a.split("");b.splice(a.length-1,1,String.fromCharCode(a.charCodeAt(a.length-1)+1));return b.join("")}),titleize:c(function(a){for(var a=a.split(" "),b,c=0;c<a.length;c++)b=a[c].split(""),"undefined"!==typeof b[0]&&(b[0]=
b[0].toUpperCase()),c+1===a.length?a[c]=b.join(""):a[c]=b.join("")+" ";return a.join("")}),camelize:c(function(a){return i.trim(a).replace(/(\-|_|\s)+(.)?/g,function(a,b,f){return f?f.toUpperCase():""})}),underscored:function(a){return i.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/\-|\s+/g,"_").toLowerCase()},dasherize:function(a){return i.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1-$2").replace(/^([A-Z]+)/,"-$1").replace(/\_|\s+/g,"-").toLowerCase()},humanize:function(a){return i.capitalize(this.underscored(a).replace(/_id$/,
"").replace(/_/g," "))},trim:c(function(b,c){if(!c&&a)return a.call(b);c=c?i.escapeRegExp(c):"\\s";return b.replace(RegExp("^["+c+"]+|["+c+"]+$","g"),"")}),ltrim:c(function(a,b){b=b?i.escapeRegExp(b):"\\s";return a.replace(RegExp("^["+b+"]+","g"),"")}),rtrim:c(function(a,b){b=b?i.escapeRegExp(b):"\\s";return a.replace(RegExp("["+b+"]+$","g"),"")}),truncate:c(function(a,b,c){b=1*b||0;return a.length>b?a.slice(0,b)+(c||"..."):a}),prune:c(function(a,b,c){var c=c||"...",b=1*b||0,e="",e=0===a.substring(b-
1,b+1).search(/^\w\w$/)?i.rtrim(a.slice(0,b).replace(/([\W][\w]*)$/,"")):i.rtrim(a.slice(0,b)),e=e.replace(/\W+$/,"");return e.length+c.length>a.length?a:e+c}),words:function(a,b){return(""+a).split(b||" ")},pad:c(function(a,c,e,h){var i="",i=0,c=1*c||0;e?1<e.length&&(e=e.charAt(0)):e=" ";switch(h){case "right":i=c-a.length;i=b(e,i);a+=i;break;case "both":i=c-a.length;i={left:b(e,Math.ceil(i/2)),right:b(e,Math.floor(i/2))};a=i.left+a+i.right;break;default:i=c-a.length,i=b(e,i),a=i+a}return a}),lpad:function(a,
b,c){return i.pad(a,b,c)},rpad:function(a,b,c){return i.pad(a,b,c,"right")},lrpad:function(a,b,c){return i.pad(a,b,c,"both")},sprintf:e,vsprintf:function(a,b){b.unshift(a);return e.apply(null,b)},toNumber:function(a,b){var c;c=1*(1*a||0).toFixed(1*b||0)||0;return!(0===c&&"0"!==a&&0!==a)?c:Number.NaN},strRight:c(function(a,b){var c=!b?-1:a.indexOf(b);return-1!=c?a.slice(c+b.length,a.length):a}),strRightBack:c(function(a,b){var c=!b?-1:a.lastIndexOf(b);return-1!=c?a.slice(c+b.length,a.length):a}),strLeft:c(function(a,
b){var c=!b?-1:a.indexOf(b);return-1!=c?a.slice(0,c):a}),strLeftBack:c(function(a,b){var c=a.lastIndexOf(b);return-1!=c?a.slice(0,c):a}),exports:function(){var a={},b;for(b in this)if(this.hasOwnProperty(b)&&!("include"==b||"contains"==b||"reverse"==b))a[b]=this[b];return a}};i.strip=i.trim;i.lstrip=i.ltrim;i.rstrip=i.rtrim;i.center=i.lrpad;i.ljust=i.lpad;i.rjust=i.rpad;i.contains=i.include;if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports)module.exports=i;exports._s=
i}else"undefined"!==typeof h._?(h._.string=i,h._.str=h._.string):h._={string:i,str:i}})(this||window);(function(){var h=this,a=h.Backbone,b;b="undefined"!==typeof exports?exports:h.Backbone={};b.VERSION="0.5.3";var c=h._;if(!c&&"undefined"!==typeof require)c=require("underscore")._;var e=h.jQuery||h.Zepto;b.noConflict=function(){h.Backbone=a;return this};b.emulateHTTP=!1;b.emulateJSON=!1;b.Events={bind:function(a,b,d){var c=this._callbacks||(this._callbacks={});(c[a]||(c[a]=[])).push([b,d]);return this},unbind:function(a,b){var d;if(a){if(d=this._callbacks)if(b){d=d[a];if(!d)return this;for(var c=
0,e=d.length;c<e;c++)if(d[c]&&b===d[c][0]){d[c]=null;break}}else d[a]=[]}else this._callbacks={};return this},trigger:function(a){var b,d,c,e,f=2;if(!(d=this._callbacks))return this;for(;f--;)if(b=f?a:"all",b=d[b])for(var h=0,i=b.length;h<i;h++)(c=b[h])?(e=f?Array.prototype.slice.call(arguments,1):arguments,c[0].apply(c[1]||this,e)):(b.splice(h,1),h--,i--);return this}};b.Model=function(a,b){var d;a||(a={});if(d=this.defaults)c.isFunction(d)&&(d=d.call(this)),a=c.extend({},d,a);this.attributes={};
this._escapedAttributes={};this.cid=c.uniqueId("c");this.set(a,{silent:!0});this._changed=!1;this._previousAttributes=c.clone(this.attributes);if(b&&b.collection)this.collection=b.collection;this.initialize(a,b)};c.extend(b.Model.prototype,b.Events,{_previousAttributes:null,_changed:!1,idAttribute:"id",initialize:function(){},toJSON:function(){return c.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;b=this.attributes[a];
return this._escapedAttributes[a]=(null==b?"":""+b).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},has:function(a){return null!=this.attributes[a]},set:function(a,b){b||(b={});if(!a)return this;if(a.attributes)a=a.attributes;var d=this.attributes,e=this._escapedAttributes;if(!b.silent&&this.validate&&!this._performValidation(a,b))return!1;if(this.idAttribute in a)this.id=a[this.idAttribute];
var f=this._changing;this._changing=!0;for(var h in a){var i=a[h];if(!c.isEqual(d[h],i))d[h]=i,delete e[h],this._changed=!0,b.silent||this.trigger("change:"+h,this,i,b)}!f&&!b.silent&&this._changed&&this.change(b);this._changing=!1;return this},unset:function(a,b){if(!(a in this.attributes))return this;b||(b={});var d={};d[a]=void 0;if(!b.silent&&this.validate&&!this._performValidation(d,b))return!1;delete this.attributes[a];delete this._escapedAttributes[a];a==this.idAttribute&&delete this.id;this._changed=
!0;b.silent||(this.trigger("change:"+a,this,void 0,b),this.change(b));return this},clear:function(a){a||(a={});var b,d=this.attributes,c={};for(b in d)c[b]=void 0;if(!a.silent&&this.validate&&!this._performValidation(c,a))return!1;this.attributes={};this._escapedAttributes={};this._changed=!0;if(!a.silent){for(b in d)this.trigger("change:"+b,this,void 0,a);this.change(a)}return this},fetch:function(a){a||(a={});var c=this,d=a.success;a.success=function(b,e,f){if(!c.set(c.parse(b,f),a))return!1;d&&
d(c,b)};a.error=x(a.error,c,a);return(this.sync||b.sync).call(this,"read",this,a)},save:function(a,c){c||(c={});if(a&&!this.set(a,c))return!1;var d=this,e=c.success;c.success=function(a,g,b){if(!d.set(d.parse(a,b),c))return!1;e&&e(d,a,b)};c.error=x(c.error,d,c);var f=this.isNew()?"create":"update";return(this.sync||b.sync).call(this,f,this,c)},destroy:function(a){a||(a={});if(this.isNew())return this.trigger("destroy",this,this.collection,a);var c=this,d=a.success;a.success=function(b){c.trigger("destroy",
c,c.collection,a);d&&d(c,b)};a.error=x(a.error,c,a);return(this.sync||b.sync).call(this,"delete",this,a)},url:function(){var a=l(this.collection)||this.urlRoot||n();return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this)},isNew:function(){return null==this.id},change:function(a){this.trigger("change",this,a);this._previousAttributes=c.clone(this.attributes);this._changed=!1},hasChanged:function(a){return a?
this._previousAttributes[a]!=this.attributes[a]:this._changed},changedAttributes:function(a){a||(a=this.attributes);var b=this._previousAttributes,d=!1,e;for(e in a)c.isEqual(b[e],a[e])||(d=d||{},d[e]=a[e]);return d},previous:function(a){return!a||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return c.clone(this._previousAttributes)},_performValidation:function(a,b){var d=this.validate(a);return d?(b.error?b.error(this,d,b):this.trigger("error",this,d,b),
!1):!0}});b.Collection=function(a,b){b||(b={});if(b.comparator)this.comparator=b.comparator;c.bindAll(this,"_onModelEvent","_removeReference");this._reset();a&&this.reset(a,{silent:!0});this.initialize.apply(this,arguments)};c.extend(b.Collection.prototype,b.Events,{model:b.Model,initialize:function(){},toJSON:function(){return this.map(function(a){return a.toJSON()})},add:function(a,b){if(c.isArray(a))for(var d=0,e=a.length;d<e;d++)this._add(a[d],b);else this._add(a,b);return this},remove:function(a,
b){if(c.isArray(a))for(var d=0,e=a.length;d<e;d++)this._remove(a[d],b);else this._remove(a,b);return this},get:function(a){return null==a?null:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");this.models=this.sortBy(this.comparator);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return c.map(this.models,
function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});this.each(this._removeReference);this._reset();this.add(a,{silent:!0});b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a||(a={});var c=this,d=a.success;a.success=function(b,e,f){c[a.add?"add":"reset"](c.parse(b,f),a);d&&d(c,b)};a.error=x(a.error,c,a);return(this.sync||b.sync).call(this,"read",this,a)},create:function(a,b){var d=this;b||(b={});a=this._prepareModel(a,b);if(!a)return!1;var c=b.success;b.success=
function(a,g,e){d.add(a,b);c&&c(a,g,e)};a.save(null,b);return a},parse:function(a){return a},chain:function(){return c(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,c){if(a instanceof b.Model){if(!a.collection)a.collection=this}else{var d=a,a=new this.model(d,{collection:this});a.validate&&!a._performValidation(d,c)&&(a=!1)}return a},_add:function(a,b){b||(b={});a=this._prepareModel(a,b);if(!a)return!1;var c=this.getByCid(a);
if(c)throw Error(["Can't add the same model to a set twice",c.id]);this._byId[a.id]=a;this._byCid[a.cid]=a;this.models.splice(null!=b.at?b.at:this.comparator?this.sortedIndex(a,this.comparator):this.length,0,a);a.bind("all",this._onModelEvent);this.length++;b.silent||a.trigger("add",a,this,b);return a},_remove:function(a,b){b||(b={});a=this.getByCid(a)||this.get(a);if(!a)return null;delete this._byId[a.id];delete this._byCid[a.cid];this.models.splice(this.indexOf(a),1);this.length--;b.silent||a.trigger("remove",
a,this,b);this._removeReference(a);return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.unbind("all",this._onModelEvent)},_onModelEvent:function(a,b,c,e){("add"==a||"remove"==a)&&c!=this||("destroy"==a&&this._remove(b,e),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments))}});c.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,rest,last,without,indexOf,lastIndexOf,isEmpty,groupBy".split(","),
function(a){b.Collection.prototype[a]=function(){return c[a].apply(c,[this.models].concat(c.toArray(arguments)))}});b.Router=function(a){a||(a={});if(a.routes)this.routes=a.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var i=/:([\w\d]+)/g,f=/\*([\w\d]+)/g,j=/[-[\]{}()+?.,\\^$|#\s]/g;c.extend(b.Router.prototype,b.Events,{initialize:function(){},route:function(a,e,d){b.history||(b.history=new b.History);c.isRegExp(a)||(a=this._routeToRegExp(a));b.history.route(a,c.bind(function(b){b=
this._extractParameters(a,b);d.apply(this,b);this.trigger.apply(this,["route:"+e].concat(b))},this))},navigate:function(a,c){b.history.navigate(a,c)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(j,"\\$&").replace(i,"([^/]*)").replace(f,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});
b.History=function(){this.handlers=[];c.bindAll(this,"checkUrl")};var m=/^#*/,s=/msie [\w.]+/,v=!1;c.extend(b.History.prototype,{interval:50,getFragment:function(a,b){if(null==a)if(this._hasPushState||b){var a=window.location.pathname,c=window.location.search;c&&(a+=c);0==a.indexOf(this.options.root)&&(a=a.substr(this.options.root.length))}else a=window.location.hash;return decodeURIComponent(a.replace(m,""))},start:function(a){if(v)throw Error("Backbone.history has already been started");this.options=
c.extend({},{root:"/"},this.options,a);this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var a=this.getFragment(),b=document.documentMode;if(b=s.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b))this.iframe=e('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?e(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!b?e(window).bind("hashchange",
this.checkUrl):setInterval(this.checkUrl,this.interval);this.fragment=a;v=!0;a=window.location;b=a.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;if(this._wantsPushState&&this._hasPushState&&b&&a.hash)this.fragment=a.hash.replace(m,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment);if(!this.options.silent)return this.loadUrl()},
route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.iframe.location.hash));if(a==this.fragment||a==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return c.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,
b){var c=(a||"").replace(m,"");if(!(this.fragment==c||this.fragment==decodeURIComponent(c))){if(this._hasPushState){var e=window.location;0!=c.indexOf(this.options.root)&&(c=this.options.root+c);this.fragment=c;window.history.pushState({},document.title,e.protocol+"//"+e.host+c)}else if(window.location.hash=this.fragment=c,this.iframe&&c!=this.getFragment(this.iframe.location.hash))this.iframe.document.open().close(),this.iframe.location.hash=c;b&&this.loadUrl(a)}}});b.View=function(a){this.cid=c.uniqueId("view");
this._configure(a||{});this._ensureElement();this.delegateEvents();this.initialize.apply(this,arguments)};var w=/^(\S+)\s*(.*)$/,k="model,collection,el,id,attributes,className,tagName".split(",");c.extend(b.View.prototype,b.Events,{tagName:"div",$:function(a){return e(a,this.el)},initialize:function(){},render:function(){return this},remove:function(){e(this.el).remove();return this},make:function(a,b,c){a=document.createElement(a);b&&e(a).attr(b);c&&e(a).html(c);return a},delegateEvents:function(a){if(a||
(a=this.events)){c.isFunction(a)&&(a=a.call(this));e(this.el).unbind(".delegateEvents"+this.cid);for(var b in a){var d=this[a[b]];if(!d)throw Error('Event "'+a[b]+'" does not exist');var f=b.match(w),h=f[1],f=f[2],d=c.bind(d,this),h=h+(".delegateEvents"+this.cid);""===f?e(this.el).bind(h,d):e(this.el).delegate(f,h,d)}}},_configure:function(a){this.options&&(a=c.extend({},this.options,a));for(var b=0,d=k.length;b<d;b++){var e=k[b];a[e]&&(this[e]=a[e])}this.options=a},_ensureElement:function(){if(this.el){if(c.isString(this.el))this.el=
e(this.el).get(0)}else{var a=this.attributes||{};if(this.id)a.id=this.id;if(this.className)a["class"]=this.className;this.el=this.make(this.tagName,a)}}});b.Model.extend=b.Collection.extend=b.Router.extend=b.View.extend=function(a,b){var c=o(this,a,b);c.extend=this.extend;return c};var p={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};b.sync=function(a,f,d){var h=p[a],d=c.extend({type:h,dataType:"json"},d);if(!d.url)d.url=l(f)||n();if(!d.data&&f&&("create"==a||"update"==a))d.contentType=
"application/json",d.data=JSON.stringify(f.toJSON());if(b.emulateJSON)d.contentType="application/x-www-form-urlencoded",d.data=d.data?{model:d.data}:{};if(b.emulateHTTP&&("PUT"===h||"DELETE"===h)){if(b.emulateJSON)d.data._method=h;d.type="POST";d.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",h)}}if("GET"!==d.type&&!b.emulateJSON)d.processData=!1;return e.ajax(d)};var q=function(){},o=function(a,b,d){var e;e=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return a.apply(this,
arguments)};c.extend(e,a);q.prototype=a.prototype;e.prototype=new q;b&&c.extend(e.prototype,b);d&&c.extend(e,d);e.prototype.constructor=e;e.__super__=a.prototype;return e},l=function(a){return!a||!a.url?null:c.isFunction(a.url)?a.url():a.url},n=function(){throw Error('A "url" property or function must be specified');},x=function(a,b,c){return function(e){a?a(b,e,c):b.trigger("error",b,e,c)}}}).call(this);function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}window.Store=function(h){this.name=h;this.records=(h=localStorage.getItem(this.name))&&h.split(",")||[]};
_.extend(Store.prototype,{save:function(){localStorage.setItem(this.name,this.records.join(","))},create:function(h){if(!h.id)h.id=h.attributes.id=guid();localStorage.setItem(this.name+"-"+h.id,JSON.stringify(h));this.records.push(h.id.toString());this.save();return h},update:function(h){localStorage.setItem(this.name+"-"+h.id,JSON.stringify(h));_.include(this.records,h.id.toString())||this.records.push(h.id.toString());this.save();return h},find:function(h){return JSON.parse(localStorage.getItem(this.name+
"-"+h.id))},findAll:function(){return _.map(this.records,function(h){return JSON.parse(localStorage.getItem(this.name+"-"+h))},this)},destroy:function(h){localStorage.removeItem(this.name+"-"+h.id);this.records=_.reject(this.records,function(a){return a==h.id.toString()});this.save();return h}});Backbone.remoteSync=Backbone.sync;
Backbone.sync=function(h,a,b,c){"function"==typeof b&&(b={success:b,error:c});var e,i=a.localStorage||a.collection&&a.collection.localStorage;if(!i)return Backbone.remoteSync(h,a,b,c);switch(h){case "read":e=a.id?i.find(a):i.findAll();break;case "create":e=i.create(a);break;case "update":e=i.update(a);break;case "delete":e=i.destroy(a)}e?b.success(e):b.error("Record not found")};window.Modernizr=function(h,a,b){function c(a,b){var c=a.charAt(0).toUpperCase()+a.substr(1),c=(a+" "+s.join(c+" ")+c).split(" ");return e(c,b)}function e(a,c){for(var e in a)if(m[a[e]]!==b)return"pfx"==c?a[e]:!0;return!1}var i={},f=a.documentElement;a.head||a.getElementsByTagName("head");var j=a.createElement("modernizr"),m=j.style,h=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),s="Webkit Moz O ms Khtml".split(" "),j={},v=[],w=function(b,c,e,g){var h,d,i=a.createElement("div");if(parseInt(e,10))for(;e--;)d=
a.createElement("div"),d.id=g?g[e]:"modernizr"+(e+1),i.appendChild(d);h=["&shy;<style>",b,"</style>"].join("");i.id="modernizr";i.innerHTML+=h;f.appendChild(i);b=c(i,b);i.parentNode.removeChild(i);return!!b},k,p={}.hasOwnProperty,q;typeof p!==b&&typeof p.call!==b?q=function(a,b){return p.call(a,b)}:q=function(a,c){return c in a&&typeof a.constructor.prototype[c]===b};(function(a,b){var c=a.join(""),e=b.length;w(c,function(a){for(var a=a.childNodes,b={};e--;)b[a[e].id]=a[e];i.csstransforms3d=9===b.csstransforms3d.offsetLeft},
e,b)})([,["@media (",h.join("transform-3d),("),"modernizr){#csstransforms3d{left:9px;position:absolute}}"].join("")],[,"csstransforms3d"]);j.csstransforms=function(){return!!e(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])};j.csstransforms3d=function(){var a=!!e(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);a&&"webkitPerspective"in f.style&&(a=i.csstransforms3d);return a};j.csstransitions=function(){return c("transitionProperty")};
for(var o in j)q(j,o)&&(k=o.toLowerCase(),i[k]=j[o](),v.push((i[k]?"":"no-")+k));m.cssText="";j=null;i._version="2.0.6";i._prefixes=h;i._domPrefixes=s;i.testProp=function(a){return e([a])};i.testAllProps=c;i.testStyles=w;return i}(this,this.document);CFW={domain:/rinkls/.test(window.location.host)||/squatch/.test(window.location.host)?"http://tameron.heroku.com":"http://cfwhiteboard.com"};
jQuery(function(h){h(document.embeds).each(function(){var a=h(this);setTimeout(function(){var b=!1,c=a.attr("wmode");"opaque"!=c&&"transparent"!=c&&(a.attr("wmode","opaque"),b=!0);var e=a.closest("object"),c=e.children("param[name=wmode]").val();"opaque"!=c&&"transparent"!=c&&(e.prepend(h('<param name="wmode" value="opaque" />')),b=!0);b&&(e=e.length?e:a,b=e.wrap(h('<span class="cfw-placeholder" />')),b.html(b.html()),b.children().unwrap())},h.browser.msie?300:0)});h("iframe").each(function(){/youtube/.test(this.src)&&
!/wmode=transparent/.test(this.src)&&!/wmode=opaque/.test(this.src)&&(this.src+=(0<=this.src.substring(this.src.lastIndexOf&&this.src.lastIndexOf("/")).indexOf("?")?"&":"?")+"wmode=opaque")})});
jQuery(function(h){h.fn.bindBefore=function(a,b){a=a.split(/\s+/);this.each(function(){for(var c=a.length;c--;){h(this).bind(a[c],b);var e=h.data(this,"events")[a[c]];e.splice(0,0,e.pop())}})};h.fn.oneBefore=function(a,b){a=a.split(/\s+/);this.each(function(){for(var c=a.length;c--;){h(this).one(a[c],b);var e=h.data(this,"events")[a[c]];e.splice(0,0,e.pop())}})}});
jQuery(function(h){if(!Modernizr.csstransitions)Modernizr.csstransforms=!1,Modernizr.csstransforms3d=!1;if(/AppleWebKit/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent))Modernizr.csstransforms3d=!1;if(h.browser.msie&&window.XDomainRequest)jQuery.ajaxSetup({xhr:function(){try{var a=new XDomainRequest;a.timeout=5E3;a.getAllResponseHeaders=function(){return""};var b=function(){var b=new XDomainRequest;b.timeout=a.timeout;b.onload=a.onload;b.onerror=a.onerror;b.ontimeout=a.ontimeout;
b.open(a.openArgs[0],a.openArgs[1]);b.send(a.sendArgs[0])};a.onload=function(){a.onload=a.onerror=a.ontimeout=jQuery.noop;a.status=200;a.statusText="OK";a.readyState=4;a.onreadystatechange&&a.onreadystatechange()};a.onerror=function(){b()};a.ontimeout=function(){b()};a.originalOpen=a.open;a.open=function(b,c){"PUT"===b?(c+="/revise",b="POST"):"DELETE"===b&&(c+="/annihilate",b="POST");a.openArgs=[b,c];a.originalOpen(b,c)};a.originalSend=a.send;a.send=function(b){a.sendArgs=[b];setTimeout(function(){a.originalSend(b)},
0)};return a}catch(c){return jQuery.ajaxSettings.xhr()}}}),jQuery.support.cors=!0;CFW.User=Backbone.Model.extend({defaults:function(){return{email:"",known_as:"",count:0,highlightColor:CFW.User.prototype.randomColor()}},randomColor:function(){return[[255,75,105],[255,105,75],[75,105,255],[105,75,255],[75,255,105],[105,255,75],[123,6,226],[226,6,123],[6,226,123],[6,123,226]][Math.floor(10*Math.random()+0)]}});CFW.UserList=Backbone.Collection.extend({model:CFW.User,initialize:function(){this.localStorage=
new Store("cfw-users");return this},comparator:function(a){return-a.get("count")}});CFW.users=new CFW.UserList;CFW.users.fetch();CFW.Entry=Backbone.Model.extend({defaults:{athlete_id:"",known_as:"",email:"",component_results:[],notes:""},emailRegex:/^\S+@\S+\.\S+$/,validate:function(a){var b=[];!(a.athlete_id||this.attributes&&this.get("athlete_id"))&&!this.emailRegex.test(a.email)&&b.push("email");_.each(a.component_results,function(a){(!a.result||!a.result.length)&&b.push("component-"+a.wp_id+"-result")});
if(b.length)return b}});CFW.EntryList=Backbone.Collection.extend({model:CFW.Entry,url:function(){return CFW.domain+"/affiliates/"+this.affiliateId+"/wods/"+this.postId+"+"+this.wod.wp_id+"/posts"},initialize:function(a,b){this.affiliateId=b.affiliateId;this.postId=b.postId;this.wod=b.wod;return this},comparator:function(a){return a.get("known_as").toLowerCase()}});CFW.EntryItemView=Backbone.View.extend({tagName:"tr",template:_.template('            <td class="cfw-known-as"><%- known_as %></td>            <%             if (wod.components && wod.components.length > 1) {                _.each(wod.components, function(component, i, components) {                    var componentResult = _.find(component_results, function(cr) {                        return cr.wp_id == component.wp_id;                    }) || {                        result: "",                        rx: false,                        mods: ""                    };                    var isLast = (i + 1 == components.length);                    %>                     <td class="cfw-component">                        <%= isLast ? "<div>" : "" %>                        <span class="cfw-result"><%- componentResult.result %></span>                        <span class="cfw-mods">                            <%= componentResult.rx ? "<strong>Rx</strong>" : "" %>                            <%- componentResult.mods %>                        </span>                        <% if (isLast) { %>                            <span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                        <% } %>                        <%= isLast ? "</div>" : "" %>                    </td>                <%                 });            } else {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == (wod.components[0] || {wp_id: "uh oh"}).wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                 <td class="cfw-result"><%- componentResult.result %></td>                <td class="cfw-mods">                    <div>                        <%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %><span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                    </div>                </td>            <%             }            %>         '),
events:{click:"showDetail"},initialize:function(){this.model.bind("change",this.render,this);this.model.bind("destroy",this.remove,this);this.model.bind("show",this.lookSelected,this);this.model.bind("unshow",this.unlookSelected,this);return this.render()},render:function(){h(this.el).html(this.template(_.extend({wod:this.options.wod},this.model.toJSON())));return this},lookSelected:function(){h(this.el).addClass("cfw-selected")},unlookSelected:function(){h(this.el);h(this.el).removeClass("cfw-selected")},
addHighlight:function(a){h(this.el).addClass("cfw-highlighted").css({backgroundColor:"rgba("+a.join(",")+",.2)",borderColor:"rgba("+a.join(",")+",.2)"})},removeHighlight:function(){h(this.el).removeClass("cfw-highlighted").css({backgroundColor:"transparent",borderColor:"#888"})},showDetail:function(){this.itemClickDisabled||this.model.trigger("show",this.model)}});CFW.WhiteboardPage=Backbone.View.extend({tagName:"div",className:"cfw-page",show:function(){h(this.el).addClass("active");var a=this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),
a.scrollbarReady=!0;a.showScrollbar()},Modernizr.csstransitions?400:0)},hide:function(){this.freezeScrollbar();var a=h(this.el).removeClass("active"),b=this;setTimeout(function(){b.hideScrollbar();b.thawScrollbar();a.trigger("cfwhide")},Modernizr.csstransitions?300:0)},initScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper({parentSelector:".cfw-window",important:!0,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("show")},
hideScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("hide")},freezeScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("freeze")},thawScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("thaw")}});CFW.EntryListView=CFW.WhiteboardPage.extend({template:_.template('            <table class="cfw-components-<%= wod.components && wod.components.length || 1 %>" cellspacing="0">                <thead>                    <tr>                        <th class="cfw-known-as">Name</th>                        <% _.each(wod.components, function(component) { %>                            <th class="cfw-component" <%= wod.components.length == 1 ? \'colspan="2"\' : "" %> title="<%- component.label %>"><%- component.label %></th>                        <% }); %>                    </tr>                </thead>            </table>            <div class="cfw-scrollable">                <table cellspacing="0" class="cfw-components-<%= wod.components && wod.components.length || 1 %>">                    <tbody>                    </tbody>                </table>            </div>        '),
events:{"touchmove .cfw-scrollable":"disableItemClicks","touchstart .cfw-scrollable":"enableItemClicks"},initialize:function(a){this.entries=a.entries;this.wod=a.wod;this.entryItemViews=[];this.entries.bind("add",this.addAll,this);this.entries.bind("change:known_as",this.addAll,this);this.entries.bind("remove",this.addAll,this);this.entries.bind("reset",this.addAll,this);CFW.users.bind("reset",this.updateHighlightedUsers,this);CFW.users.bind("change",this.updateHighlightedUsers,this);CFW.users.bind("add",
this.addHighlightedUser,this);CFW.users.bind("remove",this.removeHighlightedUser,this);return this.render()},render:function(){h(this.el).html(this.template({wod:this.wod}));return this},addOne:function(a){a=new CFW.EntryItemView({model:a,wod:this.wod});this.entryItemViews.push(a);this.$("tbody").append(a.el)},addAll:function(){_.each(this.entryItemViews,function(a,b,c){a.remove();delete c[b]});this.$("tbody").empty();this.entries.length?this.entries.each(this.addOne,this):this.$("tbody").append(h('                    <tr class="cfw-no-entries">                        <td colspan="100">No one has added an entry yet.<br /><a class="cfw-new-entry">Add yours now!<a></td>                    </tr>                '));
this.updateHighlightedUsers()},show:function(){var a=this.$("table").attr("class"),b=h(this.el).closest(".cfw-contents");setTimeout(function(){b.addClass(a).data("componentsclass",a)},Modernizr.csstransitions?300:0);CFW.WhiteboardPage.prototype.show.apply(this,arguments)},hide:function(){var a=this.$("table").attr("class");h(this.el).closest(".cfw-contents").removeClass(a).removeData("componentsclass");CFW.WhiteboardPage.prototype.hide.apply(this,arguments)},disableItemClicks:function(){_.each(this.entryItemViews,
function(a){a.itemClickDisabled=!0})},enableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!1})},updateHighlightedUsers:function(){this.entries.each(function(a){a.trigger("removeHighlight")});CFW.users.each(this.addHighlightedUser,this)},addHighlightedUser:function(a){_.each(this.entries.select(function(b){return b.get("email").toLowerCase()==a.get("email").toLowerCase()}),function(b){b.trigger("addHighlight",a.get("highlightColor"))})},removeHighlightedUser:function(a){_.each(this.entries.select(function(b){return b.get("email").toLowerCase()==
a.get("email").toLowerCase()}),function(a){a.trigger("removeHighlight")})}});CFW.EntryDetailView=CFW.WhiteboardPage.extend({template:_.template('            <div class="cfw-entry-detail">                <a class="cfw-back">back</a><a class="cfw-edit">edit</a>                <dl class="cfw-scrollable">                    <dt class="cfw-hidden">Name</dt>                    <dd class="cfw-known-as"><%- known_as %></dd>                    <%                    _.each(wod.components, function(component) {                        var componentResult = _.find(component_results, function(cr) {                            return cr.wp_id == component.wp_id;                        }) || {                            result: "",                            rx: false,                            mods: ""                        };                    %>                        <dt><%= component.label %></dt>                        <dd class="cfw-component">                            <span class="cfw-result"><%- componentResult.result %></span>                            <span class="cfw-mods"><%= componentResult.rx ? "<strong>Rx</strong> " : "" %><%- componentResult.mods %><%- !componentResult.rx && !componentResult.mods ? "(no data)" : "" %></span>                        </dd>                    <%                    });                    %>                    <dt>Notes</dt>                    <dd class="cfw-notes"><%- notes || "(no data)" %></dd>                </dl>            </div>        '),
events:{"click a.cfw-edit":"edit","click a.cfw-back":"back",cfwhide:"cleanup"},initialize:function(a){this.wod=a.wod;this.model.bind("change",this.render,this);this.model.bind("destroy",this.hide,this);return this.render()},render:function(){h(this.el).html(this.template(_.extend({wod:this.wod},this.model.toJSON())));return this},edit:function(){this.model.trigger("edit",this.model)},back:function(){h(this.el).trigger("hideEntryDetails")},cleanup:function(){var a=this;setTimeout(function(){a.model.trigger("unshow",
a.model);a.remove()},0)}});CFW.EntryFormView=Backbone.View.extend({tagName:"form",className:"cfw-scrollable",template:_.template('            <fieldset>                <\!--<h2><%= new_record ? "Add Your Entry" : "Edit Your Entry" %></h2>--\>                <h2><label for="cfw-email">Email Address</label></h2>                <input type="email" id="cfw-email" name="email" placeholder="name@example.com" autofocus="autofocus" <%= new_record ? "" : \'value="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" disabled="disabled"\' %> />            </fieldset>            <fieldset>                <h2><label for="cfw-known-as">Name</label></h2>                <input type="text" id="cfw-known-as" name="known_as" placeholder="Guest" value="<%- known_as %>" />            </fieldset>            <%            _.each(wod.components, function(component) {                var componentResult = _.find(component_results, function(cr) {                    return cr.wp_id == component.wp_id;                }) || {                    result: "",                    rx: false,                    mods: ""                };            %>                <fieldset>                    <h2><label for="cfw-component-<%= component.wp_id %>-result"><%= component.label %></label></h2>                    <input type="text" id="cfw-component-<%= component.wp_id %>-result" name="component-<%= component.wp_id %>-result" placeholder="How did you do?" value="<%- componentResult.result %>" />                    <div class="cfw-nobr">                        <label for="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority">Rx</label><label for="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority">Modifications</label>                    </div>                    <div class="cfw-nobr">                        <input type="checkbox" id="cfw-component-<%= component.wp_id %>-rx" class="cfw-minority" name="component-<%= component.wp_id %>-rx" <%= componentResult.rx ? \'checked="checked"\' : "" %>                        /><span>or</span><input type="text" id="cfw-component-<%= component.wp_id %>-mods" class="cfw-majority" name="component-<%= component.wp_id %>-mods" placeholder="How did you scale?" value="<%- componentResult.mods %>" />                    </div>                </fieldset>            <%            });            %>            <fieldset class="cfw-last">                <div class="cfw-notes <%= notes ? "cfw-open cfw-opaque" : "" %>">                    <h2><label for="cfw-notes">Notes</label></h2>                    <textarea rows="3" id="cfw-notes" name="notes" placeholder="Notes or Tips for next time?"><%- notes %></textarea>                </div>                <div class="cfw-footer">                    <a class="cfw-add-notes <%= notes ? "cfw-hidden" : "" %>"><label for="cfw-notes"><strong>+</strong> add notes</label></a>                    <input type="submit" value="<%= new_record ? "Submit" : "Save" %>" />                    <input type="reset" value="Cancel" />                </div>            </fieldset>        '),
events:{"focus :input":"scrollToInput",'keyup input[name="email"]':"guessName",'change input[name="email"]':"guessName",'blur input[name="known_as"]':"guessName","click .cfw-add-notes":"showNotesFields",submit:"save",'click input[type="reset"]':"remove"},initialize:function(a){this.entries=a.entries;this.wod=a.wod;return this.render()},render:function(){h(this.el).attr("action","javascript://").css("position","absolute",!0).html(this.template(_.extend({wod:this.wod,new_record:!this.model},(this.model||
new CFW.Entry).toJSON())));return this},initScrollbar:function(){h(this.el).scrollbarPaper({parentSelector:".cfw-window",important:!0,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){h(this.el).scrollbarPaper("show")},hideScrollbar:function(){h(this.el).scrollbarPaper("hide")},freezeScrollbar:function(){h(this.el).scrollbarPaper("freeze")},thawScrollbar:function(){h(this.el).scrollbarPaper("thaw")},scrollToInput:function(a){var b=
h(this.el);if(!this.height)this.height=b.parent().height();(a=(h(a.target).position()||{}).top)&&b.animate({scrollTop:a+b.scrollTop()-this.height/2},300)},guessName:function(){var a=this.$('input[name="email"]'),b=this.$('input[name="known_as"]');if(!(b.val().length&&this.lastGuess&&b.val()!=this.lastGuess||b.val().length&&!this.lastGuess)){var c=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.val().toLowerCase()});if(c)b.val(this.lastGuess=c.get("known_as"));else{c=a.val();if(!_.capitalize)_.capitalize=
function(a){return a.substring(0,1).toUpperCase()+a.substring(1)};this.lastGuess=_.capitalize((/[^.@0-9]+/.exec(c)||[""])[0]);b.val(this.lastGuess)}}},showNotesFields:function(){var a=this.$(".cfw-notes").addClass("cfw-open"),b=this.$(".cfw-add-notes").addClass("cfw-transparent");setTimeout(function(){a.addClass("cfw-opaque");b.addClass("cfw-hidden")},Modernizr.csstransitions?200:0)},save:function(a){a.preventDefault();if(!this.isLoading()){var b={email:this.$('input[name="email"]').val(),known_as:this.$('input[name="known_as"]').val(),
component_results:[],notes:this.$('textarea[name="notes"]').val()},c={};this.$('input[name^="component-"]').each(function(){var a=h(this),b=a.attr("name").split("-"),a="checkbox"==a.attr("type")?a.is(":checked"):a.val();c[b[1]]||(c[b[1]]={wp_id:b[1]});c[b[1]][b[2]]=a});_.each(c,function(a){b.component_results.push(a)});var e=this;e.showLoading();e.$(".ajax-error-notice").remove();a={success:function(){e.hideLoading();e.remove()},error:function(a,b){e.hideLoading();b&&b.length?e.showValidationErrors(b):
e.$(".cfw-footer").after(h('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Click <strong>'+e.$('input[type="submit"]').val()+"</strong> to try again or contact athlete support if the problem persists.</label>"))}};this.model?this.model.save(b,a):this.entries.create(b,a)||this.showValidationErrors(CFW.Entry.prototype.validate(b))}},show:function(){var a=h(this.el),b=a.closest(".cfw-contents"),c=b.data("componentsclass");
c&&b.removeClass(c);setTimeout(function(){a.addClass("cfw-translate-oldfashioned")},0);var e=this;setTimeout(function(){if(!e.scrollbarReady)e.initScrollbar(),e.scrollbarReady=!0;e.showScrollbar()},Modernizr.csstransitions?400:0)},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},showValidationErrors:function(a){var b=
this;_.each(a,function(a){b.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){h('label[for="'+h(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){h(this).removeClass("cfw-invalid");h('label[for="'+h(this).attr("id")+'"]').removeClass("cfw-invalid")})})},remove:function(){this.freezeScrollbar();var a=this,b=h(this.el).closest(".cfw-contents");h(this.el).removeClass("cfw-translate-oldfashioned");setTimeout(function(){a.hideScrollbar();var c=b.data("componentsclass");
c&&b.addClass(c);h(a.el).trigger("cfwremove").remove()},Modernizr.csstransitions?300:0)}});CFW.WhiteboardView=Backbone.View.extend({className:"cfw-pane",template:_.template('            <div>                <div class="cfw-window">                    <h2>Entries</h2>                    <a class="cfw-new-entry">+</a>                    <ul class="cfw-classes cfw-<%- allWods.length || 1 %>-classes">                        <%                        _.each(allWods, function(w) {                            %><li class="<%- w.wp_id == wod.wp_id ? "cfw-selected" : "" %>"><div>                                <a href="javascript://" data-wp_id="<%- w.wp_id %>" title="<%- w.name %>">                                    <span class="cfw-centered">                                        <span class="cfw-entry-count" data-wp_id="<%- w.wp_id %>"></span>                                        <span class="cfw-link-text"><%- w.name %></span>                                    </span>                                    <span class="cfw-separator"></span>                                </a>                            </div></li><%                        });                        %>                    </ul>                    <div class="cfw-contents"></div>                    <div class="cfw-footer">                        <a href="http://cfwhiteboard.com" target="_blank">                            What Is This?                        </a><a href="mailto:athletesupport@cfwhiteboard.com">                            Email Athlete Support                        </a>                    </div>                </div>            </div>            <a class="cfw-print cfw-admin-tool cfw-hidden" target="_blank">Print</a>        '),
events:{"click .cfw-new-entry:not([disabled])":"newEntry",hideEntryDetails:"hideEntry","cfwremove form":"cleanupEntryForm","click .cfw-classes a:not(.cfw-selected)":"returnToEntryList"},initialize:function(a){this.entries=new CFW.EntryList([],{affiliateId:a.affiliateId,postId:a.postId,wod:a.wod});this.entries.bind("add",this.updateEntryCount,this);this.entries.bind("remove",this.updateEntryCount,this);this.entries.bind("reset",this.updateEntryCount,this);this.entries.bind("edit",this.editEntry,this);
this.entries.bind("show",this.showEntry,this);this.entries.bind("add",this.updateUsers,this);this.entries.bind("change:known_as",this.updateUsers,this);this.render();a.hidden&&this.hide();this.entries.fetch({data:{postModified:a.postModified}})},render:function(){h(this.el).html(this.template({wod:this.options.wod,allWods:this.options.allWods}));this.entryListView=new CFW.EntryListView({entries:this.entries,wod:this.options.wod});this.$(".cfw-contents").append(this.entryListView.el);this.entryListView.show();
"admin"==this.options.authorization&&(this.$(".cfw-print").attr("href",this.entries.url()),this.$(".cfw-admin-tool").removeClass("cfw-hidden"));return this},show:function(){h(this.el).removeClass("cfw-hidden")},hide:function(){h(this.el).addClass("cfw-hidden")},newEntry:function(){this.showEntryForm()},editEntry:function(a){this.showEntryForm(a)},showEntryForm:function(a){this.disableNewEntries();this.formView=new CFW.EntryFormView({entries:this.entries,model:a,wod:this.options.wod});this.$(".cfw-contents").append(this.formView.el);
this.detailView?this.detailView.hideScrollbar():this.entryListView.hideScrollbar();var b=this.formView;setTimeout(function(){b.show()},0)},cleanupEntryForm:function(){this.enableNewEntries();this.detailView?this.detailView.showScrollbar():this.entryListView.showScrollbar();delete this.formView},disableNewEntries:function(){h(this.el).find(".cfw-new-entry").attr("disabled",!0)},enableNewEntries:function(){h(this.el).find(".cfw-new-entry").removeAttr("disabled")},showEntry:function(a){this.detailView=
new CFW.EntryDetailView({model:a,wod:this.options.wod});this.$(".cfw-contents").append(this.detailView.el);var b=this;setTimeout(function(){b.entryListView.hide();b.detailView.show()},0)},hideEntry:function(){this.detailView.hide();this.entryListView.show();var a=this;setTimeout(function(){delete a.detailView},Modernizr.csstransitions?400:100)},updateEntryCount:function(){h(this.el).trigger("newEntryCount",[this.options.wod.wp_id,this.entries.length])},updateUsers:function(a){var b=CFW.users.find(function(b){return b.get("email").toLowerCase()==
a.get("email").toLowerCase()});b?b.save({known_as:a.get("known_as"),count:b.get("count")+1}):b=CFW.users.create({email:a.get("email"),known_as:a.get("known_as"),count:1})},returnToEntryList:function(){this.formView?this.formView.remove():this.detailView&&this.hideEntry()}});CFW.WhiteboardButtonView=Backbone.View.extend({template:_.template('            <h1>Whiteboard <span class="cfw-entry-count-all"></span></h1>            <div class="cfw-preload-images">                <span class="cfw-metal-tile-jpg"></span>                <span class="cfw-white-water-paper-jpg"></span>                <span class="cfw-loading-gif"></span>            </div>        '),
events:{"click h1":"toggleWhiteboard","click .cfw-classes a":"showClass","newEntryCount .cfw-pane":"updateEntryCounts"},initialize:function(){var a=h(this.el).data("cfwhiteboard");this.affiliateId=a.affiliateId;this.postId=a.postId;this.postModified=a.postModified;this.wods=a.wods;this.authorization=h(this.el).data("authorization");-1<_.indexOf(_.pluck(CFW.instances,"postId"),this.postId)||this.render()},render:function(){h(this.el).html(this.template());this.whiteboardViews={};var a=this;_.each(a.wods,
function(b,c){b.name=b.name.replace(/workout of the day/ig,"WOD");var e=new CFW.WhiteboardView({affiliateId:a.affiliateId,postId:a.postId,postModified:a.postModified,wod:b,allWods:a.wods,authorization:a.authorization,hidden:0==c?!1:!0});h(a.el).append(e.el);a.whiteboardViews[b.wp_id]=e});return this},toggleWhiteboard:function(a){h(this.el).is(".cfw-active")?this.closeWhiteboard():this.openWhiteboard();a.preventDefault()},openWhiteboard:function(){h(this.el).addClass("cfw-active").removeClass("cfw-postactive")},
closeWhiteboard:function(){var a=h(this.el).addClass("cfw-postactive").removeClass("cfw-active");setTimeout(function(){a.removeClass("cfw-postactive")},Modernizr.csstransitions?300:0)},showClass:function(a){var b=h(a.target).closest("a").data("wp_id");_.inject(this.whiteboardViews,function(a,e,h){h==b?e.show():e.hide();return a},this)},updateEntryCounts:function(a,b,c){this.whiteboardViews[b.toString()].entryCount=c;this.$(".cfw-entry-count").each(function(){var a=h(this);a.data("wp_id")==b&&a.text("("+
c+")")});a=_.inject(this.whiteboardViews,function(a,b){return a+(b.entryCount||0)},0);this.$(".cfw-entry-count-all").text("("+a+")")}});CFW.instances=[];h(".cfwhiteboard").each(function(){var a=h(this),b=a.closest("a");b.length&&b.before(a);if("undefined"!=typeof CFW_POSITION){b=a.closest(CFW_POSITION.parent).find(CFW_POSITION.target);if(b.length)switch(CFW_POSITION.insertion){case "append":b.append(a);break;case "before":b.before(a);break;case "after":b.after(a);break;default:b.prepend(a)}switch(CFW_POSITION.alignment){case "inline":a.addClass("position-inline");
break;case "block":a.addClass("position-block");break;case "floatleft":a.addClass("position-floatleft")}CFW_POSITION.margin&&a.css({margin:CFW_POSITION.margin})}CFW.instances.push(new CFW.WhiteboardButtonView({el:a}))});_.each(CFW.instances,function(a){h(a.el).bind("click",function(a){a.stopPropagation()})});h("body").bind("click",function(){_.each(CFW.instances,function(a){a.closeWhiteboard()})})});
