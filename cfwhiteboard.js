var JSON;JSON||(JSON={});
(function(){function g(a){return 10>a?"0"+a:a}function a(a){j.lastIndex=0;return j.test(a)?'"'+a.replace(j,function(a){var f=i[a];return"string"===typeof f?f:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(d,g){var i,j,q,r,p=h,m,o=g[d];o&&"object"===typeof o&&"function"===typeof o.toJSON&&(o=o.toJSON(d));"function"===typeof n&&(o=n.call(g,d,o));switch(typeof o){case "string":return a(o);case "number":return isFinite(o)?""+o:"null";case "boolean":case "null":return""+o;
case "object":if(!o)return"null";h+=f;m=[];if("[object Array]"===Object.prototype.toString.apply(o)){r=o.length;for(i=0;i<r;i+=1)m[i]=b(i,o)||"null";q=0===m.length?"[]":h?"[\n"+h+m.join(",\n"+h)+"\n"+p+"]":"["+m.join(",")+"]";h=p;return q}if(n&&"object"===typeof n){r=n.length;for(i=0;i<r;i+=1)"string"===typeof n[i]&&(j=n[i],(q=b(j,o))&&m.push(a(j)+(h?": ":":")+q))}else for(j in o)Object.prototype.hasOwnProperty.call(o,j)&&(q=b(j,o))&&m.push(a(j)+(h?": ":":")+q);q=0===m.length?"{}":h?"{\n"+h+m.join(",\n"+
h)+"\n"+p+"}":"{"+m.join(",")+"}";h=p;return q}}if("function"!==typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+g(this.getUTCMonth()+1)+"-"+g(this.getUTCDate())+"T"+g(this.getUTCHours())+":"+g(this.getUTCMinutes())+":"+g(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
j=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h,f,i={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},n;if("function"!==typeof JSON.stringify)JSON.stringify=function(a,d,i){var g;f=h="";if("number"===typeof i)for(g=0;g<i;g+=1)f+=" ";else"string"===typeof i&&(f=i);if((n=d)&&"function"!==typeof d&&("object"!==typeof d||"number"!==typeof d.length))throw Error("JSON.stringify");return b("",
{"":a})};if("function"!==typeof JSON.parse)JSON.parse=function(a,f){function i(a,d){var g,n,b=a[d];if(b&&"object"===typeof b)for(g in b)Object.prototype.hasOwnProperty.call(b,g)&&(n=i(b,g),void 0!==n?b[g]=n:delete b[g]);return f.call(a,d,b)}var g,a=""+a;d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return g=eval("("+a+")"),"function"===typeof f?i({"":g},""):g;throw new SyntaxError("JSON.parse");}})();(function(g){function a(a,f,d){var i,d=d||"",b=d.match(RegExp("(?:^|\\s|;)("+a+")\\s*:\\s*([^;]*(?:;|$))","i"));b&&(b[0]=b[0].replace(/^;/,""));null===f?i="":"string"===typeof f&&(i=a+":"+f+" !important;");b?("boolean"===typeof f&&(i=g.important(a+":"+b[2],f)),d=d.replace(b[0],i)):"undefined"!==typeof i&&(d=g.trim(d),""!==d&&(";"!==d.slice(-1)&&(d+=";"),d+=" "),d+=i);return d}function b(a,f){var d=b.re;if(!d)d=b.re=/\s*(! ?important)?[\s\r\t\n]*;/g;return!1===f?a.replace(d,";"):a.replace(d,function(a,
f){return f?a:" !important;"})}function d(a,f){var i=d.re;if(!i)i=d.re=/(?=<style[^>]*>)([\w\W]*?)(?=<\/style>)/g;return a.replace(i,function(a,d){return b(d,f)})}var j=!1,h={},f={},i=g.each({css:function(f,d){var i={},b=g(this),j=b.attr("style");if("string"===typeof f){if("undefined"===typeof d)return h.css.apply(this,arguments);i[f]=d}else if("object"===typeof f)i=f;else return b;g.each(i,function(f,d){j=a(f,d,j)});return b.attr("style",j)}},function(a,d){h[a]=g.fn[a];d.overridden=!0;f[a]=function(){var f=
g.makeArray(arguments),i=f[f.length-1],b=g(this);return!0===i?d.apply(b,f.slice(0,-1)):j&&!1!==i?d.apply(b,f):h[a].apply(b,f)}});g.extend(g.fn,f);g.important=g.extend(function(){var a=g.makeArray(arguments),f;if("string"===typeof a[0]){if("undefined"===typeof a[1]||"boolean"===typeof a[1])return f=!1!==a[1],/<\w+.*>/.test(a[0])?d(a[0],f):b(a[0],f)}else if(g.isFunction(a[0]))f=j,g.important.status=j=!0,a[0].call(this),g.important.status=j=f;else if("undefined"===typeof a[0]||"boolean"===typeof a[0])g.important.status=
j=!1!==a[0];return j},{status:j,noConflict:function(){g.each(h,function(a,f){g.fn[a]=f});return i},declaration:a});g.fn.important=function(d){var i=g(this),j=g.makeArray(arguments).concat(!0),h=i.data("nodeName"),k;if("undefined"===typeof d||"boolean"===typeof d)h||(h=i.attr("nodeName").toLowerCase(),i.data("nodeName",h)),"style"===h?(k=!1!==d,i.html(b(i.html(),k)),j=i.attr("sheet"),_("stylesheet",j),j&&j.cssRules&&(_("cssRules",j.cssRules),g.each(j.cssRules,function(a,f){_("rule",f,f.cssText);_(g.important(f.style.cssText,
k));if(f.type===CSSRule.STYLE_RULE)f.style.cssText=g.important(f.style.cssText,k)}))):i.attr("style",g.important(i.attr("style"),d));else{if("object"===typeof d)return j.unshift("css"),i.important.apply(this,j);if("string"===typeof d)if(g.isFunction(f[d]))j=j.slice(1),f[d].apply(i,j);else{if("undefined"===typeof j[1]||"boolean"===typeof j[1])k=!1!==j[1],i.attr("style",a(d,k,i.attr("style")))}else g.isFunction(d)&&g.important.call(this,d)}return i}})(jQuery);(function(g){var a=function(a){var b=a.data("scrollbarPaper")||a.data("scrollbar-paper"),g=a.innerHeight(),f=g-a.height();return{height:g,ratio:g/(b.clearer.position().top-(b.content.children().eq(0).position().top||0)+f),offset:a.offset()}},b={_init:function(d){d=g.extend({parentSelector:"",important:!1,show:function(a){a.show()},hide:function(a){a.hide()}},d);return this.each(function(){var b=g(this),h=b.data("scrollbarPaper")||b.data("scrollbar-paper");if(!h){b.css({"overflow-x":"hidden","overflow-y":"auto"},
!!d.important);h=b.closest(d.parentSelector);h.length||(h=b.offsetParent());var f=g('<div class="scrollbarpaper-container"></div>').appendTo(h);d.hide(f);var i=g('<div class="scrollbarpaper-track"></div>').appendTo(f),n=g('<div class="scrollbarpaper-drag"></div>').appendTo(i),h={options:d,offsetParent:h,paper:f,track:i,drag:n,dragTop:g('<div class="scrollbarpaper-drag-top"></div>').appendTo(n),dragBottom:g('<div class="scrollbarpaper-drag-bottom"></div>').appendTo(n),content:b,clearer:g('<div style="clear:both;"></div>').appendTo(b),
offsetHeight:i.outerHeight()-i.height()};b.data("scrollbarPaper",h).data("scrollbar-paper",h);var t=a(b),u=setInterval(function(){if(b.closest(".cfwhiteboard").length){var d=a(b);if(d.height!=t.height||d.ratio!=t.ratio||d.offset.left!=t.offset.left||d.offset.top!=t.offset.top)b.scrollbarPaper("update"),t=d}else clearInterval(u),f.remove()},200)}b.scrollbarPaper("update")})},update:function(d){return this.each(function(){var b=g(this);if(b.is(":visible")&&!b.data("scrollbarpaperfrozen")){var h=b.data("scrollbarPaper")||
b.data("scrollbar-paper");d=d||a(b);b.unbind(".scrollbarPaper");var f=b.innerHeight()-h.offsetHeight;h.track.css({height:f+"px"},!!h.options.important);var i=0<h.offsetParent.not("html, body").length?h.offsetParent.offset():{left:0,top:0};h.paper.css({left:-i.left+d.offset.left+b.innerWidth()-h.paper.width()+"px",top:-i.top+d.offset.top+"px"},!!h.options.important);var n=Math.max(Math.round(f*d.ratio),h.dragTop.height()+h.dragBottom.height());h.drag.css({height:n+"px"},!!h.options.important);i=function(){h.drag.css({top:Math.min(Math.round(b.scrollTop()*
d.ratio),f-n)+"px"},!!h.options.important)};i();b.bind("scroll.scrollbarPaper",i);var t=function(a){return a.pageY||(a.originalEvent&&(a.originalEvent.targetTouches||a.originalEvent.touches||[])[0]||a).pageY},u=function(){g("body").unbind("mousemove.scrollbarPaper touchmove.scrollbarPaper")};h.drag.bind("mousedown.scrollbarPaper touchstart.scrollbarPaper",function(a){u();var f=t(a)-h.drag.offset().top;g("body").bind("mousemove.scrollbarPaper touchmove.scrollbarPaper",function(a){a.preventDefault();
b.scrollTop((t(a)-b.offset().top-f)/d.ratio);return!1}).bind("mouseup.scrollbarPaper touchend.scrollbarPaper",u);return!1});1>d.ratio?(h.options.show(h.drag),h.content.addClass("scrollbarpaper-visible")):(h.options.hide(h.drag),h.content.removeClass("scrollbarpaper-visible"))}})},show:function(){return this.each(function(){var a=g(this),b=a.data("scrollbarPaper")||a.data("scrollbar-paper");b&&(a.scrollbarPaper("update"),"function"==typeof b.options.show?b.options.show(b.paper):b.paper.show())})},
hide:function(){return this.each(function(){var a=g(this);(a=a.data("scrollbarPaper")||a.data("scrollbar-paper"))&&("function"==typeof a.options.hide?a.options.hide(a.paper):a.paper.hide())})},freeze:function(){return this.each(function(){g(this).data("scrollbarpaperfrozen",!0)})},thaw:function(){return this.each(function(){g(this).data("scrollbarpaperfrozen",!1)})}};g.fn.scrollbarPaper=function(a){if(b[a])return b[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return b._init.apply(this,
arguments);throw"Method "+a+" does not exist on jQuery.scrollbarPaper.";}})(jQuery);(function(){function g(l,c,a){if(l===c)return 0!==l||1/l==1/c;if(null==l||null==c)return l===c;if(l._chain)l=l._wrapped;if(c._chain)c=c._wrapped;if(l.isEqual&&e.isFunction(l.isEqual))return l.isEqual(c);if(c.isEqual&&e.isFunction(c.isEqual))return c.isEqual(l);var f=n.call(l);if(f!=n.call(c))return!1;switch(f){case "[object String]":return l==""+c;case "[object Number]":return l!=+l?c!=+c:0==l?1/l==1/c:l==+c;case "[object Date]":case "[object Boolean]":return+l==+c;case "[object RegExp]":return l.source==
c.source&&l.global==c.global&&l.multiline==c.multiline&&l.ignoreCase==c.ignoreCase}if("object"!=typeof l||"object"!=typeof c)return!1;for(var b=a.length;b--;)if(a[b]==l)return!0;a.push(l);var b=0,d=!0;if("[object Array]"==f){if(b=l.length,d=b==c.length)for(;b--&&(d=b in l==b in c&&g(l[b],c[b],a)););}else{if("constructor"in l!="constructor"in c||l.constructor!=c.constructor)return!1;for(var i in l)if(e.has(l,i)&&(b++,!(d=e.has(c,i)&&g(l[i],c[i],a))))break;if(d){for(i in c)if(e.has(c,i)&&!b--)break;
d=!b}}a.pop();return d}var a=this,b=a._,d={},j=Array.prototype,h=Object.prototype,f=j.slice,i=j.unshift,n=h.toString,t=h.hasOwnProperty,u=j.forEach,v=j.map,k=j.reduce,q=j.reduceRight,r=j.filter,p=j.every,m=j.some,o=j.indexOf,w=j.lastIndexOf,h=Array.isArray,c=Object.keys,x=Function.prototype.bind,e=function(c){return new y(c)};if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports)exports=module.exports=e;exports._=e}else a._=e;e.VERSION="1.3.1";var s=e.each=e.forEach=function(c,
a,f){if(null!=c)if(u&&c.forEach===u)c.forEach(a,f);else if(c.length===+c.length)for(var b=0,i=c.length;b<i&&!(b in c&&a.call(f,c[b],b,c)===d);b++);else for(b in c)if(e.has(c,b)&&a.call(f,c[b],b,c)===d)break};e.map=e.collect=function(c,e,a){var f=[];if(null==c)return f;if(v&&c.map===v)return c.map(e,a);s(c,function(c,l,b){f[f.length]=e.call(a,c,l,b)});if(c.length===+c.length)f.length=c.length;return f};e.reduce=e.foldl=e.inject=function(c,a,f,b){var i=2<arguments.length;null==c&&(c=[]);if(k&&c.reduce===
k)return b&&(a=e.bind(a,b)),i?c.reduce(a,f):c.reduce(a);s(c,function(c,e,l){i?f=a.call(b,f,c,e,l):(f=c,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return f};e.reduceRight=e.foldr=function(c,a,f,b){var i=2<arguments.length;null==c&&(c=[]);if(q&&c.reduceRight===q)return b&&(a=e.bind(a,b)),i?c.reduceRight(a,f):c.reduceRight(a);var d=e.toArray(c).reverse();b&&!i&&(a=e.bind(a,b));return i?e.reduce(d,a,f,b):e.reduce(d,a)};e.find=e.detect=function(c,a,e){var f;C(c,function(c,
l,b){if(a.call(e,c,l,b))return f=c,!0});return f};e.filter=e.select=function(c,a,e){var f=[];if(null==c)return f;if(r&&c.filter===r)return c.filter(a,e);s(c,function(c,l,b){a.call(e,c,l,b)&&(f[f.length]=c)});return f};e.reject=function(c,a,e){var f=[];if(null==c)return f;s(c,function(c,l,b){a.call(e,c,l,b)||(f[f.length]=c)});return f};e.every=e.all=function(c,a,e){var f=!0;if(null==c)return f;if(p&&c.every===p)return c.every(a,e);s(c,function(c,l,b){if(!(f=f&&a.call(e,c,l,b)))return d});return f};
var C=e.some=e.any=function(c,a,f){a||(a=e.identity);var b=!1;if(null==c)return b;if(m&&c.some===m)return c.some(a,f);s(c,function(c,e,l){if(b||(b=a.call(f,c,e,l)))return d});return!!b};e.include=e.contains=function(c,a){var e;return null==c?!1:o&&c.indexOf===o?-1!=c.indexOf(a):e=C(c,function(c){return c===a})};e.invoke=function(c,a){var b=f.call(arguments,2);return e.map(c,function(c){return(e.isFunction(a)?a||c:c[a]).apply(c,b)})};e.pluck=function(c,a){return e.map(c,function(c){return c[a]})};
e.max=function(c,a,f){if(!a&&e.isArray(c))return Math.max.apply(Math,c);if(!a&&e.isEmpty(c))return-Infinity;var b={computed:-Infinity};s(c,function(c,e,l){e=a?a.call(f,c,e,l):c;e>=b.computed&&(b={value:c,computed:e})});return b.value};e.min=function(c,a,f){if(!a&&e.isArray(c))return Math.min.apply(Math,c);if(!a&&e.isEmpty(c))return Infinity;var b={computed:Infinity};s(c,function(c,e,l){e=a?a.call(f,c,e,l):c;e<b.computed&&(b={value:c,computed:e})});return b.value};e.shuffle=function(c){var a=[],e;
s(c,function(c,f){0==f?a[0]=c:(e=Math.floor(Math.random()*(f+1)),a[f]=a[e],a[e]=c)});return a};e.sortBy=function(c,a,f){return e.pluck(e.map(c,function(c,e,b){return{value:c,criteria:a.call(f,c,e,b)}}).sort(function(c,a){var e=c.criteria,f=a.criteria;return e<f?-1:e>f?1:0}),"value")};e.groupBy=function(c,a){var f={},b=e.isFunction(a)?a:function(c){return c[a]};s(c,function(c,a){var e=b(c,a);(f[e]||(f[e]=[])).push(c)});return f};e.sortedIndex=function(c,a,f){f||(f=e.identity);for(var b=0,i=c.length;b<
i;){var d=b+i>>1;f(c[d])<f(a)?b=d+1:i=d}return b};e.toArray=function(c){return!c?[]:c.toArray?c.toArray():e.isArray(c)?f.call(c):e.isArguments(c)?f.call(c):e.values(c)};e.size=function(c){return e.toArray(c).length};e.first=e.head=function(c,a,e){return null!=a&&!e?f.call(c,0,a):c[0]};e.initial=function(c,a,e){return f.call(c,0,c.length-(null==a||e?1:a))};e.last=function(c,a,e){return null!=a&&!e?f.call(c,Math.max(c.length-a,0)):c[c.length-1]};e.rest=e.tail=function(c,a,e){return f.call(c,null==a||
e?1:a)};e.compact=function(c){return e.filter(c,function(c){return!!c})};e.flatten=function(c,a){return e.reduce(c,function(c,f){if(e.isArray(f))return c.concat(a?f:e.flatten(f));c[c.length]=f;return c},[])};e.without=function(c){return e.difference(c,f.call(arguments,1))};e.uniq=e.unique=function(c,a,f){var f=f?e.map(c,f):c,b=[];e.reduce(f,function(f,i,d){if(0==d||(!0===a?e.last(f)!=i:!e.include(f,i)))f[f.length]=i,b[b.length]=c[d];return f},[]);return b};e.union=function(){return e.uniq(e.flatten(arguments,
!0))};e.intersection=e.intersect=function(c){var a=f.call(arguments,1);return e.filter(e.uniq(c),function(c){return e.every(a,function(a){return 0<=e.indexOf(a,c)})})};e.difference=function(c){var a=e.flatten(f.call(arguments,1));return e.filter(c,function(c){return!e.include(a,c)})};e.zip=function(){for(var c=f.call(arguments),a=e.max(e.pluck(c,"length")),b=Array(a),i=0;i<a;i++)b[i]=e.pluck(c,""+i);return b};e.indexOf=function(c,a,f){if(null==c)return-1;var b;if(f)return f=e.sortedIndex(c,a),c[f]===
a?f:-1;if(o&&c.indexOf===o)return c.indexOf(a);for(f=0,b=c.length;f<b;f++)if(f in c&&c[f]===a)return f;return-1};e.lastIndexOf=function(c,a){if(null==c)return-1;if(w&&c.lastIndexOf===w)return c.lastIndexOf(a);for(var e=c.length;e--;)if(e in c&&c[e]===a)return e;return-1};e.range=function(c,a,e){1>=arguments.length&&(a=c||0,c=0);for(var e=arguments[2]||1,f=Math.max(Math.ceil((a-c)/e),0),b=0,i=Array(f);b<f;)i[b++]=c,c+=e;return i};var D=function(){};e.bind=function(c,a){var b,i;if(c.bind===x&&x)return x.apply(c,
f.call(arguments,1));if(!e.isFunction(c))throw new TypeError;i=f.call(arguments,2);return b=function(){if(!(this instanceof b))return c.apply(a,i.concat(f.call(arguments)));D.prototype=c.prototype;var e=new D,d=c.apply(e,i.concat(f.call(arguments)));return Object(d)===d?d:e}};e.bindAll=function(c){var a=f.call(arguments,1);0==a.length&&(a=e.functions(c));s(a,function(a){c[a]=e.bind(c[a],c)});return c};e.memoize=function(c,a){var f={};a||(a=e.identity);return function(){var b=a.apply(this,arguments);
return e.has(f,b)?f[b]:f[b]=c.apply(this,arguments)}};e.delay=function(c,a){var e=f.call(arguments,2);return setTimeout(function(){return c.apply(c,e)},a)};e.defer=function(c){return e.delay.apply(e,[c,1].concat(f.call(arguments,1)))};e.throttle=function(c,a){var f,b,i,d,x,g=e.debounce(function(){x=d=!1},a);return function(){f=this;b=arguments;i||(i=setTimeout(function(){i=null;x&&c.apply(f,b);g()},a));d?x=!0:c.apply(f,b);g();d=!0}};e.debounce=function(c,a){var e;return function(){var f=this,b=arguments;
clearTimeout(e);e=setTimeout(function(){e=null;c.apply(f,b)},a)}};e.once=function(c){var a=!1,e;return function(){if(a)return e;a=!0;return e=c.apply(this,arguments)}};e.wrap=function(c,a){return function(){var e=[c].concat(f.call(arguments,0));return a.apply(this,e)}};e.compose=function(){var c=arguments;return function(){for(var a=arguments,e=c.length-1;0<=e;e--)a=[c[e].apply(this,a)];return a[0]}};e.after=function(c,a){return 0>=c?a():function(){if(1>--c)return a.apply(this,arguments)}};e.keys=
c||function(c){if(c!==Object(c))throw new TypeError("Invalid object");var a=[],f;for(f in c)e.has(c,f)&&(a[a.length]=f);return a};e.values=function(c){return e.map(c,e.identity)};e.functions=e.methods=function(c){var a=[],f;for(f in c)e.isFunction(c[f])&&a.push(f);return a.sort()};e.extend=function(c){s(f.call(arguments,1),function(a){for(var e in a)c[e]=a[e]});return c};e.defaults=function(c){s(f.call(arguments,1),function(a){for(var e in a)null==c[e]&&(c[e]=a[e])});return c};e.clone=function(c){return!e.isObject(c)?
c:e.isArray(c)?c.slice():e.extend({},c)};e.tap=function(c,a){a(c);return c};e.isEqual=function(c,a){return g(c,a,[])};e.isEmpty=function(c){if(e.isArray(c)||e.isString(c))return 0===c.length;for(var a in c)if(e.has(c,a))return!1;return!0};e.isElement=function(c){return!!(c&&1==c.nodeType)};e.isArray=h||function(c){return"[object Array]"==n.call(c)};e.isObject=function(c){return c===Object(c)};e.isArguments=function(c){return"[object Arguments]"==n.call(c)};if(!e.isArguments(arguments))e.isArguments=
function(c){return!(!c||!e.has(c,"callee"))};e.isFunction=function(c){return"[object Function]"==n.call(c)};e.isString=function(c){return"[object String]"==n.call(c)};e.isNumber=function(c){return"[object Number]"==n.call(c)};e.isNaN=function(c){return c!==c};e.isBoolean=function(c){return!0===c||!1===c||"[object Boolean]"==n.call(c)};e.isDate=function(c){return"[object Date]"==n.call(c)};e.isRegExp=function(c){return"[object RegExp]"==n.call(c)};e.isNull=function(c){return null===c};e.isUndefined=
function(c){return void 0===c};e.has=function(c,a){return t.call(c,a)};e.noConflict=function(){a._=b;return this};e.identity=function(c){return c};e.times=function(c,a,e){for(var f=0;f<c;f++)a.call(e,f)};e.escape=function(c){return(""+c).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};e.mixin=function(c){s(e.functions(c),function(a){E(a,e[a]=c[a])})};var F=0;e.uniqueId=function(c){var a=F++;return c?c+a:a};e.templateSettings=
{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/.^/,A=function(c){return c.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};e.template=function(c,a){var f=e.templateSettings,f="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+c.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(f.escape||z,function(c,a){return"',_.escape("+A(a)+"),'"}).replace(f.interpolate||z,function(c,a){return"',"+A(a)+",'"}).replace(f.evaluate||z,function(c,
a){return"');"+A(a).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",b=new Function("obj","_",f);return a?b(a,e):function(c){return b.call(this,c,e)}};e.chain=function(c){return e(c).chain()};var y=function(c){this._wrapped=c};e.prototype=y.prototype;var B=function(c,a){return a?e(c).chain():c},E=function(c,a){y.prototype[c]=function(){var c=f.call(arguments);i.call(c,this._wrapped);return B(a.apply(e,c),this._chain)}};
e.mixin(e);s("pop,push,reverse,shift,sort,splice,unshift".split(","),function(c){var a=j[c];y.prototype[c]=function(){var e=this._wrapped;a.apply(e,arguments);var f=e.length;("shift"==c||"splice"==c)&&0===f&&delete e[0];return B(e,this._chain)}});s(["concat","join","slice"],function(c){var a=j[c];y.prototype[c]=function(){return B(a.apply(this._wrapped,arguments),this._chain)}});y.prototype.chain=function(){this._chain=!0;return this};y.prototype.value=function(){return this._wrapped}}).call(this);
(function(g){var a=String.prototype.trim,b=function(a,b){for(var d=[];0<b;d[--b]=a);return d.join("")},d=function(a){return function(){for(var b=Array.prototype.slice.call(arguments),d=0;d<b.length;d++)b[d]=null==b[d]?"":""+b[d];return a.apply(null,b)}},j=function(){function a(f){return Object.prototype.toString.call(f).slice(8,-1).toLowerCase()}var d=function(){d.cache.hasOwnProperty(arguments[0])||(d.cache[arguments[0]]=d.parse(arguments[0]));return d.format.call(null,d.cache[arguments[0]],arguments)};
d.format=function(d,i){var g=1,h=d.length,k="",q=[],r,p,m,o;for(r=0;r<h;r++)if(k=a(d[r]),"string"===k)q.push(d[r]);else if("array"===k){m=d[r];if(m[2]){k=i[g];for(p=0;p<m[2].length;p++){if(!k.hasOwnProperty(m[2][p]))throw j('[_.sprintf] property "%s" does not exist',m[2][p]);k=k[m[2][p]]}}else k=m[1]?i[m[1]]:i[g++];if(/[^s]/.test(m[8])&&"number"!=a(k))throw j("[_.sprintf] expecting number but found %s",a(k));switch(m[8]){case "b":k=k.toString(2);break;case "c":k=String.fromCharCode(k);break;case "d":k=
parseInt(k,10);break;case "e":k=m[7]?k.toExponential(m[7]):k.toExponential();break;case "f":k=m[7]?parseFloat(k).toFixed(m[7]):parseFloat(k);break;case "o":k=k.toString(8);break;case "s":k=(k=""+k)&&m[7]?k.substring(0,m[7]):k;break;case "u":k=Math.abs(k);break;case "x":k=k.toString(16);break;case "X":k=k.toString(16).toUpperCase()}k=/[def]/.test(m[8])&&m[3]&&0<=k?"+"+k:k;p=m[4]?"0"==m[4]?"0":m[4].charAt(1):" ";o=m[6]-(""+k).length;p=m[6]?b(p,o):"";q.push(m[5]?k+p:p+k)}return q.join("")};d.cache={};
d.parse=function(a){for(var f=[],b=[],d=0;a;){if(null!==(f=/^[^\x25]+/.exec(a)))b.push(f[0]);else if(null!==(f=/^\x25{2}/.exec(a)))b.push("%");else if(null!==(f=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(a))){if(f[2]){var d=d|1,i=[],g=f[2],h=[];if(null!==(h=/^([a-z_][a-z_\d]*)/i.exec(g)))for(i.push(h[1]);""!==(g=g.substring(h[0].length));)if(null!==(h=/^\.([a-z_][a-z_\d]*)/i.exec(g)))i.push(h[1]);else if(null!==(h=/^\[(\d+)\]/.exec(g)))i.push(h[1]);
else throw"[_.sprintf] huh?";else throw"[_.sprintf] huh?";f[2]=i}else d|=2;if(3===d)throw"[_.sprintf] mixing positional and named placeholders is not (yet) supported";b.push(f)}else throw"[_.sprintf] huh?";a=a.substring(f[0].length)}return b};return d}(),h={VERSION:"1.2.0",isBlank:d(function(a){return/^\s*$/.test(a)}),stripTags:d(function(a){return a.replace(/<\/?[^>]+>/ig,"")}),capitalize:d(function(a){return a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()}),chop:d(function(a,b){for(var b=
1*b||a.length,d=[],g=0;g<a.length;)d.push(a.slice(g,g+b)),g+=b;return d}),clean:d(function(a){return h.strip(a.replace(/\s+/g," "))}),count:d(function(a,b){for(var d=0,g,h=0;h<a.length;)g=a.indexOf(b,h),0<=g&&d++,h=h+(0<=g?g:0)+b.length;return d}),chars:d(function(a){return a.split("")}),escapeHTML:d(function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}),unescapeHTML:d(function(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,
">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")}),escapeRegExp:d(function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")}),insert:d(function(a,b,d){a=a.split("");a.splice(1*b||0,0,d);return a.join("")}),include:d(function(a,b){return-1!==a.indexOf(b)}),join:d(function(a){var b=Array.prototype.slice.call(arguments);return b.join(b.shift())}),lines:d(function(a){return a.split("\n")}),reverse:d(function(a){return Array.prototype.reverse.apply((""+a).split("")).join("")}),
splice:d(function(a,b,d,g){a=a.split("");a.splice(1*b||0,1*d||0,g);return a.join("")}),startsWith:d(function(a,b){return a.length>=b.length&&a.substring(0,b.length)===b}),endsWith:d(function(a,b){return a.length>=b.length&&a.substring(a.length-b.length)===b}),succ:d(function(a){var b=a.split("");b.splice(a.length-1,1,String.fromCharCode(a.charCodeAt(a.length-1)+1));return b.join("")}),titleize:d(function(a){for(var a=a.split(" "),b,d=0;d<a.length;d++)b=a[d].split(""),"undefined"!==typeof b[0]&&(b[0]=
b[0].toUpperCase()),d+1===a.length?a[d]=b.join(""):a[d]=b.join("")+" ";return a.join("")}),camelize:d(function(a){return h.trim(a).replace(/(\-|_|\s)+(.)?/g,function(a,b,f){return f?f.toUpperCase():""})}),underscored:function(a){return h.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/\-|\s+/g,"_").toLowerCase()},dasherize:function(a){return h.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1-$2").replace(/^([A-Z]+)/,"-$1").replace(/\_|\s+/g,"-").toLowerCase()},humanize:function(a){return h.capitalize(this.underscored(a).replace(/_id$/,
"").replace(/_/g," "))},trim:d(function(b,d){if(!d&&a)return a.call(b);d=d?h.escapeRegExp(d):"\\s";return b.replace(RegExp("^["+d+"]+|["+d+"]+$","g"),"")}),ltrim:d(function(a,b){b=b?h.escapeRegExp(b):"\\s";return a.replace(RegExp("^["+b+"]+","g"),"")}),rtrim:d(function(a,b){b=b?h.escapeRegExp(b):"\\s";return a.replace(RegExp("["+b+"]+$","g"),"")}),truncate:d(function(a,b,d){b=1*b||0;return a.length>b?a.slice(0,b)+(d||"..."):a}),prune:d(function(a,b,d){var d=d||"...",b=1*b||0,g="",g=0===a.substring(b-
1,b+1).search(/^\w\w$/)?h.rtrim(a.slice(0,b).replace(/([\W][\w]*)$/,"")):h.rtrim(a.slice(0,b)),g=g.replace(/\W+$/,"");return g.length+d.length>a.length?a:g+d}),words:function(a,b){return(""+a).split(b||" ")},pad:d(function(a,d,g,h){var j="",j=0,d=1*d||0;g?1<g.length&&(g=g.charAt(0)):g=" ";switch(h){case "right":j=d-a.length;j=b(g,j);a+=j;break;case "both":j=d-a.length;j={left:b(g,Math.ceil(j/2)),right:b(g,Math.floor(j/2))};a=j.left+a+j.right;break;default:j=d-a.length,j=b(g,j),a=j+a}return a}),lpad:function(a,
b,d){return h.pad(a,b,d)},rpad:function(a,b,d){return h.pad(a,b,d,"right")},lrpad:function(a,b,d){return h.pad(a,b,d,"both")},sprintf:j,vsprintf:function(a,b){b.unshift(a);return j.apply(null,b)},toNumber:function(a,b){var d;d=1*(1*a||0).toFixed(1*b||0)||0;return!(0===d&&"0"!==a&&0!==a)?d:Number.NaN},strRight:d(function(a,b){var d=!b?-1:a.indexOf(b);return-1!=d?a.slice(d+b.length,a.length):a}),strRightBack:d(function(a,b){var d=!b?-1:a.lastIndexOf(b);return-1!=d?a.slice(d+b.length,a.length):a}),strLeft:d(function(a,
b){var d=!b?-1:a.indexOf(b);return-1!=d?a.slice(0,d):a}),strLeftBack:d(function(a,b){var d=a.lastIndexOf(b);return-1!=d?a.slice(0,d):a}),exports:function(){var a={},b;for(b in this)if(this.hasOwnProperty(b)&&!("include"==b||"contains"==b||"reverse"==b))a[b]=this[b];return a}};h.strip=h.trim;h.lstrip=h.ltrim;h.rstrip=h.rtrim;h.center=h.lrpad;h.ljust=h.lpad;h.rjust=h.rpad;h.contains=h.include;if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports)module.exports=h;exports._s=
h}else"undefined"!==typeof g._?(g._.string=h,g._.str=g._.string):g._={string:h,str:h}})(this||window);(function(){var g=this,a=g.Backbone,b;b="undefined"!==typeof exports?exports:g.Backbone={};b.VERSION="0.5.3";var d=g._;if(!d&&"undefined"!==typeof require)d=require("underscore")._;var j=g.jQuery||g.Zepto;b.noConflict=function(){g.Backbone=a;return this};b.emulateHTTP=!1;b.emulateJSON=!1;b.Events={bind:function(c,a,b){var d=this._callbacks||(this._callbacks={});(d[c]||(d[c]=[])).push([a,b]);return this},unbind:function(c,a){var b;if(c){if(b=this._callbacks)if(a){b=b[c];if(!b)return this;for(var d=
0,f=b.length;d<f;d++)if(b[d]&&a===b[d][0]){b[d]=null;break}}else b[c]=[]}else this._callbacks={};return this},trigger:function(c){var a,b,d,f,g=2;if(!(b=this._callbacks))return this;for(;g--;)if(a=g?c:"all",a=b[a])for(var h=0,j=a.length;h<j;h++)(d=a[h])?(f=g?Array.prototype.slice.call(arguments,1):arguments,d[0].apply(d[1]||this,f)):(a.splice(h,1),h--,j--);return this}};b.Model=function(c,a){var b;c||(c={});if(b=this.defaults)d.isFunction(b)&&(b=b.call(this)),c=d.extend({},b,c);this.attributes={};
this._escapedAttributes={};this.cid=d.uniqueId("c");this.set(c,{silent:!0});this._changed=!1;this._previousAttributes=d.clone(this.attributes);if(a&&a.collection)this.collection=a.collection;this.initialize(c,a)};d.extend(b.Model.prototype,b.Events,{_previousAttributes:null,_changed:!1,idAttribute:"id",initialize:function(){},toJSON:function(){return d.clone(this.attributes)},get:function(c){return this.attributes[c]},escape:function(c){var a;if(a=this._escapedAttributes[c])return a;a=this.attributes[c];
return this._escapedAttributes[c]=(null==a?"":""+a).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},has:function(c){return null!=this.attributes[c]},set:function(c,a){a||(a={});if(!c)return this;if(c.attributes)c=c.attributes;var b=this.attributes,f=this._escapedAttributes;if(!a.silent&&this.validate&&!this._performValidation(c,a))return!1;if(this.idAttribute in c)this.id=c[this.idAttribute];
var g=this._changing;this._changing=!0;for(var h in c){var j=c[h];if(!d.isEqual(b[h],j))b[h]=j,delete f[h],this._changed=!0,a.silent||this.trigger("change:"+h,this,j,a)}!g&&!a.silent&&this._changed&&this.change(a);this._changing=!1;return this},unset:function(c,a){if(!(c in this.attributes))return this;a||(a={});var b={};b[c]=void 0;if(!a.silent&&this.validate&&!this._performValidation(b,a))return!1;delete this.attributes[c];delete this._escapedAttributes[c];c==this.idAttribute&&delete this.id;this._changed=
!0;a.silent||(this.trigger("change:"+c,this,void 0,a),this.change(a));return this},clear:function(c){c||(c={});var a,b=this.attributes,d={};for(a in b)d[a]=void 0;if(!c.silent&&this.validate&&!this._performValidation(d,c))return!1;this.attributes={};this._escapedAttributes={};this._changed=!0;if(!c.silent){for(a in b)this.trigger("change:"+a,this,void 0,c);this.change(c)}return this},fetch:function(c){c||(c={});var a=this,e=c.success;c.success=function(b,d,f){if(!a.set(a.parse(b,f),c))return!1;e&&
e(a,b)};c.error=w(c.error,a,c);return(this.sync||b.sync).call(this,"read",this,c)},save:function(c,a){a||(a={});if(c&&!this.set(c,a))return!1;var e=this,d=a.success;a.success=function(c,b,f){if(!e.set(e.parse(c,f),a))return!1;d&&d(e,c,f)};a.error=w(a.error,e,a);var f=this.isNew()?"create":"update";return(this.sync||b.sync).call(this,f,this,a)},destroy:function(c){c||(c={});if(this.isNew())return this.trigger("destroy",this,this.collection,c);var a=this,e=c.success;c.success=function(b){a.trigger("destroy",
a,a.collection,c);e&&e(a,b)};c.error=w(c.error,a,c);return(this.sync||b.sync).call(this,"delete",this,c)},url:function(){var a=m(this.collection)||this.urlRoot||o();return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this)},isNew:function(){return null==this.id},change:function(a){this.trigger("change",this,a);this._previousAttributes=d.clone(this.attributes);this._changed=!1},hasChanged:function(a){return a?
this._previousAttributes[a]!=this.attributes[a]:this._changed},changedAttributes:function(a){a||(a=this.attributes);var b=this._previousAttributes,e=!1,f;for(f in a)d.isEqual(b[f],a[f])||(e=e||{},e[f]=a[f]);return e},previous:function(a){return!a||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return d.clone(this._previousAttributes)},_performValidation:function(a,b){var e=this.validate(a);return e?(b.error?b.error(this,e,b):this.trigger("error",this,e,b),
!1):!0}});b.Collection=function(a,b){b||(b={});if(b.comparator)this.comparator=b.comparator;d.bindAll(this,"_onModelEvent","_removeReference");this._reset();a&&this.reset(a,{silent:!0});this.initialize.apply(this,arguments)};d.extend(b.Collection.prototype,b.Events,{model:b.Model,initialize:function(){},toJSON:function(){return this.map(function(a){return a.toJSON()})},add:function(a,b){if(d.isArray(a))for(var e=0,f=a.length;e<f;e++)this._add(a[e],b);else this._add(a,b);return this},remove:function(a,
b){if(d.isArray(a))for(var e=0,f=a.length;e<f;e++)this._remove(a[e],b);else this._remove(a,b);return this},get:function(a){return null==a?null:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");this.models=this.sortBy(this.comparator);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return d.map(this.models,
function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});this.each(this._removeReference);this._reset();this.add(a,{silent:!0});b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a||(a={});var d=this,e=a.success;a.success=function(b,f,g){d[a.add?"add":"reset"](d.parse(b,g),a);e&&e(d,b)};a.error=w(a.error,d,a);return(this.sync||b.sync).call(this,"read",this,a)},create:function(a,b){var e=this;b||(b={});a=this._prepareModel(a,b);if(!a)return!1;var d=b.success;b.success=
function(a,c,f){e.add(a,b);d&&d(a,c,f)};a.save(null,b);return a},parse:function(a){return a},chain:function(){return d(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,d){if(a instanceof b.Model){if(!a.collection)a.collection=this}else{var e=a,a=new this.model(e,{collection:this});a.validate&&!a._performValidation(e,d)&&(a=!1)}return a},_add:function(a,b){b||(b={});a=this._prepareModel(a,b);if(!a)return!1;var e=this.getByCid(a);
if(e)throw Error(["Can't add the same model to a set twice",e.id]);this._byId[a.id]=a;this._byCid[a.cid]=a;this.models.splice(null!=b.at?b.at:this.comparator?this.sortedIndex(a,this.comparator):this.length,0,a);a.bind("all",this._onModelEvent);this.length++;b.silent||a.trigger("add",a,this,b);return a},_remove:function(a,b){b||(b={});a=this.getByCid(a)||this.get(a);if(!a)return null;delete this._byId[a.id];delete this._byCid[a.cid];this.models.splice(this.indexOf(a),1);this.length--;b.silent||a.trigger("remove",
a,this,b);this._removeReference(a);return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.unbind("all",this._onModelEvent)},_onModelEvent:function(a,b,e,d){("add"==a||"remove"==a)&&e!=this||("destroy"==a&&this._remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments))}});d.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,rest,last,without,indexOf,lastIndexOf,isEmpty,groupBy".split(","),
function(a){b.Collection.prototype[a]=function(){return d[a].apply(d,[this.models].concat(d.toArray(arguments)))}});b.Router=function(a){a||(a={});if(a.routes)this.routes=a.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var h=/:([\w\d]+)/g,f=/\*([\w\d]+)/g,i=/[-[\]{}()+?.,\\^$|#\s]/g;d.extend(b.Router.prototype,b.Events,{initialize:function(){},route:function(a,f,e){b.history||(b.history=new b.History);d.isRegExp(a)||(a=this._routeToRegExp(a));b.history.route(a,d.bind(function(b){b=
this._extractParameters(a,b);e.apply(this,b);this.trigger.apply(this,["route:"+f].concat(b))},this))},navigate:function(a,d){b.history.navigate(a,d)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,this.routes[b]]);b=0;for(var e=a.length;b<e;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(i,"\\$&").replace(h,"([^/]*)").replace(f,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});
b.History=function(){this.handlers=[];d.bindAll(this,"checkUrl")};var n=/^#*/,t=/msie [\w.]+/,u=!1;d.extend(b.History.prototype,{interval:50,getFragment:function(a,b){if(null==a)if(this._hasPushState||b){var a=window.location.pathname,e=window.location.search;e&&(a+=e);0==a.indexOf(this.options.root)&&(a=a.substr(this.options.root.length))}else a=window.location.hash;return decodeURIComponent(a.replace(n,""))},start:function(a){if(u)throw Error("Backbone.history has already been started");this.options=
d.extend({},{root:"/"},this.options,a);this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var a=this.getFragment(),b=document.documentMode;if(b=t.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b))this.iframe=j('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?j(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!b?j(window).bind("hashchange",
this.checkUrl):setInterval(this.checkUrl,this.interval);this.fragment=a;u=!0;a=window.location;b=a.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;if(this._wantsPushState&&this._hasPushState&&b&&a.hash)this.fragment=a.hash.replace(n,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment);if(!this.options.silent)return this.loadUrl()},
route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.iframe.location.hash));if(a==this.fragment||a==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return d.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,
b){var e=(a||"").replace(n,"");if(!(this.fragment==e||this.fragment==decodeURIComponent(e))){if(this._hasPushState){var d=window.location;0!=e.indexOf(this.options.root)&&(e=this.options.root+e);this.fragment=e;window.history.pushState({},document.title,d.protocol+"//"+d.host+e)}else if(window.location.hash=this.fragment=e,this.iframe&&e!=this.getFragment(this.iframe.location.hash))this.iframe.document.open().close(),this.iframe.location.hash=e;b&&this.loadUrl(a)}}});b.View=function(a){this.cid=d.uniqueId("view");
this._configure(a||{});this._ensureElement();this.delegateEvents();this.initialize.apply(this,arguments)};var v=/^(\S+)\s*(.*)$/,k="model,collection,el,id,attributes,className,tagName".split(",");d.extend(b.View.prototype,b.Events,{tagName:"div",$:function(a){return j(a,this.el)},initialize:function(){},render:function(){return this},remove:function(){j(this.el).remove();return this},make:function(a,b,e){a=document.createElement(a);b&&j(a).attr(b);e&&j(a).html(e);return a},delegateEvents:function(a){if(a||
(a=this.events)){d.isFunction(a)&&(a=a.call(this));j(this.el).unbind(".delegateEvents"+this.cid);for(var b in a){var e=this[a[b]];if(!e)throw Error('Event "'+a[b]+'" does not exist');var f=b.match(v),g=f[1],f=f[2],e=d.bind(e,this),g=g+(".delegateEvents"+this.cid);""===f?j(this.el).bind(g,e):j(this.el).delegate(f,g,e)}}},_configure:function(a){this.options&&(a=d.extend({},this.options,a));for(var b=0,e=k.length;b<e;b++){var f=k[b];a[f]&&(this[f]=a[f])}this.options=a},_ensureElement:function(){if(this.el){if(d.isString(this.el))this.el=
j(this.el).get(0)}else{var a=this.attributes||{};if(this.id)a.id=this.id;if(this.className)a["class"]=this.className;this.el=this.make(this.tagName,a)}}});b.Model.extend=b.Collection.extend=b.Router.extend=b.View.extend=function(a,b){var e=p(this,a,b);e.extend=this.extend;return e};var q={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};b.sync=function(a,f,e){var g=q[a],e=d.extend({type:g,dataType:"json"},e);if(!e.url)e.url=m(f)||o();if(!e.data&&f&&("create"==a||"update"==a))e.contentType=
"application/json",e.data=JSON.stringify(f.toJSON());if(b.emulateJSON)e.contentType="application/x-www-form-urlencoded",e.data=e.data?{model:e.data}:{};if(b.emulateHTTP&&("PUT"===g||"DELETE"===g)){if(b.emulateJSON)e.data._method=g;e.type="POST";e.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",g)}}if("GET"!==e.type&&!b.emulateJSON)e.processData=!1;return j.ajax(e)};var r=function(){},p=function(a,b,e){var f;f=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return a.apply(this,
arguments)};d.extend(f,a);r.prototype=a.prototype;f.prototype=new r;b&&d.extend(f.prototype,b);e&&d.extend(f,e);f.prototype.constructor=f;f.__super__=a.prototype;return f},m=function(a){return!a||!a.url?null:d.isFunction(a.url)?a.url():a.url},o=function(){throw Error('A "url" property or function must be specified');},w=function(a,b,e){return function(d){a?a(b,d,e):b.trigger("error",b,d,e)}}}).call(this);function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}window.Store=function(g){this.name=g;this.records=(g=localStorage.getItem(this.name))&&g.split(",")||[]};
_.extend(Store.prototype,{save:function(){localStorage.setItem(this.name,this.records.join(","))},create:function(g){if(!g.id)g.id=g.attributes.id=guid();localStorage.setItem(this.name+"-"+g.id,JSON.stringify(g));this.records.push(g.id.toString());this.save();return g},update:function(g){localStorage.setItem(this.name+"-"+g.id,JSON.stringify(g));_.include(this.records,g.id.toString())||this.records.push(g.id.toString());this.save();return g},find:function(g){return JSON.parse(localStorage.getItem(this.name+
"-"+g.id))},findAll:function(){return _.map(this.records,function(g){return JSON.parse(localStorage.getItem(this.name+"-"+g))},this)},destroy:function(g){localStorage.removeItem(this.name+"-"+g.id);this.records=_.reject(this.records,function(a){return a==g.id.toString()});this.save();return g}});Backbone.remoteSync=Backbone.sync;
Backbone.sync=function(g,a,b,d){"function"==typeof b&&(b={success:b,error:d});var j,h=a.localStorage||a.collection&&a.collection.localStorage;if(!h)return Backbone.remoteSync(g,a,b,d);switch(g){case "read":j=a.id?h.find(a):h.findAll();break;case "create":j=h.create(a);break;case "update":j=h.update(a);break;case "delete":j=h.destroy(a)}j?b.success(j):b.error("Record not found")};window.Modernizr=function(g,a,b){function d(a,b){var d=a.charAt(0).toUpperCase()+a.substr(1),d=(a+" "+t.join(d+" ")+d).split(" ");return j(d,b)}function j(a,d){for(var f in a)if(n[a[f]]!==b)return"pfx"==d?a[f]:!0;return!1}var h={},f=a.documentElement;a.head||a.getElementsByTagName("head");var i=a.createElement("modernizr"),n=i.style,g=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),t="Webkit Moz O ms Khtml".split(" "),i={},u=[],v=function(b,d,g,c){var h,e,j=a.createElement("div");if(parseInt(g,10))for(;g--;)e=
a.createElement("div"),e.id=c?c[g]:"modernizr"+(g+1),j.appendChild(e);h=["&shy;<style>",b,"</style>"].join("");j.id="modernizr";j.innerHTML+=h;f.appendChild(j);b=d(j,b);j.parentNode.removeChild(j);return!!b},k,q={}.hasOwnProperty,r;typeof q!==b&&typeof q.call!==b?r=function(a,b){return q.call(a,b)}:r=function(a,d){return d in a&&typeof a.constructor.prototype[d]===b};(function(a,b){var d=a.join(""),c=b.length;v(d,function(a){for(var a=a.childNodes,b={};c--;)b[a[c].id]=a[c];h.csstransforms3d=9===b.csstransforms3d.offsetLeft},
c,b)})([,["@media (",g.join("transform-3d),("),"modernizr){#csstransforms3d{left:9px;position:absolute}}"].join("")],[,"csstransforms3d"]);i.csstransforms=function(){return!!j(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])};i.csstransforms3d=function(){var a=!!j(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);a&&"webkitPerspective"in f.style&&(a=h.csstransforms3d);return a};i.csstransitions=function(){return d("transitionProperty")};
for(var p in i)r(i,p)&&(k=p.toLowerCase(),h[k]=i[p](),u.push((h[k]?"":"no-")+k));n.cssText="";i=null;h._version="2.0.6";h._prefixes=g;h._domPrefixes=t;h.testProp=function(a){return j([a])};h.testAllProps=d;h.testStyles=v;return h}(this,this.document);CFW={domain:"http://cfwhiteboard.com"};
jQuery(function(g){g(document.embeds).each(function(){var a=g(this);setTimeout(function(){var b=!1,d=a.attr("wmode");"opaque"!=d&&"transparent"!=d&&(a.attr("wmode","opaque"),b=!0);var j=a.closest("object"),d=j.children("param[name=wmode]").val();"opaque"!=d&&"transparent"!=d&&(j.prepend(g('<param name="wmode" value="opaque" />')),b=!0);b&&(j=j.length?j:a,j.after(g('<span class="cfw-placeholder" />')),j.next().replaceWith(j))},g.browser.msie?300:0)});g("iframe").each(function(){/youtube/.test(this.src)&&!/wmode=transparent/.test(this.src)&&
!/wmode=opaque/.test(this.src)&&(this.src+=(0<=this.src.substring(this.src.lastIndexOf&&this.src.lastIndexOf("/")).indexOf("?")?"&":"?")+"wmode=opaque")})});
jQuery(function(g){g.fn.bindBefore=function(a,b){a=a.split(/\s+/);this.each(function(){for(var d=a.length;d--;){g(this).bind(a[d],b);var j=g.data(this,"events")[a[d]];j.splice(0,0,j.pop())}})};g.fn.oneBefore=function(a,b){a=a.split(/\s+/);this.each(function(){for(var d=a.length;d--;){g(this).one(a[d],b);var j=g.data(this,"events")[a[d]];j.splice(0,0,j.pop())}})}});
jQuery(function(g){if(!Modernizr.csstransitions)Modernizr.csstransforms=!1,Modernizr.csstransforms3d=!1;if(/AppleWebKit/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent))Modernizr.csstransforms3d=!1;if(g.browser.msie&&window.XDomainRequest)jQuery.ajaxSetup({xhr:function(){try{var a=new XDomainRequest;a.timeout=5E3;a.getAllResponseHeaders=function(){return""};var b=function(){var b=new XDomainRequest;b.timeout=a.timeout;b.onload=a.onload;b.onerror=a.onerror;b.ontimeout=a.ontimeout;
b.open(a.openArgs[0],a.openArgs[1]);b.send(a.sendArgs[0])};a.onload=function(){a.onload=a.onerror=a.ontimeout=jQuery.noop;a.status=200;a.statusText="OK";a.readyState=4;a.onreadystatechange&&a.onreadystatechange()};a.onerror=function(){b()};a.ontimeout=function(){b()};a.originalOpen=a.open;a.open=function(b,d){"PUT"===b?(d+="/revise",b="POST"):"DELETE"===b&&(d+="/annihilate",b="POST");a.openArgs=[b,d];a.originalOpen(b,d)};a.originalSend=a.send;a.send=function(b){a.sendArgs=[b];setTimeout(function(){a.originalSend(b)},
0)};return a}catch(d){return jQuery.ajaxSettings.xhr()}}}),jQuery.support.cors=!0;CFW.User=Backbone.Model.extend({defaults:function(){return{email:"",known_as:"",count:0,highlightColor:CFW.User.prototype.randomColor()}},randomColor:function(){return[[255,75,105],[255,105,75],[75,105,255],[105,75,255],[75,255,105],[105,255,75],[123,6,226],[226,6,123],[6,226,123],[6,123,226]][Math.floor(10*Math.random()+0)]}});CFW.UserList=Backbone.Collection.extend({model:CFW.User,initialize:function(){this.localStorage=
new Store("cfw-users");return this},comparator:function(a){return-a.get("count")}});CFW.users=new CFW.UserList;CFW.users.fetch();CFW.Entry=Backbone.Model.extend({defaults:{athlete_id:"",known_as:"",email:"",result:"",rx:!1,mods:"",notes:""},emailRegex:/^\S+@\S+\.\S+$/,validate:function(a){var b=[];!(a.athlete_id||this.attributes&&this.get("athlete_id"))&&!this.emailRegex.test(a.email)&&b.push("email");(!a.result||!a.result.length)&&b.push("result");if(b.length)return b}});CFW.EntryList=Backbone.Collection.extend({model:CFW.Entry,
url:function(){return CFW.domain+"/affiliates/"+this.affiliateId+"/wods/"+this.postId+"/posts"},initialize:function(a,b){this.affiliateId=b.affiliateId;this.postId=b.postId;return this},comparator:function(a){return a.get("known_as").toLowerCase()}});CFW.EntryItemView=Backbone.View.extend({tagName:"tr",template:_.template('            <td class="cfw-known-as"><%- known_as %></td>            <td class="cfw-result"><%- result %></td>            <td class="cfw-mods">                <div>                    <%= rx ? "<strong>Rx</strong> " : "" %><%- mods %><span class="cfw-more <%= notes ? "cfw-notes-hint" : "" %>">&bull;&bull;&bull;</span>                </div>            </td>        '),
events:{click:"showDetail"},initialize:function(){this.model.bind("change",this.render,this);this.model.bind("destroy",this.remove,this);this.model.bind("show",this.lookSelected,this);this.model.bind("unshow",this.unlookSelected,this);return this.render()},render:function(){g(this.el).html(this.template(this.model.toJSON()));return this},lookSelected:function(){g(this.el).addClass("cfw-selected")},unlookSelected:function(){g(this.el);g(this.el).removeClass("cfw-selected")},addHighlight:function(a){g(this.el).addClass("cfw-highlighted").css({backgroundColor:"rgba("+
a.join(",")+",.2)",borderColor:"rgba("+a.join(",")+",.2)"})},removeHighlight:function(){g(this.el).removeClass("cfw-highlighted").css({backgroundColor:"transparent",borderColor:"#888"})},showDetail:function(){this.itemClickDisabled||this.model.trigger("show",this.model)}});CFW.WhiteboardPage=Backbone.View.extend({tagName:"div",className:"cfw-page",show:function(){g(this.el).addClass("active");var a=this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),a.scrollbarReady=!0;a.showScrollbar()},
Modernizr.csstransitions?400:0)},hide:function(){this.freezeScrollbar();var a=g(this.el).removeClass("active"),b=this;setTimeout(function(){b.hideScrollbar();b.thawScrollbar();a.trigger("cfwhide")},Modernizr.csstransitions?300:0)},initScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper({parentSelector:".cfw-window",important:!0,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("show")},
hideScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("hide")},freezeScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("freeze")},thawScrollbar:function(){this.$(".cfw-scrollable").scrollbarPaper("thaw")}});CFW.EntryListView=CFW.WhiteboardPage.extend({template:_.template('            <table cellspacing="0">                <thead>                    <tr>                        <th class="cfw-known-as">Name</th>                        <th class="cfw-result">Entry</th>                        <th class="cfw-mods">Modifications</th>                    </tr>                </thead>            </table>            <div class="cfw-scrollable">                <table cellspacing="0">                    <tbody>                    </tbody>                </table>            </div>        '),
events:{"touchmove .cfw-scrollable":"disableItemClicks","touchstart .cfw-scrollable":"enableItemClicks"},initialize:function(a){this.entries=a.entries;this.entryItemViews=[];this.entries.bind("add",this.addAll,this);this.entries.bind("change:known_as",this.addAll,this);this.entries.bind("remove",this.addAll,this);this.entries.bind("reset",this.addAll,this);CFW.users.bind("reset",this.updateHighlightedUsers,this);CFW.users.bind("change",this.updateHighlightedUsers,this);CFW.users.bind("add",this.addHighlightedUser,
this);CFW.users.bind("remove",this.removeHighlightedUser,this);return this.render()},render:function(){g(this.el).html(this.template());return this},addOne:function(a){a=new CFW.EntryItemView({model:a});this.entryItemViews.push(a);this.$("tbody").append(a.el)},addAll:function(){_.each(this.entryItemViews,function(a,b,d){a.remove();delete d[b]});this.$("tbody").empty();this.entries.length?this.entries.each(this.addOne,this):this.$("tbody").append(g('                    <tr class="cfw-no-entries">                        <td colspan="100">No one has added an entry yet.<br /><a class="cfw-new-entry">Add yours now!<a></td>                    </tr>                '));
this.updateHighlightedUsers()},disableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!0})},enableItemClicks:function(){_.each(this.entryItemViews,function(a){a.itemClickDisabled=!1})},updateHighlightedUsers:function(){this.entries.each(function(a){a.trigger("removeHighlight")});CFW.users.each(this.addHighlightedUser,this)},addHighlightedUser:function(a){_.each(this.entries.select(function(b){return b.get("email").toLowerCase()==a.get("email").toLowerCase()}),function(b){b.trigger("addHighlight",
a.get("highlightColor"))})},removeHighlightedUser:function(a){_.each(this.entries.select(function(b){return b.get("email").toLowerCase()==a.get("email").toLowerCase()}),function(a){a.trigger("removeHighlight")})}});CFW.EntryDetailView=CFW.WhiteboardPage.extend({template:_.template('            <div class="cfw-entry-detail">                <a class="cfw-back">back</a><a class="cfw-edit">edit</a>                <dl class="cfw-scrollable">                    <dt>Name</dt>                    <dd class="cfw-known-as"><%- known_as %></dd>                    <dt>Entry</dt>                    <dd class="cfw-result"><%- result %></dd>                    <dt>Modifications</dt>                    <dd class="cfw-mods"><%= rx ? "<strong>Rx</strong> " : "" %><%- mods %><%= !rx && !mods ? "(no data)" : "" %></dd>                    <dt>Notes</dt>                    <dd class="cfw-notes"><%- notes || "(no data)" %></dd>                </dl>            </div>        '),
events:{"click a.cfw-edit":"edit","click a.cfw-back":"back",cfwhide:"cleanup"},initialize:function(){this.model.bind("change",this.render,this);this.model.bind("destroy",this.hide,this);return this.render()},render:function(){g(this.el).html(this.template(this.model.toJSON()));return this},edit:function(){this.model.trigger("edit",this.model)},back:function(){g(this.el).trigger("hideEntryDetails")},cleanup:function(){var a=this;setTimeout(function(){a.model.trigger("unshow",a.model);a.remove()},0)}});
CFW.EntryFormView=Backbone.View.extend({tagName:"form",className:"cfw-scrollable",template:_.template('            <h2><%= new_record ? "Add Your Entry" : "Edit Your Entry" %></h2>            <label for="cfw-email">Email Address</label>            <input type="email" id="cfw-email" name="email" placeholder="name@example.com" <%= new_record ? "" : \'value="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" disabled="disabled"\' %> />            <div class="cfw-nobr">                <label for="cfw-known-as" class="cfw-half">Name</label><label for="cfw-result" class="cfw-half">Entry</label>            </div>            <div class="cfw-nobr">                <input type="text" id="cfw-known-as" class="cfw-half" name="known_as" placeholder="Guest" value="<%- known_as %>"                /><input type="text" id="cfw-result" class="cfw-half" name="result" placeholder="How\'d you do?" value="<%- result %>" />            </div>            <div class="cfw-nobr">                <label for="cfw-rx" class="cfw-minority">Rx</label><label for="cfw-mods" class="cfw-majority">Modifications</label>            </div>            <div class="cfw-nobr">                <input type="checkbox" id="cfw-rx" class="cfw-minority" name="rx" <%= rx ? \'checked="checked"\' : "" %>                /><span>or</span><input type="text" id="cfw-mods" class="cfw-majority" name="mods" placeholder="How did you scale?" value="<%- mods %>" />            </div>            <div class="cfw-notes <%= notes ? "cfw-open cfw-opaque" : "" %>">                <label for="cfw-notes">Notes</label>                <textarea rows="3" id="cfw-notes" name="notes" placeholder="Notes or Tips for next time?"><%- notes %></textarea>            </div>            <div class="cfw-footer">                <a class="cfw-add-notes <%= notes ? "cfw-hidden" : "" %>"><strong>+</strong> add notes</a>                <input type="submit" value="<%= new_record ? "Submit" : "Save" %>" />                <input type="reset" value="Cancel" />            </div>        '),
events:{'keyup input[name="email"]':"guessName",'change input[name="email"]':"guessName",'blur input[name="known_as"]':"guessName","click .cfw-add-notes":"showNotesFields",submit:"save",'click input[type="reset"]':"remove"},initialize:function(a){this.entries=a.entries;return this.render()},render:function(){g(this.el).attr("action","javascript://").html(this.template(_.extend({new_record:!this.model},(this.model||new CFW.Entry).toJSON())));return this},initScrollbar:function(){g(this.el).scrollbarPaper({parentSelector:".cfw-window",
important:!0,show:function(a){a.removeClass("cfw-hidden")},hide:function(a){a.addClass("cfw-hidden")}})},showScrollbar:function(){g(this.el).scrollbarPaper("show")},hideScrollbar:function(){g(this.el).scrollbarPaper("hide")},freezeScrollbar:function(){g(this.el).scrollbarPaper("freeze")},thawScrollbar:function(){g(this.el).scrollbarPaper("thaw")},guessName:function(){var a=this.$('input[name="email"]'),b=this.$('input[name="known_as"]');if(!(b.val().length&&this.lastGuess&&b.val()!=this.lastGuess||
b.val().length&&!this.lastGuess)){var d=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.val().toLowerCase()});if(d)b.val(this.lastGuess=d.get("known_as"));else{var d=a.val(),g=d.indexOf("@");if(!_.capitalize)_.capitalize=function(a){return a.substring(0,1).toUpperCase()+a.substring(1)};b.val(this.lastGuess=-1==g?_.capitalize(d):_.capitalize(d.substring(0,g)))}}},showNotesFields:function(){var a=this.$(".cfw-notes").addClass("cfw-open"),b=this.$(".cfw-add-notes").addClass("cfw-transparent");
setTimeout(function(){a.addClass("cfw-opaque");b.addClass("cfw-hidden")},Modernizr.csstransitions?200:0)},save:function(a){a.preventDefault();if(!this.isLoading()){var a={result:this.$('input[name="result"]').val(),email:this.$('input[name="email"]').val(),known_as:this.$('input[name="known_as"]').val(),rx:this.$('input[name="rx"]').is(":checked"),mods:this.$('input[name="mods"]').val(),notes:this.$('textarea[name="notes"]').val()},b=this;b.showLoading();b.$(".ajax-error-notice").remove();var d={success:function(){b.hideLoading();
b.remove()},error:function(a,d){b.hideLoading();d&&d.length?b.showValidationErrors(d):b.$(".cfw-footer").after(g('<label class="cfw-invalid ajax-error-notice" style="text-align:center;line-height:1.2;">Oops! There was a problem connecting to the server.  Click <strong>'+b.$('input[type="submit"]').val()+"</strong> to try again or contact athlete support if the problem persists.</label>"))}};this.model?this.model.save(a,d):this.entries.create(a,d)||this.showValidationErrors(CFW.Entry.prototype.validate(a))}},
show:function(){Modernizr.csstransforms3d?g(this.el).addClass("cfw-translate3d"):Modernizr.csstransforms?g(this.el).addClass("cfw-translate"):g(this.el).addClass("cfw-translate-oldfashioned");var a=this;setTimeout(function(){if(!a.scrollbarReady)a.initScrollbar(),a.scrollbarReady=!0;a.showScrollbar()},Modernizr.csstransitions?300:0)},showLoading:function(){this.$('input[type="submit"]').addClass("loading")},isLoading:function(){return this.$('input[type="submit"]').hasClass("loading")},hideLoading:function(){this.$('input[type="submit"]').removeClass("loading").removeAttr("disabled")},
showValidationErrors:function(a){var b=this;_.each(a,function(a){b.$('input[name="'+a+'"]').addClass("cfw-invalid").each(function(){g('label[for="'+g(this).attr("id")+'"]').addClass("cfw-invalid")}).one("keydown change",function(){g(this).removeClass("cfw-invalid");g('label[for="'+g(this).attr("id")+'"]').removeClass("cfw-invalid")})})},remove:function(){function a(){b.hideScrollbar();g(b.el).trigger("cfwremove").remove()}this.freezeScrollbar();var b=this;Modernizr.csstransforms3d||Modernizr.csstransforms?
(g(this.el).removeClass("cfw-translate3d cfw-translate"),setTimeout(a,300)):(g(this.el).removeClass("cfw-translate-oldfashioned"),setTimeout(a,Modernizr.csstransitions?300:0))}});CFW.WhiteboardView=Backbone.View.extend({template:_.template('            <h1>Whiteboard<span class="cfw-entry-count"></span></h1>            <div class="cfw-pane">                <a class="cfw-print cfw-admin-tool cfw-hidden" target="_blank">Print</a>                <div>                    <div class="cfw-window">                        <h2>WOD Entries</h2>                        <a class="cfw-new-entry">+</a>                        <div class="cfw-contents"></div>                        <div class="cfw-footer">                            <a href="http://cfwhiteboard.com" target="_blank">                                What Is This?                            </a><a href="mailto:athletesupport@cfwhiteboard.com">                                Email Athlete Support                            </a>                        </div>                    </div>                </div>            </div>            <div class="cfw-preload-images">                <span class="cfw-metal-tile-jpg"></span>                <span class="cfw-white-water-paper-jpg"></span>                <span class="cfw-loading-gif"></span>            </div>        '),
events:{"click h1":"toggleWhiteboard","click .cfw-new-entry:not([disabled])":"newEntry",hideEntryDetails:"hideEntry","cfwremove form":"cleanupEntryForm"},initialize:function(){var a=g(this.el);this.affiliateId=a.data("affiliateId")||a.data("affiliate-id");this.postId=a.data("postId")||a.data("post-id");if(!(-1<_.indexOf(_.pluck(CFW.instances,"postId"),this.postId)))this.entries=new CFW.EntryList([],{affiliateId:this.affiliateId,postId:this.postId}),this.entries.bind("add",this.updateEntryCount,this),
this.entries.bind("remove",this.updateEntryCount,this),this.entries.bind("reset",this.updateEntryCount,this),this.entries.bind("edit",this.editEntry,this),this.entries.bind("show",this.showEntry,this),this.entries.bind("add",this.updateUsers,this),this.entries.bind("change:known_as",this.updateUsers,this),this.render(),this.entries.fetch()},render:function(){var a=g(this.el).html(this.template());this.entryListView=new CFW.EntryListView({entries:this.entries});this.$(".cfw-contents").append(this.entryListView.el);
this.entryListView.show();"admin"==a.data("authorization")&&(this.$(".cfw-print").attr("href",this.entries.url()),this.$(".cfw-admin-tool").removeClass("cfw-hidden"));return this},toggleWhiteboard:function(a){g(this.el).is(".cfw-active")?this.closeWhiteboard():this.openWhiteboard();a.preventDefault()},openWhiteboard:function(){g(this.el).addClass("cfw-active").removeClass("cfw-postactive")},closeWhiteboard:function(){var a=g(this.el).addClass("cfw-postactive").removeClass("cfw-active");setTimeout(function(){a.removeClass("cfw-postactive")},
Modernizr.csstransitions?300:0)},newEntry:function(){var a=new CFW.EntryFormView({entries:this.entries});this.$(".cfw-contents").append(a.el);var b=this;setTimeout(function(){b.disableNewEntries();a.show();setTimeout(function(){b.detailView?b.detailView.hideScrollbar():b.entryListView.hideScrollbar()},Modernizr.csstransitions?300:0)},0)},editEntry:function(a){var b=new CFW.EntryFormView({entries:this.entries,model:a});this.$(".cfw-contents").append(b.el);var d=this;setTimeout(function(){d.disableNewEntries();
b.show();setTimeout(function(){d.detailView?d.detailView.hideScrollbar():d.entryListView.hideScrollbar()},Modernizr.csstransitions?300:0)},0)},cleanupEntryForm:function(){this.enableNewEntries();this.detailView?this.detailView.showScrollbar():this.entryListView.showScrollbar()},disableNewEntries:function(){g(this.el).find(".cfw-new-entry").attr("disabled",!0)},enableNewEntries:function(){g(this.el).find(".cfw-new-entry").removeAttr("disabled")},showEntry:function(a){this.detailView=new CFW.EntryDetailView({model:a});
this.$(".cfw-contents").append(this.detailView.el);var b=this;setTimeout(function(){b.detailView.show();b.entryListView.hide()},0)},hideEntry:function(){this.entryListView.show();this.detailView.hide();var a=this;setTimeout(function(){delete a.detailView},Modernizr.csstransitions?400:100)},updateEntryCount:function(){this.$(".cfw-entry-count").text("("+this.entries.length+")")},updateUsers:function(a){var b=CFW.users.find(function(b){return b.get("email").toLowerCase()==a.get("email").toLowerCase()});
b?b.save({known_as:a.get("known_as"),count:b.get("count")+1}):b=CFW.users.create({email:a.get("email"),known_as:a.get("known_as"),count:1})}});CFW.instances=[];g(".cfwhiteboard").each(function(){var a=g(this),b=a.closest("a");b.length&&b.before(a);if("undefined"!=typeof CFW_POSITION){b=a.closest(CFW_POSITION.parent).find(CFW_POSITION.target);if(b.length)switch(CFW_POSITION.insertion){case "append":b.append(a);break;case "before":b.before(a);break;case "after":b.after(a);break;default:b.prepend(a)}switch(CFW_POSITION.alignment){case "inline":a.addClass("position-inline");
break;case "block":a.addClass("position-block");break;case "floatleft":a.addClass("position-floatleft")}CFW_POSITION.margin&&a.css({margin:CFW_POSITION.margin})}CFW.instances.push(new CFW.WhiteboardView({el:a}))});_.each(CFW.instances,function(a){g(a.el).bind("click",function(a){a.stopPropagation()})});g("body").bind("click",function(){_.each(CFW.instances,function(a){a.closeWhiteboard()})})});
